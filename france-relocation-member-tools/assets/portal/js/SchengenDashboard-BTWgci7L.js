import{j as e}from"./vendor-query-D8MH73Ff.js";import{r as h}from"./vendor-react-F9Y4d3HK.js";import{a as j}from"./vendor-utils-C5RVuWu4.js";import{c as G,aH as Te,aI as De,aJ as Ee,aK as Pe,aL as Le,aM as Ie,A as T,a2 as R,b as A,B as M,F as ge,aN as Me,aO as Ae,C as U,O as Y,ax as pe,ah as ye,aP as Fe,l as H,X as te,aQ as ze,aR as be,aS as $,aT as Oe,aU as Re,a3 as Ue,aV as He,aW as We,a as je,Z as fe,aX as _e,aY as Ye,ae as $e,P as Ge,Y as ie}from"./main-DoY2Q5Kx.js";import{X as Be}from"./x-circle-rLl-szUK.js";import{A as Q}from"./alert-circle-DhimSPVV.js";import{B as Ve}from"./briefcase-a9aIED45.js";import{T as se}from"./trash-2-BPJBJ1WN.js";import{C as Ke}from"./chevron-up-DnBbFAJZ.js";import{C as Ze}from"./chevron-down-b5EhxsMv.js";import{L as I}from"./loader-2-DHeZl5zm.js";import{P as ae}from"./plane-CKBWjcdG.js";import{D as qe}from"./download-BWroa7Ap.js";import{C as K,L as le}from"./lock-BU_q15FB.js";import{S as Je}from"./send-BUz2namD.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=G("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=G("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=G("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=G("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=G("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),tt={yellowThreshold:60,redThreshold:80,emailAlerts:!1,upcomingTripReminders:!0};function st(){const{data:t=[],isLoading:s,isError:r}=Te(),{data:a=tt,isLoading:i}=De(),n=Ee(),l=Pe(),d=Le(),o=Ie(),c=!s&&!i,u=r,f=h.useMemo(()=>[...t].sort((b,N)=>new Date(N.startDate).getTime()-new Date(b.startDate).getTime()),[t]),p=h.useCallback(b=>n.mutateAsync(b),[n]),w=h.useCallback((b,N)=>l.mutateAsync({id:b,data:N}),[l]),y=h.useCallback(b=>d.mutateAsync(b),[d]),g=h.useCallback(b=>o.mutateAsync(b),[o]),m=n.isPending||l.isPending||d.isPending||o.isPending;return{trips:f,settings:a,isLoaded:c,isError:u,isSaving:m,addTrip:p,updateTrip:w,deleteTrip:y,updateSettings:g}}const re=90,q=180;function P(t){if(t instanceof Date){const s=t.toISOString().split("T")[0];return new Date(s+"T00:00:00Z")}return new Date(t+"T00:00:00Z")}function J(){const s=new Date().toISOString().split("T")[0];return new Date(s+"T00:00:00Z")}function O(t){return t.toISOString().split("T")[0]}function Ne(t,s=J()){const r=P(s),a=new Date(r.getTime()-(q-1)*24*60*60*1e3),i=new Set;return t.forEach(n=>{const l=P(n.startDate),d=P(n.endDate);if(l>r)return;const o=l<a?a:l,c=d>r?r:d;if(o<=c){const u=new Date(o);for(;u<=c;)i.add(O(u)),u.setTime(u.getTime()+24*60*60*1e3)}}),i.size}function at(t,s=J()){const r=P(s),a=new Date(r.getTime()-(q-1)*24*60*60*1e3),i=new Set;return t.forEach(n=>{const l=P(n.startDate),d=P(n.endDate);if(l>r)return;const o=l<a?a:l,c=d>r?r:d;if(o<=c){const u=new Date(o);for(;u<=c;)i.add(O(u)),u.setTime(u.getTime()+24*60*60*1e3)}}),i}function rt(t,s={yellow:60,red:80}){return t>=re?"critical":t>=s.red?"danger":t>=s.yellow?"warning":"safe"}function nt(t,s=J()){const r=at(t,s);if(r.size===0)return null;const i=Array.from(r).sort()[0],n=P(i);return n.setTime(n.getTime()+q*24*60*60*1e3),O(n)}function it(t,s={yellow:60,red:80}){const r=J(),a=Ne(t,r),i=Math.max(0,re-a),n=r,l=new Date(r.getTime()-(q-1)*24*60*60*1e3);return{daysUsed:a,daysRemaining:i,windowStart:O(l),windowEnd:O(n),status:rt(a,s),nextExpiration:nt(t,r),statusThresholds:s}}function we(t,s){const r=P(t),a=P(s),i=Math.abs(a.getTime()-r.getTime());return Math.floor(i/(1e3*60*60*24))+1}function _(t){return we(t.startDate,t.endDate)}function lt(t,s,r){const a=P(s),i=P(r),n=new Date(a);let l=0;for(;n<=i;){const d={id:"temp",startDate:s,endDate:O(n),country:"France",category:"personal",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},o=[...t,d],c=Ne(o,n);if(l=Math.max(l,c),c>re)return{wouldViolate:!0,projectedDaysUsed:c,earliestSafeEntry:null,maxTripLength:null,message:`This trip would exceed the 90-day limit on ${O(n)} with ${c} days used.`};n.setTime(n.getTime()+24*60*60*1e3)}return{wouldViolate:!1,projectedDaysUsed:l,earliestSafeEntry:s,maxTripLength:we(s,r),message:`This trip is safe. Maximum days used during trip: ${l}/90.`}}function F(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function ot(t,s){const r=new Date(t),a=new Date(s);return t===s?F(t):r.getMonth()===a.getMonth()&&r.getFullYear()===a.getFullYear()?`${r.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.getDate()}, ${a.getFullYear()}`:r.getFullYear()===a.getFullYear()?`${r.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}, ${a.getFullYear()}`:`${F(t)} - ${F(s)}`}const dt={safe:{stroke:"stroke-green-500",text:"text-green-600",bg:"bg-green-50"},warning:{stroke:"stroke-yellow-500",text:"text-yellow-600",bg:"bg-yellow-50"},danger:{stroke:"stroke-orange-500",text:"text-orange-600",bg:"bg-orange-50"},critical:{stroke:"stroke-red-500",text:"text-red-600",bg:"bg-red-50"}},ct={sm:{container:"w-24 h-24",svgSize:96,strokeWidth:6,radius:42,textSize:"text-2xl",labelSize:"text-xs"},md:{container:"w-36 h-36",svgSize:144,strokeWidth:8,radius:64,textSize:"text-4xl",labelSize:"text-sm"},lg:{container:"w-48 h-48",svgSize:192,strokeWidth:10,radius:86,textSize:"text-5xl",labelSize:"text-base"}};function mt({daysUsed:t,daysRemaining:s,status:r,size:a="md",className:i}){const n=dt[r],l=ct[a],d=Math.min(t/90*100,100),o=2*Math.PI*l.radius,c=o-d/100*o;return e.jsxs("div",{className:j("relative inline-flex",l.container,i),children:[e.jsxs("svg",{className:"transform -rotate-90",width:l.svgSize,height:l.svgSize,"aria-hidden":"true",children:[e.jsx("circle",{cx:l.svgSize/2,cy:l.svgSize/2,r:l.radius,fill:"none",strokeWidth:l.strokeWidth,className:"stroke-gray-200"}),e.jsx("circle",{cx:l.svgSize/2,cy:l.svgSize/2,r:l.radius,fill:"none",strokeWidth:l.strokeWidth,strokeLinecap:"round",strokeDasharray:o,strokeDashoffset:c,className:j("transition-all duration-500",n.stroke)})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:j("font-bold",l.textSize,n.text),"aria-label":`${t} days used`,children:t}),e.jsx("span",{className:j("text-gray-500",l.labelSize),children:"of 90 days"})]}),e.jsx("div",{role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":90,"aria-label":`Schengen days: ${t} used, ${s} remaining`,className:"sr-only"})]})}const xt={safe:{label:"Safe",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200",Icon:R},warning:{label:"Warning",bgColor:"bg-yellow-50",textColor:"text-yellow-700",borderColor:"border-yellow-200",Icon:T},danger:{label:"Danger",bgColor:"bg-orange-50",textColor:"text-orange-700",borderColor:"border-orange-200",Icon:Q},critical:{label:"Critical",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200",Icon:Be}},ut={sm:{badge:"px-2 py-0.5 text-xs",icon:"w-3 h-3"},md:{badge:"px-2.5 py-1 text-sm",icon:"w-4 h-4"},lg:{badge:"px-3 py-1.5 text-base",icon:"w-5 h-5"}};function ht({status:t,showLabel:s=!0,size:r="md",className:a}){const i=xt[t],n=ut[r],l=i.Icon;return e.jsxs("span",{className:j("inline-flex items-center gap-1 rounded-full border font-medium",i.bgColor,i.textColor,i.borderColor,n.badge,a),children:[e.jsx(l,{className:n.icon,"aria-hidden":"true"}),s&&e.jsx("span",{children:i.label})]})}const gt=["Austria","Belgium","Bulgaria","Croatia","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Italy","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland"];function oe({trip:t,existingTrips:s,onSubmit:r,onCancel:a,className:i}){const n=!!t,[l,d]=h.useState((t==null?void 0:t.startDate)||""),[o,c]=h.useState((t==null?void 0:t.endDate)||""),[u,f]=h.useState((t==null?void 0:t.country)||"France"),[p,w]=h.useState((t==null?void 0:t.category)||"personal"),[y,g]=h.useState((t==null?void 0:t.notes)||""),[m,b]=h.useState(null),[N,S]=h.useState(null);h.useEffect(()=>{if(l&&o){const x=n?s.filter(X=>X.id!==t.id):s,v=lt(x,l,o);v.wouldViolate?b(v.message):v.projectedDaysUsed>=80?b(`This trip will bring you to ${v.projectedDaysUsed}/90 days - approaching the limit.`):v.projectedDaysUsed>=60?b(`This trip will bring you to ${v.projectedDaysUsed}/90 days.`):b(null)}else b(null)},[l,o,s,n,t]);const D=x=>{if(x.preventDefault(),S(null),!l||!o){S("Please enter both start and end dates.");return}if(new Date(o)<new Date(l)){S("End date must be on or after start date.");return}if(_({startDate:l,endDate:o})>90){S("A single trip cannot exceed 90 days.");return}r({startDate:l,endDate:o,country:u,category:p,notes:y.trim()||void 0})},k=l&&o?_({startDate:l,endDate:o}):null;return e.jsxs("form",{onSubmit:D,className:j("space-y-4",i),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(A,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Start Date"]}),e.jsx("input",{type:"date",id:"startDate",value:l,onChange:x=>d(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(A,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"End Date"]}),e.jsx("input",{type:"date",id:"endDate",value:o,onChange:x=>c(x.target.value),min:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]})]}),k!==null&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg",children:["Duration: ",e.jsxs("span",{className:"font-medium",children:[k," day",k!==1?"s":""]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(M,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Country"]}),e.jsx("select",{id:"country",value:u,onChange:x=>f(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:gt.map(x=>e.jsx("option",{value:x,children:x},x))})]}),e.jsxs("div",{role:"radiogroup","aria-labelledby":"category-label",children:[e.jsxs("span",{id:"category-label",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Ve,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Category"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"personal",checked:p==="personal",onChange:()=>w("personal"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Personal"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"business",checked:p==="business",onChange:()=>w("business"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Business"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ge,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Notes (optional)"]}),e.jsx("textarea",{id:"notes",value:y,onChange:x=>g(x.target.value),rows:2,placeholder:"e.g., Visa appointment, apartment hunting...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-none"})]}),m&&e.jsxs("div",{className:"flex gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(T,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-amber-800",children:m})]}),N&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:N})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-primary-600 hover:bg-primary-700 rounded-lg font-medium transition-colors",children:n?"Save Changes":"Add Trip"})]})]})}function pt({trips:t,currentWindowStart:s,onEdit:r,onDelete:a,className:i}){const[n,l]=h.useState("date"),[d,o]=h.useState("desc"),[c,u]=h.useState(null),f=m=>{n===m?o(b=>b==="asc"?"desc":"asc"):(l(m),o("desc"))},p=[...t].sort((m,b)=>{let N=0;switch(n){case"date":N=new Date(m.startDate).getTime()-new Date(b.startDate).getTime();break;case"country":N=m.country.localeCompare(b.country);break;case"duration":N=_(m)-_(b);break}return d==="asc"?N:-N}),w=m=>new Date(m.endDate)>=new Date(s),y=m=>{c===m?(a(m),u(null)):(u(m),setTimeout(()=>u(null),3e3))};if(t.length===0)return e.jsxs("div",{className:j("text-center py-12",i),children:[e.jsx(M,{className:"w-12 h-12 text-gray-300 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No trips recorded"}),e.jsx("p",{className:"text-gray-500",children:"Add your first trip to start tracking your Schengen days."})]});const g=({field:m})=>n!==m?null:d==="asc"?e.jsx(Ke,{className:"w-4 h-4"}):e.jsx(Ze,{className:"w-4 h-4"});return e.jsxs("div",{className:j("overflow-hidden",i),children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-3 bg-gray-50 border-b border-gray-200 text-sm font-medium text-gray-600",children:[e.jsxs("button",{onClick:()=>f("date"),className:"col-span-4 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(A,{className:"w-4 h-4","aria-hidden":"true"}),"Dates",e.jsx(g,{field:"date"})]}),e.jsxs("button",{onClick:()=>f("country"),className:"col-span-3 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(M,{className:"w-4 h-4","aria-hidden":"true"}),"Country",e.jsx(g,{field:"country"})]}),e.jsxs("button",{onClick:()=>f("duration"),className:"col-span-2 flex items-center gap-1 text-left hover:text-gray-900",children:["Days",e.jsx(g,{field:"duration"})]}),e.jsx("div",{className:"col-span-3 text-right",children:"Actions"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:p.map(m=>{const b=_(m),N=w(m);return e.jsxs("div",{className:j("grid grid-cols-12 gap-4 px-4 py-3 items-center",N?"bg-white":"bg-gray-50 opacity-75"),children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:ot(m.startDate,m.endDate)}),m.notes&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:m.notes})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("span",{className:"text-sm text-gray-700",children:m.country}),e.jsx("span",{className:j("ml-2 text-xs px-1.5 py-0.5 rounded",m.category==="business"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"),children:m.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:[b," day",b!==1?"s":""]}),!N&&e.jsx("span",{className:"block text-xs text-gray-400",children:"outside window"})]}),e.jsxs("div",{className:"col-span-3 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>r(m),className:"p-2 text-gray-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors","aria-label":`Edit trip to ${m.country}`,children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(m.id),className:j("p-2 rounded-lg transition-colors",c===m.id?"text-white bg-red-600 hover:bg-red-700":"text-gray-400 hover:text-red-600 hover:bg-red-50"),"aria-label":c===m.id?"Confirm delete":`Delete trip to ${m.country}`,children:e.jsx(se,{className:"w-4 h-4"})})]})]},m.id)})})]})}function yt(){const[t,s]=h.useState(""),[r,a]=h.useState(""),[i,n]=h.useState(null),l=Ae(),d=()=>{!t||!r||l.mutate({startDate:t,endDate:r},{onSuccess:u=>{n(u)}})},o=()=>{s(""),a(""),n(null)},c=t&&r&&new Date(r)>=new Date(t);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(Z,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Trip Planning Tool"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Check if a planned trip would violate the 90/180 rule"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-start-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-start-date",value:t,onChange:u=>s(u.target.value),className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-end-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-end-date",value:r,onChange:u=>a(u.target.value),min:t,className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:d,disabled:!c||l.isPending,className:j("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",c&&!l.isPending?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"}),"Check Trip"]})}),i&&e.jsx("button",{onClick:o,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Reset"})]}),i&&e.jsx("div",{className:j("rounded-lg p-4 border",i.wouldViolate?"bg-red-50 border-red-200":"bg-green-50 border-green-200"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[i.wouldViolate?e.jsx(T,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}):e.jsx(U,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:j("font-semibold",i.wouldViolate?"text-red-800":"text-green-800"),children:i.wouldViolate?"This trip would violate the 90/180 rule":"This trip is safe"}),e.jsx("p",{className:j("text-sm mt-1",i.wouldViolate?"text-red-700":"text-green-700"),children:i.wouldViolate?`You would exceed the limit by ${i.daysOverLimit} day${i.daysOverLimit!==1?"s":""}.`:`You would use ${i.maxDaysUsed} of your 90 days.`}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Trip Length"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[i.proposedLength," day",i.proposedLength!==1?"s":""]})]}),e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Max Days Used"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:i.maxDaysUsed})]})]}),i.wouldViolate&&e.jsxs("div",{className:"mt-4 space-y-3",children:[i.earliestSafeDate&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Earliest safe start date:"})," ",F(i.earliestSafeDate)]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsxs("span",{className:"font-medium",children:["Max safe trip length from ",F(t),":"]})," ",i.maxSafeLength," day",i.maxSafeLength!==1?"s":""]})]})]})]})]})}),l.isError&&e.jsx("div",{className:"rounded-lg p-4 bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(T,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("p",{className:"text-sm",children:"Failed to simulate trip. Please try again."})]})})]})}const bt=["S","M","T","W","T","F","S"],jt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ft=["January","February","March","April","May","June","July","August","September","October","November","December"],Nt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function wt({trips:t,windowStart:s,windowEnd:r}){const a=h.useMemo(()=>new Date().toISOString().split("T")[0],[]),i=h.useMemo(()=>new Date(a),[a]),[n,l]=h.useState(i.getMonth()),[d,o]=h.useState(i.getFullYear()),c=h.useMemo(()=>{const y=new Map;return t.forEach(g=>{const m=new Date(g.startDate),b=new Date(g.endDate),N=new Date(m);for(;N<=b;){const S=N.toISOString().split("T")[0];y.set(S,g),N.setDate(N.getDate()+1)}}),y},[t]),u=h.useMemo(()=>{const y=[],g=new Date(d,n,1),m=new Date(d,n+1,0),b=new Date(s),N=new Date(r),S=g.getDay();for(let k=S-1;k>=0;k--){const x=new Date(d,n,-k),v=x.toISOString().split("T")[0];y.push({date:x,isCurrentMonth:!1,isToday:!1,isInWindow:x>=b&&x<=N,trip:c.get(v)||null,isFuture:x>i})}for(let k=1;k<=m.getDate();k++){const x=new Date(d,n,k),v=x.toISOString().split("T")[0];y.push({date:x,isCurrentMonth:!0,isToday:v===a,isInWindow:x>=b&&x<=N,trip:c.get(v)||null,isFuture:x>i})}const D=6-m.getDay();for(let k=1;k<=D;k++){const x=new Date(d,n+1,k),v=x.toISOString().split("T")[0];y.push({date:x,isCurrentMonth:!1,isToday:!1,isInWindow:x>=b&&x<=N,trip:c.get(v)||null,isFuture:x>i})}return y},[n,d,c,s,r,i,a]),f=()=>{n===0?(l(11),o(d-1)):l(n-1)},p=()=>{n===11?(l(0),o(d+1)):l(n+1)},w=()=>{l(i.getMonth()),o(i.getFullYear())};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:f,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Previous month",children:e.jsx(pe,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsx("button",{onClick:p,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Next month",children:e.jsx(ye,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-gray-900 ml-1 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline",children:ft[n]}),e.jsx("span",{className:"sm:hidden",children:Nt[n]})," ",d]})]}),e.jsx("button",{onClick:w,className:"px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",children:"Today"})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200",children:jt.map((y,g)=>e.jsxs("div",{className:"py-1.5 sm:py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("span",{className:"hidden sm:inline",children:y}),e.jsx("span",{className:"sm:hidden",children:bt[g]})]},y))}),e.jsx("div",{className:"grid grid-cols-7",children:u.map((y,g)=>{const{date:m,isCurrentMonth:b,isToday:N,isInWindow:S,trip:D,isFuture:k}=y;return e.jsxs("div",{className:j("relative min-h-[44px] sm:min-h-[60px] p-0.5 sm:p-1 border-b border-r border-gray-100",!b&&"bg-gray-50",N&&"bg-primary-50"),children:[e.jsx("span",{className:j("inline-flex items-center justify-center w-5 h-5 sm:w-6 sm:h-6 text-xs sm:text-sm rounded-full",N&&"bg-primary-600 text-white font-medium",!N&&b&&"text-gray-900",!N&&!b&&"text-gray-400"),children:m.getDate()}),D&&e.jsxs("div",{className:j("mt-0.5 sm:mt-1 px-0.5 sm:px-1 py-0.5 rounded text-[10px] sm:text-xs truncate",k?"bg-blue-100 text-blue-700 border border-dashed border-blue-300":S?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600"),title:`${D.country}${k?" (planned)":""}`,children:[e.jsx(ae,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 inline-block sm:mr-0.5","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Trip to "}),e.jsx("span",{className:"hidden sm:inline",children:D.country.slice(0,3)})]}),S&&!D&&b&&e.jsx("div",{className:"absolute bottom-0.5 sm:bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-green-400",title:"In current 180-day window"})]},g)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 p-2 sm:p-3 border-t border-gray-200 text-[10px] sm:text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-primary-100 border border-primary-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (in window)"}),e.jsx("span",{className:"sm:hidden",children:"In window"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-blue-100 border border-dashed border-blue-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Future trip"}),e.jsx("span",{className:"sm:hidden",children:"Future"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-gray-100 border border-gray-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (outside window)"}),e.jsx("span",{className:"sm:hidden",children:"Outside"})]})]})]})}function vt({disabled:t}){const[s,r]=h.useState(!1),[a,i]=h.useState(null),n=h.useRef(null),l=Fe(),d=()=>{l.mutate(void 0,{onSuccess:f=>{i(f),r(!0)}})},o=()=>{var f;(f=n.current)!=null&&f.contentWindow&&n.current.contentWindow.print()},c=()=>{if(!a)return;const f=new Blob([a.html],{type:"text/html"}),p=URL.createObjectURL(f),w=document.createElement("a");w.href=p,w.download=a.filename.replace(".pdf",".html"),document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(p)},u=()=>{r(!1),i(null)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:d,disabled:t||l.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Export Schengen report as PDF",children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4","aria-hidden":"true"}),"Export Report"]})}),e.jsx(H,{isOpen:s,onClose:u,title:"Schengen Report Preview",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.summary)&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.daysUsed}),e.jsx("p",{className:"text-xs text-gray-500",children:"Days Used"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.daysRemaining}),e.jsx("p",{className:"text-xs text-gray-500",children:"Remaining"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:a.summary.status}),e.jsx("p",{className:"text-xs text-gray-500",children:"Status"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.tripCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Trips"})]})]}),(a==null?void 0:a.html)&&e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",style:{height:"400px"},children:e.jsx("iframe",{ref:n,srcDoc:a.html,title:"Report Preview",className:"w-full h-full",sandbox:"allow-same-origin"})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Close"}),e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(qe,{className:"w-4 h-4","aria-hidden":"true"}),"Download HTML"]}),e.jsxs("button",{onClick:o,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700",children:[e.jsx(et,{className:"w-4 h-4","aria-hidden":"true"}),"Print / Save as PDF"]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:`Tip: Use your browser's "Print to PDF" option to save as a PDF file`})]})}),l.isError&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-50 border border-red-200 rounded-lg p-4 shadow-lg flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-red-800",children:"Failed to generate report. Please try again."}),e.jsx("button",{onClick:()=>l.reset(),className:"text-red-600 hover:text-red-800","aria-label":"Dismiss error",children:e.jsx(te,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}const St={enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4};function ve(t={}){const s={...St,...t},[r,a]=h.useState(null),[i,n]=h.useState(null),[l,d]=h.useState(!1),[o,c]=h.useState("prompt"),u=typeof navigator<"u"&&"geolocation"in navigator;h.useEffect(()=>{if(!u){c("unavailable");return}"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(w=>{c(w.state),w.addEventListener("change",()=>{c(w.state)})}).catch(()=>{c("prompt")})},[u]);const f=h.useCallback(()=>new Promise((w,y)=>{if(!u){const g={code:0,message:"Geolocation is not supported by this browser."};n(g),y(g);return}d(!0),n(null),navigator.geolocation.getCurrentPosition(g=>{const m={lat:g.coords.latitude,lng:g.coords.longitude,accuracy:g.coords.accuracy,timestamp:g.timestamp};a(m),n(null),d(!1),c("granted"),w(m)},g=>{const m={code:g.code,message:kt(g.code)};n(m),d(!1),g.code===g.PERMISSION_DENIED&&c("denied"),y(m)},{enableHighAccuracy:s.enableHighAccuracy,timeout:s.timeout,maximumAge:s.maximumAge})}),[u,s.enableHighAccuracy,s.timeout,s.maximumAge]),p=h.useCallback(()=>{a(null),n(null)},[]);return{position:r,error:i,isLoading:l,permission:o,isSupported:u,getCurrentPosition:f,clearPosition:p}}function kt(t){switch(t){case 1:return"Location permission denied. Please enable location access in your browser settings.";case 2:return"Unable to determine your location. Please try again.";case 3:return"Location request timed out. Please try again.";default:return"An unknown error occurred while getting your location."}}function de({compact:t=!1}){const[s,r]=h.useState(!1),[a,i]=h.useState(!1),{error:n,isLoading:l,permission:d,isSupported:o,getCurrentPosition:c}=ve(),{data:u,isLoading:f}=ze(),p=be(),w=h.useCallback(async()=>{try{const b=await c();await p.mutateAsync({lat:b.lat,lng:b.lng,accuracy:b.accuracy,source:"checkin"})}catch(b){console.error("Check-in failed:",b)}},[c,p]),y=(u==null?void 0:u.hasCheckedInToday)??!1,g=u==null?void 0:u.lastLocation,m=l||p.isPending;return t?e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:j("p-2 rounded-lg",y?"bg-green-100":"bg-gray-100"),children:e.jsx(M,{className:j("w-5 h-5",y?"text-green-600":"text-gray-500"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Location Check-in"}),y&&g?e.jsxs("p",{className:"text-xs text-green-600",children:["Checked in: ",g.countryName??"Unknown",g.isSchengen&&" (Schengen)"]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Not checked in today"})]})]}),e.jsx("button",{onClick:w,disabled:m||!o,className:j("inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",m?"bg-gray-100 text-gray-400 cursor-not-allowed":y?"bg-green-100 text-green-700 hover:bg-green-200":"bg-primary-600 text-white hover:bg-primary-700"),children:m?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Checking in..."})]}):y?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4","aria-hidden":"true"}),"Update"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4","aria-hidden":"true"}),"Check In"]})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:j("p-3 rounded-xl",y?"bg-green-100":"bg-blue-100"),children:e.jsx(M,{className:j("w-6 h-6",y?"text-green-600":"text-blue-600"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Check-in"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Record your current location for Schengen tracking"})]})]}),e.jsxs("button",{onClick:()=>r(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Qe,{className:"w-4 h-4","aria-hidden":"true"}),"History"]})]}),!o&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg mb-4",children:[e.jsx(T,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Geolocation is not supported by your browser. Try using a modern browser like Chrome, Firefox, or Safari."})]}),d==="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(T,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Location permission denied"}),e.jsx("p",{className:"text-sm text-red-700",children:"Please enable location access in your browser settings to use this feature."})]})]}),n&&d!=="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(T,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:n.message})]}),p.error&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(T,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"Failed to save location."}),e.jsx("p",{className:"mt-1 text-xs",children:p.error instanceof Error?p.error.message:"Please try again."})]})]}),f?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(I,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})}):y&&g?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-6 h-6 text-green-600","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-800",children:"Checked in today"}),e.jsxs("p",{className:"text-sm text-green-700",children:[g.city&&`${g.city}, `,g.countryName??"Unknown location",g.isSchengen&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:[e.jsx($,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Schengen"]})]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["at ",new Date(g.recordedAt).toLocaleTimeString()]})]})]})}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-500","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You haven't checked in today. Check in to record your location for Schengen tracking."})]})}),e.jsx("button",{onClick:w,disabled:m||!o||d==="denied",className:j("w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors",m||!o||d==="denied"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:m?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}),"Getting your location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5","aria-hidden":"true"}),y?"Update Location":"Check In Now"]})}),p.isSuccess&&p.data&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(U,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:p.data.message})]})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-blue-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"How location tracking works:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Your location is detected using your browser's GPS"}),e.jsx("li",{children:"We determine which country you're in automatically"}),e.jsx("li",{children:"Schengen zone countries are tracked for the 90/180 rule"}),e.jsx("li",{children:"You can view and delete your location history at any time"})]})]})]})})]}),e.jsx(H,{isOpen:s,onClose:()=>r(!1),title:"Location History",size:"lg",children:e.jsx(Ct,{onClearRequest:()=>i(!0)})}),e.jsx(H,{isOpen:a,onClose:()=>i(!1),title:"Clear Location History",size:"sm",children:e.jsx(Dt,{onConfirm:()=>{i(!1),r(!1)},onCancel:()=>i(!1)})})]})}function Ct({onClearRequest:t}){const{data:s,isLoading:r,refetch:a,isRefetching:i}=Oe({limit:50}),n=Re(),l=async o=>{confirm("Delete this location entry?")&&await n.mutateAsync(o)};if(r)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})});const d=(s==null?void 0:s.locations)??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[(s==null?void 0:s.total)??0," location",((s==null?void 0:s.total)??0)!==1?"s":""," recorded"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>a(),disabled:i,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",children:[e.jsx(Ue,{className:j("w-4 h-4",i&&"animate-spin"),"aria-hidden":"true"}),"Refresh"]}),d.length>0&&e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-colors",children:[e.jsx(se,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All"]})]})]}),d.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500",children:"No location history yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Check in to start recording your locations"})]}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:d.map(o=>e.jsx(Tt,{location:o,onDelete:()=>l(o.id),isDeleting:n.isPending},o.id))})]})}function Tt({location:t,onDelete:s,isDeleting:r}){const a=new Date(t.recordedAt);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:j("p-2 rounded-lg",t.isSchengen?"bg-blue-100":"bg-gray-100"),children:t.isSchengen?e.jsx($,{className:"w-4 h-4 text-blue-600","aria-hidden":"true"}):e.jsx(M,{className:"w-4 h-4 text-gray-500","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[t.city&&`${t.city}, `,t.countryName??"Unknown location",t.isSchengen&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Schengen)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.toLocaleDateString()," at ",a.toLocaleTimeString(),t.accuracy&&e.jsxs("span",{className:"ml-2",children:["(Â±",Math.round(t.accuracy),"m)"]})]})]})]}),e.jsx("button",{onClick:s,disabled:r,className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-red-600 transition-all",title:"Delete",children:e.jsx(te,{className:"w-4 h-4","aria-hidden":"true"})})]})}function Dt({onConfirm:t,onCancel:s}){const r=He(),a=async()=>{await r.mutateAsync(),t()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete all your location history? This action cannot be undone."}),r.error&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:"Failed to clear history. Please try again."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:s,disabled:r.isPending,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:r.isPending,className:j("inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors",r.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700"),children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All History"]})})]})]})}const Et={"Europe/Paris":["FR"],"Europe/Berlin":["DE"],"Europe/Rome":["IT"],"Europe/Madrid":["ES"],"Europe/Amsterdam":["NL"],"Europe/Brussels":["BE"],"Europe/Vienna":["AT"],"Europe/Zurich":["CH"],"Europe/Stockholm":["SE"],"Europe/Oslo":["NO"],"Europe/Copenhagen":["DK"],"Europe/Helsinki":["FI"],"Europe/Warsaw":["PL"],"Europe/Prague":["CZ"],"Europe/Budapest":["HU"],"Europe/Athens":["GR"],"Europe/Lisbon":["PT"],"Europe/Dublin":["IE"],"Europe/London":["GB"],"Europe/Bucharest":["RO"],"Europe/Sofia":["BG"],"Europe/Zagreb":["HR"],"Europe/Ljubljana":["SI"],"Europe/Bratislava":["SK"],"Europe/Tallinn":["EE"],"Europe/Riga":["LV"],"Europe/Vilnius":["LT"],"Europe/Luxembourg":["LU"],"Europe/Malta":["MT"],"Europe/Reykjavik":["IS"],"Europe/Vaduz":["LI"],"Europe/Monaco":["MC"]},Pt=new Set(["AT","BE","BG","HR","CZ","DK","EE","FI","FR","DE","GR","HU","IS","IT","LV","LI","LT","LU","MT","NL","NO","PL","PT","RO","SK","SI","ES","SE","CH"]),L={TIMEZONE:"r2f_schengen_last_timezone",LAST_CHECKIN:"r2f_schengen_last_checkin_date",PROMPT_DISMISSED:"r2f_schengen_prompt_dismissed_date"};function ce(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return"UTC"}}function Lt(){return navigator.language||"en-US"}function me(t){const s=Et[t];return(s==null?void 0:s[0])||null}function xe(t){return t?Pt.has(t):!1}function V(){return new Date().toISOString().split("T")[0]}function It(t={}){const{enableReminder:s=!0,reminderHour:r=9}=t,[a,i]=h.useState(()=>{const c=ce(),u=localStorage.getItem(L.TIMEZONE),f=localStorage.getItem(L.LAST_CHECKIN),p=localStorage.getItem(L.PROMPT_DISMISSED),w=V(),y=me(c),g=u!==null&&u!==c,m=f===w,N=g||s&&!m&&!(p===w);return{currentTimezone:c,storedTimezone:u,timezoneChanged:g,likelyCountry:y,likelySchengen:xe(y),currentLocale:Lt(),shouldPromptCheckin:N,lastCheckinDate:f,checkedInToday:m}});h.useEffect(()=>{const u=setInterval(()=>{const f=ce();i(p=>{if(p.currentTimezone!==f){const w=me(f);return{...p,currentTimezone:f,timezoneChanged:p.storedTimezone!==null&&p.storedTimezone!==f,likelyCountry:w,likelySchengen:xe(w),shouldPromptCheckin:!0}}return p})},3e5);return()=>clearInterval(u)},[]),h.useEffect(()=>{if(!s)return;const c=()=>{const f=new Date,p=V(),w=localStorage.getItem(L.LAST_CHECKIN),y=localStorage.getItem(L.PROMPT_DISMISSED);f.getHours()>=r&&w!==p&&y!==p&&i(g=>({...g,shouldPromptCheckin:!0,checkedInToday:!1}))};c();const u=setInterval(c,60*1e3);return()=>clearInterval(u)},[s,r]);const n=h.useCallback(()=>{localStorage.setItem(L.TIMEZONE,a.currentTimezone),i(c=>({...c,storedTimezone:c.currentTimezone,timezoneChanged:!1}))},[a.currentTimezone]),l=h.useCallback(()=>{const c=V();localStorage.setItem(L.LAST_CHECKIN,c),localStorage.setItem(L.TIMEZONE,a.currentTimezone),i(u=>({...u,lastCheckinDate:c,checkedInToday:!0,shouldPromptCheckin:!1,storedTimezone:u.currentTimezone,timezoneChanged:!1}))},[a.currentTimezone]),d=h.useCallback(()=>{const c=V();localStorage.setItem(L.PROMPT_DISMISSED,c),i(u=>({...u,shouldPromptCheckin:!1}))},[]),o=h.useCallback(()=>new Date().getHours()>=r,[r]);return h.useMemo(()=>({state:a,acknowledgeTimezone:n,markCheckedIn:l,dismissPrompt:d,isReminderTime:o}),[a,n,l,d,o])}function Mt(t){const s=t.toUpperCase().split("").map(r=>127397+r.charCodeAt(0));return String.fromCodePoint(...s)}function At({enabled:t=!0,onCheckin:s,onDismiss:r}){const[a,i]=h.useState(!1),{state:n,markCheckedIn:l,dismissPrompt:d}=It({enableReminder:t}),{data:o}=We(),{getCurrentPosition:c,isLoading:u,isSupported:f}=ve(),p=be();h.useEffect(()=>{if(a){const v=setTimeout(()=>i(!1),3e3);return()=>clearTimeout(v)}},[a]);const w=h.useCallback(async()=>{try{const v=await c();await p.mutateAsync({lat:v.lat,lng:v.lng,accuracy:v.accuracy,source:"checkin"}),l(),i(!0),s==null||s()}catch(v){console.error("Check-in failed:",v)}},[c,p,l,s]),y=h.useCallback(()=>{d(),r==null||r()},[d,r]);if(!t||!n.shouldPromptCheckin||n.checkedInToday)return null;const g=u||p.isPending;let m=je,b="Daily Location Check-in",N="Don't forget to check in your location for accurate Schengen tracking.",S="blue";if(n.timezoneChanged?(m=ae,b="Travel Detected",N=`Your timezone changed from ${n.storedTimezone} to ${n.currentTimezone}. Are you traveling?`,S="amber"):o!=null&&o.detected&&o.countryCode&&n.likelyCountry&&o.countryCode!==n.likelyCountry&&(m=$,b="Location Check",N=`Your IP suggests you're in ${o.countryName||o.countryCode}. Check in to confirm your location.`,S="purple"),a)return e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-green-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Location recorded!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your location has been saved for Schengen tracking."})]})]})});const D=m,x={blue:{bg:"bg-blue-50",border:"border-blue-200",icon:"bg-blue-100 text-blue-600",title:"text-blue-800",message:"text-blue-700",button:"bg-blue-600 hover:bg-blue-700 text-white",dismiss:"text-blue-500 hover:text-blue-700 hover:bg-blue-100"},amber:{bg:"bg-amber-50",border:"border-amber-200",icon:"bg-amber-100 text-amber-600",title:"text-amber-800",message:"text-amber-700",button:"bg-amber-600 hover:bg-amber-700 text-white",dismiss:"text-amber-500 hover:text-amber-700 hover:bg-amber-100"},purple:{bg:"bg-purple-50",border:"border-purple-200",icon:"bg-purple-100 text-purple-600",title:"text-purple-800",message:"text-purple-700",button:"bg-purple-600 hover:bg-purple-700 text-white",dismiss:"text-purple-500 hover:text-purple-700 hover:bg-purple-100"}}[S];return e.jsx("div",{className:j("border rounded-lg p-4 mb-4",x.bg,x.border),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:j("p-2 rounded-lg",x.icon),children:e.jsx(D,{className:"w-5 h-5","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:j("font-medium",x.title),children:b}),(o==null?void 0:o.detected)&&o.countryCode&&e.jsx("span",{className:"text-lg",role:"img","aria-label":o.countryName||o.countryCode,children:Mt(o.countryCode)})]}),e.jsx("p",{className:j("text-sm mt-0.5",x.message),children:N}),n.likelySchengen&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs",children:[e.jsx($,{className:"w-3 h-3 text-blue-500","aria-hidden":"true"}),e.jsxs("span",{className:"text-blue-600",children:["Based on timezone: Likely in Schengen zone (",n.likelyCountry,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsx("button",{onClick:w,disabled:g||!f,className:j("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",g||!f?"bg-gray-100 text-gray-400 cursor-not-allowed":x.button),children:g?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Getting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4","aria-hidden":"true"}),"Check In Now"]})}),e.jsx("button",{onClick:y,className:j("px-3 py-2 rounded-lg text-sm transition-colors",x.dismiss),children:"Maybe later"})]}),p.error&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-sm text-red-600",children:[e.jsx(Q,{className:"w-4 h-4","aria-hidden":"true"}),"Failed to save location. Please try again."]}),!f&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs text-gray-500",children:[e.jsx(Q,{className:"w-3 h-3","aria-hidden":"true"}),"Geolocation is not supported by your browser."]})]})]}),e.jsx("button",{onClick:y,className:j("p-1 rounded transition-colors",x.dismiss),"aria-label":"Dismiss",children:e.jsx(te,{className:"w-4 h-4","aria-hidden":"true"})})]})})}const Se="r2f_schengen_onboarding_complete";function Ft(){return localStorage.getItem(Se)==="true"}function ue(){localStorage.setItem(Se,"true")}function zt({isOpen:t,onComplete:s,isPremium:r=!1}){const[a,i]=h.useState(0),n=[{icon:e.jsx($,{className:"w-8 h-8 text-primary-600","aria-hidden":"true"}),title:"Welcome to Schengen Tracker",description:"Understand and comply with the 90/180 day rule",details:e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"The 90/180 Rule"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["Non-EU citizens may stay up to ",e.jsx("strong",{children:"90 days"})," within any"," ",e.jsx("strong",{children:"180-day rolling period"})," in the Schengen area without a long-stay visa."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Entry & Exit"}),e.jsx("p",{className:"text-gray-600",children:"Both days count as full days"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Rolling Window"}),e.jsx("p",{className:"text-gray-600",children:"Days expire after 180 days"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Overstaying can result in fines, deportation, and future visa denials."})]})},{icon:e.jsx(ae,{className:"w-8 h-8 text-primary-600","aria-hidden":"true"}),title:"Track Your Trips",description:"Add your past and future Schengen travel",details:e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Keep an accurate record of all your Schengen zone visits to stay compliant."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-primary-700",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:'Click "Add Trip"'}),e.jsx("p",{className:"text-sm text-gray-600",children:"Enter your travel dates and destination country"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-primary-700",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Add all past trips"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Include trips from the last 6 months for accurate tracking"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-primary-700",children:"3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Plan future trips"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add upcoming travel to see projected compliance"})]})]})]})]})},{icon:e.jsx(M,{className:"w-8 h-8 text-primary-600","aria-hidden":"true"}),title:"Smart Location Check-in",description:"Quick daily check-ins to keep your tracker current",details:e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Use the location check-in feature to automatically record your presence in Schengen countries."}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"w-5 h-5 text-green-600","aria-hidden":"true"}),e.jsx("h4",{className:"font-semibold text-green-900",children:"Automatic Trip Creation"})]}),e.jsx("p",{className:"text-sm text-green-800",children:"When you check in from a Schengen country, we automatically create or extend your trip record. No manual entry needed!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Browser Location"}),e.jsx("p",{className:"text-gray-600",children:"One-click check-in with GPS"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Smart Detection"}),e.jsx("p",{className:"text-gray-600",children:"Prompts when timezone changes"})]})]})]})},{icon:e.jsx(Z,{className:"w-8 h-8 text-primary-600","aria-hidden":"true"}),title:"Plan Future Travel",description:'Use the "What If" calculator before you book',details:e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Before booking a trip, use the Planning Tool to check if it would violate the 90/180 rule."}),e.jsxs("div",{className:"p-4 bg-primary-50 border border-primary-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-primary-900 mb-2",children:"The Planning Tool shows you:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-primary-800",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),"Whether your planned trip would be safe"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),"The earliest safe date to start your trip"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),"Maximum safe trip length from any date"]})]})]}),!r&&e.jsx("p",{className:"text-xs text-amber-700 bg-amber-50 p-2 rounded",children:"â­ Planning Tool is a premium feature"})]})},{icon:e.jsx(fe,{className:"w-8 h-8 text-primary-600","aria-hidden":"true"}),title:"Stay Informed with Alerts",description:"Get notified before you approach the limit",details:e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Enable email alerts to receive warnings when you're approaching your 90-day limit."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-900",children:"60 days used"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"Friendly reminder to plan ahead"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-orange-900",children:"80 days used"}),e.jsx("p",{className:"text-xs text-orange-700",children:"Warning to limit travel"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-900",children:"85+ days used"}),e.jsx("p",{className:"text-xs text-red-700",children:"Urgent alert to avoid overstay"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"You can enable alerts in the Settings tab after completing this tour."})]})}],l=()=>{a<n.length-1?i(a+1):(ue(),s())},d=()=>{a>0&&i(a-1)},o=()=>{ue(),s()},c=n[a],u=a===n.length-1;return e.jsx(H,{isOpen:t,onClose:o,title:"",size:"md",children:e.jsxs("div",{className:"text-center pb-2",children:[e.jsx("div",{className:"flex justify-center gap-2 mb-6",children:n.map((f,p)=>e.jsx("button",{onClick:()=>i(p),className:j("w-2.5 h-2.5 rounded-full transition-all",p===a?"bg-primary-600 w-6":p<a?"bg-primary-300":"bg-gray-200"),"aria-label":`Go to step ${p+1}`},p))}),e.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4",children:c.icon}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:c.title}),e.jsx("p",{className:"text-gray-600 mb-6",children:c.description}),e.jsx("div",{className:"mb-6",children:c.details}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:o,className:"text-sm text-gray-500 hover:text-gray-700",children:"Skip tour"}),e.jsxs("div",{className:"flex items-center gap-3",children:[a>0&&e.jsxs("button",{onClick:d,className:"inline-flex items-center gap-1 px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900",children:[e.jsx(pe,{className:"w-4 h-4","aria-hidden":"true"}),"Back"]}),e.jsx("button",{onClick:l,className:"inline-flex items-center gap-1 px-6 py-2 bg-primary-600 text-white rounded-lg font-medium text-sm hover:bg-primary-700 transition-colors",children:u?e.jsxs(e.Fragment,{children:["Get Started",e.jsx(R,{className:"w-4 h-4","aria-hidden":"true"})]}):e.jsxs(e.Fragment,{children:["Next",e.jsx(ye,{className:"w-4 h-4","aria-hidden":"true"})]})})]})]})]})})}function Xt(){const{trips:t,settings:s,isLoaded:r,addTrip:a,updateTrip:i,deleteTrip:n,updateSettings:l}=st(),{data:d,isLoading:o}=_e(),c=Ye(),[u,f]=h.useState(!1),[p,w]=h.useState(null),[y,g]=h.useState("trips"),[m,b]=h.useState(null),[N,S]=h.useState(null),[D,k]=h.useState(!1);h.useEffect(()=>{r&&!Ft()&&k(!0)},[r]);const x=h.useMemo(()=>it(t,{yellow:s.yellowThreshold,red:s.redThreshold}),[t,s.yellowThreshold,s.redThreshold]),v=async C=>{S(null);try{await a(C),f(!1)}catch(E){const W=E instanceof Error?E.message:"Failed to add trip";S(W),console.error("Failed to add trip:",E)}},X=async C=>{if(p){S(null);try{await i(p.id,C),w(null)}catch(E){const W=E instanceof Error?E.message:"Failed to update trip";S(W),console.error("Failed to update trip:",E)}}},ke=async C=>{S(null);try{await n(C)}catch(E){const W=E instanceof Error?E.message:"Failed to delete trip";S(W),console.error("Failed to delete trip:",E)}},Ce=C=>{w(C)},B=()=>{f(!1),w(null)},ne=(d==null?void 0:d.canAddTrip)??!0,z=(d==null?void 0:d.isPremium)??!0;return!r||o?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3",role:"status","aria-label":"Loading"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Schengen Tracker"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track your 90/180 day Schengen zone compliance"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>k(!0),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Show help tour",title:"Show help tour",children:e.jsx($e,{className:"w-5 h-5","aria-hidden":"true"})}),z&&e.jsx(vt,{}),e.jsxs("button",{onClick:()=>f(!0),disabled:!ne,className:j("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors",ne?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[e.jsx(Ge,{className:"w-5 h-5","aria-hidden":"true"}),"Add Trip"]})]})]}),!z&&d&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-5 h-5 text-amber-600","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-amber-800",children:["Free Plan: ",d.tripCount," of ",d.tripLimit," trips used"]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Upgrade to Premium for unlimited trips, planning tools, and PDF reports"})]})]}),d.upgradeUrl&&e.jsxs("a",{href:d.upgradeUrl,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(K,{className:"w-4 h-4","aria-hidden":"true"}),"Upgrade"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card p-6 flex flex-col items-center justify-center",children:[e.jsx(mt,{daysUsed:x.daysUsed,daysRemaining:x.daysRemaining,status:x.status,size:"lg"}),e.jsx("div",{className:"mt-4",children:e.jsx(ht,{status:x.status,size:"lg"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:j("card p-4 border-l-4",x.status==="safe"&&"border-l-green-500",x.status==="warning"&&"border-l-yellow-500",x.status==="danger"&&"border-l-orange-500",x.status==="critical"&&"border-l-red-500"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Days Remaining"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.daysRemaining})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current 180-Day Window"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[F(x.windowStart)," - ",F(x.windowEnd)]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[x.nextExpiration&&e.jsx("div",{className:"card p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Next Day Expires"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:F(x.nextExpiration)}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"A day will drop off the 180-day window"})]})]})}),e.jsx("div",{className:"card p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"The 90/180 Rule"}),e.jsx("p",{children:"Non-EU citizens may stay up to 90 days within any 180-day period in the Schengen area without a visa."})]})]})})]})]}),e.jsx(At,{enabled:!0}),e.jsx(de,{compact:!0}),x.status==="warning"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(T,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-medium",children:"Approaching limit:"})," You have used ",x.daysUsed," of your 90 days. Plan future travel carefully to avoid overstaying."]})]}),x.status==="danger"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(T,{className:"w-5 h-5 text-orange-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("span",{className:"font-medium",children:"Warning:"})," You have used ",x.daysUsed," of your 90 days. Limited travel remaining in this window."]})]}),x.status==="critical"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(T,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("span",{className:"font-medium",children:"Limit reached:"})," You have used all 90 days allowed in this 180-day window. Additional travel may result in overstay violations."]})]}),N&&e.jsxs("div",{className:"flex items-center justify-between gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:N})]}),e.jsx("button",{onClick:()=>S(null),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Dismiss"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-6","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>g("trips"),className:j("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",y==="trips"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4","aria-hidden":"true"}),"Trip List"]})}),e.jsx("button",{onClick:()=>g("calendar"),className:j("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",y==="calendar"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar View",!z&&e.jsx(le,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>g("planning"),className:j("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",y==="planning"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"}),"Planning Tool",!z&&e.jsx(le,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>g("location"),className:j("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",y==="location"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4","aria-hidden":"true"}),"Location"]})}),e.jsx("button",{onClick:()=>g("settings"),className:j("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",y==="settings"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4","aria-hidden":"true"}),"Settings"]})})]})}),y==="trips"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Your Trips"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," trip",t.length!==1?"s":""]})]}),e.jsx(pt,{trips:t,currentWindowStart:x.windowStart,onEdit:Ce,onDelete:ke})]}),y==="calendar"&&(z?e.jsx(wt,{trips:t,windowStart:x.windowStart,windowEnd:x.windowEnd}):e.jsx(he,{feature:"Calendar View",description:"Visualize your trips on an interactive calendar to better understand your travel patterns and plan future trips.",upgradeUrl:d==null?void 0:d.upgradeUrl})),y==="planning"&&(z?e.jsx("div",{className:"card p-6",children:e.jsx(yt,{})}):e.jsx(he,{feature:"Planning Tool",description:"Use the 'What If' calculator to check if a planned trip would violate the 90/180 rule before you book.",upgradeUrl:d==null?void 0:d.upgradeUrl})),y==="location"&&e.jsx(de,{}),y==="settings"&&e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tracker Settings"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure alerts and notification preferences"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Alerts"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive email notifications when approaching your 90-day limit"})]})]}),e.jsx("button",{onClick:()=>l({emailAlerts:!s.emailAlerts}),className:j("relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",s.emailAlerts?"bg-primary-600":"bg-gray-200"),role:"switch","aria-checked":s.emailAlerts,children:e.jsx("span",{className:j("pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",s.emailAlerts?"translate-x-5":"translate-x-0")})})]}),s.emailAlerts&&e.jsx("div",{className:"mt-4 ml-14 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Alert thresholds:"})," You will receive email alerts when you reach 60 days (warning), 80 days (danger), and 85 days (urgent)."]})}),s.emailAlerts&&e.jsxs("div",{className:"mt-4 ml-14",children:[e.jsx("button",{onClick:()=>{b(null),c.mutate(void 0,{onSuccess:C=>{b({type:C.success?"success":"error",text:C.message})},onError:C=>{b({type:"error",text:C instanceof Error?C.message:"Failed to send test alert"})}})},disabled:c.isPending,className:j("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",c.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4","aria-hidden":"true"}),"Send Test Alert"]})}),m&&e.jsxs("div",{className:j("mt-3 p-3 rounded-lg flex items-center gap-2 text-sm",m.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:[m.type==="success"?e.jsx(U,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}):e.jsx(T,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),m.text]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Warning Thresholds"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Warning Level"}),e.jsxs("p",{className:"text-lg font-bold text-yellow-900",children:[s.yellowThreshold," days"]}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Status turns yellow"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:"Danger Level"}),e.jsxs("p",{className:"text-lg font-bold text-orange-900",children:[s.redThreshold," days"]}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Status turns red"})]})]})]})]}),e.jsx(H,{isOpen:u,onClose:B,title:"Add Trip",size:"md",children:e.jsx(oe,{existingTrips:t,onSubmit:v,onCancel:B})}),e.jsx(H,{isOpen:!!p,onClose:B,title:"Edit Trip",size:"md",children:p&&e.jsx(oe,{trip:p,existingTrips:t,onSubmit:X,onCancel:B})}),e.jsx(zt,{isOpen:D,onComplete:()=>k(!1),isPremium:z})]})}function he({feature:t,description:s,upgradeUrl:r}){return e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{className:"w-8 h-8 text-amber-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[t," is a Premium Feature"]}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:s}),r&&e.jsxs("a",{href:r,className:"inline-flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(K,{className:"w-5 h-5","aria-hidden":"true"}),"Upgrade to Premium"]})]})}export{Xt as default};
