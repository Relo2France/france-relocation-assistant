import{j as e}from"./vendor-query-D8MH73Ff.js";import{r as h}from"./vendor-react-F9Y4d3HK.js";import{a as f}from"./vendor-utils-C5RVuWu4.js";import{c as Q,aH as Qe,aI as Xe,aJ as es,aK as ss,aL as ts,aM as as,A as z,a2 as Z,aN as Fe,aO as B,b as R,B as _,F as ze,aP as rs,aQ as ns,C as W,O as ne,ax as Re,ah as Ue,aR as is,aS as ls,aT as os,aU as ds,aV as cs,aW as ms,aX as xs,aY as hs,aZ as us,X as K,q as gs,a as xe,a3 as Oe,a_ as ps,l as ae,a$ as ys,b0 as He,b1 as bs,b2 as fs,b3 as js,b4 as Ns,Z as $e,b5 as ws,b6 as vs,b7 as Ss,b8 as ks,P as le,b9 as Cs,ba as Ts,ae as Ds,Y as Ce,bb as Es}from"./main-7LAJ-Qcu.js";import{X as Ne}from"./x-circle-neDLxUMh.js";import{A as oe}from"./alert-circle-O7pqPI8K.js";import{B as Ls}from"./briefcase-Dd274Qvj.js";import{T as ve}from"./trash-2-ZbZtJMO3.js";import{C as We}from"./chevron-up-C8ANL6hV.js";import{C as Se}from"./chevron-down-B1nvvmhf.js";import{L as M}from"./loader-2-DrrZAFkl.js";import{P as he}from"./plane-C3d0zE0E.js";import{D as Ps}from"./download-BElrpZvj.js";import{C as de,L as Te}from"./lock-iXy3FDx-.js";import{S as Ms}from"./send-B-qgpZCQ.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=Q("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=Q("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=Q("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=Q("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=Q("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=Q("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=Q("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=Q("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),Os={yellowThreshold:60,redThreshold:80,emailAlerts:!1,upcomingTripReminders:!0};function Hs(){const{data:s=[],isLoading:t,isError:n}=Qe(),{data:a=Os,isLoading:i}=Xe(),r=es(),o=ss(),l=ts(),c=as(),d=!t&&!i,u=n,j=h.useMemo(()=>[...s].sort((N,k)=>new Date(k.startDate).getTime()-new Date(N.startDate).getTime()),[s]),y=h.useCallback(N=>r.mutateAsync(N),[r]),w=h.useCallback((N,k)=>o.mutateAsync({id:N,data:k}),[o]),b=h.useCallback(N=>l.mutateAsync(N),[l]),g=h.useCallback(N=>c.mutateAsync(N),[c]),x=r.isPending||o.isPending||l.isPending||c.isPending;return{trips:j,settings:a,isLoaded:d,isError:u,isSaving:x,addTrip:y,updateTrip:w,deleteTrip:b,updateSettings:g}}const ke=90,ue=180;function H(s){if(s instanceof Date){const t=s.toISOString().split("T")[0];return new Date(t+"T00:00:00Z")}return new Date(s+"T00:00:00Z")}function ge(){const t=new Date().toISOString().split("T")[0];return new Date(t+"T00:00:00Z")}function X(s){return s.toISOString().split("T")[0]}function _e(s,t=ge()){const n=H(t),a=new Date(n.getTime()-(ue-1)*24*60*60*1e3),i=new Set;return s.forEach(r=>{const o=H(r.startDate),l=H(r.endDate);if(o>n)return;const c=o<a?a:o,d=l>n?n:l;if(c<=d){const u=new Date(c);for(;u<=d;)i.add(X(u)),u.setTime(u.getTime()+24*60*60*1e3)}}),i.size}function $s(s,t=ge()){const n=H(t),a=new Date(n.getTime()-(ue-1)*24*60*60*1e3),i=new Set;return s.forEach(r=>{const o=H(r.startDate),l=H(r.endDate);if(o>n)return;const c=o<a?a:o,d=l>n?n:l;if(c<=d){const u=new Date(c);for(;u<=d;)i.add(X(u)),u.setTime(u.getTime()+24*60*60*1e3)}}),i}function Ws(s,t={yellow:60,red:80}){return s>=ke?"critical":s>=t.red?"danger":s>=t.yellow?"warning":"safe"}function _s(s,t=ge()){const n=$s(s,t);if(n.size===0)return null;const i=Array.from(n).sort()[0],r=H(i);return r.setTime(r.getTime()+ue*24*60*60*1e3),X(r)}function Ys(s,t={yellow:60,red:80}){const n=ge(),a=_e(s,n),i=Math.max(0,ke-a),r=n,o=new Date(n.getTime()-(ue-1)*24*60*60*1e3);return{daysUsed:a,daysRemaining:i,windowStart:X(o),windowEnd:X(r),status:Ws(a,t),nextExpiration:_s(s,n),statusThresholds:t}}function Ye(s,t){const n=H(s),a=H(t),i=Math.abs(a.getTime()-n.getTime());return Math.floor(i/(1e3*60*60*24))+1}function te(s){return Ye(s.startDate,s.endDate)}function Gs(s,t,n){const a=H(t),i=H(n),r=new Date(a);let o=0;for(;r<=i;){const l={id:"temp",startDate:t,endDate:X(r),country:"France",category:"personal",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},c=[...s,l],d=_e(c,r);if(o=Math.max(o,d),d>ke)return{wouldViolate:!0,projectedDaysUsed:d,earliestSafeEntry:null,maxTripLength:null,message:`This trip would exceed the 90-day limit on ${X(r)} with ${d} days used.`};r.setTime(r.getTime()+24*60*60*1e3)}return{wouldViolate:!1,projectedDaysUsed:o,earliestSafeEntry:t,maxTripLength:Ye(t,n),message:`This trip is safe. Maximum days used during trip: ${o}/90.`}}function q(s){return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function Vs(s,t){const n=new Date(s),a=new Date(t);return s===t?q(s):n.getMonth()===a.getMonth()&&n.getFullYear()===a.getFullYear()?`${n.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.getDate()}, ${a.getFullYear()}`:n.getFullYear()===a.getFullYear()?`${n.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}, ${a.getFullYear()}`:`${q(s)} - ${q(t)}`}const Bs={safe:{stroke:"stroke-green-500",text:"text-green-600",bg:"bg-green-50"},warning:{stroke:"stroke-yellow-500",text:"text-yellow-600",bg:"bg-yellow-50"},danger:{stroke:"stroke-orange-500",text:"text-orange-600",bg:"bg-orange-50"},critical:{stroke:"stroke-red-500",text:"text-red-600",bg:"bg-red-50"}},Js={sm:{container:"w-24 h-24",svgSize:96,strokeWidth:6,radius:42,textSize:"text-2xl",labelSize:"text-xs"},md:{container:"w-36 h-36",svgSize:144,strokeWidth:8,radius:64,textSize:"text-4xl",labelSize:"text-sm"},lg:{container:"w-48 h-48",svgSize:192,strokeWidth:10,radius:86,textSize:"text-5xl",labelSize:"text-base"}};function Ge({daysUsed:s,daysRemaining:t,status:n,size:a="md",className:i}){const r=Bs[n],o=Js[a],l=Math.min(s/90*100,100),c=2*Math.PI*o.radius,d=c-l/100*c;return e.jsxs("div",{className:f("relative inline-flex",o.container,i),children:[e.jsxs("svg",{className:"transform -rotate-90",width:o.svgSize,height:o.svgSize,"aria-hidden":"true",children:[e.jsx("circle",{cx:o.svgSize/2,cy:o.svgSize/2,r:o.radius,fill:"none",strokeWidth:o.strokeWidth,className:"stroke-gray-200"}),e.jsx("circle",{cx:o.svgSize/2,cy:o.svgSize/2,r:o.radius,fill:"none",strokeWidth:o.strokeWidth,strokeLinecap:"round",strokeDasharray:c,strokeDashoffset:d,className:f("transition-all duration-500",r.stroke)})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:f("font-bold",o.textSize,r.text),"aria-label":`${s} days used`,children:s}),e.jsx("span",{className:f("text-gray-500",o.labelSize),children:"of 90 days"})]}),e.jsx("div",{role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":90,"aria-label":`Schengen days: ${s} used, ${t} remaining`,className:"sr-only"})]})}const Zs={safe:{label:"Safe",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200",Icon:Z},warning:{label:"Warning",bgColor:"bg-yellow-50",textColor:"text-yellow-700",borderColor:"border-yellow-200",Icon:z},danger:{label:"Danger",bgColor:"bg-orange-50",textColor:"text-orange-700",borderColor:"border-orange-200",Icon:oe},critical:{label:"Critical",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200",Icon:Ne}},Ks={sm:{badge:"px-2 py-0.5 text-xs",icon:"w-3 h-3"},md:{badge:"px-2.5 py-1 text-sm",icon:"w-4 h-4"},lg:{badge:"px-3 py-1.5 text-base",icon:"w-5 h-5"}};function Ve({status:s,showLabel:t=!0,size:n="md",className:a}){const i=Zs[s],r=Ks[n],o=i.Icon;return e.jsxs("span",{className:f("inline-flex items-center gap-1 rounded-full border font-medium",i.bgColor,i.textColor,i.borderColor,r.badge,a),children:[e.jsx(o,{className:r.icon,"aria-hidden":"true"}),t&&e.jsx("span",{children:i.label})]})}const qs=["Austria","Belgium","Bulgaria","Croatia","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Italy","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland"],Qs=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming","District of Columbia"];function De({trip:s,existingTrips:t,onSubmit:n,onCancel:a,className:i,defaultJurisdiction:r="schengen"}){const o=!!s,[l,c]=h.useState((s==null?void 0:s.startDate)||""),[d,u]=h.useState((s==null?void 0:s.endDate)||""),[j,y]=h.useState((s==null?void 0:s.country)||"France"),[w,b]=h.useState((s==null?void 0:s.jurisdictionCode)||r),[g,x]=h.useState((s==null?void 0:s.category)||"personal"),[N,k]=h.useState((s==null?void 0:s.notes)||""),{data:T}=Fe(),[v,S]=h.useState(null),[p,L]=h.useState(null),D=T==null?void 0:T.find(C=>C.code===w),$=w==="schengen",J=(w==null?void 0:w.startsWith("us_"))&&(D==null?void 0:D.type)==="state",U=()=>$?[...qs]:J?[...Qs]:D?[D.name]:["Unknown"];h.useEffect(()=>{const C=U();C.includes(j)||y(C[0]||"")},[w]),h.useEffect(()=>{if(l&&d)if($){const re=(o?t.filter(ee=>ee.id!==s.id):t).filter(ee=>!ee.jurisdictionCode||ee.jurisdictionCode==="schengen"),O=Gs(re,l,d);O.wouldViolate?S(O.message):O.projectedDaysUsed>=80?S(`This trip will bring you to ${O.projectedDaysUsed}/90 days - approaching the limit.`):O.projectedDaysUsed>=60?S(`This trip will bring you to ${O.projectedDaysUsed}/90 days.`):S(null)}else D&&te({startDate:l,endDate:d})>D.daysAllowed?S(`This trip exceeds the ${D.daysAllowed}-day limit for ${D.name}.`):S(null);else S(null)},[l,d,t,o,s,w,D,$]);const Y=C=>{if(C.preventDefault(),L(null),!l||!d){L("Please enter both start and end dates.");return}if(new Date(d)<new Date(l)){L("End date must be on or after start date.");return}const re=te({startDate:l,endDate:d}),O=(D==null?void 0:D.daysAllowed)||90;if(re>O){L(`A single trip cannot exceed ${O} days for ${(D==null?void 0:D.name)||"this jurisdiction"}.`);return}n({startDate:l,endDate:d,country:j,jurisdictionCode:w,category:g,notes:N.trim()||void 0})},I=l&&d?te({startDate:l,endDate:d}):null,P=U(),A=T&&T.length>1;return e.jsxs("form",{onSubmit:Y,className:f("space-y-4",i),children:[A&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"jurisdiction",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(B,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Jurisdiction"]}),e.jsx("select",{id:"jurisdiction",value:w,onChange:C=>b(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:T.map(C=>e.jsxs("option",{value:C.code,children:[C.name," (",C.daysAllowed,"/",C.windowDays," days)"]},C.code))}),(D==null?void 0:D.description)&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:D.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(R,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Start Date"]}),e.jsx("input",{type:"date",id:"startDate",value:l,onChange:C=>c(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(R,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"End Date"]}),e.jsx("input",{type:"date",id:"endDate",value:d,onChange:C=>u(C.target.value),min:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]})]}),I!==null&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg",children:["Duration: ",e.jsxs("span",{className:"font-medium",children:[I," day",I!==1?"s":""]}),D&&e.jsxs("span",{className:"text-gray-400 ml-2",children:["(max ",D.daysAllowed," for ",D.name,")"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(_,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),J?"State":"Country"]}),e.jsx("select",{id:"country",value:j,onChange:C=>y(C.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:P.map(C=>e.jsx("option",{value:C,children:C},C))})]}),e.jsxs("div",{role:"radiogroup","aria-labelledby":"category-label",children:[e.jsxs("span",{id:"category-label",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Ls,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Category"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"personal",checked:g==="personal",onChange:()=>x("personal"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Personal"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"business",checked:g==="business",onChange:()=>x("business"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Business"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ze,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Notes (optional)"]}),e.jsx("textarea",{id:"notes",value:N,onChange:C=>k(C.target.value),rows:2,placeholder:"e.g., Visa appointment, apartment hunting...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-none"})]}),v&&e.jsxs("div",{className:"flex gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(z,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-amber-800",children:v})]}),p&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:p})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-primary-600 hover:bg-primary-700 rounded-lg font-medium transition-colors",children:o?"Save Changes":"Add Trip"})]})]})}function Xs({trips:s,currentWindowStart:t,onEdit:n,onDelete:a,className:i}){const[r,o]=h.useState("date"),[l,c]=h.useState("desc"),[d,u]=h.useState(null),j=x=>{r===x?c(N=>N==="asc"?"desc":"asc"):(o(x),c("desc"))},y=[...s].sort((x,N)=>{let k=0;switch(r){case"date":k=new Date(x.startDate).getTime()-new Date(N.startDate).getTime();break;case"country":k=x.country.localeCompare(N.country);break;case"duration":k=te(x)-te(N);break}return l==="asc"?k:-k}),w=x=>new Date(x.endDate)>=new Date(t),b=x=>{d===x?(a(x),u(null)):(u(x),setTimeout(()=>u(null),3e3))};if(s.length===0)return e.jsxs("div",{className:f("text-center py-12",i),children:[e.jsx(_,{className:"w-12 h-12 text-gray-300 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No trips recorded"}),e.jsx("p",{className:"text-gray-500",children:"Add your first trip to start tracking your Schengen days."})]});const g=({field:x})=>r!==x?null:l==="asc"?e.jsx(We,{className:"w-4 h-4"}):e.jsx(Se,{className:"w-4 h-4"});return e.jsxs("div",{className:f("overflow-hidden",i),children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-3 bg-gray-50 border-b border-gray-200 text-sm font-medium text-gray-600",children:[e.jsxs("button",{onClick:()=>j("date"),className:"col-span-4 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(R,{className:"w-4 h-4","aria-hidden":"true"}),"Dates",e.jsx(g,{field:"date"})]}),e.jsxs("button",{onClick:()=>j("country"),className:"col-span-3 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(_,{className:"w-4 h-4","aria-hidden":"true"}),"Country",e.jsx(g,{field:"country"})]}),e.jsxs("button",{onClick:()=>j("duration"),className:"col-span-2 flex items-center gap-1 text-left hover:text-gray-900",children:["Days",e.jsx(g,{field:"duration"})]}),e.jsx("div",{className:"col-span-3 text-right",children:"Actions"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:y.map(x=>{const N=te(x),k=w(x);return e.jsxs("div",{className:f("grid grid-cols-12 gap-4 px-4 py-3 items-center",k?"bg-white":"bg-gray-50 opacity-75"),children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Vs(x.startDate,x.endDate)}),x.notes&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:x.notes})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("span",{className:"text-sm text-gray-700",children:x.country}),e.jsx("span",{className:f("ml-2 text-xs px-1.5 py-0.5 rounded",x.category==="business"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"),children:x.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:[N," day",N!==1?"s":""]}),!k&&e.jsx("span",{className:"block text-xs text-gray-400",children:"outside window"})]}),e.jsxs("div",{className:"col-span-3 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>n(x),className:"p-2 text-gray-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors","aria-label":`Edit trip to ${x.country}`,children:e.jsx(rs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>b(x.id),className:f("p-2 rounded-lg transition-colors",d===x.id?"text-white bg-red-600 hover:bg-red-700":"text-gray-400 hover:text-red-600 hover:bg-red-50"),"aria-label":d===x.id?"Confirm delete":`Delete trip to ${x.country}`,children:e.jsx(ve,{className:"w-4 h-4"})})]})]},x.id)})})]})}function et(){const[s,t]=h.useState(""),[n,a]=h.useState(""),[i,r]=h.useState(null),o=ns(),l=()=>{!s||!n||o.mutate({startDate:s,endDate:n},{onSuccess:u=>{r(u)}})},c=()=>{t(""),a(""),r(null)},d=s&&n&&new Date(n)>=new Date(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(ce,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Trip Planning Tool"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Check if a planned trip would violate the 90/180 rule"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-start-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-start-date",value:s,onChange:u=>t(u.target.value),className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-end-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-end-date",value:n,onChange:u=>a(u.target.value),min:s,className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:l,disabled:!d||o.isPending,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",d&&!o.isPending?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4","aria-hidden":"true"}),"Check Trip"]})}),i&&e.jsx("button",{onClick:c,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Reset"})]}),i&&e.jsx("div",{className:f("rounded-lg p-4 border",i.wouldViolate?"bg-red-50 border-red-200":"bg-green-50 border-green-200"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[i.wouldViolate?e.jsx(z,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}):e.jsx(W,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:f("font-semibold",i.wouldViolate?"text-red-800":"text-green-800"),children:i.wouldViolate?"This trip would violate the 90/180 rule":"This trip is safe"}),e.jsx("p",{className:f("text-sm mt-1",i.wouldViolate?"text-red-700":"text-green-700"),children:i.wouldViolate?`You would exceed the limit by ${i.daysOverLimit} day${i.daysOverLimit!==1?"s":""}.`:`You would use ${i.maxDaysUsed} of your 90 days.`}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Trip Length"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[i.proposedLength," day",i.proposedLength!==1?"s":""]})]}),e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Max Days Used"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:i.maxDaysUsed})]})]}),i.wouldViolate&&e.jsxs("div",{className:"mt-4 space-y-3",children:[i.earliestSafeDate&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ne,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Earliest safe start date:"})," ",q(i.earliestSafeDate)]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ne,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsxs("span",{className:"font-medium",children:["Max safe trip length from ",q(s),":"]})," ",i.maxSafeLength," day",i.maxSafeLength!==1?"s":""]})]})]})]})]})}),o.isError&&e.jsx("div",{className:"rounded-lg p-4 bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(z,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("p",{className:"text-sm",children:"Failed to simulate trip. Please try again."})]})})]})}const st=["S","M","T","W","T","F","S"],tt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],at=["January","February","March","April","May","June","July","August","September","October","November","December"],rt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function nt({trips:s,windowStart:t,windowEnd:n}){const a=h.useMemo(()=>new Date().toISOString().split("T")[0],[]),i=h.useMemo(()=>new Date(a),[a]),[r,o]=h.useState(i.getMonth()),[l,c]=h.useState(i.getFullYear()),d=h.useMemo(()=>{const b=new Map;return s.forEach(g=>{const x=new Date(g.startDate),N=new Date(g.endDate),k=new Date(x);for(;k<=N;){const T=k.toISOString().split("T")[0];b.set(T,g),k.setDate(k.getDate()+1)}}),b},[s]),u=h.useMemo(()=>{const b=[],g=new Date(l,r,1),x=new Date(l,r+1,0),N=new Date(t),k=new Date(n),T=g.getDay();for(let S=T-1;S>=0;S--){const p=new Date(l,r,-S),L=p.toISOString().split("T")[0];b.push({date:p,isCurrentMonth:!1,isToday:!1,isInWindow:p>=N&&p<=k,trip:d.get(L)||null,isFuture:p>i})}for(let S=1;S<=x.getDate();S++){const p=new Date(l,r,S),L=p.toISOString().split("T")[0];b.push({date:p,isCurrentMonth:!0,isToday:L===a,isInWindow:p>=N&&p<=k,trip:d.get(L)||null,isFuture:p>i})}const v=6-x.getDay();for(let S=1;S<=v;S++){const p=new Date(l,r+1,S),L=p.toISOString().split("T")[0];b.push({date:p,isCurrentMonth:!1,isToday:!1,isInWindow:p>=N&&p<=k,trip:d.get(L)||null,isFuture:p>i})}return b},[r,l,d,t,n,i,a]),j=()=>{r===0?(o(11),c(l-1)):o(r-1)},y=()=>{r===11?(o(0),c(l+1)):o(r+1)},w=()=>{o(i.getMonth()),c(i.getFullYear())};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:j,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Previous month",children:e.jsx(Re,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsx("button",{onClick:y,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Next month",children:e.jsx(Ue,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-gray-900 ml-1 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline",children:at[r]}),e.jsx("span",{className:"sm:hidden",children:rt[r]})," ",l]})]}),e.jsx("button",{onClick:w,className:"px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",children:"Today"})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200",children:tt.map((b,g)=>e.jsxs("div",{className:"py-1.5 sm:py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("span",{className:"hidden sm:inline",children:b}),e.jsx("span",{className:"sm:hidden",children:st[g]})]},b))}),e.jsx("div",{className:"grid grid-cols-7",children:u.map((b,g)=>{const{date:x,isCurrentMonth:N,isToday:k,isInWindow:T,trip:v,isFuture:S}=b;return e.jsxs("div",{className:f("relative min-h-[44px] sm:min-h-[60px] p-0.5 sm:p-1 border-b border-r border-gray-100",!N&&"bg-gray-50",k&&"bg-primary-50"),children:[e.jsx("span",{className:f("inline-flex items-center justify-center w-5 h-5 sm:w-6 sm:h-6 text-xs sm:text-sm rounded-full",k&&"bg-primary-600 text-white font-medium",!k&&N&&"text-gray-900",!k&&!N&&"text-gray-400"),children:x.getDate()}),v&&e.jsxs("div",{className:f("mt-0.5 sm:mt-1 px-0.5 sm:px-1 py-0.5 rounded text-[10px] sm:text-xs truncate",S?"bg-blue-100 text-blue-700 border border-dashed border-blue-300":T?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600"),title:`${v.country}${S?" (planned)":""}`,children:[e.jsx(he,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 inline-block sm:mr-0.5","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Trip to "}),e.jsx("span",{className:"hidden sm:inline",children:v.country.slice(0,3)})]}),T&&!v&&N&&e.jsx("div",{className:"absolute bottom-0.5 sm:bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-green-400",title:"In current 180-day window"})]},g)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 p-2 sm:p-3 border-t border-gray-200 text-[10px] sm:text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-primary-100 border border-primary-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (in window)"}),e.jsx("span",{className:"sm:hidden",children:"In window"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-blue-100 border border-dashed border-blue-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Future trip"}),e.jsx("span",{className:"sm:hidden",children:"Future"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-gray-100 border border-gray-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (outside window)"}),e.jsx("span",{className:"sm:hidden",children:"Outside"})]})]})]})}function it({compact:s=!1}){const[t,n]=h.useState(new Set),[a,i]=h.useState(!1),[r,o]=h.useState(null),[l,c]=h.useState(null),d=h.useRef(null),u=is(),j=ls(),y=os("pending"),w=u.data??[],b=j.data??[],g=y.data??[],x=y.refetch,N=u.isLoading,k=j.isLoading,T=y.isLoading,v=u.error,S=j.error,p=y.error,L=ds(),D=cs(),$=ms(),J=xs(),U=hs(),Y=us();h.useEffect(()=>{try{const m=new URLSearchParams(window.location.search),E=m.get("calendar_connected"),G=m.get("calendar_error");if(E){o(`Successfully connected ${E==="google"?"Google Calendar":"Microsoft Outlook"}!`),m.delete("calendar_connected");const F=m.toString(),je=window.location.pathname+(F?`?${F}`:"");window.history.replaceState({},"",je),x()}if(G){c(decodeURIComponent(G)),m.delete("calendar_error");const F=m.toString(),je=window.location.pathname+(F?`?${F}`:"");window.history.replaceState({},"",je)}}catch(m){console.error("Error handling URL params:",m)}},[x]),h.useEffect(()=>{if(r){const m=setTimeout(()=>o(null),5e3);return()=>clearTimeout(m)}},[r]),h.useEffect(()=>{if(l){const m=setTimeout(()=>c(null),8e3);return()=>clearTimeout(m)}},[l]);const I=m=>{c(null),L.mutate(m,{onError:E=>{c(E instanceof Error?E.message:"Failed to connect")}})},P=m=>{confirm("Are you sure you want to disconnect this calendar? Pending events will be removed.")&&D.mutate(m,{onSuccess:()=>{o("Calendar disconnected")},onError:E=>{c(E instanceof Error?E.message:"Failed to disconnect")}})},A=m=>{$.mutate(m,{onSuccess:E=>{o(`Synced! Found ${E.travelDetected} travel events.`)},onError:E=>{c(E instanceof Error?E.message:"Sync failed")}})},C=m=>{var G;const E=(G=m.target.files)==null?void 0:G[0];E&&Y.mutate(E,{onSuccess:F=>{o(`Imported ${F.detected} travel events from ${F.parsed} calendar entries.`),d.current&&(d.current.value="")},onError:F=>{c(F instanceof Error?F.message:"Failed to import file")}})},re=m=>{const E=new Set(t);E.has(m)?E.delete(m):E.add(m),n(E)},O=()=>{if(!g)return;const m=g.filter(E=>E.isSchengen);t.size===m.length?n(new Set):n(new Set(m.map(E=>E.id)))},ee=()=>{t.size!==0&&J.mutate(Array.from(t),{onSuccess:m=>{o(`Imported ${m.imported} trips!`),n(new Set)},onError:m=>{c(m instanceof Error?m.message:"Import failed")}})},Ze=()=>{t.size!==0&&U.mutate(Array.from(t),{onSuccess:m=>{o(`Skipped ${m.skipped} events.`),n(new Set)},onError:m=>{c(m instanceof Error?m.message:"Skip failed")}})},Ke=N||k||T,qe=!!(v||S||p),pe=b.length>0,ye=g.length>0,se=g.filter(m=>m.isSchengen),be=g.filter(m=>!m.isSchengen),fe=m=>m instanceof Error?m.message:typeof m=="string"?m:"Unknown error";if(Ke)return e.jsx("div",{className:f("card p-6",s&&"p-4"),children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(M,{className:"w-6 h-6 animate-spin text-primary-600","aria-hidden":"true"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading calendar sync..."})]})});if(qe){const m=v?fe(v):S?fe(S):p?fe(p):"Failed to load calendar data";return e.jsx("div",{className:f("card p-6",s&&"p-4"),children:e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ne,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Unable to load calendar sync"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m})]})]})})}return s?e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Calendar Sync"})]}),ye&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 text-xs font-medium rounded-full",children:[se.length," to review"]})]}),pe?e.jsx("div",{className:"space-y-2",children:b.map(m=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-green-500","aria-hidden":"true"}),e.jsx("span",{children:m.providerName})]}),e.jsx("button",{onClick:()=>A(m.id),disabled:$.isPending,className:"text-primary-600 hover:text-primary-700 text-xs font-medium",children:$.isPending?"Syncing...":"Sync now"})]},m.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Connect your calendar to auto-detect travel."})]}):e.jsxs("div",{className:"space-y-6",children:[r&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(W,{className:"w-5 h-5 text-green-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-green-800",children:r}),e.jsx("button",{onClick:()=>o(null),className:"ml-auto text-green-600 hover:text-green-800",children:e.jsx(K,{className:"w-4 h-4","aria-hidden":"true"})})]}),l&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ne,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:l}),e.jsx("button",{onClick:()=>c(null),className:"ml-auto text-red-600 hover:text-red-800",children:e.jsx(K,{className:"w-4 h-4","aria-hidden":"true"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Connected Calendars"})}),e.jsxs("div",{className:"p-6",children:[pe?e.jsx("div",{className:"space-y-4",children:b.map(m=>e.jsx(lt,{connection:m,onSync:()=>A(m.id),onDisconnect:()=>P(m.id),isSyncing:$.isPending,isDisconnecting:D.isPending},m.id))}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(R,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No calendars connected yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Connect a calendar to automatically detect travel events"})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Add Calendar"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:w.map(m=>{const E=b.some(F=>F.provider===m.id),G=m.isConfigured&&!E;return e.jsxs("button",{onClick:()=>G&&I(m.id),disabled:!G||L.isPending,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",G?"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[L.isPending?e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(zs,{className:"w-4 h-4","aria-hidden":"true"}),m.name,E&&e.jsx("span",{className:"text-xs text-green-600",children:"(Connected)"}),!m.isConfigured&&e.jsx("span",{className:"text-xs text-gray-400",children:"(Not configured)"})]},m.id)})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Import iCal File"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{ref:d,type:"file",accept:".ics,text/calendar",onChange:C,className:"hidden",id:"ical-upload"}),e.jsxs("label",{htmlFor:"ical-upload",className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium cursor-pointer transition-colors",Y.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"),children:[Y.isPending?e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(gs,{className:"w-4 h-4","aria-hidden":"true"}),Y.isPending?"Uploading...":"Upload .ics file"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"Export from Apple Calendar, Outlook, or other apps"})]})]})]})]}),ye&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detected Travel Events"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Review and import these events as Schengen trips"})]}),se.length>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:O,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:t.size===se.length?"Deselect all":"Select all"})})]}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[se.length>0&&e.jsx("div",{children:se.map(m=>e.jsx(ot,{event:m,isSelected:t.has(m.id),onToggle:()=>re(m.id)},m.id))}),be.length>0&&e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsxs("button",{onClick:()=>i(!a),className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800",children:[a?e.jsx(We,{className:"w-4 h-4","aria-hidden":"true"}):e.jsx(Se,{className:"w-4 h-4","aria-hidden":"true"}),be.length," non-Schengen events detected"]}),a&&e.jsx("div",{className:"mt-4 space-y-2",children:be.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:m.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[me(m.startDate)," - ",me(m.endDate),m.location&&` â€¢ ${m.location}`]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:m.detectedCountry||"Unknown location"})]},m.id))})]})]}),t.size>0&&e.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[t.size," event",t.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Ze,disabled:U.isPending,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:[U.isPending?e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(K,{className:"w-4 h-4","aria-hidden":"true"}),"Skip"]}),e.jsxs("button",{onClick:ee,disabled:J.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-50",children:[J.isPending?e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"}),"Import as Trips"]})]})]}),se.length===0&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(W,{className:"w-8 h-8 text-green-500 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-600",children:"All Schengen travel events have been processed!"})]})]}),!ye&&pe&&e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx(W,{className:"w-12 h-12 text-green-400 mx-auto mb-3","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"All caught up!"}),e.jsx("p",{className:"text-gray-500",children:"No pending travel events to review. Events will appear here after syncing."})]})]})}function lt({connection:s,onSync:t,onDisconnect:n,isSyncing:a,isDisconnecting:i}){const r={active:"bg-green-100 text-green-700",error:"bg-red-100 text-red-700",expired:"bg-yellow-100 text-yellow-700"};return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm",children:e.jsx(R,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.providerName}),e.jsx("span",{className:f("px-2 py-0.5 rounded-full text-xs font-medium",r[s.syncStatus]),children:s.syncStatus})]}),s.lastSyncAt&&e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(xe,{className:"w-3 h-3","aria-hidden":"true"}),"Last synced: ",dt(s.lastSyncAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:t,disabled:a||s.syncStatus==="expired",className:f("inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",a||s.syncStatus==="expired"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-100 text-primary-700 hover:bg-primary-200"),children:[a?e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Oe,{className:"w-4 h-4","aria-hidden":"true"}),a?"Syncing...":"Sync"]}),e.jsx("button",{onClick:n,disabled:i,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 transition-colors",children:i?e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Us,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}function ot({event:s,isSelected:t,onToggle:n}){const a=s.confidence>=.8?"High":s.confidence>=.5?"Medium":"Low",i=s.confidence>=.8?"text-green-600":s.confidence>=.5?"text-yellow-600":"text-gray-500";return e.jsxs("div",{className:f("flex items-center gap-4 p-4 hover:bg-gray-50 cursor-pointer transition-colors",t&&"bg-primary-50"),onClick:n,role:"checkbox","aria-checked":t,tabIndex:0,onKeyDown:r=>{(r.key===" "||r.key==="Enter")&&(r.preventDefault(),n())},children:[e.jsx("div",{className:f("w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0",t?"bg-primary-600 border-primary-600":"border-gray-300"),children:t&&e.jsx(Z,{className:"w-3 h-3 text-white","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-primary-500 flex-shrink-0","aria-hidden":"true"}),e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:s.title})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3","aria-hidden":"true"}),me(s.startDate)," - ",me(s.endDate)]}),s.location&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(_,{className:"w-3 h-3","aria-hidden":"true"}),s.location]})]})]}),e.jsx("div",{className:"flex items-center gap-4 flex-shrink-0",children:s.detectedCountry&&e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:[s.countryCode&&e.jsx("span",{className:"font-mono",children:s.countryCode}),s.detectedCountry]}),e.jsxs("p",{className:f("text-xs mt-1",i),children:[a," confidence"]})]})})]})}function me(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function dt(s){const t=new Date(s),a=new Date().getTime()-t.getTime(),i=Math.floor(a/6e4),r=Math.floor(a/36e5),o=Math.floor(a/864e5);return i<1?"just now":i<60?`${i}m ago`:r<24?`${r}h ago`:o<7?`${o}d ago`:t.toLocaleDateString()}function ct({disabled:s}){const[t,n]=h.useState(!1),[a,i]=h.useState(null),r=h.useRef(null),o=ps(),l=()=>{o.mutate(void 0,{onSuccess:j=>{i(j),n(!0)}})},c=()=>{var j;(j=r.current)!=null&&j.contentWindow&&r.current.contentWindow.print()},d=()=>{if(!a)return;const j=new Blob([a.html],{type:"text/html"}),y=URL.createObjectURL(j),w=document.createElement("a");w.href=y,w.download=a.filename.replace(".pdf",".html"),document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(y)},u=()=>{n(!1),i(null)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l,disabled:s||o.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Export Schengen report as PDF",children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-4 h-4","aria-hidden":"true"}),"Export Report"]})}),e.jsx(ae,{isOpen:t,onClose:u,title:"Schengen Report Preview",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.summary)&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.daysUsed}),e.jsx("p",{className:"text-xs text-gray-500",children:"Days Used"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.daysRemaining}),e.jsx("p",{className:"text-xs text-gray-500",children:"Remaining"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:a.summary.status}),e.jsx("p",{className:"text-xs text-gray-500",children:"Status"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.tripCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Trips"})]})]}),(a==null?void 0:a.html)&&e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",style:{height:"400px"},children:e.jsx("iframe",{ref:r,srcDoc:a.html,title:"Report Preview",className:"w-full h-full",sandbox:"allow-same-origin"})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Close"}),e.jsxs("button",{onClick:d,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(Ps,{className:"w-4 h-4","aria-hidden":"true"}),"Download HTML"]}),e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700",children:[e.jsx(Rs,{className:"w-4 h-4","aria-hidden":"true"}),"Print / Save as PDF"]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:`Tip: Use your browser's "Print to PDF" option to save as a PDF file`})]})}),o.isError&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-50 border border-red-200 rounded-lg p-4 shadow-lg flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-red-800",children:"Failed to generate report. Please try again."}),e.jsx("button",{onClick:()=>o.reset(),className:"text-red-600 hover:text-red-800","aria-label":"Dismiss error",children:e.jsx(K,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}const mt={enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4};function Be(s={}){const t={...mt,...s},[n,a]=h.useState(null),[i,r]=h.useState(null),[o,l]=h.useState(!1),[c,d]=h.useState("prompt"),u=typeof navigator<"u"&&"geolocation"in navigator;h.useEffect(()=>{if(!u){d("unavailable");return}"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(w=>{d(w.state),w.addEventListener("change",()=>{d(w.state)})}).catch(()=>{d("prompt")})},[u]);const j=h.useCallback(()=>new Promise((w,b)=>{if(!u){const g={code:0,message:"Geolocation is not supported by this browser."};r(g),b(g);return}l(!0),r(null),navigator.geolocation.getCurrentPosition(g=>{const x={lat:g.coords.latitude,lng:g.coords.longitude,accuracy:g.coords.accuracy,timestamp:g.timestamp};a(x),r(null),l(!1),d("granted"),w(x)},g=>{const x={code:g.code,message:xt(g.code)};r(x),l(!1),g.code===g.PERMISSION_DENIED&&d("denied"),b(x)},{enableHighAccuracy:t.enableHighAccuracy,timeout:t.timeout,maximumAge:t.maximumAge})}),[u,t.enableHighAccuracy,t.timeout,t.maximumAge]),y=h.useCallback(()=>{a(null),r(null)},[]);return{position:n,error:i,isLoading:o,permission:c,isSupported:u,getCurrentPosition:j,clearPosition:y}}function xt(s){switch(s){case 1:return"Location permission denied. Please enable location access in your browser settings.";case 2:return"Unable to determine your location. Please try again.";case 3:return"Location request timed out. Please try again.";default:return"An unknown error occurred while getting your location."}}function Ee({compact:s=!1}){const[t,n]=h.useState(!1),[a,i]=h.useState(!1),{error:r,isLoading:o,permission:l,isSupported:c,getCurrentPosition:d}=Be(),{data:u,isLoading:j}=ys(),y=He(),w=h.useCallback(async()=>{try{const N=await d();await y.mutateAsync({lat:N.lat,lng:N.lng,accuracy:N.accuracy,source:"checkin"})}catch(N){console.error("Check-in failed:",N)}},[d,y]),b=(u==null?void 0:u.hasCheckedInToday)??!1,g=u==null?void 0:u.lastLocation,x=o||y.isPending;return s?e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-2 rounded-lg",b?"bg-green-100":"bg-gray-100"),children:e.jsx(_,{className:f("w-5 h-5",b?"text-green-600":"text-gray-500"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Location Check-in"}),b&&g?e.jsxs("p",{className:"text-xs text-green-600",children:["Checked in: ",g.countryName??"Unknown",g.isSchengen&&" (Schengen)"]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Not checked in today"})]})]}),e.jsx("button",{onClick:w,disabled:x||!c,className:f("inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",x?"bg-gray-100 text-gray-400 cursor-not-allowed":b?"bg-green-100 text-green-700 hover:bg-green-200":"bg-primary-600 text-white hover:bg-primary-700"),children:x?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Checking in..."})]}):b?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4","aria-hidden":"true"}),"Update"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4","aria-hidden":"true"}),"Check In"]})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-3 rounded-xl",b?"bg-green-100":"bg-blue-100"),children:e.jsx(_,{className:f("w-6 h-6",b?"text-green-600":"text-blue-600"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Check-in"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Record your current location for Schengen tracking"})]})]}),e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Fs,{className:"w-4 h-4","aria-hidden":"true"}),"History"]})]}),!c&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Geolocation is not supported by your browser. Try using a modern browser like Chrome, Firefox, or Safari."})]}),l==="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Location permission denied"}),e.jsx("p",{className:"text-sm text-red-700",children:"Please enable location access in your browser settings to use this feature."})]})]}),r&&l!=="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:r.message})]}),y.error&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"Failed to save location."}),e.jsx("p",{className:"mt-1 text-xs",children:y.error instanceof Error?y.error.message:"Please try again."})]})]}),j?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(M,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})}):b&&g?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-6 h-6 text-green-600","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-800",children:"Checked in today"}),e.jsxs("p",{className:"text-sm text-green-700",children:[g.city&&`${g.city}, `,g.countryName??"Unknown location",g.isSchengen&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:[e.jsx(B,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Schengen"]})]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["at ",new Date(g.recordedAt).toLocaleTimeString()]})]})]})}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-500","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You haven't checked in today. Check in to record your location for Schengen tracking."})]})}),e.jsx("button",{onClick:w,disabled:x||!c||l==="denied",className:f("w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors",x||!c||l==="denied"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:x?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}),"Getting your location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-5 h-5","aria-hidden":"true"}),b?"Update Location":"Check In Now"]})}),y.isSuccess&&y.data&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(W,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:y.data.message})]})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-blue-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"How location tracking works:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Your location is detected using your browser's GPS"}),e.jsx("li",{children:"We determine which country you're in automatically"}),e.jsx("li",{children:"Schengen zone countries are tracked for the 90/180 rule"}),e.jsx("li",{children:"You can view and delete your location history at any time"})]})]})]})})]}),e.jsx(ae,{isOpen:t,onClose:()=>n(!1),title:"Location History",size:"lg",children:e.jsx(ht,{onClearRequest:()=>i(!0)})}),e.jsx(ae,{isOpen:a,onClose:()=>i(!1),title:"Clear Location History",size:"sm",children:e.jsx(gt,{onConfirm:()=>{i(!1),n(!1)},onCancel:()=>i(!1)})})]})}function ht({onClearRequest:s}){const{data:t,isLoading:n,refetch:a,isRefetching:i}=bs({limit:50}),r=fs(),o=async c=>{confirm("Delete this location entry?")&&await r.mutateAsync(c)};if(n)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})});const l=(t==null?void 0:t.locations)??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[(t==null?void 0:t.total)??0," location",((t==null?void 0:t.total)??0)!==1?"s":""," recorded"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>a(),disabled:i,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",children:[e.jsx(Oe,{className:f("w-4 h-4",i&&"animate-spin"),"aria-hidden":"true"}),"Refresh"]}),l.length>0&&e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-colors",children:[e.jsx(ve,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All"]})]})]}),l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500",children:"No location history yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Check in to start recording your locations"})]}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:l.map(c=>e.jsx(ut,{location:c,onDelete:()=>o(c.id),isDeleting:r.isPending},c.id))})]})}function ut({location:s,onDelete:t,isDeleting:n}){const a=new Date(s.recordedAt);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-2 rounded-lg",s.isSchengen?"bg-blue-100":"bg-gray-100"),children:s.isSchengen?e.jsx(B,{className:"w-4 h-4 text-blue-600","aria-hidden":"true"}):e.jsx(_,{className:"w-4 h-4 text-gray-500","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[s.city&&`${s.city}, `,s.countryName??"Unknown location",s.isSchengen&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Schengen)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.toLocaleDateString()," at ",a.toLocaleTimeString(),s.accuracy&&e.jsxs("span",{className:"ml-2",children:["(Â±",Math.round(s.accuracy),"m)"]})]})]})]}),e.jsx("button",{onClick:t,disabled:n,className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-red-600 transition-all",title:"Delete",children:e.jsx(K,{className:"w-4 h-4","aria-hidden":"true"})})]})}function gt({onConfirm:s,onCancel:t}){const n=js(),a=async()=>{await n.mutateAsync(),s()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete all your location history? This action cannot be undone."}),n.error&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:"Failed to clear history. Please try again."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:t,disabled:n.isPending,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:n.isPending,className:f("inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors",n.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700"),children:n.isPending?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All History"]})})]})]})}const pt={"Europe/Paris":["FR"],"Europe/Berlin":["DE"],"Europe/Rome":["IT"],"Europe/Madrid":["ES"],"Europe/Amsterdam":["NL"],"Europe/Brussels":["BE"],"Europe/Vienna":["AT"],"Europe/Zurich":["CH"],"Europe/Stockholm":["SE"],"Europe/Oslo":["NO"],"Europe/Copenhagen":["DK"],"Europe/Helsinki":["FI"],"Europe/Warsaw":["PL"],"Europe/Prague":["CZ"],"Europe/Budapest":["HU"],"Europe/Athens":["GR"],"Europe/Lisbon":["PT"],"Europe/Dublin":["IE"],"Europe/London":["GB"],"Europe/Bucharest":["RO"],"Europe/Sofia":["BG"],"Europe/Zagreb":["HR"],"Europe/Ljubljana":["SI"],"Europe/Bratislava":["SK"],"Europe/Tallinn":["EE"],"Europe/Riga":["LV"],"Europe/Vilnius":["LT"],"Europe/Luxembourg":["LU"],"Europe/Malta":["MT"],"Europe/Reykjavik":["IS"],"Europe/Vaduz":["LI"],"Europe/Monaco":["MC"]},yt=new Set(["AT","BE","BG","HR","CZ","DK","EE","FI","FR","DE","GR","HU","IS","IT","LV","LI","LT","LU","MT","NL","NO","PL","PT","RO","SK","SI","ES","SE","CH"]),V={TIMEZONE:"r2f_schengen_last_timezone",LAST_CHECKIN:"r2f_schengen_last_checkin_date",PROMPT_DISMISSED:"r2f_schengen_prompt_dismissed_date"};function Le(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return"UTC"}}function bt(){return navigator.language||"en-US"}function Pe(s){const t=pt[s];return(t==null?void 0:t[0])||null}function Me(s){return s?yt.has(s):!1}function ie(){return new Date().toISOString().split("T")[0]}function ft(s={}){const{enableReminder:t=!0,reminderHour:n=9}=s,[a,i]=h.useState(()=>{const d=Le(),u=localStorage.getItem(V.TIMEZONE),j=localStorage.getItem(V.LAST_CHECKIN),y=localStorage.getItem(V.PROMPT_DISMISSED),w=ie(),b=Pe(d),g=u!==null&&u!==d,x=j===w,k=g||t&&!x&&!(y===w);return{currentTimezone:d,storedTimezone:u,timezoneChanged:g,likelyCountry:b,likelySchengen:Me(b),currentLocale:bt(),shouldPromptCheckin:k,lastCheckinDate:j,checkedInToday:x}});h.useEffect(()=>{const u=setInterval(()=>{const j=Le();i(y=>{if(y.currentTimezone!==j){const w=Pe(j);return{...y,currentTimezone:j,timezoneChanged:y.storedTimezone!==null&&y.storedTimezone!==j,likelyCountry:w,likelySchengen:Me(w),shouldPromptCheckin:!0}}return y})},3e5);return()=>clearInterval(u)},[]),h.useEffect(()=>{if(!t)return;const d=()=>{const j=new Date,y=ie(),w=localStorage.getItem(V.LAST_CHECKIN),b=localStorage.getItem(V.PROMPT_DISMISSED);j.getHours()>=n&&w!==y&&b!==y&&i(g=>({...g,shouldPromptCheckin:!0,checkedInToday:!1}))};d();const u=setInterval(d,60*1e3);return()=>clearInterval(u)},[t,n]);const r=h.useCallback(()=>{localStorage.setItem(V.TIMEZONE,a.currentTimezone),i(d=>({...d,storedTimezone:d.currentTimezone,timezoneChanged:!1}))},[a.currentTimezone]),o=h.useCallback(()=>{const d=ie();localStorage.setItem(V.LAST_CHECKIN,d),localStorage.setItem(V.TIMEZONE,a.currentTimezone),i(u=>({...u,lastCheckinDate:d,checkedInToday:!0,shouldPromptCheckin:!1,storedTimezone:u.currentTimezone,timezoneChanged:!1}))},[a.currentTimezone]),l=h.useCallback(()=>{const d=ie();localStorage.setItem(V.PROMPT_DISMISSED,d),i(u=>({...u,shouldPromptCheckin:!1}))},[]),c=h.useCallback(()=>new Date().getHours()>=n,[n]);return h.useMemo(()=>({state:a,acknowledgeTimezone:r,markCheckedIn:o,dismissPrompt:l,isReminderTime:c}),[a,r,o,l,c])}function jt(s){const t=s.toUpperCase().split("").map(n=>127397+n.charCodeAt(0));return String.fromCodePoint(...t)}function Nt({enabled:s=!0,onCheckin:t,onDismiss:n}){const[a,i]=h.useState(!1),{state:r,markCheckedIn:o,dismissPrompt:l}=ft({enableReminder:s}),{data:c}=Ns(),{getCurrentPosition:d,isLoading:u,isSupported:j}=Be(),y=He();h.useEffect(()=>{if(a){const L=setTimeout(()=>i(!1),3e3);return()=>clearTimeout(L)}},[a]);const w=h.useCallback(async()=>{try{const L=await d();await y.mutateAsync({lat:L.lat,lng:L.lng,accuracy:L.accuracy,source:"checkin"}),o(),i(!0),t==null||t()}catch(L){console.error("Check-in failed:",L)}},[d,y,o,t]),b=h.useCallback(()=>{l(),n==null||n()},[l,n]);if(!s||!r.shouldPromptCheckin||r.checkedInToday)return null;const g=u||y.isPending;let x=xe,N="Daily Location Check-in",k="Don't forget to check in your location for accurate Schengen tracking.",T="blue";if(r.timezoneChanged?(x=he,N="Travel Detected",k=`Your timezone changed from ${r.storedTimezone} to ${r.currentTimezone}. Are you traveling?`,T="amber"):c!=null&&c.detected&&c.countryCode&&r.likelyCountry&&c.countryCode!==r.likelyCountry&&(x=B,N="Location Check",k=`Your IP suggests you're in ${c.countryName||c.countryCode}. Check in to confirm your location.`,T="purple"),a)return e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(W,{className:"w-5 h-5 text-green-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Location recorded!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your location has been saved for Schengen tracking."})]})]})});const v=x,p={blue:{bg:"bg-blue-50",border:"border-blue-200",icon:"bg-blue-100 text-blue-600",title:"text-blue-800",message:"text-blue-700",button:"bg-blue-600 hover:bg-blue-700 text-white",dismiss:"text-blue-500 hover:text-blue-700 hover:bg-blue-100"},amber:{bg:"bg-amber-50",border:"border-amber-200",icon:"bg-amber-100 text-amber-600",title:"text-amber-800",message:"text-amber-700",button:"bg-amber-600 hover:bg-amber-700 text-white",dismiss:"text-amber-500 hover:text-amber-700 hover:bg-amber-100"},purple:{bg:"bg-purple-50",border:"border-purple-200",icon:"bg-purple-100 text-purple-600",title:"text-purple-800",message:"text-purple-700",button:"bg-purple-600 hover:bg-purple-700 text-white",dismiss:"text-purple-500 hover:text-purple-700 hover:bg-purple-100"}}[T];return e.jsx("div",{className:f("border rounded-lg p-4 mb-4",p.bg,p.border),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:f("p-2 rounded-lg",p.icon),children:e.jsx(v,{className:"w-5 h-5","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:f("font-medium",p.title),children:N}),(c==null?void 0:c.detected)&&c.countryCode&&e.jsx("span",{className:"text-lg",role:"img","aria-label":c.countryName||c.countryCode,children:jt(c.countryCode)})]}),e.jsx("p",{className:f("text-sm mt-0.5",p.message),children:k}),r.likelySchengen&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs",children:[e.jsx(B,{className:"w-3 h-3 text-blue-500","aria-hidden":"true"}),e.jsxs("span",{className:"text-blue-600",children:["Based on timezone: Likely in Schengen zone (",r.likelyCountry,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsx("button",{onClick:w,disabled:g||!j,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",g||!j?"bg-gray-100 text-gray-400 cursor-not-allowed":p.button),children:g?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Getting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4","aria-hidden":"true"}),"Check In Now"]})}),e.jsx("button",{onClick:b,className:f("px-3 py-2 rounded-lg text-sm transition-colors",p.dismiss),children:"Maybe later"})]}),y.error&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-sm text-red-600",children:[e.jsx(oe,{className:"w-4 h-4","aria-hidden":"true"}),"Failed to save location. Please try again."]}),!j&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs text-gray-500",children:[e.jsx(oe,{className:"w-3 h-3","aria-hidden":"true"}),"Geolocation is not supported by your browser."]})]})]}),e.jsx("button",{onClick:b,className:f("p-1 rounded transition-colors",p.dismiss),"aria-label":"Dismiss",children:e.jsx(K,{className:"w-4 h-4","aria-hidden":"true"})})]})})}const Je="r2f_schengen_onboarding_complete";function wt(){return localStorage.getItem(Je)==="true"}function Ae(){localStorage.setItem(Je,"true")}function vt({isOpen:s,onComplete:t,isPremium:n=!1}){const[a,i]=h.useState(0),r=[{icon:e.jsx(B,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Welcome to Schengen Tracker",description:"Understand and comply with the 90/180 day rule",details:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-5 bg-blue-50 border border-blue-100 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-base",children:"The 90/180 Rule"}),e.jsxs("p",{className:"text-blue-800 leading-relaxed",children:["Non-EU citizens may stay up to ",e.jsx("strong",{children:"90 days"})," within any"," ",e.jsx("strong",{children:"180-day rolling period"})," in the Schengen area without a long-stay visa."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Entry & Exit"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Both days count as full days"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Rolling Window"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Days expire after 180 days"})]})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Overstaying can result in fines, deportation, and future visa denials."})]})},{icon:e.jsx(he,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Track Your Trips",description:"Add your past and future Schengen travel",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Keep an accurate record of all your Schengen zone visits to stay compliant."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"1"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:'Click "Add Trip"'}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Enter your travel dates and destination country"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"2"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Add all past trips"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Include trips from the last 6 months for accurate tracking"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"3"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Plan future trips"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Add upcoming travel to see projected compliance"})]})]})]})]})},{icon:e.jsx(_,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Smart Location Check-in",description:"Quick daily check-ins keep your tracker current",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Use location check-in to automatically record your presence in Schengen countries."}),e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-600 flex items-center justify-center",children:e.jsx(Z,{className:"w-5 h-5 text-white","aria-hidden":"true"})}),e.jsx("h4",{className:"font-semibold text-green-900 text-base",children:"Automatic Trip Creation"})]}),e.jsx("p",{className:"text-green-800 leading-relaxed",children:"When you check in from a Schengen country, we automatically create or extend your trip record. No manual entry needed!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Browser Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:"One-click check-in with GPS"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Smart Detection"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Prompts when timezone changes"})]})]})]})},{icon:e.jsx(ce,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Plan Future Travel",description:'Use the "What If" calculator before you book',details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Before booking a trip, check if it would violate the 90/180 rule."}),e.jsxs("div",{className:"p-5 bg-primary-50 border border-primary-100 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-primary-900 mb-4 text-base",children:"The Planning Tool shows you:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"Whether your planned trip would be safe"]}),e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"The earliest safe date to start your trip"]}),e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"Maximum safe trip length from any date"]})]})]}),!n&&e.jsx("p",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-100 p-3 rounded-xl text-center",children:"â­ Planning Tool is a premium feature"})]})},{icon:e.jsx($e,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Stay Informed with Alerts",description:"Get notified before you approach the limit",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Enable email alerts to receive warnings when approaching your 90-day limit."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-yellow-50 border border-yellow-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-yellow-900",children:"60 days used"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Friendly reminder to plan ahead"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-orange-50 border border-orange-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-orange-900",children:"80 days used"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Warning to limit travel"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-red-50 border border-red-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-red-900",children:"85+ days used"}),e.jsx("p",{className:"text-sm text-red-700",children:"Urgent alert to avoid overstay"})]})]})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Enable alerts in the Settings tab after completing this tour."})]})}],o=()=>{a<r.length-1?i(a+1):(Ae(),t())},l=()=>{a>0&&i(a-1)},c=()=>{Ae(),t()},d=r[a],u=a===r.length-1;return e.jsx(ae,{isOpen:s,onClose:c,title:"",size:"lg",children:e.jsxs("div",{className:"px-4 py-6 sm:px-8 sm:py-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 bg-primary-50 rounded-2xl flex items-center justify-center",children:d.icon})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:d.title}),e.jsx("p",{className:"text-gray-500 text-lg",children:d.description})]}),e.jsx("div",{className:"mb-10 max-w-lg mx-auto",children:d.details}),e.jsx("div",{className:"flex justify-center gap-2.5 mb-8",children:r.map((j,y)=>e.jsx("button",{onClick:()=>i(y),className:f("h-2.5 rounded-full transition-all duration-300",y===a?"bg-primary-600 w-8":y<a?"bg-primary-300 w-2.5":"bg-gray-200 w-2.5"),"aria-label":`Go to step ${y+1}`},y))}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-100",children:[e.jsx("button",{onClick:c,className:"text-sm text-gray-400 hover:text-gray-600 transition-colors",children:"Skip tour"}),e.jsxs("div",{className:"flex items-center gap-3",children:[a>0&&e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-1.5 px-5 py-2.5 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(Re,{className:"w-4 h-4","aria-hidden":"true"}),"Back"]}),e.jsx("button",{onClick:o,className:"inline-flex items-center gap-1.5 px-6 py-2.5 bg-primary-600 text-white rounded-lg font-medium text-sm hover:bg-primary-700 transition-colors shadow-sm",children:u?e.jsxs(e.Fragment,{children:["Get Started",e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"})]}):e.jsxs(e.Fragment,{children:["Next",e.jsx(Ue,{className:"w-4 h-4","aria-hidden":"true"})]})})]})]})]})})}function St({className:s}){const{data:t,isLoading:n}=ws(),{data:a,isLoading:i}=Fe(),{data:r,isLoading:o}=vs(),l=Ss(),c=ks(),[d,u]=h.useState(!1),[j,y]=h.useState("all"),w=n||i||o,b=new Set((a==null?void 0:a.map(v=>v.code))||[]),g=(t==null?void 0:t.filter(v=>!b.has(v.code)))||[],N=(j==="all"?g:g.filter(v=>v.type===j)).reduce((v,S)=>{const p=S.type;return v[p]||(v[p]=[]),v[p].push(S),v},{}),k=async v=>{try{await l.mutateAsync(v)}catch(S){console.error("Failed to add jurisdiction:",S)}},T=async v=>{try{await c.mutateAsync(v)}catch(S){console.error("Failed to remove jurisdiction:",S)}};return w?e.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3",role:"status","aria-label":"Loading"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading jurisdictions..."})]})}):e.jsxs("div",{className:f("space-y-6",s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(B,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Jurisdiction Tracking"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Track multiple visa and residency rules"})]})]}),e.jsxs("button",{type:"button",onClick:()=>u(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(le,{className:"w-4 h-4","aria-hidden":"true"}),"Add Jurisdiction"]})]}),a&&a.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(v=>{const S=r==null?void 0:r[v.code];return e.jsx(kt,{jurisdiction:v,summary:S,onRemove:()=>T(v.code),isRemoving:c.isPending},v.code)})}):e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Jurisdictions Tracked"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add jurisdictions to track your visa and residency compliance across multiple countries."}),e.jsxs("button",{type:"button",onClick:()=>u(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(le,{className:"w-4 h-4","aria-hidden":"true"}),"Add Your First Jurisdiction"]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Jurisdiction"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:e.jsx(K,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:["all","zone","country","state"].map(v=>e.jsx("button",{type:"button",onClick:()=>y(v),className:f("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",j===v?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:v==="all"?"All":v==="zone"?"Zones":v==="country"?"Countries":"States"},v))})}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[50vh]",children:Object.keys(N).length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No jurisdictions available to add."}):e.jsx("div",{className:"space-y-4",children:Object.entries(N).map(([v,S])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-2",children:v==="zone"?"Visa Zones":v==="country"?"Country Rules":"State Rules"}),e.jsx("div",{className:"space-y-2",children:S.map(p=>e.jsxs("button",{type:"button",onClick:L=>{L.preventDefault(),k(p.code),u(!1)},disabled:l.isPending,className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors text-left",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:p.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[p.daysAllowed," days / ",p.windowDays," day window"]}),p.description&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:p.description})]}),e.jsx(le,{className:"w-5 h-5 text-primary-600 flex-shrink-0","aria-hidden":"true"})]},p.code))})]},v))})})]})})]})}function kt({jurisdiction:s,summary:t,onRemove:n,isRemoving:a}){const[i,r]=h.useState(!1),l=(y=>{switch(y){case"warning":return"warning";case"danger":return"danger";case"critical":case"violation":return"critical";default:return"safe"}})(t==null?void 0:t.status),c=(t==null?void 0:t.daysUsed)??0,d=(t==null?void 0:t.daysRemaining)??s.daysAllowed,u=(t==null?void 0:t.percentage)??0,j=y=>new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:f("card p-4 border-l-4",l==="safe"&&"border-l-green-500",l==="warning"&&"border-l-yellow-500",l==="danger"&&"border-l-orange-500",l==="critical"&&"border-l-red-500"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.type==="zone"?"Visa Zone":s.type==="country"?"Country Rule":"State Tax"})]}),e.jsx("button",{type:"button",onClick:n,disabled:a,className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors","aria-label":`Remove ${s.name}`,children:a?e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(K,{className:"w-4 h-4","aria-hidden":"true"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx(Ge,{daysUsed:c,daysRemaining:d,status:l,size:"sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[c," / ",s.daysAllowed," days"]}),e.jsx(Ve,{status:l,size:"sm"})]}),e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:f("h-full rounded-full transition-all duration-500",l==="safe"&&"bg-green-500",l==="warning"&&"bg-yellow-500",l==="danger"&&"bg-orange-500",l==="critical"&&"bg-red-500"),style:{width:`${Math.min(u,100)}%`}})})]})]}),e.jsxs("button",{type:"button",onClick:()=>r(!i),className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 transition-colors",children:[e.jsx(Se,{className:f("w-4 h-4 transition-transform",i&&"rotate-180"),"aria-hidden":"true"}),i?"Hide details":"Show details"]}),i&&t&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(R,{className:"w-3.5 h-3.5","aria-hidden":"true"}),e.jsxs("span",{children:["Window: ",j(t.windowStart)," - ",j(t.windowEnd)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(xe,{className:"w-3.5 h-3.5","aria-hidden":"true"}),e.jsxs("span",{children:["Counting: ",t.countingMethod==="rolling"?"Rolling Window":t.countingMethod==="calendar_year"?"Calendar Year":"Fiscal Year"]})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:s.description})]})]})}function $t(){const{trips:s,settings:t,isLoaded:n,addTrip:a,updateTrip:i,deleteTrip:r,updateSettings:o}=Hs(),{data:l,isLoading:c}=Cs(),d=Ts(),[u,j]=h.useState(!1),[y,w]=h.useState(null),[b,g]=h.useState("trips"),[x,N]=h.useState(null),[k,T]=h.useState(null),[v,S]=h.useState(!1);h.useEffect(()=>{n&&!wt()&&S(!0)},[n]);const p=h.useMemo(()=>Ys(s,{yellow:t.yellowThreshold,red:t.redThreshold}),[s,t.yellowThreshold,t.redThreshold]),L=async P=>{T(null);try{await a(P),j(!1)}catch(A){const C=A instanceof Error?A.message:"Failed to add trip";T(C),console.error("Failed to add trip:",A)}},D=async P=>{if(y){T(null);try{await i(y.id,P),w(null)}catch(A){const C=A instanceof Error?A.message:"Failed to update trip";T(C),console.error("Failed to update trip:",A)}}},$=async P=>{T(null);try{await r(P)}catch(A){const C=A instanceof Error?A.message:"Failed to delete trip";T(C),console.error("Failed to delete trip:",A)}},J=P=>{w(P)},U=()=>{j(!1),w(null)},Y=(l==null?void 0:l.canAddTrip)??!0,I=(l==null?void 0:l.isPremium)??!0;return!n||c?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3",role:"status","aria-label":"Loading"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Schengen Tracker"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track your 90/180 day Schengen zone compliance"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>S(!0),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Show help tour",title:"Show help tour",children:e.jsx(Ds,{className:"w-5 h-5","aria-hidden":"true"})}),I&&e.jsx(ct,{}),e.jsxs("button",{onClick:()=>j(!0),disabled:!Y,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors",Y?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[e.jsx(le,{className:"w-5 h-5","aria-hidden":"true"}),"Add Trip"]})]})]}),!I&&l&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-amber-600","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-amber-800",children:["Free Plan: ",l.tripCount," of ",l.tripLimit," trips used"]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Upgrade to Premium for unlimited trips, planning tools, and PDF reports"})]})]}),l.upgradeUrl&&e.jsxs("a",{href:l.upgradeUrl,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(de,{className:"w-4 h-4","aria-hidden":"true"}),"Upgrade"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card p-6 flex flex-col items-center justify-center",children:[e.jsx(Ge,{daysUsed:p.daysUsed,daysRemaining:p.daysRemaining,status:p.status,size:"lg"}),e.jsx("div",{className:"mt-4",children:e.jsx(Ve,{status:p.status,size:"lg"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:f("card p-4 border-l-4",p.status==="safe"&&"border-l-green-500",p.status==="warning"&&"border-l-yellow-500",p.status==="danger"&&"border-l-orange-500",p.status==="critical"&&"border-l-red-500"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Days Remaining"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.daysRemaining})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(R,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current 180-Day Window"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[q(p.windowStart)," - ",q(p.windowEnd)]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[p.nextExpiration&&e.jsx("div",{className:"card p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(R,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Next Day Expires"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:q(p.nextExpiration)}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"A day will drop off the 180-day window"})]})]})}),e.jsx("div",{className:"card p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"The 90/180 Rule"}),e.jsx("p",{children:"Non-EU citizens may stay up to 90 days within any 180-day period in the Schengen area without a visa."})]})]})})]})]}),e.jsx(Nt,{enabled:!0}),e.jsx(Ee,{compact:!0}),p.status==="warning"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(z,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-medium",children:"Approaching limit:"})," You have used ",p.daysUsed," of your 90 days. Plan future travel carefully to avoid overstaying."]})]}),p.status==="danger"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(z,{className:"w-5 h-5 text-orange-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("span",{className:"font-medium",children:"Warning:"})," You have used ",p.daysUsed," of your 90 days. Limited travel remaining in this window."]})]}),p.status==="critical"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(z,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("span",{className:"font-medium",children:"Limit reached:"})," You have used all 90 days allowed in this 180-day window. Additional travel may result in overstay violations."]})]}),k&&e.jsxs("div",{className:"flex items-center justify-between gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:k})]}),e.jsx("button",{onClick:()=>T(null),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Dismiss"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-6","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>g("trips"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",b==="trips"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4","aria-hidden":"true"}),"Trip List"]})}),e.jsx("button",{onClick:()=>g("jurisdictions"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",b==="jurisdictions"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"}),"Jurisdictions"]})}),e.jsx("button",{onClick:()=>g("calendar"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",b==="calendar"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(As,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar View",!I&&e.jsx(Te,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>g("sync"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",b==="sync"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar Sync"]})}),e.jsx("button",{onClick:()=>g("planning"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",b==="planning"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4","aria-hidden":"true"}),"Planning Tool",!I&&e.jsx(Te,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>g("location"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",b==="location"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4","aria-hidden":"true"}),"Location"]})}),e.jsx("button",{onClick:()=>g("settings"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",b==="settings"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4","aria-hidden":"true"}),"Settings"]})})]})}),b==="trips"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Your Trips"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.length," trip",s.length!==1?"s":""]})]}),e.jsx(Xs,{trips:s,currentWindowStart:p.windowStart,onEdit:J,onDelete:$})]}),b==="jurisdictions"&&e.jsx("div",{className:"card p-6",children:e.jsx(St,{})}),b==="calendar"&&(I?e.jsx(nt,{trips:s,windowStart:p.windowStart,windowEnd:p.windowEnd}):e.jsx(Ie,{feature:"Calendar View",description:"Visualize your trips on an interactive calendar to better understand your travel patterns and plan future trips.",upgradeUrl:l==null?void 0:l.upgradeUrl})),b==="sync"&&e.jsx(Es,{children:e.jsx(it,{})}),b==="planning"&&(I?e.jsx("div",{className:"card p-6",children:e.jsx(et,{})}):e.jsx(Ie,{feature:"Planning Tool",description:"Use the 'What If' calculator to check if a planned trip would violate the 90/180 rule before you book.",upgradeUrl:l==null?void 0:l.upgradeUrl})),b==="location"&&e.jsx(Ee,{}),b==="settings"&&e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(Ce,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tracker Settings"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure alerts and notification preferences"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx($e,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Alerts"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive email notifications when approaching your 90-day limit"})]})]}),e.jsx("button",{onClick:()=>o({emailAlerts:!t.emailAlerts}),className:f("relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",t.emailAlerts?"bg-primary-600":"bg-gray-200"),role:"switch","aria-checked":t.emailAlerts,children:e.jsx("span",{className:f("pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",t.emailAlerts?"translate-x-5":"translate-x-0")})})]}),t.emailAlerts&&e.jsx("div",{className:"mt-4 ml-14 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Alert thresholds:"})," You will receive email alerts when you reach 60 days (warning), 80 days (danger), and 85 days (urgent)."]})}),t.emailAlerts&&e.jsxs("div",{className:"mt-4 ml-14",children:[e.jsx("button",{onClick:()=>{N(null),d.mutate(void 0,{onSuccess:P=>{N({type:P.success?"success":"error",text:P.message})},onError:P=>{N({type:"error",text:P instanceof Error?P.message:"Failed to send test alert"})}})},disabled:d.isPending,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",d.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:d.isPending?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"w-4 h-4","aria-hidden":"true"}),"Send Test Alert"]})}),x&&e.jsxs("div",{className:f("mt-3 p-3 rounded-lg flex items-center gap-2 text-sm",x.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:[x.type==="success"?e.jsx(W,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}):e.jsx(z,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),x.text]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Warning Thresholds"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Warning Level"}),e.jsxs("p",{className:"text-lg font-bold text-yellow-900",children:[t.yellowThreshold," days"]}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Status turns yellow"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:"Danger Level"}),e.jsxs("p",{className:"text-lg font-bold text-orange-900",children:[t.redThreshold," days"]}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Status turns red"})]})]})]})]}),e.jsx(ae,{isOpen:u,onClose:U,title:"Add Trip",size:"md",children:e.jsx(De,{existingTrips:s,onSubmit:L,onCancel:U})}),e.jsx(ae,{isOpen:!!y,onClose:U,title:"Edit Trip",size:"md",children:y&&e.jsx(De,{trip:y,existingTrips:s,onSubmit:D,onCancel:U})}),e.jsx(vt,{isOpen:v,onComplete:()=>S(!1),isPremium:I})]})}function Ie({feature:s,description:t,upgradeUrl:n}){return e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(de,{className:"w-8 h-8 text-amber-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[s," is a Premium Feature"]}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:t}),n&&e.jsxs("a",{href:n,className:"inline-flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(de,{className:"w-5 h-5","aria-hidden":"true"}),"Upgrade to Premium"]})]})}export{$t as default};
