import{j as e}from"./vendor-query-D8MH73Ff.js";import{r as u}from"./vendor-react-F9Y4d3HK.js";import{a as f}from"./vendor-utils-C5RVuWu4.js";import{c as W,aH as _e,aI as We,aJ as $e,aK as Ye,aL as Ge,aM as Be,A as I,a2 as H,b as M,B as z,F as Te,aN as Ve,aO as Ke,C as F,O as X,ax as De,ah as Ee,aP as Ze,aQ as qe,aR as Je,aS as Xe,aT as Qe,aU as et,aV as tt,aW as st,aX as at,X as Z,q as rt,a as ge,a3 as Pe,aY as nt,l as q,aZ as it,a_ as Le,a$ as Q,b0 as lt,b1 as ot,b2 as dt,b3 as ct,Z as Ie,b4 as mt,b5 as xt,ae as ht,P as ut,Y as be}from"./main-C_N7cgOT.js";import{X as Me}from"./x-circle-ymJOS4iv.js";import{A as se}from"./alert-circle-B4Eddzej.js";import{B as gt}from"./briefcase-CHoRfpHd.js";import{T as pe}from"./trash-2-8Jk8TWmy.js";import{C as Ae}from"./chevron-up-Dunt1cE5.js";import{C as Fe}from"./chevron-down-DfzxE-vR.js";import{L as D}from"./loader-2-BUIrU9lX.js";import{P as ie}from"./plane-CMrYNkmr.js";import{u as pt}from"./vendor-router-CI589utZ.js";import{D as yt}from"./download-B4WLC2Yf.js";import{C as ae,L as fe}from"./lock-Cl-sOkPQ.js";import{S as bt}from"./send-COSyAObr.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=W("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=W("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=W("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=W("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=W("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=W("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=W("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=W("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),Ct={yellowThreshold:60,redThreshold:80,emailAlerts:!1,upcomingTripReminders:!0};function kt(){const{data:t=[],isLoading:s,isError:i}=_e(),{data:a=Ct,isLoading:n}=We(),r=$e(),l=Ye(),c=Ge(),o=Be(),m=!s&&!n,x=i,N=u.useMemo(()=>[...t].sort((j,w)=>new Date(w.startDate).getTime()-new Date(j.startDate).getTime()),[t]),b=u.useCallback(j=>r.mutateAsync(j),[r]),v=u.useCallback((j,w)=>l.mutateAsync({id:j,data:w}),[l]),p=u.useCallback(j=>c.mutateAsync(j),[c]),y=u.useCallback(j=>o.mutateAsync(j),[o]),d=r.isPending||l.isPending||c.isPending||o.isPending;return{trips:N,settings:a,isLoaded:m,isError:x,isSaving:d,addTrip:b,updateTrip:v,deleteTrip:p,updateSettings:y}}const ye=90,le=180;function A(t){if(t instanceof Date){const s=t.toISOString().split("T")[0];return new Date(s+"T00:00:00Z")}return new Date(t+"T00:00:00Z")}function oe(){const s=new Date().toISOString().split("T")[0];return new Date(s+"T00:00:00Z")}function B(t){return t.toISOString().split("T")[0]}function ze(t,s=oe()){const i=A(s),a=new Date(i.getTime()-(le-1)*24*60*60*1e3),n=new Set;return t.forEach(r=>{const l=A(r.startDate),c=A(r.endDate);if(l>i)return;const o=l<a?a:l,m=c>i?i:c;if(o<=m){const x=new Date(o);for(;x<=m;)n.add(B(x)),x.setTime(x.getTime()+24*60*60*1e3)}}),n.size}function Tt(t,s=oe()){const i=A(s),a=new Date(i.getTime()-(le-1)*24*60*60*1e3),n=new Set;return t.forEach(r=>{const l=A(r.startDate),c=A(r.endDate);if(l>i)return;const o=l<a?a:l,m=c>i?i:c;if(o<=m){const x=new Date(o);for(;x<=m;)n.add(B(x)),x.setTime(x.getTime()+24*60*60*1e3)}}),n}function Dt(t,s={yellow:60,red:80}){return t>=ye?"critical":t>=s.red?"danger":t>=s.yellow?"warning":"safe"}function Et(t,s=oe()){const i=Tt(t,s);if(i.size===0)return null;const n=Array.from(i).sort()[0],r=A(n);return r.setTime(r.getTime()+le*24*60*60*1e3),B(r)}function Pt(t,s={yellow:60,red:80}){const i=oe(),a=ze(t,i),n=Math.max(0,ye-a),r=i,l=new Date(i.getTime()-(le-1)*24*60*60*1e3);return{daysUsed:a,daysRemaining:n,windowStart:B(l),windowEnd:B(r),status:Dt(a,s),nextExpiration:Et(t,i),statusThresholds:s}}function Re(t,s){const i=A(t),a=A(s),n=Math.abs(a.getTime()-i.getTime());return Math.floor(n/(1e3*60*60*24))+1}function J(t){return Re(t.startDate,t.endDate)}function Lt(t,s,i){const a=A(s),n=A(i),r=new Date(a);let l=0;for(;r<=n;){const c={id:"temp",startDate:s,endDate:B(r),country:"France",category:"personal",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},o=[...t,c],m=ze(o,r);if(l=Math.max(l,m),m>ye)return{wouldViolate:!0,projectedDaysUsed:m,earliestSafeEntry:null,maxTripLength:null,message:`This trip would exceed the 90-day limit on ${B(r)} with ${m} days used.`};r.setTime(r.getTime()+24*60*60*1e3)}return{wouldViolate:!1,projectedDaysUsed:l,earliestSafeEntry:s,maxTripLength:Re(s,i),message:`This trip is safe. Maximum days used during trip: ${l}/90.`}}function _(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function It(t,s){const i=new Date(t),a=new Date(s);return t===s?_(t):i.getMonth()===a.getMonth()&&i.getFullYear()===a.getFullYear()?`${i.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.getDate()}, ${a.getFullYear()}`:i.getFullYear()===a.getFullYear()?`${i.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}, ${a.getFullYear()}`:`${_(t)} - ${_(s)}`}const Mt={safe:{stroke:"stroke-green-500",text:"text-green-600",bg:"bg-green-50"},warning:{stroke:"stroke-yellow-500",text:"text-yellow-600",bg:"bg-yellow-50"},danger:{stroke:"stroke-orange-500",text:"text-orange-600",bg:"bg-orange-50"},critical:{stroke:"stroke-red-500",text:"text-red-600",bg:"bg-red-50"}},At={sm:{container:"w-24 h-24",svgSize:96,strokeWidth:6,radius:42,textSize:"text-2xl",labelSize:"text-xs"},md:{container:"w-36 h-36",svgSize:144,strokeWidth:8,radius:64,textSize:"text-4xl",labelSize:"text-sm"},lg:{container:"w-48 h-48",svgSize:192,strokeWidth:10,radius:86,textSize:"text-5xl",labelSize:"text-base"}};function Ft({daysUsed:t,daysRemaining:s,status:i,size:a="md",className:n}){const r=Mt[i],l=At[a],c=Math.min(t/90*100,100),o=2*Math.PI*l.radius,m=o-c/100*o;return e.jsxs("div",{className:f("relative inline-flex",l.container,n),children:[e.jsxs("svg",{className:"transform -rotate-90",width:l.svgSize,height:l.svgSize,"aria-hidden":"true",children:[e.jsx("circle",{cx:l.svgSize/2,cy:l.svgSize/2,r:l.radius,fill:"none",strokeWidth:l.strokeWidth,className:"stroke-gray-200"}),e.jsx("circle",{cx:l.svgSize/2,cy:l.svgSize/2,r:l.radius,fill:"none",strokeWidth:l.strokeWidth,strokeLinecap:"round",strokeDasharray:o,strokeDashoffset:m,className:f("transition-all duration-500",r.stroke)})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:f("font-bold",l.textSize,r.text),"aria-label":`${t} days used`,children:t}),e.jsx("span",{className:f("text-gray-500",l.labelSize),children:"of 90 days"})]}),e.jsx("div",{role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":90,"aria-label":`Schengen days: ${t} used, ${s} remaining`,className:"sr-only"})]})}const zt={safe:{label:"Safe",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200",Icon:H},warning:{label:"Warning",bgColor:"bg-yellow-50",textColor:"text-yellow-700",borderColor:"border-yellow-200",Icon:I},danger:{label:"Danger",bgColor:"bg-orange-50",textColor:"text-orange-700",borderColor:"border-orange-200",Icon:se},critical:{label:"Critical",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200",Icon:Me}},Rt={sm:{badge:"px-2 py-0.5 text-xs",icon:"w-3 h-3"},md:{badge:"px-2.5 py-1 text-sm",icon:"w-4 h-4"},lg:{badge:"px-3 py-1.5 text-base",icon:"w-5 h-5"}};function Ut({status:t,showLabel:s=!0,size:i="md",className:a}){const n=zt[t],r=Rt[i],l=n.Icon;return e.jsxs("span",{className:f("inline-flex items-center gap-1 rounded-full border font-medium",n.bgColor,n.textColor,n.borderColor,r.badge,a),children:[e.jsx(l,{className:r.icon,"aria-hidden":"true"}),s&&e.jsx("span",{children:n.label})]})}const Ot=["Austria","Belgium","Bulgaria","Croatia","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Italy","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland"];function je({trip:t,existingTrips:s,onSubmit:i,onCancel:a,className:n}){const r=!!t,[l,c]=u.useState((t==null?void 0:t.startDate)||""),[o,m]=u.useState((t==null?void 0:t.endDate)||""),[x,N]=u.useState((t==null?void 0:t.country)||"France"),[b,v]=u.useState((t==null?void 0:t.category)||"personal"),[p,y]=u.useState((t==null?void 0:t.notes)||""),[d,j]=u.useState(null),[w,T]=u.useState(null);u.useEffect(()=>{if(l&&o){const h=r?s.filter(O=>O.id!==t.id):s,C=Lt(h,l,o);C.wouldViolate?j(C.message):C.projectedDaysUsed>=80?j(`This trip will bring you to ${C.projectedDaysUsed}/90 days - approaching the limit.`):C.projectedDaysUsed>=60?j(`This trip will bring you to ${C.projectedDaysUsed}/90 days.`):j(null)}else j(null)},[l,o,s,r,t]);const E=h=>{if(h.preventDefault(),T(null),!l||!o){T("Please enter both start and end dates.");return}if(new Date(o)<new Date(l)){T("End date must be on or after start date.");return}if(J({startDate:l,endDate:o})>90){T("A single trip cannot exceed 90 days.");return}i({startDate:l,endDate:o,country:x,category:b,notes:p.trim()||void 0})},S=l&&o?J({startDate:l,endDate:o}):null;return e.jsxs("form",{onSubmit:E,className:f("space-y-4",n),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(M,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Start Date"]}),e.jsx("input",{type:"date",id:"startDate",value:l,onChange:h=>c(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(M,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"End Date"]}),e.jsx("input",{type:"date",id:"endDate",value:o,onChange:h=>m(h.target.value),min:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]})]}),S!==null&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg",children:["Duration: ",e.jsxs("span",{className:"font-medium",children:[S," day",S!==1?"s":""]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(z,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Country"]}),e.jsx("select",{id:"country",value:x,onChange:h=>N(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:Ot.map(h=>e.jsx("option",{value:h,children:h},h))})]}),e.jsxs("div",{role:"radiogroup","aria-labelledby":"category-label",children:[e.jsxs("span",{id:"category-label",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(gt,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Category"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"personal",checked:b==="personal",onChange:()=>v("personal"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Personal"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"business",checked:b==="business",onChange:()=>v("business"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Business"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Te,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Notes (optional)"]}),e.jsx("textarea",{id:"notes",value:p,onChange:h=>y(h.target.value),rows:2,placeholder:"e.g., Visa appointment, apartment hunting...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-none"})]}),d&&e.jsxs("div",{className:"flex gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(I,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-amber-800",children:d})]}),w&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:w})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-primary-600 hover:bg-primary-700 rounded-lg font-medium transition-colors",children:r?"Save Changes":"Add Trip"})]})]})}function Ht({trips:t,currentWindowStart:s,onEdit:i,onDelete:a,className:n}){const[r,l]=u.useState("date"),[c,o]=u.useState("desc"),[m,x]=u.useState(null),N=d=>{r===d?o(j=>j==="asc"?"desc":"asc"):(l(d),o("desc"))},b=[...t].sort((d,j)=>{let w=0;switch(r){case"date":w=new Date(d.startDate).getTime()-new Date(j.startDate).getTime();break;case"country":w=d.country.localeCompare(j.country);break;case"duration":w=J(d)-J(j);break}return c==="asc"?w:-w}),v=d=>new Date(d.endDate)>=new Date(s),p=d=>{m===d?(a(d),x(null)):(x(d),setTimeout(()=>x(null),3e3))};if(t.length===0)return e.jsxs("div",{className:f("text-center py-12",n),children:[e.jsx(z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No trips recorded"}),e.jsx("p",{className:"text-gray-500",children:"Add your first trip to start tracking your Schengen days."})]});const y=({field:d})=>r!==d?null:c==="asc"?e.jsx(Ae,{className:"w-4 h-4"}):e.jsx(Fe,{className:"w-4 h-4"});return e.jsxs("div",{className:f("overflow-hidden",n),children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-3 bg-gray-50 border-b border-gray-200 text-sm font-medium text-gray-600",children:[e.jsxs("button",{onClick:()=>N("date"),className:"col-span-4 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(M,{className:"w-4 h-4","aria-hidden":"true"}),"Dates",e.jsx(y,{field:"date"})]}),e.jsxs("button",{onClick:()=>N("country"),className:"col-span-3 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(z,{className:"w-4 h-4","aria-hidden":"true"}),"Country",e.jsx(y,{field:"country"})]}),e.jsxs("button",{onClick:()=>N("duration"),className:"col-span-2 flex items-center gap-1 text-left hover:text-gray-900",children:["Days",e.jsx(y,{field:"duration"})]}),e.jsx("div",{className:"col-span-3 text-right",children:"Actions"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:b.map(d=>{const j=J(d),w=v(d);return e.jsxs("div",{className:f("grid grid-cols-12 gap-4 px-4 py-3 items-center",w?"bg-white":"bg-gray-50 opacity-75"),children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:It(d.startDate,d.endDate)}),d.notes&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:d.notes})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("span",{className:"text-sm text-gray-700",children:d.country}),e.jsx("span",{className:f("ml-2 text-xs px-1.5 py-0.5 rounded",d.category==="business"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"),children:d.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:[j," day",j!==1?"s":""]}),!w&&e.jsx("span",{className:"block text-xs text-gray-400",children:"outside window"})]}),e.jsxs("div",{className:"col-span-3 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(d),className:"p-2 text-gray-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors","aria-label":`Edit trip to ${d.country}`,children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(d.id),className:f("p-2 rounded-lg transition-colors",m===d.id?"text-white bg-red-600 hover:bg-red-700":"text-gray-400 hover:text-red-600 hover:bg-red-50"),"aria-label":m===d.id?"Confirm delete":`Delete trip to ${d.country}`,children:e.jsx(pe,{className:"w-4 h-4"})})]})]},d.id)})})]})}function _t(){const[t,s]=u.useState(""),[i,a]=u.useState(""),[n,r]=u.useState(null),l=Ke(),c=()=>{!t||!i||l.mutate({startDate:t,endDate:i},{onSuccess:x=>{r(x)}})},o=()=>{s(""),a(""),r(null)},m=t&&i&&new Date(i)>=new Date(t);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(re,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Trip Planning Tool"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Check if a planned trip would violate the 90/180 rule"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-start-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-start-date",value:t,onChange:x=>s(x.target.value),className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-end-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-end-date",value:i,onChange:x=>a(x.target.value),min:t,className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:c,disabled:!m||l.isPending,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",m&&!l.isPending?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4","aria-hidden":"true"}),"Check Trip"]})}),n&&e.jsx("button",{onClick:o,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Reset"})]}),n&&e.jsx("div",{className:f("rounded-lg p-4 border",n.wouldViolate?"bg-red-50 border-red-200":"bg-green-50 border-green-200"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[n.wouldViolate?e.jsx(I,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}):e.jsx(F,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:f("font-semibold",n.wouldViolate?"text-red-800":"text-green-800"),children:n.wouldViolate?"This trip would violate the 90/180 rule":"This trip is safe"}),e.jsx("p",{className:f("text-sm mt-1",n.wouldViolate?"text-red-700":"text-green-700"),children:n.wouldViolate?`You would exceed the limit by ${n.daysOverLimit} day${n.daysOverLimit!==1?"s":""}.`:`You would use ${n.maxDaysUsed} of your 90 days.`}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Trip Length"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[n.proposedLength," day",n.proposedLength!==1?"s":""]})]}),e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Max Days Used"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n.maxDaysUsed})]})]}),n.wouldViolate&&e.jsxs("div",{className:"mt-4 space-y-3",children:[n.earliestSafeDate&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Earliest safe start date:"})," ",_(n.earliestSafeDate)]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsxs("span",{className:"font-medium",children:["Max safe trip length from ",_(t),":"]})," ",n.maxSafeLength," day",n.maxSafeLength!==1?"s":""]})]})]})]})]})}),l.isError&&e.jsx("div",{className:"rounded-lg p-4 bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(I,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("p",{className:"text-sm",children:"Failed to simulate trip. Please try again."})]})})]})}const Wt=["S","M","T","W","T","F","S"],$t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Yt=["January","February","March","April","May","June","July","August","September","October","November","December"],Gt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Bt({trips:t,windowStart:s,windowEnd:i}){const a=u.useMemo(()=>new Date().toISOString().split("T")[0],[]),n=u.useMemo(()=>new Date(a),[a]),[r,l]=u.useState(n.getMonth()),[c,o]=u.useState(n.getFullYear()),m=u.useMemo(()=>{const p=new Map;return t.forEach(y=>{const d=new Date(y.startDate),j=new Date(y.endDate),w=new Date(d);for(;w<=j;){const T=w.toISOString().split("T")[0];p.set(T,y),w.setDate(w.getDate()+1)}}),p},[t]),x=u.useMemo(()=>{const p=[],y=new Date(c,r,1),d=new Date(c,r+1,0),j=new Date(s),w=new Date(i),T=y.getDay();for(let S=T-1;S>=0;S--){const h=new Date(c,r,-S),C=h.toISOString().split("T")[0];p.push({date:h,isCurrentMonth:!1,isToday:!1,isInWindow:h>=j&&h<=w,trip:m.get(C)||null,isFuture:h>n})}for(let S=1;S<=d.getDate();S++){const h=new Date(c,r,S),C=h.toISOString().split("T")[0];p.push({date:h,isCurrentMonth:!0,isToday:C===a,isInWindow:h>=j&&h<=w,trip:m.get(C)||null,isFuture:h>n})}const E=6-d.getDay();for(let S=1;S<=E;S++){const h=new Date(c,r+1,S),C=h.toISOString().split("T")[0];p.push({date:h,isCurrentMonth:!1,isToday:!1,isInWindow:h>=j&&h<=w,trip:m.get(C)||null,isFuture:h>n})}return p},[r,c,m,s,i,n,a]),N=()=>{r===0?(l(11),o(c-1)):l(r-1)},b=()=>{r===11?(l(0),o(c+1)):l(r+1)},v=()=>{l(n.getMonth()),o(n.getFullYear())};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:N,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Previous month",children:e.jsx(De,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsx("button",{onClick:b,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Next month",children:e.jsx(Ee,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-gray-900 ml-1 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline",children:Yt[r]}),e.jsx("span",{className:"sm:hidden",children:Gt[r]})," ",c]})]}),e.jsx("button",{onClick:v,className:"px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",children:"Today"})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200",children:$t.map((p,y)=>e.jsxs("div",{className:"py-1.5 sm:py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("span",{className:"hidden sm:inline",children:p}),e.jsx("span",{className:"sm:hidden",children:Wt[y]})]},p))}),e.jsx("div",{className:"grid grid-cols-7",children:x.map((p,y)=>{const{date:d,isCurrentMonth:j,isToday:w,isInWindow:T,trip:E,isFuture:S}=p;return e.jsxs("div",{className:f("relative min-h-[44px] sm:min-h-[60px] p-0.5 sm:p-1 border-b border-r border-gray-100",!j&&"bg-gray-50",w&&"bg-primary-50"),children:[e.jsx("span",{className:f("inline-flex items-center justify-center w-5 h-5 sm:w-6 sm:h-6 text-xs sm:text-sm rounded-full",w&&"bg-primary-600 text-white font-medium",!w&&j&&"text-gray-900",!w&&!j&&"text-gray-400"),children:d.getDate()}),E&&e.jsxs("div",{className:f("mt-0.5 sm:mt-1 px-0.5 sm:px-1 py-0.5 rounded text-[10px] sm:text-xs truncate",S?"bg-blue-100 text-blue-700 border border-dashed border-blue-300":T?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600"),title:`${E.country}${S?" (planned)":""}`,children:[e.jsx(ie,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 inline-block sm:mr-0.5","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Trip to "}),e.jsx("span",{className:"hidden sm:inline",children:E.country.slice(0,3)})]}),T&&!E&&j&&e.jsx("div",{className:"absolute bottom-0.5 sm:bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-green-400",title:"In current 180-day window"})]},y)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 p-2 sm:p-3 border-t border-gray-200 text-[10px] sm:text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-primary-100 border border-primary-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (in window)"}),e.jsx("span",{className:"sm:hidden",children:"In window"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-blue-100 border border-dashed border-blue-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Future trip"}),e.jsx("span",{className:"sm:hidden",children:"Future"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-gray-100 border border-gray-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (outside window)"}),e.jsx("span",{className:"sm:hidden",children:"Outside"})]})]})]})}function Vt({compact:t=!1}){const[s,i]=pt(),[a,n]=u.useState(new Set),[r,l]=u.useState(!1),[c,o]=u.useState(null),[m,x]=u.useState(null),N=u.useRef(null),{data:b,isLoading:v}=Ze(),{data:p,isLoading:y}=qe(),{data:d,isLoading:j,refetch:w}=Je("pending"),T=Xe(),E=Qe(),S=et(),h=tt(),C=st(),O=at();u.useEffect(()=>{const g=s.get("calendar_connected"),k=s.get("calendar_error");g&&(o(`Successfully connected ${g==="google"?"Google Calendar":"Microsoft Outlook"}!`),s.delete("calendar_connected"),i(s,{replace:!0}),w()),k&&(x(decodeURIComponent(k)),s.delete("calendar_error"),i(s,{replace:!0}))},[s,i,w]),u.useEffect(()=>{if(c){const g=setTimeout(()=>o(null),5e3);return()=>clearTimeout(g)}},[c]),u.useEffect(()=>{if(m){const g=setTimeout(()=>x(null),8e3);return()=>clearTimeout(g)}},[m]);const de=g=>{x(null),T.mutate(g,{onError:k=>{x(k instanceof Error?k.message:"Failed to connect")}})},ce=g=>{confirm("Are you sure you want to disconnect this calendar? Pending events will be removed.")&&E.mutate(g,{onSuccess:()=>{o("Calendar disconnected")},onError:k=>{x(k instanceof Error?k.message:"Failed to disconnect")}})},$=g=>{S.mutate(g,{onSuccess:k=>{o(`Synced! Found ${k.travelDetected} travel events.`)},onError:k=>{x(k instanceof Error?k.message:"Sync failed")}})},ee=g=>{var K;const k=(K=g.target.files)==null?void 0:K[0];k&&O.mutate(k,{onSuccess:G=>{o(`Imported ${G.detected} travel events from ${G.parsed} calendar entries.`),N.current&&(N.current.value="")},onError:G=>{x(G instanceof Error?G.message:"Failed to import file")}})},R=g=>{const k=new Set(a);k.has(g)?k.delete(g):k.add(g),n(k)},P=()=>{if(!d)return;const g=d.filter(k=>k.isSchengen);a.size===g.length?n(new Set):n(new Set(g.map(k=>k.id)))},L=()=>{a.size!==0&&h.mutate(Array.from(a),{onSuccess:g=>{o(`Imported ${g.imported} trips!`),n(new Set)},onError:g=>{x(g instanceof Error?g.message:"Import failed")}})},Y=()=>{a.size!==0&&C.mutate(Array.from(a),{onSuccess:g=>{o(`Skipped ${g.skipped} events.`),n(new Set)},onError:g=>{x(g instanceof Error?g.message:"Skip failed")}})},He=v||y||j,me=p&&p.length>0,xe=d&&d.length>0,V=(d==null?void 0:d.filter(g=>g.isSchengen))||[],he=(d==null?void 0:d.filter(g=>!g.isSchengen))||[];return He?e.jsx("div",{className:f("card p-6",t&&"p-4"),children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(D,{className:"w-6 h-6 animate-spin text-primary-600","aria-hidden":"true"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading calendar sync..."})]})}):t?e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Calendar Sync"})]}),xe&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 text-xs font-medium rounded-full",children:[V.length," to review"]})]}),me?e.jsx("div",{className:"space-y-2",children:p.map(g=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-green-500","aria-hidden":"true"}),e.jsx("span",{children:g.providerName})]}),e.jsx("button",{onClick:()=>$(g.id),disabled:S.isPending,className:"text-primary-600 hover:text-primary-700 text-xs font-medium",children:S.isPending?"Syncing...":"Sync now"})]},g.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Connect your calendar to auto-detect travel."})]}):e.jsxs("div",{className:"space-y-6",children:[c&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(F,{className:"w-5 h-5 text-green-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-green-800",children:c}),e.jsx("button",{onClick:()=>o(null),className:"ml-auto text-green-600 hover:text-green-800",children:e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"})})]}),m&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Me,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:m}),e.jsx("button",{onClick:()=>x(null),className:"ml-auto text-red-600 hover:text-red-800",children:e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Connected Calendars"})}),e.jsxs("div",{className:"p-6",children:[me?e.jsx("div",{className:"space-y-4",children:p.map(g=>e.jsx(Kt,{connection:g,onSync:()=>$(g.id),onDisconnect:()=>ce(g.id),isSyncing:S.isPending,isDisconnecting:E.isPending},g.id))}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(M,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No calendars connected yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Connect a calendar to automatically detect travel events"})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Add Calendar"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:b==null?void 0:b.map(g=>{const k=p==null?void 0:p.some(G=>G.provider===g.id),K=g.isConfigured&&!k;return e.jsxs("button",{onClick:()=>K&&de(g.id),disabled:!K||T.isPending,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",K?"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[T.isPending?e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(wt,{className:"w-4 h-4","aria-hidden":"true"}),g.name,k&&e.jsx("span",{className:"text-xs text-green-600",children:"(Connected)"}),!g.isConfigured&&e.jsx("span",{className:"text-xs text-gray-400",children:"(Not configured)"})]},g.id)})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Import iCal File"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{ref:N,type:"file",accept:".ics,text/calendar",onChange:ee,className:"hidden",id:"ical-upload"}),e.jsxs("label",{htmlFor:"ical-upload",className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium cursor-pointer transition-colors",O.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"),children:[O.isPending?e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(rt,{className:"w-4 h-4","aria-hidden":"true"}),O.isPending?"Uploading...":"Upload .ics file"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"Export from Apple Calendar, Outlook, or other apps"})]})]})]})]}),xe&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detected Travel Events"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Review and import these events as Schengen trips"})]}),V.length>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:P,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:a.size===V.length?"Deselect all":"Select all"})})]}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[V.length>0&&e.jsx("div",{children:V.map(g=>e.jsx(Zt,{event:g,isSelected:a.has(g.id),onToggle:()=>R(g.id)},g.id))}),he.length>0&&e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsxs("button",{onClick:()=>l(!r),className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800",children:[r?e.jsx(Ae,{className:"w-4 h-4","aria-hidden":"true"}):e.jsx(Fe,{className:"w-4 h-4","aria-hidden":"true"}),he.length," non-Schengen events detected"]}),r&&e.jsx("div",{className:"mt-4 space-y-2",children:he.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:g.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[ne(g.startDate)," - ",ne(g.endDate),g.location&&` â€¢ ${g.location}`]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:g.detectedCountry||"Unknown location"})]},g.id))})]})]}),a.size>0&&e.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[a.size," event",a.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Y,disabled:C.isPending,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:[C.isPending?e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"}),"Skip"]}),e.jsxs("button",{onClick:L,disabled:h.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-50",children:[h.isPending?e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(H,{className:"w-4 h-4","aria-hidden":"true"}),"Import as Trips"]})]})]}),V.length===0&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(F,{className:"w-8 h-8 text-green-500 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-600",children:"All Schengen travel events have been processed!"})]})]}),!xe&&me&&e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx(F,{className:"w-12 h-12 text-green-400 mx-auto mb-3","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"All caught up!"}),e.jsx("p",{className:"text-gray-500",children:"No pending travel events to review. Events will appear here after syncing."})]})]})}function Kt({connection:t,onSync:s,onDisconnect:i,isSyncing:a,isDisconnecting:n}){const r={active:"bg-green-100 text-green-700",error:"bg-red-100 text-red-700",expired:"bg-yellow-100 text-yellow-700"};return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm",children:e.jsx(M,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:t.providerName}),e.jsx("span",{className:f("px-2 py-0.5 rounded-full text-xs font-medium",r[t.syncStatus]),children:t.syncStatus})]}),t.lastSyncAt&&e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(ge,{className:"w-3 h-3","aria-hidden":"true"}),"Last synced: ",qt(t.lastSyncAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:s,disabled:a||t.syncStatus==="expired",className:f("inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",a||t.syncStatus==="expired"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-100 text-primary-700 hover:bg-primary-200"),children:[a?e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Pe,{className:"w-4 h-4","aria-hidden":"true"}),a?"Syncing...":"Sync"]}),e.jsx("button",{onClick:i,disabled:n,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 transition-colors",children:n?e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(St,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}function Zt({event:t,isSelected:s,onToggle:i}){const a=t.confidence>=.8?"High":t.confidence>=.5?"Medium":"Low",n=t.confidence>=.8?"text-green-600":t.confidence>=.5?"text-yellow-600":"text-gray-500";return e.jsxs("div",{className:f("flex items-center gap-4 p-4 hover:bg-gray-50 cursor-pointer transition-colors",s&&"bg-primary-50"),onClick:i,role:"checkbox","aria-checked":s,tabIndex:0,onKeyDown:r=>{(r.key===" "||r.key==="Enter")&&(r.preventDefault(),i())},children:[e.jsx("div",{className:f("w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0",s?"bg-primary-600 border-primary-600":"border-gray-300"),children:s&&e.jsx(H,{className:"w-3 h-3 text-white","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-primary-500 flex-shrink-0","aria-hidden":"true"}),e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3","aria-hidden":"true"}),ne(t.startDate)," - ",ne(t.endDate)]}),t.location&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(z,{className:"w-3 h-3","aria-hidden":"true"}),t.location]})]})]}),e.jsx("div",{className:"flex items-center gap-4 flex-shrink-0",children:t.detectedCountry&&e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:[t.countryCode&&e.jsx("span",{className:"font-mono",children:t.countryCode}),t.detectedCountry]}),e.jsxs("p",{className:f("text-xs mt-1",n),children:[a," confidence"]})]})})]})}function ne(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function qt(t){const s=new Date(t),a=new Date().getTime()-s.getTime(),n=Math.floor(a/6e4),r=Math.floor(a/36e5),l=Math.floor(a/864e5);return n<1?"just now":n<60?`${n}m ago`:r<24?`${r}h ago`:l<7?`${l}d ago`:s.toLocaleDateString()}function Jt({disabled:t}){const[s,i]=u.useState(!1),[a,n]=u.useState(null),r=u.useRef(null),l=nt(),c=()=>{l.mutate(void 0,{onSuccess:N=>{n(N),i(!0)}})},o=()=>{var N;(N=r.current)!=null&&N.contentWindow&&r.current.contentWindow.print()},m=()=>{if(!a)return;const N=new Blob([a.html],{type:"text/html"}),b=URL.createObjectURL(N),v=document.createElement("a");v.href=b,v.download=a.filename.replace(".pdf",".html"),document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(b)},x=()=>{i(!1),n(null)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,disabled:t||l.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Export Schengen report as PDF",children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4","aria-hidden":"true"}),"Export Report"]})}),e.jsx(q,{isOpen:s,onClose:x,title:"Schengen Report Preview",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.summary)&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.daysUsed}),e.jsx("p",{className:"text-xs text-gray-500",children:"Days Used"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.daysRemaining}),e.jsx("p",{className:"text-xs text-gray-500",children:"Remaining"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:a.summary.status}),e.jsx("p",{className:"text-xs text-gray-500",children:"Status"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.tripCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Trips"})]})]}),(a==null?void 0:a.html)&&e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",style:{height:"400px"},children:e.jsx("iframe",{ref:r,srcDoc:a.html,title:"Report Preview",className:"w-full h-full",sandbox:"allow-same-origin"})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Close"}),e.jsxs("button",{onClick:m,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(yt,{className:"w-4 h-4","aria-hidden":"true"}),"Download HTML"]}),e.jsxs("button",{onClick:o,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700",children:[e.jsx(vt,{className:"w-4 h-4","aria-hidden":"true"}),"Print / Save as PDF"]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:`Tip: Use your browser's "Print to PDF" option to save as a PDF file`})]})}),l.isError&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-50 border border-red-200 rounded-lg p-4 shadow-lg flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-red-800",children:"Failed to generate report. Please try again."}),e.jsx("button",{onClick:()=>l.reset(),className:"text-red-600 hover:text-red-800","aria-label":"Dismiss error",children:e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}const Xt={enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4};function Ue(t={}){const s={...Xt,...t},[i,a]=u.useState(null),[n,r]=u.useState(null),[l,c]=u.useState(!1),[o,m]=u.useState("prompt"),x=typeof navigator<"u"&&"geolocation"in navigator;u.useEffect(()=>{if(!x){m("unavailable");return}"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(v=>{m(v.state),v.addEventListener("change",()=>{m(v.state)})}).catch(()=>{m("prompt")})},[x]);const N=u.useCallback(()=>new Promise((v,p)=>{if(!x){const y={code:0,message:"Geolocation is not supported by this browser."};r(y),p(y);return}c(!0),r(null),navigator.geolocation.getCurrentPosition(y=>{const d={lat:y.coords.latitude,lng:y.coords.longitude,accuracy:y.coords.accuracy,timestamp:y.timestamp};a(d),r(null),c(!1),m("granted"),v(d)},y=>{const d={code:y.code,message:Qt(y.code)};r(d),c(!1),y.code===y.PERMISSION_DENIED&&m("denied"),p(d)},{enableHighAccuracy:s.enableHighAccuracy,timeout:s.timeout,maximumAge:s.maximumAge})}),[x,s.enableHighAccuracy,s.timeout,s.maximumAge]),b=u.useCallback(()=>{a(null),r(null)},[]);return{position:i,error:n,isLoading:l,permission:o,isSupported:x,getCurrentPosition:N,clearPosition:b}}function Qt(t){switch(t){case 1:return"Location permission denied. Please enable location access in your browser settings.";case 2:return"Unable to determine your location. Please try again.";case 3:return"Location request timed out. Please try again.";default:return"An unknown error occurred while getting your location."}}function Ne({compact:t=!1}){const[s,i]=u.useState(!1),[a,n]=u.useState(!1),{error:r,isLoading:l,permission:c,isSupported:o,getCurrentPosition:m}=Ue(),{data:x,isLoading:N}=it(),b=Le(),v=u.useCallback(async()=>{try{const j=await m();await b.mutateAsync({lat:j.lat,lng:j.lng,accuracy:j.accuracy,source:"checkin"})}catch(j){console.error("Check-in failed:",j)}},[m,b]),p=(x==null?void 0:x.hasCheckedInToday)??!1,y=x==null?void 0:x.lastLocation,d=l||b.isPending;return t?e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-2 rounded-lg",p?"bg-green-100":"bg-gray-100"),children:e.jsx(z,{className:f("w-5 h-5",p?"text-green-600":"text-gray-500"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Location Check-in"}),p&&y?e.jsxs("p",{className:"text-xs text-green-600",children:["Checked in: ",y.countryName??"Unknown",y.isSchengen&&" (Schengen)"]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Not checked in today"})]})]}),e.jsx("button",{onClick:v,disabled:d||!o,className:f("inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",d?"bg-gray-100 text-gray-400 cursor-not-allowed":p?"bg-green-100 text-green-700 hover:bg-green-200":"bg-primary-600 text-white hover:bg-primary-700"),children:d?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Checking in..."})]}):p?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4","aria-hidden":"true"}),"Update"]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4","aria-hidden":"true"}),"Check In"]})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-3 rounded-xl",p?"bg-green-100":"bg-blue-100"),children:e.jsx(z,{className:f("w-6 h-6",p?"text-green-600":"text-blue-600"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Check-in"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Record your current location for Schengen tracking"})]})]}),e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Nt,{className:"w-4 h-4","aria-hidden":"true"}),"History"]})]}),!o&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg mb-4",children:[e.jsx(I,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Geolocation is not supported by your browser. Try using a modern browser like Chrome, Firefox, or Safari."})]}),c==="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(I,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Location permission denied"}),e.jsx("p",{className:"text-sm text-red-700",children:"Please enable location access in your browser settings to use this feature."})]})]}),r&&c!=="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(I,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:r.message})]}),b.error&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(I,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"Failed to save location."}),e.jsx("p",{className:"mt-1 text-xs",children:b.error instanceof Error?b.error.message:"Please try again."})]})]}),N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(D,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})}):p&&y?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"w-6 h-6 text-green-600","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-800",children:"Checked in today"}),e.jsxs("p",{className:"text-sm text-green-700",children:[y.city&&`${y.city}, `,y.countryName??"Unknown location",y.isSchengen&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:[e.jsx(Q,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Schengen"]})]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["at ",new Date(y.recordedAt).toLocaleTimeString()]})]})]})}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-gray-500","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You haven't checked in today. Check in to record your location for Schengen tracking."})]})}),e.jsx("button",{onClick:v,disabled:d||!o||c==="denied",className:f("w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors",d||!o||c==="denied"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:d?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}),"Getting your location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-5 h-5","aria-hidden":"true"}),p?"Update Location":"Check In Now"]})}),b.isSuccess&&b.data&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(F,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:b.data.message})]})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-blue-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"How location tracking works:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Your location is detected using your browser's GPS"}),e.jsx("li",{children:"We determine which country you're in automatically"}),e.jsx("li",{children:"Schengen zone countries are tracked for the 90/180 rule"}),e.jsx("li",{children:"You can view and delete your location history at any time"})]})]})]})})]}),e.jsx(q,{isOpen:s,onClose:()=>i(!1),title:"Location History",size:"lg",children:e.jsx(es,{onClearRequest:()=>n(!0)})}),e.jsx(q,{isOpen:a,onClose:()=>n(!1),title:"Clear Location History",size:"sm",children:e.jsx(ss,{onConfirm:()=>{n(!1),i(!1)},onCancel:()=>n(!1)})})]})}function es({onClearRequest:t}){const{data:s,isLoading:i,refetch:a,isRefetching:n}=lt({limit:50}),r=ot(),l=async o=>{confirm("Delete this location entry?")&&await r.mutateAsync(o)};if(i)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(D,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})});const c=(s==null?void 0:s.locations)??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[(s==null?void 0:s.total)??0," location",((s==null?void 0:s.total)??0)!==1?"s":""," recorded"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>a(),disabled:n,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",children:[e.jsx(Pe,{className:f("w-4 h-4",n&&"animate-spin"),"aria-hidden":"true"}),"Refresh"]}),c.length>0&&e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-colors",children:[e.jsx(pe,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All"]})]})]}),c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500",children:"No location history yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Check in to start recording your locations"})]}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:c.map(o=>e.jsx(ts,{location:o,onDelete:()=>l(o.id),isDeleting:r.isPending},o.id))})]})}function ts({location:t,onDelete:s,isDeleting:i}){const a=new Date(t.recordedAt);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-2 rounded-lg",t.isSchengen?"bg-blue-100":"bg-gray-100"),children:t.isSchengen?e.jsx(Q,{className:"w-4 h-4 text-blue-600","aria-hidden":"true"}):e.jsx(z,{className:"w-4 h-4 text-gray-500","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[t.city&&`${t.city}, `,t.countryName??"Unknown location",t.isSchengen&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Schengen)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.toLocaleDateString()," at ",a.toLocaleTimeString(),t.accuracy&&e.jsxs("span",{className:"ml-2",children:["(Â±",Math.round(t.accuracy),"m)"]})]})]})]}),e.jsx("button",{onClick:s,disabled:i,className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-red-600 transition-all",title:"Delete",children:e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"})})]})}function ss({onConfirm:t,onCancel:s}){const i=dt(),a=async()=>{await i.mutateAsync(),t()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete all your location history? This action cannot be undone."}),i.error&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:"Failed to clear history. Please try again."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:s,disabled:i.isPending,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:i.isPending,className:f("inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors",i.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700"),children:i.isPending?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All History"]})})]})]})}const as={"Europe/Paris":["FR"],"Europe/Berlin":["DE"],"Europe/Rome":["IT"],"Europe/Madrid":["ES"],"Europe/Amsterdam":["NL"],"Europe/Brussels":["BE"],"Europe/Vienna":["AT"],"Europe/Zurich":["CH"],"Europe/Stockholm":["SE"],"Europe/Oslo":["NO"],"Europe/Copenhagen":["DK"],"Europe/Helsinki":["FI"],"Europe/Warsaw":["PL"],"Europe/Prague":["CZ"],"Europe/Budapest":["HU"],"Europe/Athens":["GR"],"Europe/Lisbon":["PT"],"Europe/Dublin":["IE"],"Europe/London":["GB"],"Europe/Bucharest":["RO"],"Europe/Sofia":["BG"],"Europe/Zagreb":["HR"],"Europe/Ljubljana":["SI"],"Europe/Bratislava":["SK"],"Europe/Tallinn":["EE"],"Europe/Riga":["LV"],"Europe/Vilnius":["LT"],"Europe/Luxembourg":["LU"],"Europe/Malta":["MT"],"Europe/Reykjavik":["IS"],"Europe/Vaduz":["LI"],"Europe/Monaco":["MC"]},rs=new Set(["AT","BE","BG","HR","CZ","DK","EE","FI","FR","DE","GR","HU","IS","IT","LV","LI","LT","LU","MT","NL","NO","PL","PT","RO","SK","SI","ES","SE","CH"]),U={TIMEZONE:"r2f_schengen_last_timezone",LAST_CHECKIN:"r2f_schengen_last_checkin_date",PROMPT_DISMISSED:"r2f_schengen_prompt_dismissed_date"};function we(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return"UTC"}}function ns(){return navigator.language||"en-US"}function ve(t){const s=as[t];return(s==null?void 0:s[0])||null}function Se(t){return t?rs.has(t):!1}function te(){return new Date().toISOString().split("T")[0]}function is(t={}){const{enableReminder:s=!0,reminderHour:i=9}=t,[a,n]=u.useState(()=>{const m=we(),x=localStorage.getItem(U.TIMEZONE),N=localStorage.getItem(U.LAST_CHECKIN),b=localStorage.getItem(U.PROMPT_DISMISSED),v=te(),p=ve(m),y=x!==null&&x!==m,d=N===v,w=y||s&&!d&&!(b===v);return{currentTimezone:m,storedTimezone:x,timezoneChanged:y,likelyCountry:p,likelySchengen:Se(p),currentLocale:ns(),shouldPromptCheckin:w,lastCheckinDate:N,checkedInToday:d}});u.useEffect(()=>{const x=setInterval(()=>{const N=we();n(b=>{if(b.currentTimezone!==N){const v=ve(N);return{...b,currentTimezone:N,timezoneChanged:b.storedTimezone!==null&&b.storedTimezone!==N,likelyCountry:v,likelySchengen:Se(v),shouldPromptCheckin:!0}}return b})},3e5);return()=>clearInterval(x)},[]),u.useEffect(()=>{if(!s)return;const m=()=>{const N=new Date,b=te(),v=localStorage.getItem(U.LAST_CHECKIN),p=localStorage.getItem(U.PROMPT_DISMISSED);N.getHours()>=i&&v!==b&&p!==b&&n(y=>({...y,shouldPromptCheckin:!0,checkedInToday:!1}))};m();const x=setInterval(m,60*1e3);return()=>clearInterval(x)},[s,i]);const r=u.useCallback(()=>{localStorage.setItem(U.TIMEZONE,a.currentTimezone),n(m=>({...m,storedTimezone:m.currentTimezone,timezoneChanged:!1}))},[a.currentTimezone]),l=u.useCallback(()=>{const m=te();localStorage.setItem(U.LAST_CHECKIN,m),localStorage.setItem(U.TIMEZONE,a.currentTimezone),n(x=>({...x,lastCheckinDate:m,checkedInToday:!0,shouldPromptCheckin:!1,storedTimezone:x.currentTimezone,timezoneChanged:!1}))},[a.currentTimezone]),c=u.useCallback(()=>{const m=te();localStorage.setItem(U.PROMPT_DISMISSED,m),n(x=>({...x,shouldPromptCheckin:!1}))},[]),o=u.useCallback(()=>new Date().getHours()>=i,[i]);return u.useMemo(()=>({state:a,acknowledgeTimezone:r,markCheckedIn:l,dismissPrompt:c,isReminderTime:o}),[a,r,l,c,o])}function ls(t){const s=t.toUpperCase().split("").map(i=>127397+i.charCodeAt(0));return String.fromCodePoint(...s)}function os({enabled:t=!0,onCheckin:s,onDismiss:i}){const[a,n]=u.useState(!1),{state:r,markCheckedIn:l,dismissPrompt:c}=is({enableReminder:t}),{data:o}=ct(),{getCurrentPosition:m,isLoading:x,isSupported:N}=Ue(),b=Le();u.useEffect(()=>{if(a){const C=setTimeout(()=>n(!1),3e3);return()=>clearTimeout(C)}},[a]);const v=u.useCallback(async()=>{try{const C=await m();await b.mutateAsync({lat:C.lat,lng:C.lng,accuracy:C.accuracy,source:"checkin"}),l(),n(!0),s==null||s()}catch(C){console.error("Check-in failed:",C)}},[m,b,l,s]),p=u.useCallback(()=>{c(),i==null||i()},[c,i]);if(!t||!r.shouldPromptCheckin||r.checkedInToday)return null;const y=x||b.isPending;let d=ge,j="Daily Location Check-in",w="Don't forget to check in your location for accurate Schengen tracking.",T="blue";if(r.timezoneChanged?(d=ie,j="Travel Detected",w=`Your timezone changed from ${r.storedTimezone} to ${r.currentTimezone}. Are you traveling?`,T="amber"):o!=null&&o.detected&&o.countryCode&&r.likelyCountry&&o.countryCode!==r.likelyCountry&&(d=Q,j="Location Check",w=`Your IP suggests you're in ${o.countryName||o.countryCode}. Check in to confirm your location.`,T="purple"),a)return e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-green-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Location recorded!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your location has been saved for Schengen tracking."})]})]})});const E=d,h={blue:{bg:"bg-blue-50",border:"border-blue-200",icon:"bg-blue-100 text-blue-600",title:"text-blue-800",message:"text-blue-700",button:"bg-blue-600 hover:bg-blue-700 text-white",dismiss:"text-blue-500 hover:text-blue-700 hover:bg-blue-100"},amber:{bg:"bg-amber-50",border:"border-amber-200",icon:"bg-amber-100 text-amber-600",title:"text-amber-800",message:"text-amber-700",button:"bg-amber-600 hover:bg-amber-700 text-white",dismiss:"text-amber-500 hover:text-amber-700 hover:bg-amber-100"},purple:{bg:"bg-purple-50",border:"border-purple-200",icon:"bg-purple-100 text-purple-600",title:"text-purple-800",message:"text-purple-700",button:"bg-purple-600 hover:bg-purple-700 text-white",dismiss:"text-purple-500 hover:text-purple-700 hover:bg-purple-100"}}[T];return e.jsx("div",{className:f("border rounded-lg p-4 mb-4",h.bg,h.border),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:f("p-2 rounded-lg",h.icon),children:e.jsx(E,{className:"w-5 h-5","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:f("font-medium",h.title),children:j}),(o==null?void 0:o.detected)&&o.countryCode&&e.jsx("span",{className:"text-lg",role:"img","aria-label":o.countryName||o.countryCode,children:ls(o.countryCode)})]}),e.jsx("p",{className:f("text-sm mt-0.5",h.message),children:w}),r.likelySchengen&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs",children:[e.jsx(Q,{className:"w-3 h-3 text-blue-500","aria-hidden":"true"}),e.jsxs("span",{className:"text-blue-600",children:["Based on timezone: Likely in Schengen zone (",r.likelyCountry,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsx("button",{onClick:v,disabled:y||!N,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",y||!N?"bg-gray-100 text-gray-400 cursor-not-allowed":h.button),children:y?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Getting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4","aria-hidden":"true"}),"Check In Now"]})}),e.jsx("button",{onClick:p,className:f("px-3 py-2 rounded-lg text-sm transition-colors",h.dismiss),children:"Maybe later"})]}),b.error&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-sm text-red-600",children:[e.jsx(se,{className:"w-4 h-4","aria-hidden":"true"}),"Failed to save location. Please try again."]}),!N&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs text-gray-500",children:[e.jsx(se,{className:"w-3 h-3","aria-hidden":"true"}),"Geolocation is not supported by your browser."]})]})]}),e.jsx("button",{onClick:p,className:f("p-1 rounded transition-colors",h.dismiss),"aria-label":"Dismiss",children:e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"})})]})})}const Oe="r2f_schengen_onboarding_complete";function ds(){return localStorage.getItem(Oe)==="true"}function Ce(){localStorage.setItem(Oe,"true")}function cs({isOpen:t,onComplete:s,isPremium:i=!1}){const[a,n]=u.useState(0),r=[{icon:e.jsx(Q,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Welcome to Schengen Tracker",description:"Understand and comply with the 90/180 day rule",details:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-5 bg-blue-50 border border-blue-100 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-base",children:"The 90/180 Rule"}),e.jsxs("p",{className:"text-blue-800 leading-relaxed",children:["Non-EU citizens may stay up to ",e.jsx("strong",{children:"90 days"})," within any"," ",e.jsx("strong",{children:"180-day rolling period"})," in the Schengen area without a long-stay visa."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Entry & Exit"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Both days count as full days"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Rolling Window"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Days expire after 180 days"})]})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Overstaying can result in fines, deportation, and future visa denials."})]})},{icon:e.jsx(ie,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Track Your Trips",description:"Add your past and future Schengen travel",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Keep an accurate record of all your Schengen zone visits to stay compliant."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"1"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:'Click "Add Trip"'}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Enter your travel dates and destination country"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"2"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Add all past trips"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Include trips from the last 6 months for accurate tracking"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"3"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Plan future trips"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Add upcoming travel to see projected compliance"})]})]})]})]})},{icon:e.jsx(z,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Smart Location Check-in",description:"Quick daily check-ins keep your tracker current",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Use location check-in to automatically record your presence in Schengen countries."}),e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-600 flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-white","aria-hidden":"true"})}),e.jsx("h4",{className:"font-semibold text-green-900 text-base",children:"Automatic Trip Creation"})]}),e.jsx("p",{className:"text-green-800 leading-relaxed",children:"When you check in from a Schengen country, we automatically create or extend your trip record. No manual entry needed!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Browser Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:"One-click check-in with GPS"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Smart Detection"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Prompts when timezone changes"})]})]})]})},{icon:e.jsx(re,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Plan Future Travel",description:'Use the "What If" calculator before you book',details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Before booking a trip, check if it would violate the 90/180 rule."}),e.jsxs("div",{className:"p-5 bg-primary-50 border border-primary-100 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-primary-900 mb-4 text-base",children:"The Planning Tool shows you:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(H,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"Whether your planned trip would be safe"]}),e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(H,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"The earliest safe date to start your trip"]}),e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(H,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"Maximum safe trip length from any date"]})]})]}),!i&&e.jsx("p",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-100 p-3 rounded-xl text-center",children:"â­ Planning Tool is a premium feature"})]})},{icon:e.jsx(Ie,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Stay Informed with Alerts",description:"Get notified before you approach the limit",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Enable email alerts to receive warnings when approaching your 90-day limit."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-yellow-50 border border-yellow-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-yellow-900",children:"60 days used"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Friendly reminder to plan ahead"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-orange-50 border border-orange-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-orange-900",children:"80 days used"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Warning to limit travel"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-red-50 border border-red-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-red-900",children:"85+ days used"}),e.jsx("p",{className:"text-sm text-red-700",children:"Urgent alert to avoid overstay"})]})]})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Enable alerts in the Settings tab after completing this tour."})]})}],l=()=>{a<r.length-1?n(a+1):(Ce(),s())},c=()=>{a>0&&n(a-1)},o=()=>{Ce(),s()},m=r[a],x=a===r.length-1;return e.jsx(q,{isOpen:t,onClose:o,title:"",size:"lg",children:e.jsxs("div",{className:"px-4 py-6 sm:px-8 sm:py-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 bg-primary-50 rounded-2xl flex items-center justify-center",children:m.icon})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:m.title}),e.jsx("p",{className:"text-gray-500 text-lg",children:m.description})]}),e.jsx("div",{className:"mb-10 max-w-lg mx-auto",children:m.details}),e.jsx("div",{className:"flex justify-center gap-2.5 mb-8",children:r.map((N,b)=>e.jsx("button",{onClick:()=>n(b),className:f("h-2.5 rounded-full transition-all duration-300",b===a?"bg-primary-600 w-8":b<a?"bg-primary-300 w-2.5":"bg-gray-200 w-2.5"),"aria-label":`Go to step ${b+1}`},b))}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-100",children:[e.jsx("button",{onClick:o,className:"text-sm text-gray-400 hover:text-gray-600 transition-colors",children:"Skip tour"}),e.jsxs("div",{className:"flex items-center gap-3",children:[a>0&&e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-1.5 px-5 py-2.5 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(De,{className:"w-4 h-4","aria-hidden":"true"}),"Back"]}),e.jsx("button",{onClick:l,className:"inline-flex items-center gap-1.5 px-6 py-2.5 bg-primary-600 text-white rounded-lg font-medium text-sm hover:bg-primary-700 transition-colors shadow-sm",children:x?e.jsxs(e.Fragment,{children:["Get Started",e.jsx(H,{className:"w-4 h-4","aria-hidden":"true"})]}):e.jsxs(e.Fragment,{children:["Next",e.jsx(Ee,{className:"w-4 h-4","aria-hidden":"true"})]})})]})]})]})})}function Ts(){const{trips:t,settings:s,isLoaded:i,addTrip:a,updateTrip:n,deleteTrip:r,updateSettings:l}=kt(),{data:c,isLoading:o}=mt(),m=xt(),[x,N]=u.useState(!1),[b,v]=u.useState(null),[p,y]=u.useState("trips"),[d,j]=u.useState(null),[w,T]=u.useState(null),[E,S]=u.useState(!1);u.useEffect(()=>{i&&!ds()&&S(!0)},[i]);const h=u.useMemo(()=>Pt(t,{yellow:s.yellowThreshold,red:s.redThreshold}),[t,s.yellowThreshold,s.redThreshold]),C=async P=>{T(null);try{await a(P),N(!1)}catch(L){const Y=L instanceof Error?L.message:"Failed to add trip";T(Y),console.error("Failed to add trip:",L)}},O=async P=>{if(b){T(null);try{await n(b.id,P),v(null)}catch(L){const Y=L instanceof Error?L.message:"Failed to update trip";T(Y),console.error("Failed to update trip:",L)}}},de=async P=>{T(null);try{await r(P)}catch(L){const Y=L instanceof Error?L.message:"Failed to delete trip";T(Y),console.error("Failed to delete trip:",L)}},ce=P=>{v(P)},$=()=>{N(!1),v(null)},ee=(c==null?void 0:c.canAddTrip)??!0,R=(c==null?void 0:c.isPremium)??!0;return!i||o?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3",role:"status","aria-label":"Loading"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Schengen Tracker"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track your 90/180 day Schengen zone compliance"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>S(!0),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Show help tour",title:"Show help tour",children:e.jsx(ht,{className:"w-5 h-5","aria-hidden":"true"})}),R&&e.jsx(Jt,{}),e.jsxs("button",{onClick:()=>N(!0),disabled:!ee,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors",ee?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[e.jsx(ut,{className:"w-5 h-5","aria-hidden":"true"}),"Add Trip"]})]})]}),!R&&c&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-amber-600","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-amber-800",children:["Free Plan: ",c.tripCount," of ",c.tripLimit," trips used"]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Upgrade to Premium for unlimited trips, planning tools, and PDF reports"})]})]}),c.upgradeUrl&&e.jsxs("a",{href:c.upgradeUrl,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(ae,{className:"w-4 h-4","aria-hidden":"true"}),"Upgrade"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card p-6 flex flex-col items-center justify-center",children:[e.jsx(Ft,{daysUsed:h.daysUsed,daysRemaining:h.daysRemaining,status:h.status,size:"lg"}),e.jsx("div",{className:"mt-4",children:e.jsx(Ut,{status:h.status,size:"lg"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:f("card p-4 border-l-4",h.status==="safe"&&"border-l-green-500",h.status==="warning"&&"border-l-yellow-500",h.status==="danger"&&"border-l-orange-500",h.status==="critical"&&"border-l-red-500"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(ge,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Days Remaining"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.daysRemaining})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(M,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current 180-Day Window"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[_(h.windowStart)," - ",_(h.windowEnd)]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[h.nextExpiration&&e.jsx("div",{className:"card p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(M,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Next Day Expires"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:_(h.nextExpiration)}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"A day will drop off the 180-day window"})]})]})}),e.jsx("div",{className:"card p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"The 90/180 Rule"}),e.jsx("p",{children:"Non-EU citizens may stay up to 90 days within any 180-day period in the Schengen area without a visa."})]})]})})]})]}),e.jsx(os,{enabled:!0}),e.jsx(Ne,{compact:!0}),h.status==="warning"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(I,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-medium",children:"Approaching limit:"})," You have used ",h.daysUsed," of your 90 days. Plan future travel carefully to avoid overstaying."]})]}),h.status==="danger"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(I,{className:"w-5 h-5 text-orange-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("span",{className:"font-medium",children:"Warning:"})," You have used ",h.daysUsed," of your 90 days. Limited travel remaining in this window."]})]}),h.status==="critical"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(I,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("span",{className:"font-medium",children:"Limit reached:"})," You have used all 90 days allowed in this 180-day window. Additional travel may result in overstay violations."]})]}),w&&e.jsxs("div",{className:"flex items-center justify-between gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:w})]}),e.jsx("button",{onClick:()=>T(null),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Dismiss"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-6","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>y("trips"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",p==="trips"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4","aria-hidden":"true"}),"Trip List"]})}),e.jsx("button",{onClick:()=>y("calendar"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",p==="calendar"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar View",!R&&e.jsx(fe,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>y("sync"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",p==="sync"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar Sync"]})}),e.jsx("button",{onClick:()=>y("planning"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",p==="planning"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4","aria-hidden":"true"}),"Planning Tool",!R&&e.jsx(fe,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>y("location"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",p==="location"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4","aria-hidden":"true"}),"Location"]})}),e.jsx("button",{onClick:()=>y("settings"),className:f("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",p==="settings"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4","aria-hidden":"true"}),"Settings"]})})]})}),p==="trips"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Your Trips"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," trip",t.length!==1?"s":""]})]}),e.jsx(Ht,{trips:t,currentWindowStart:h.windowStart,onEdit:ce,onDelete:de})]}),p==="calendar"&&(R?e.jsx(Bt,{trips:t,windowStart:h.windowStart,windowEnd:h.windowEnd}):e.jsx(ke,{feature:"Calendar View",description:"Visualize your trips on an interactive calendar to better understand your travel patterns and plan future trips.",upgradeUrl:c==null?void 0:c.upgradeUrl})),p==="sync"&&e.jsx(Vt,{}),p==="planning"&&(R?e.jsx("div",{className:"card p-6",children:e.jsx(_t,{})}):e.jsx(ke,{feature:"Planning Tool",description:"Use the 'What If' calculator to check if a planned trip would violate the 90/180 rule before you book.",upgradeUrl:c==null?void 0:c.upgradeUrl})),p==="location"&&e.jsx(Ne,{}),p==="settings"&&e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tracker Settings"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure alerts and notification preferences"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ie,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Alerts"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive email notifications when approaching your 90-day limit"})]})]}),e.jsx("button",{onClick:()=>l({emailAlerts:!s.emailAlerts}),className:f("relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",s.emailAlerts?"bg-primary-600":"bg-gray-200"),role:"switch","aria-checked":s.emailAlerts,children:e.jsx("span",{className:f("pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",s.emailAlerts?"translate-x-5":"translate-x-0")})})]}),s.emailAlerts&&e.jsx("div",{className:"mt-4 ml-14 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Alert thresholds:"})," You will receive email alerts when you reach 60 days (warning), 80 days (danger), and 85 days (urgent)."]})}),s.emailAlerts&&e.jsxs("div",{className:"mt-4 ml-14",children:[e.jsx("button",{onClick:()=>{j(null),m.mutate(void 0,{onSuccess:P=>{j({type:P.success?"success":"error",text:P.message})},onError:P=>{j({type:"error",text:P instanceof Error?P.message:"Failed to send test alert"})}})},disabled:m.isPending,className:f("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",m.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-4 h-4","aria-hidden":"true"}),"Send Test Alert"]})}),d&&e.jsxs("div",{className:f("mt-3 p-3 rounded-lg flex items-center gap-2 text-sm",d.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:[d.type==="success"?e.jsx(F,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}):e.jsx(I,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),d.text]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Warning Thresholds"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Warning Level"}),e.jsxs("p",{className:"text-lg font-bold text-yellow-900",children:[s.yellowThreshold," days"]}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Status turns yellow"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:"Danger Level"}),e.jsxs("p",{className:"text-lg font-bold text-orange-900",children:[s.redThreshold," days"]}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Status turns red"})]})]})]})]}),e.jsx(q,{isOpen:x,onClose:$,title:"Add Trip",size:"md",children:e.jsx(je,{existingTrips:t,onSubmit:C,onCancel:$})}),e.jsx(q,{isOpen:!!b,onClose:$,title:"Edit Trip",size:"md",children:b&&e.jsx(je,{trip:b,existingTrips:t,onSubmit:O,onCancel:$})}),e.jsx(cs,{isOpen:E,onComplete:()=>S(!1),isPremium:R})]})}function ke({feature:t,description:s,upgradeUrl:i}){return e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-amber-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[t," is a Premium Feature"]}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:s}),i&&e.jsxs("a",{href:i,className:"inline-flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(ae,{className:"w-5 h-5","aria-hidden":"true"}),"Upgrade to Premium"]})]})}export{Ts as default};
