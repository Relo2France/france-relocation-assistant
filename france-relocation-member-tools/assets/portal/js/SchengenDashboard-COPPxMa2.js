import{j as e}from"./vendor-query-D8MH73Ff.js";import{r as u}from"./vendor-react-F9Y4d3HK.js";import{a as g}from"./vendor-utils-C5RVuWu4.js";import{c as V,aI as cs,aJ as os,aK as ms,aL as xs,aM as hs,aN as us,A as U,a3 as Z,aO as qe,aP as z,b as F,E as O,F as Je,aQ as gs,aR as ps,C as Y,Q as ee,ay as Ke,ai as Ze,aS as ys,aT as bs,aU as js,aV as fs,aW as Ns,aX as vs,aY as ws,aZ as Ss,a_ as Cs,X as B,q as ye,a as le,a4 as Re,a$ as ks,l as se,s as Ae,b0 as Ts,b1 as Qe,b2 as Ds,b3 as Es,b4 as Ms,b5 as Ls,_ as je,b6 as Ps,b7 as As,b8 as Fs,b9 as Is,P as ne,ba as Us,bb as Rs,bc as zs,bd as Os,be as $s,Z as Fe,bf as _s,bg as Hs,bh as Vs,ak as Xe,bi as Ws,bj as Ys,bk as Bs,bl as Gs,aa as be,U as qs,bm as Js,bn as Ks,bo as Zs,bp as Qs,bq as Xs,br as et,af as st,bs as Pe}from"./main-NoTna2qB.js";import{X as Ie}from"./x-circle-CuXxcm1Y.js";import{A as ce}from"./alert-circle-C3jsoopu.js";import{B as tt}from"./briefcase-B2KaYBwJ.js";import{T as oe}from"./trash-2-B9cOZY-o.js";import{C as ze}from"./chevron-up-CtCRWNhN.js";import{C as me}from"./chevron-down-Bg2LoUUX.js";import{L}from"./loader-2-Bot9AUrb.js";import{P as xe}from"./plane-BCYyk9K_.js";import{C as at}from"./check-circle-2-DB7PzEK9.js";import{F as rt,S as nt}from"./shield-alert-Dn8dUSQr.js";import{L as es}from"./lightbulb-C3UzUjFt.js";import{P as it}from"./pen-CFTc-oOC.js";import{C as fe,L as he}from"./lock-PD7EZXu-.js";import{S as lt}from"./send-CvkXueJN.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=V("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=V("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=V("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=V("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=V("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=V("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=V("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=V("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=V("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=V("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=V("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),gt={yellowThreshold:60,redThreshold:80,emailAlerts:!1,upcomingTripReminders:!0};function pt(){const{data:s=[],isLoading:t,isError:a}=cs(),{data:r=gt,isLoading:i}=os(),d=ms(),l=xs(),n=hs(),x=us(),c=!t&&!i,h=a,w=u.useMemo(()=>[...s].sort((y,j)=>new Date(j.startDate).getTime()-new Date(y.startDate).getTime()),[s]),p=u.useCallback(y=>d.mutateAsync(y),[d]),C=u.useCallback((y,j)=>l.mutateAsync({id:y,data:j}),[l]),v=u.useCallback(y=>n.mutateAsync(y),[n]),b=u.useCallback(y=>x.mutateAsync(y),[x]),o=d.isPending||l.isPending||n.isPending||x.isPending;return{trips:w,settings:r,isLoaded:c,isError:h,isSaving:o,addTrip:p,updateTrip:C,deleteTrip:v,updateSettings:b}}const Oe=90,Se=180;function H(s){if(s instanceof Date){const t=s.toISOString().split("T")[0];return new Date(t+"T00:00:00Z")}return new Date(s+"T00:00:00Z")}function Ce(){const t=new Date().toISOString().split("T")[0];return new Date(t+"T00:00:00Z")}function te(s){return s.toISOString().split("T")[0]}function ts(s,t=Ce()){const a=H(t),r=new Date(a.getTime()-(Se-1)*24*60*60*1e3),i=new Set;return s.forEach(d=>{const l=H(d.startDate),n=H(d.endDate);if(l>a)return;const x=l<r?r:l,c=n>a?a:n;if(x<=c){const h=new Date(x);for(;h<=c;)i.add(te(h)),h.setTime(h.getTime()+24*60*60*1e3)}}),i.size}function yt(s,t=Ce()){const a=H(t),r=new Date(a.getTime()-(Se-1)*24*60*60*1e3),i=new Set;return s.forEach(d=>{const l=H(d.startDate),n=H(d.endDate);if(l>a)return;const x=l<r?r:l,c=n>a?a:n;if(x<=c){const h=new Date(x);for(;h<=c;)i.add(te(h)),h.setTime(h.getTime()+24*60*60*1e3)}}),i}function bt(s,t={yellow:60,red:80}){return s>=Oe?"critical":s>=t.red?"danger":s>=t.yellow?"warning":"safe"}function jt(s,t=Ce()){const a=yt(s,t);if(a.size===0)return null;const i=Array.from(a).sort()[0],d=H(i);return d.setTime(d.getTime()+Se*24*60*60*1e3),te(d)}function ft(s,t={yellow:60,red:80}){const a=Ce(),r=ts(s,a),i=Math.max(0,Oe-r),d=a,l=new Date(a.getTime()-(Se-1)*24*60*60*1e3);return{daysUsed:r,daysRemaining:i,windowStart:te(l),windowEnd:te(d),status:bt(r,t),nextExpiration:jt(s,a),statusThresholds:t}}function as(s,t){const a=H(s),r=H(t),i=Math.abs(r.getTime()-a.getTime());return Math.floor(i/(1e3*60*60*24))+1}function ie(s){return as(s.startDate,s.endDate)}function Nt(s,t,a){const r=H(t),i=H(a),d=new Date(r);let l=0;for(;d<=i;){const n={id:"temp",startDate:t,endDate:te(d),country:"France",category:"personal",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},x=[...s,n],c=ts(x,d);if(l=Math.max(l,c),c>Oe)return{wouldViolate:!0,projectedDaysUsed:c,earliestSafeEntry:null,maxTripLength:null,message:`This trip would exceed the 90-day limit on ${te(d)} with ${c} days used.`};d.setTime(d.getTime()+24*60*60*1e3)}return{wouldViolate:!1,projectedDaysUsed:l,earliestSafeEntry:t,maxTripLength:as(t,a),message:`This trip is safe. Maximum days used during trip: ${l}/90.`}}function Q(s){return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function vt(s,t){const a=new Date(s),r=new Date(t);return s===t?Q(s):a.getMonth()===r.getMonth()&&a.getFullYear()===r.getFullYear()?`${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${r.getDate()}, ${r.getFullYear()}`:a.getFullYear()===r.getFullYear()?`${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${r.toLocaleDateString("en-US",{month:"short",day:"numeric"})}, ${r.getFullYear()}`:`${Q(s)} - ${Q(t)}`}const wt={safe:{stroke:"stroke-green-500",text:"text-green-600",bg:"bg-green-50"},warning:{stroke:"stroke-yellow-500",text:"text-yellow-600",bg:"bg-yellow-50"},danger:{stroke:"stroke-orange-500",text:"text-orange-600",bg:"bg-orange-50"},critical:{stroke:"stroke-red-500",text:"text-red-600",bg:"bg-red-50"}},St={sm:{container:"w-24 h-24",svgSize:96,strokeWidth:6,radius:42,textSize:"text-2xl",labelSize:"text-xs"},md:{container:"w-36 h-36",svgSize:144,strokeWidth:8,radius:64,textSize:"text-4xl",labelSize:"text-sm"},lg:{container:"w-48 h-48",svgSize:192,strokeWidth:10,radius:86,textSize:"text-5xl",labelSize:"text-base"}};function $e({daysUsed:s,daysRemaining:t,status:a,size:r="md",className:i}){const d=wt[a],l=St[r],n=Math.min(s/90*100,100),x=2*Math.PI*l.radius,c=x-n/100*x;return e.jsxs("div",{className:g("relative inline-flex",l.container,i),children:[e.jsxs("svg",{className:"transform -rotate-90",width:l.svgSize,height:l.svgSize,"aria-hidden":"true",children:[e.jsx("circle",{cx:l.svgSize/2,cy:l.svgSize/2,r:l.radius,fill:"none",strokeWidth:l.strokeWidth,className:"stroke-gray-200"}),e.jsx("circle",{cx:l.svgSize/2,cy:l.svgSize/2,r:l.radius,fill:"none",strokeWidth:l.strokeWidth,strokeLinecap:"round",strokeDasharray:x,strokeDashoffset:c,className:g("transition-all duration-500",d.stroke)})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:g("font-bold",l.textSize,d.text),"aria-label":`${s} days used`,children:s}),e.jsx("span",{className:g("text-gray-500",l.labelSize),children:"of 90 days"})]}),e.jsx("div",{role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":90,"aria-label":`Schengen days: ${s} used, ${t} remaining`,className:"sr-only"})]})}const Ct={safe:{label:"Safe",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200",Icon:Z},warning:{label:"Warning",bgColor:"bg-yellow-50",textColor:"text-yellow-700",borderColor:"border-yellow-200",Icon:U},danger:{label:"Danger",bgColor:"bg-orange-50",textColor:"text-orange-700",borderColor:"border-orange-200",Icon:ce},critical:{label:"Critical",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200",Icon:Ie}},kt={sm:{badge:"px-2 py-0.5 text-xs",icon:"w-3 h-3"},md:{badge:"px-2.5 py-1 text-sm",icon:"w-4 h-4"},lg:{badge:"px-3 py-1.5 text-base",icon:"w-5 h-5"}};function X({status:s,showLabel:t=!0,size:a="md",className:r}){const i=Ct[s],d=kt[a],l=i.Icon;return e.jsxs("span",{className:g("inline-flex items-center gap-1 rounded-full border font-medium",i.bgColor,i.textColor,i.borderColor,d.badge,r),children:[e.jsx(l,{className:d.icon,"aria-hidden":"true"}),t&&e.jsx("span",{children:i.label})]})}const Tt=["Austria","Belgium","Bulgaria","Croatia","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Italy","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland"],Dt=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming","District of Columbia"];function He({trip:s,existingTrips:t,onSubmit:a,onCancel:r,className:i,defaultJurisdiction:d="schengen"}){const l=!!s,[n,x]=u.useState((s==null?void 0:s.startDate)||""),[c,h]=u.useState((s==null?void 0:s.endDate)||""),[w,p]=u.useState((s==null?void 0:s.country)||"France"),[C,v]=u.useState((s==null?void 0:s.jurisdictionCode)||d),[b,o]=u.useState((s==null?void 0:s.category)||"personal"),[y,j]=u.useState((s==null?void 0:s.notes)||""),{data:k}=qe(),[S,f]=u.useState(null),[m,D]=u.useState(null),E=k==null?void 0:k.find(T=>T.code===C),W=C==="schengen",K=(C==null?void 0:C.startsWith("us_"))&&(E==null?void 0:E.type)==="state",$=()=>W?[...Tt]:K?[...Dt]:E?[E.name]:["Unknown"];u.useEffect(()=>{const T=$();T.includes(w)||p(T[0]||"")},[C]),u.useEffect(()=>{if(n&&c)if(W){const de=(l?t.filter(ae=>ae.id!==s.id):t).filter(ae=>!ae.jurisdictionCode||ae.jurisdictionCode==="schengen"),_=Nt(de,n,c);_.wouldViolate?f(_.message):_.projectedDaysUsed>=80?f(`This trip will bring you to ${_.projectedDaysUsed}/90 days - approaching the limit.`):_.projectedDaysUsed>=60?f(`This trip will bring you to ${_.projectedDaysUsed}/90 days.`):f(null)}else E&&ie({startDate:n,endDate:c})>E.daysAllowed?f(`This trip exceeds the ${E.daysAllowed}-day limit for ${E.name}.`):f(null);else f(null)},[n,c,t,l,s,C,E,W]);const G=T=>{if(T.preventDefault(),D(null),!n||!c){D("Please enter both start and end dates.");return}if(new Date(c)<new Date(n)){D("End date must be on or after start date.");return}const de=ie({startDate:n,endDate:c}),_=(E==null?void 0:E.daysAllowed)||90;if(de>_){D(`A single trip cannot exceed ${_} days for ${(E==null?void 0:E.name)||"this jurisdiction"}.`);return}a({startDate:n,endDate:c,country:w,jurisdictionCode:C,category:b,notes:y.trim()||void 0})},P=n&&c?ie({startDate:n,endDate:c}):null,A=$(),I=k&&k.length>1;return e.jsxs("form",{onSubmit:G,className:g("space-y-4",i),children:[I&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"jurisdiction",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(z,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Jurisdiction"]}),e.jsx("select",{id:"jurisdiction",value:C,onChange:T=>v(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:k.map(T=>e.jsxs("option",{value:T.code,children:[T.name," (",T.daysAllowed,"/",T.windowDays," days)"]},T.code))}),(E==null?void 0:E.description)&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:E.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(F,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Start Date"]}),e.jsx("input",{type:"date",id:"startDate",value:n,onChange:T=>x(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(F,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"End Date"]}),e.jsx("input",{type:"date",id:"endDate",value:c,onChange:T=>h(T.target.value),min:n,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]})]}),P!==null&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg",children:["Duration: ",e.jsxs("span",{className:"font-medium",children:[P," day",P!==1?"s":""]}),E&&e.jsxs("span",{className:"text-gray-400 ml-2",children:["(max ",E.daysAllowed," for ",E.name,")"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(O,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),K?"State":"Country"]}),e.jsx("select",{id:"country",value:w,onChange:T=>p(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:A.map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("div",{role:"radiogroup","aria-labelledby":"category-label",children:[e.jsxs("span",{id:"category-label",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(tt,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Category"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"personal",checked:b==="personal",onChange:()=>o("personal"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Personal"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"business",checked:b==="business",onChange:()=>o("business"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Business"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Je,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Notes (optional)"]}),e.jsx("textarea",{id:"notes",value:y,onChange:T=>j(T.target.value),rows:2,placeholder:"e.g., Visa appointment, apartment hunting...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-none"})]}),S&&e.jsxs("div",{className:"flex gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(U,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-amber-800",children:S})]}),m&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:m})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-primary-600 hover:bg-primary-700 rounded-lg font-medium transition-colors",children:l?"Save Changes":"Add Trip"})]})]})}function Et({trips:s,currentWindowStart:t,onEdit:a,onDelete:r,className:i}){const[d,l]=u.useState("date"),[n,x]=u.useState("desc"),[c,h]=u.useState(null),w=o=>{d===o?x(y=>y==="asc"?"desc":"asc"):(l(o),x("desc"))},p=[...s].sort((o,y)=>{let j=0;switch(d){case"date":j=new Date(o.startDate).getTime()-new Date(y.startDate).getTime();break;case"country":j=o.country.localeCompare(y.country);break;case"duration":j=ie(o)-ie(y);break}return n==="asc"?j:-j}),C=o=>new Date(o.endDate)>=new Date(t),v=o=>{c===o?(r(o),h(null)):(h(o),setTimeout(()=>h(null),3e3))};if(s.length===0)return e.jsxs("div",{className:g("text-center py-12",i),children:[e.jsx(O,{className:"w-12 h-12 text-gray-300 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No trips recorded"}),e.jsx("p",{className:"text-gray-500",children:"Add your first trip to start tracking your Schengen days."})]});const b=({field:o})=>d!==o?null:n==="asc"?e.jsx(ze,{className:"w-4 h-4"}):e.jsx(me,{className:"w-4 h-4"});return e.jsxs("div",{className:g("overflow-hidden",i),children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-3 bg-gray-50 border-b border-gray-200 text-sm font-medium text-gray-600",children:[e.jsxs("button",{onClick:()=>w("date"),className:"col-span-4 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(F,{className:"w-4 h-4","aria-hidden":"true"}),"Dates",e.jsx(b,{field:"date"})]}),e.jsxs("button",{onClick:()=>w("country"),className:"col-span-3 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(O,{className:"w-4 h-4","aria-hidden":"true"}),"Country",e.jsx(b,{field:"country"})]}),e.jsxs("button",{onClick:()=>w("duration"),className:"col-span-2 flex items-center gap-1 text-left hover:text-gray-900",children:["Days",e.jsx(b,{field:"duration"})]}),e.jsx("div",{className:"col-span-3 text-right",children:"Actions"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:p.map(o=>{const y=ie(o),j=C(o);return e.jsxs("div",{className:g("grid grid-cols-12 gap-4 px-4 py-3 items-center",j?"bg-white":"bg-gray-50 opacity-75"),children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:vt(o.startDate,o.endDate)}),o.notes&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:o.notes})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("span",{className:"text-sm text-gray-700",children:o.country}),e.jsx("span",{className:g("ml-2 text-xs px-1.5 py-0.5 rounded",o.category==="business"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"),children:o.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:[y," day",y!==1?"s":""]}),!j&&e.jsx("span",{className:"block text-xs text-gray-400",children:"outside window"})]}),e.jsxs("div",{className:"col-span-3 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>a(o),className:"p-2 text-gray-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors","aria-label":`Edit trip to ${o.country}`,children:e.jsx(gs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(o.id),className:g("p-2 rounded-lg transition-colors",c===o.id?"text-white bg-red-600 hover:bg-red-700":"text-gray-400 hover:text-red-600 hover:bg-red-50"),"aria-label":c===o.id?"Confirm delete":`Delete trip to ${o.country}`,children:e.jsx(oe,{className:"w-4 h-4"})})]})]},o.id)})})]})}function Mt(){const[s,t]=u.useState(""),[a,r]=u.useState(""),[i,d]=u.useState(null),l=ps(),n=()=>{!s||!a||l.mutate({startDate:s,endDate:a},{onSuccess:h=>{d(h)}})},x=()=>{t(""),r(""),d(null)},c=s&&a&&new Date(a)>=new Date(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(ve,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Trip Planning Tool"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Check if a planned trip would violate the 90/180 rule"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-start-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-start-date",value:s,onChange:h=>t(h.target.value),className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-end-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-end-date",value:a,onChange:h=>r(h.target.value),min:s,className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,disabled:!c||l.isPending,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",c&&!l.isPending?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4","aria-hidden":"true"}),"Check Trip"]})}),i&&e.jsx("button",{onClick:x,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Reset"})]}),i&&e.jsx("div",{className:g("rounded-lg p-4 border",i.wouldViolate?"bg-red-50 border-red-200":"bg-green-50 border-green-200"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[i.wouldViolate?e.jsx(U,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}):e.jsx(Y,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:g("font-semibold",i.wouldViolate?"text-red-800":"text-green-800"),children:i.wouldViolate?"This trip would violate the 90/180 rule":"This trip is safe"}),e.jsx("p",{className:g("text-sm mt-1",i.wouldViolate?"text-red-700":"text-green-700"),children:i.wouldViolate?`You would exceed the limit by ${i.daysOverLimit} day${i.daysOverLimit!==1?"s":""}.`:`You would use ${i.maxDaysUsed} of your 90 days.`}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Trip Length"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[i.proposedLength," day",i.proposedLength!==1?"s":""]})]}),e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Max Days Used"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:i.maxDaysUsed})]})]}),i.wouldViolate&&e.jsxs("div",{className:"mt-4 space-y-3",children:[i.earliestSafeDate&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ee,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Earliest safe start date:"})," ",Q(i.earliestSafeDate)]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ee,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsxs("span",{className:"font-medium",children:["Max safe trip length from ",Q(s),":"]})," ",i.maxSafeLength," day",i.maxSafeLength!==1?"s":""]})]})]})]})]})}),l.isError&&e.jsx("div",{className:"rounded-lg p-4 bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(U,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("p",{className:"text-sm",children:"Failed to simulate trip. Please try again."})]})})]})}const Lt=["S","M","T","W","T","F","S"],Pt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],At=["January","February","March","April","May","June","July","August","September","October","November","December"],Ft=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function It({trips:s,windowStart:t,windowEnd:a}){const r=u.useMemo(()=>new Date().toISOString().split("T")[0],[]),i=u.useMemo(()=>new Date(r),[r]),[d,l]=u.useState(i.getMonth()),[n,x]=u.useState(i.getFullYear()),c=u.useMemo(()=>{const v=new Map;return s.forEach(b=>{const o=new Date(b.startDate),y=new Date(b.endDate),j=new Date(o);for(;j<=y;){const k=j.toISOString().split("T")[0];v.set(k,b),j.setDate(j.getDate()+1)}}),v},[s]),h=u.useMemo(()=>{const v=[],b=new Date(n,d,1),o=new Date(n,d+1,0),y=new Date(t),j=new Date(a),k=b.getDay();for(let f=k-1;f>=0;f--){const m=new Date(n,d,-f),D=m.toISOString().split("T")[0];v.push({date:m,isCurrentMonth:!1,isToday:!1,isInWindow:m>=y&&m<=j,trip:c.get(D)||null,isFuture:m>i})}for(let f=1;f<=o.getDate();f++){const m=new Date(n,d,f),D=m.toISOString().split("T")[0];v.push({date:m,isCurrentMonth:!0,isToday:D===r,isInWindow:m>=y&&m<=j,trip:c.get(D)||null,isFuture:m>i})}const S=6-o.getDay();for(let f=1;f<=S;f++){const m=new Date(n,d+1,f),D=m.toISOString().split("T")[0];v.push({date:m,isCurrentMonth:!1,isToday:!1,isInWindow:m>=y&&m<=j,trip:c.get(D)||null,isFuture:m>i})}return v},[d,n,c,t,a,i,r]),w=()=>{d===0?(l(11),x(n-1)):l(d-1)},p=()=>{d===11?(l(0),x(n+1)):l(d+1)},C=()=>{l(i.getMonth()),x(i.getFullYear())};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:w,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Previous month",children:e.jsx(Ke,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsx("button",{onClick:p,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Next month",children:e.jsx(Ze,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-gray-900 ml-1 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline",children:At[d]}),e.jsx("span",{className:"sm:hidden",children:Ft[d]})," ",n]})]}),e.jsx("button",{onClick:C,className:"px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",children:"Today"})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200",children:Pt.map((v,b)=>e.jsxs("div",{className:"py-1.5 sm:py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("span",{className:"hidden sm:inline",children:v}),e.jsx("span",{className:"sm:hidden",children:Lt[b]})]},v))}),e.jsx("div",{className:"grid grid-cols-7",children:h.map((v,b)=>{const{date:o,isCurrentMonth:y,isToday:j,isInWindow:k,trip:S,isFuture:f}=v;return e.jsxs("div",{className:g("relative min-h-[44px] sm:min-h-[60px] p-0.5 sm:p-1 border-b border-r border-gray-100",!y&&"bg-gray-50",j&&"bg-primary-50"),children:[e.jsx("span",{className:g("inline-flex items-center justify-center w-5 h-5 sm:w-6 sm:h-6 text-xs sm:text-sm rounded-full",j&&"bg-primary-600 text-white font-medium",!j&&y&&"text-gray-900",!j&&!y&&"text-gray-400"),children:o.getDate()}),S&&e.jsxs("div",{className:g("mt-0.5 sm:mt-1 px-0.5 sm:px-1 py-0.5 rounded text-[10px] sm:text-xs truncate",f?"bg-blue-100 text-blue-700 border border-dashed border-blue-300":k?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600"),title:`${S.country}${f?" (planned)":""}`,children:[e.jsx(xe,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 inline-block sm:mr-0.5","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Trip to "}),e.jsx("span",{className:"hidden sm:inline",children:S.country.slice(0,3)})]}),k&&!S&&y&&e.jsx("div",{className:"absolute bottom-0.5 sm:bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-green-400",title:"In current 180-day window"})]},b)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 p-2 sm:p-3 border-t border-gray-200 text-[10px] sm:text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-primary-100 border border-primary-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (in window)"}),e.jsx("span",{className:"sm:hidden",children:"In window"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-blue-100 border border-dashed border-blue-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Future trip"}),e.jsx("span",{className:"sm:hidden",children:"Future"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-gray-100 border border-gray-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (outside window)"}),e.jsx("span",{className:"sm:hidden",children:"Outside"})]})]})]})}function Ut({compact:s=!1}){const[t,a]=u.useState(new Set),[r,i]=u.useState(!1),[d,l]=u.useState(null),[n,x]=u.useState(null),c=u.useRef(null),h=ys(),w=bs(),p=js("pending"),C=h.data??[],v=w.data??[],b=p.data??[],o=p.refetch,y=h.isLoading,j=w.isLoading,k=p.isLoading,S=h.error,f=w.error,m=p.error,D=fs(),E=Ns(),W=vs(),K=ws(),$=Ss(),G=Cs();u.useEffect(()=>{try{const N=new URLSearchParams(window.location.search),M=N.get("calendar_connected"),q=N.get("calendar_error");if(M){l(`Successfully connected ${M==="google"?"Google Calendar":"Microsoft Outlook"}!`),N.delete("calendar_connected");const R=N.toString(),Le=window.location.pathname+(R?`?${R}`:"");window.history.replaceState({},"",Le),o()}if(q){x(decodeURIComponent(q)),N.delete("calendar_error");const R=N.toString(),Le=window.location.pathname+(R?`?${R}`:"");window.history.replaceState({},"",Le)}}catch(N){console.error("Error handling URL params:",N)}},[o]),u.useEffect(()=>{if(d){const N=setTimeout(()=>l(null),5e3);return()=>clearTimeout(N)}},[d]),u.useEffect(()=>{if(n){const N=setTimeout(()=>x(null),8e3);return()=>clearTimeout(N)}},[n]);const P=N=>{x(null),D.mutate(N,{onError:M=>{x(M instanceof Error?M.message:"Failed to connect")}})},A=N=>{confirm("Are you sure you want to disconnect this calendar? Pending events will be removed.")&&E.mutate(N,{onSuccess:()=>{l("Calendar disconnected")},onError:M=>{x(M instanceof Error?M.message:"Failed to disconnect")}})},I=N=>{W.mutate(N,{onSuccess:M=>{l(`Synced! Found ${M.travelDetected} travel events.`)},onError:M=>{x(M instanceof Error?M.message:"Sync failed")}})},T=N=>{var q;const M=(q=N.target.files)==null?void 0:q[0];M&&G.mutate(M,{onSuccess:R=>{l(`Imported ${R.detected} travel events from ${R.parsed} calendar entries.`),c.current&&(c.current.value="")},onError:R=>{x(R instanceof Error?R.message:"Failed to import file")}})},de=N=>{const M=new Set(t);M.has(N)?M.delete(N):M.add(N),a(M)},_=()=>{if(!b)return;const N=b.filter(M=>M.isSchengen);t.size===N.length?a(new Set):a(new Set(N.map(M=>M.id)))},ae=()=>{t.size!==0&&K.mutate(Array.from(t),{onSuccess:N=>{l(`Imported ${N.imported} trips!`),a(new Set)},onError:N=>{x(N instanceof Error?N.message:"Import failed")}})},is=()=>{t.size!==0&&$.mutate(Array.from(t),{onSuccess:N=>{l(`Skipped ${N.skipped} events.`),a(new Set)},onError:N=>{x(N instanceof Error?N.message:"Skip failed")}})},ls=y||j||k,ds=!!(S||f||m),Te=v.length>0,De=b.length>0,re=b.filter(N=>N.isSchengen),Ee=b.filter(N=>!N.isSchengen),Me=N=>N instanceof Error?N.message:typeof N=="string"?N:"Unknown error";if(ls)return e.jsx("div",{className:g("card p-6",s&&"p-4"),children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(L,{className:"w-6 h-6 animate-spin text-primary-600","aria-hidden":"true"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading calendar sync..."})]})});if(ds){const N=S?Me(S):f?Me(f):m?Me(m):"Failed to load calendar data";return e.jsx("div",{className:g("card p-6",s&&"p-4"),children:e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ie,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Unable to load calendar sync"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:N})]})]})})}return s?e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Calendar Sync"})]}),De&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 text-xs font-medium rounded-full",children:[re.length," to review"]})]}),Te?e.jsx("div",{className:"space-y-2",children:v.map(N=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-green-500","aria-hidden":"true"}),e.jsx("span",{children:N.providerName})]}),e.jsx("button",{onClick:()=>I(N.id),disabled:W.isPending,className:"text-primary-600 hover:text-primary-700 text-xs font-medium",children:W.isPending?"Syncing...":"Sync now"})]},N.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Connect your calendar to auto-detect travel."})]}):e.jsxs("div",{className:"space-y-6",children:[d&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(Y,{className:"w-5 h-5 text-green-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-green-800",children:d}),e.jsx("button",{onClick:()=>l(null),className:"ml-auto text-green-600 hover:text-green-800",children:e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"})})]}),n&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ie,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:n}),e.jsx("button",{onClick:()=>x(null),className:"ml-auto text-red-600 hover:text-red-800",children:e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Connected Calendars"})}),e.jsxs("div",{className:"p-6",children:[Te?e.jsx("div",{className:"space-y-4",children:v.map(N=>e.jsx(Rt,{connection:N,onSync:()=>I(N.id),onDisconnect:()=>A(N.id),isSyncing:W.isPending,isDisconnecting:E.isPending},N.id))}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(F,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No calendars connected yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Connect a calendar to automatically detect travel events"})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Add Calendar"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:C.map(N=>{const M=v.some(R=>R.provider===N.id),q=N.isConfigured&&!M;return e.jsxs("button",{onClick:()=>q&&P(N.id),disabled:!q||D.isPending,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",q?"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[D.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(xt,{className:"w-4 h-4","aria-hidden":"true"}),N.name,M&&e.jsx("span",{className:"text-xs text-green-600",children:"(Connected)"}),!N.isConfigured&&e.jsx("span",{className:"text-xs text-gray-400",children:"(Not configured)"})]},N.id)})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Import iCal File"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{ref:c,type:"file",accept:".ics,text/calendar",onChange:T,className:"hidden",id:"ical-upload"}),e.jsxs("label",{htmlFor:"ical-upload",className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium cursor-pointer transition-colors",G.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"),children:[G.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(ye,{className:"w-4 h-4","aria-hidden":"true"}),G.isPending?"Uploading...":"Upload .ics file"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"Export from Apple Calendar, Outlook, or other apps"})]})]})]})]}),De&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detected Travel Events"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Review and import these events as Schengen trips"})]}),re.length>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:_,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:t.size===re.length?"Deselect all":"Select all"})})]}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[re.length>0&&e.jsx("div",{children:re.map(N=>e.jsx(zt,{event:N,isSelected:t.has(N.id),onToggle:()=>de(N.id)},N.id))}),Ee.length>0&&e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsxs("button",{onClick:()=>i(!r),className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800",children:[r?e.jsx(ze,{className:"w-4 h-4","aria-hidden":"true"}):e.jsx(me,{className:"w-4 h-4","aria-hidden":"true"}),Ee.length," non-Schengen events detected"]}),r&&e.jsx("div",{className:"mt-4 space-y-2",children:Ee.map(N=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:N.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[we(N.startDate)," - ",we(N.endDate),N.location&&` â€¢ ${N.location}`]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:N.detectedCountry||"Unknown location"})]},N.id))})]})]}),t.size>0&&e.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[t.size," event",t.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:is,disabled:$.isPending,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:[$.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"}),"Skip"]}),e.jsxs("button",{onClick:ae,disabled:K.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-50",children:[K.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"}),"Import as Trips"]})]})]}),re.length===0&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Y,{className:"w-8 h-8 text-green-500 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-600",children:"All Schengen travel events have been processed!"})]})]}),!De&&Te&&e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx(Y,{className:"w-12 h-12 text-green-400 mx-auto mb-3","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"All caught up!"}),e.jsx("p",{className:"text-gray-500",children:"No pending travel events to review. Events will appear here after syncing."})]})]})}function Rt({connection:s,onSync:t,onDisconnect:a,isSyncing:r,isDisconnecting:i}){const d={active:"bg-green-100 text-green-700",error:"bg-red-100 text-red-700",expired:"bg-yellow-100 text-yellow-700"};return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm",children:e.jsx(F,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.providerName}),e.jsx("span",{className:g("px-2 py-0.5 rounded-full text-xs font-medium",d[s.syncStatus]),children:s.syncStatus})]}),s.lastSyncAt&&e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(le,{className:"w-3 h-3","aria-hidden":"true"}),"Last synced: ",Ot(s.lastSyncAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:t,disabled:r||s.syncStatus==="expired",className:g("inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",r||s.syncStatus==="expired"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-100 text-primary-700 hover:bg-primary-200"),children:[r?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Re,{className:"w-4 h-4","aria-hidden":"true"}),r?"Syncing...":"Sync"]}),e.jsx("button",{onClick:a,disabled:i,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 transition-colors",children:i?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(ut,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}function zt({event:s,isSelected:t,onToggle:a}){const r=s.confidence>=.8?"High":s.confidence>=.5?"Medium":"Low",i=s.confidence>=.8?"text-green-600":s.confidence>=.5?"text-yellow-600":"text-gray-500";return e.jsxs("div",{className:g("flex items-center gap-4 p-4 hover:bg-gray-50 cursor-pointer transition-colors",t&&"bg-primary-50"),onClick:a,role:"checkbox","aria-checked":t,tabIndex:0,onKeyDown:d=>{(d.key===" "||d.key==="Enter")&&(d.preventDefault(),a())},children:[e.jsx("div",{className:g("w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0",t?"bg-primary-600 border-primary-600":"border-gray-300"),children:t&&e.jsx(Z,{className:"w-3 h-3 text-white","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-primary-500 flex-shrink-0","aria-hidden":"true"}),e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:s.title})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3","aria-hidden":"true"}),we(s.startDate)," - ",we(s.endDate)]}),s.location&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(O,{className:"w-3 h-3","aria-hidden":"true"}),s.location]})]})]}),e.jsx("div",{className:"flex items-center gap-4 flex-shrink-0",children:s.detectedCountry&&e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:[s.countryCode&&e.jsx("span",{className:"font-mono",children:s.countryCode}),s.detectedCountry]}),e.jsxs("p",{className:g("text-xs mt-1",i),children:[r," confidence"]})]})})]})}function we(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Ot(s){const t=new Date(s),r=new Date().getTime()-t.getTime(),i=Math.floor(r/6e4),d=Math.floor(r/36e5),l=Math.floor(r/864e5);return i<1?"just now":i<60?`${i}m ago`:d<24?`${d}h ago`:l<7?`${l}d ago`:t.toLocaleDateString()}function $t({disabled:s}){const[t,a]=u.useState(!1),[r,i]=u.useState(null),d=u.useRef(null),l=ks(),n=()=>{l.mutate(void 0,{onSuccess:w=>{i(w),a(!0)}})},x=()=>{var w;(w=d.current)!=null&&w.contentWindow&&d.current.contentWindow.print()},c=()=>{if(!r)return;const w=new Blob([r.html],{type:"text/html"}),p=URL.createObjectURL(w),C=document.createElement("a");C.href=p,C.download=r.filename.replace(".pdf",".html"),document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(p)},h=()=>{a(!1),i(null)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,disabled:s||l.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Export Schengen report as PDF",children:l.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4","aria-hidden":"true"}),"Export Report"]})}),e.jsx(se,{isOpen:t,onClose:h,title:"Schengen Report Preview",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[(r==null?void 0:r.summary)&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.summary.daysUsed}),e.jsx("p",{className:"text-xs text-gray-500",children:"Days Used"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.summary.daysRemaining}),e.jsx("p",{className:"text-xs text-gray-500",children:"Remaining"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:r.summary.status}),e.jsx("p",{className:"text-xs text-gray-500",children:"Status"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.summary.tripCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Trips"})]})]}),(r==null?void 0:r.html)&&e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",style:{height:"400px"},children:e.jsx("iframe",{ref:d,srcDoc:r.html,title:"Report Preview",className:"w-full h-full",sandbox:"allow-same-origin"})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Close"}),e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(Ae,{className:"w-4 h-4","aria-hidden":"true"}),"Download HTML"]}),e.jsxs("button",{onClick:x,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700",children:[e.jsx(ht,{className:"w-4 h-4","aria-hidden":"true"}),"Print / Save as PDF"]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:`Tip: Use your browser's "Print to PDF" option to save as a PDF file`})]})}),l.isError&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-50 border border-red-200 rounded-lg p-4 shadow-lg flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-red-800",children:"Failed to generate report. Please try again."}),e.jsx("button",{onClick:()=>l.reset(),className:"text-red-600 hover:text-red-800","aria-label":"Dismiss error",children:e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}const _t={enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4};function rs(s={}){const t={..._t,...s},[a,r]=u.useState(null),[i,d]=u.useState(null),[l,n]=u.useState(!1),[x,c]=u.useState("prompt"),h=typeof navigator<"u"&&"geolocation"in navigator;u.useEffect(()=>{if(!h){c("unavailable");return}"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(C=>{c(C.state),C.addEventListener("change",()=>{c(C.state)})}).catch(()=>{c("prompt")})},[h]);const w=u.useCallback(()=>new Promise((C,v)=>{if(!h){const b={code:0,message:"Geolocation is not supported by this browser."};d(b),v(b);return}n(!0),d(null),navigator.geolocation.getCurrentPosition(b=>{const o={lat:b.coords.latitude,lng:b.coords.longitude,accuracy:b.coords.accuracy,timestamp:b.timestamp};r(o),d(null),n(!1),c("granted"),C(o)},b=>{const o={code:b.code,message:Ht(b.code)};d(o),n(!1),b.code===b.PERMISSION_DENIED&&c("denied"),v(o)},{enableHighAccuracy:t.enableHighAccuracy,timeout:t.timeout,maximumAge:t.maximumAge})}),[h,t.enableHighAccuracy,t.timeout,t.maximumAge]),p=u.useCallback(()=>{r(null),d(null)},[]);return{position:a,error:i,isLoading:l,permission:x,isSupported:h,getCurrentPosition:w,clearPosition:p}}function Ht(s){switch(s){case 1:return"Location permission denied. Please enable location access in your browser settings.";case 2:return"Unable to determine your location. Please try again.";case 3:return"Location request timed out. Please try again.";default:return"An unknown error occurred while getting your location."}}function Ve({compact:s=!1}){const[t,a]=u.useState(!1),[r,i]=u.useState(!1),{error:d,isLoading:l,permission:n,isSupported:x,getCurrentPosition:c}=rs(),{data:h,isLoading:w}=Ts(),p=Qe(),C=u.useCallback(async()=>{try{const y=await c();await p.mutateAsync({lat:y.lat,lng:y.lng,accuracy:y.accuracy,source:"checkin"})}catch(y){console.error("Check-in failed:",y)}},[c,p]),v=(h==null?void 0:h.hasCheckedInToday)??!1,b=h==null?void 0:h.lastLocation,o=l||p.isPending;return s?e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("p-2 rounded-lg",v?"bg-green-100":"bg-gray-100"),children:e.jsx(O,{className:g("w-5 h-5",v?"text-green-600":"text-gray-500"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Location Check-in"}),v&&b?e.jsxs("p",{className:"text-xs text-green-600",children:["Checked in: ",b.countryName??"Unknown",b.isSchengen&&" (Schengen)"]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Not checked in today"})]})]}),e.jsx("button",{onClick:C,disabled:o||!x,className:g("inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",o?"bg-gray-100 text-gray-400 cursor-not-allowed":v?"bg-green-100 text-green-700 hover:bg-green-200":"bg-primary-600 text-white hover:bg-primary-700"),children:o?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Checking in..."})]}):v?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4","aria-hidden":"true"}),"Update"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4","aria-hidden":"true"}),"Check In"]})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("p-3 rounded-xl",v?"bg-green-100":"bg-blue-100"),children:e.jsx(O,{className:g("w-6 h-6",v?"text-green-600":"text-blue-600"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Check-in"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Record your current location for Schengen tracking"})]})]}),e.jsxs("button",{onClick:()=>a(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(mt,{className:"w-4 h-4","aria-hidden":"true"}),"History"]})]}),!x&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Geolocation is not supported by your browser. Try using a modern browser like Chrome, Firefox, or Safari."})]}),n==="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Location permission denied"}),e.jsx("p",{className:"text-sm text-red-700",children:"Please enable location access in your browser settings to use this feature."})]})]}),d&&n!=="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:d.message})]}),p.error&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"Failed to save location."}),e.jsx("p",{className:"mt-1 text-xs",children:p.error instanceof Error?p.error.message:"Please try again."})]})]}),w?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})}):v&&b?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-green-600","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-800",children:"Checked in today"}),e.jsxs("p",{className:"text-sm text-green-700",children:[b.city&&`${b.city}, `,b.countryName??"Unknown location",b.isSchengen&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:[e.jsx(z,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Schengen"]})]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["at ",new Date(b.recordedAt).toLocaleTimeString()]})]})]})}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-500","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You haven't checked in today. Check in to record your location for Schengen tracking."})]})}),e.jsx("button",{onClick:C,disabled:o||!x||n==="denied",className:g("w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors",o||!x||n==="denied"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:o?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}),"Getting your location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-5 h-5","aria-hidden":"true"}),v?"Update Location":"Check In Now"]})}),p.isSuccess&&p.data&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(Y,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:p.data.message})]})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-blue-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"How location tracking works:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Your location is detected using your browser's GPS"}),e.jsx("li",{children:"We determine which country you're in automatically"}),e.jsx("li",{children:"Schengen zone countries are tracked for the 90/180 rule"}),e.jsx("li",{children:"You can view and delete your location history at any time"})]})]})]})})]}),e.jsx(se,{isOpen:t,onClose:()=>a(!1),title:"Location History",size:"lg",children:e.jsx(Vt,{onClearRequest:()=>i(!0)})}),e.jsx(se,{isOpen:r,onClose:()=>i(!1),title:"Clear Location History",size:"sm",children:e.jsx(Yt,{onConfirm:()=>{i(!1),a(!1)},onCancel:()=>i(!1)})})]})}function Vt({onClearRequest:s}){const{data:t,isLoading:a,refetch:r,isRefetching:i}=Ds({limit:50}),d=Es(),l=async x=>{confirm("Delete this location entry?")&&await d.mutateAsync(x)};if(a)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})});const n=(t==null?void 0:t.locations)??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[(t==null?void 0:t.total)??0," location",((t==null?void 0:t.total)??0)!==1?"s":""," recorded"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>r(),disabled:i,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",children:[e.jsx(Re,{className:g("w-4 h-4",i&&"animate-spin"),"aria-hidden":"true"}),"Refresh"]}),n.length>0&&e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-colors",children:[e.jsx(oe,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All"]})]})]}),n.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500",children:"No location history yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Check in to start recording your locations"})]}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:n.map(x=>e.jsx(Wt,{location:x,onDelete:()=>l(x.id),isDeleting:d.isPending},x.id))})]})}function Wt({location:s,onDelete:t,isDeleting:a}){const r=new Date(s.recordedAt);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("p-2 rounded-lg",s.isSchengen?"bg-blue-100":"bg-gray-100"),children:s.isSchengen?e.jsx(z,{className:"w-4 h-4 text-blue-600","aria-hidden":"true"}):e.jsx(O,{className:"w-4 h-4 text-gray-500","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[s.city&&`${s.city}, `,s.countryName??"Unknown location",s.isSchengen&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Schengen)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.toLocaleDateString()," at ",r.toLocaleTimeString(),s.accuracy&&e.jsxs("span",{className:"ml-2",children:["(Â±",Math.round(s.accuracy),"m)"]})]})]})]}),e.jsx("button",{onClick:t,disabled:a,className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-red-600 transition-all",title:"Delete",children:e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"})})]})}function Yt({onConfirm:s,onCancel:t}){const a=Ms(),r=async()=>{await a.mutateAsync(),s()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete all your location history? This action cannot be undone."}),a.error&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:"Failed to clear history. Please try again."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:t,disabled:a.isPending,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:r,disabled:a.isPending,className:g("inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors",a.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700"),children:a.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All History"]})})]})]})}const Bt={"Europe/Paris":["FR"],"Europe/Berlin":["DE"],"Europe/Rome":["IT"],"Europe/Madrid":["ES"],"Europe/Amsterdam":["NL"],"Europe/Brussels":["BE"],"Europe/Vienna":["AT"],"Europe/Zurich":["CH"],"Europe/Stockholm":["SE"],"Europe/Oslo":["NO"],"Europe/Copenhagen":["DK"],"Europe/Helsinki":["FI"],"Europe/Warsaw":["PL"],"Europe/Prague":["CZ"],"Europe/Budapest":["HU"],"Europe/Athens":["GR"],"Europe/Lisbon":["PT"],"Europe/Dublin":["IE"],"Europe/London":["GB"],"Europe/Bucharest":["RO"],"Europe/Sofia":["BG"],"Europe/Zagreb":["HR"],"Europe/Ljubljana":["SI"],"Europe/Bratislava":["SK"],"Europe/Tallinn":["EE"],"Europe/Riga":["LV"],"Europe/Vilnius":["LT"],"Europe/Luxembourg":["LU"],"Europe/Malta":["MT"],"Europe/Reykjavik":["IS"],"Europe/Vaduz":["LI"],"Europe/Monaco":["MC"]},Gt=new Set(["AT","BE","BG","HR","CZ","DK","EE","FI","FR","DE","GR","HU","IS","IT","LV","LI","LT","LU","MT","NL","NO","PL","PT","RO","SK","SI","ES","SE","CH"]),J={TIMEZONE:"r2f_schengen_last_timezone",LAST_CHECKIN:"r2f_schengen_last_checkin_date",PROMPT_DISMISSED:"r2f_schengen_prompt_dismissed_date"};function We(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return"UTC"}}function qt(){return navigator.language||"en-US"}function Ye(s){const t=Bt[s];return(t==null?void 0:t[0])||null}function Be(s){return s?Gt.has(s):!1}function ue(){return new Date().toISOString().split("T")[0]}function Jt(s={}){const{enableReminder:t=!0,reminderHour:a=9}=s,[r,i]=u.useState(()=>{const c=We(),h=localStorage.getItem(J.TIMEZONE),w=localStorage.getItem(J.LAST_CHECKIN),p=localStorage.getItem(J.PROMPT_DISMISSED),C=ue(),v=Ye(c),b=h!==null&&h!==c,o=w===C,j=b||t&&!o&&!(p===C);return{currentTimezone:c,storedTimezone:h,timezoneChanged:b,likelyCountry:v,likelySchengen:Be(v),currentLocale:qt(),shouldPromptCheckin:j,lastCheckinDate:w,checkedInToday:o}});u.useEffect(()=>{const h=setInterval(()=>{const w=We();i(p=>{if(p.currentTimezone!==w){const C=Ye(w);return{...p,currentTimezone:w,timezoneChanged:p.storedTimezone!==null&&p.storedTimezone!==w,likelyCountry:C,likelySchengen:Be(C),shouldPromptCheckin:!0}}return p})},3e5);return()=>clearInterval(h)},[]),u.useEffect(()=>{if(!t)return;const c=()=>{const w=new Date,p=ue(),C=localStorage.getItem(J.LAST_CHECKIN),v=localStorage.getItem(J.PROMPT_DISMISSED);w.getHours()>=a&&C!==p&&v!==p&&i(b=>({...b,shouldPromptCheckin:!0,checkedInToday:!1}))};c();const h=setInterval(c,60*1e3);return()=>clearInterval(h)},[t,a]);const d=u.useCallback(()=>{localStorage.setItem(J.TIMEZONE,r.currentTimezone),i(c=>({...c,storedTimezone:c.currentTimezone,timezoneChanged:!1}))},[r.currentTimezone]),l=u.useCallback(()=>{const c=ue();localStorage.setItem(J.LAST_CHECKIN,c),localStorage.setItem(J.TIMEZONE,r.currentTimezone),i(h=>({...h,lastCheckinDate:c,checkedInToday:!0,shouldPromptCheckin:!1,storedTimezone:h.currentTimezone,timezoneChanged:!1}))},[r.currentTimezone]),n=u.useCallback(()=>{const c=ue();localStorage.setItem(J.PROMPT_DISMISSED,c),i(h=>({...h,shouldPromptCheckin:!1}))},[]),x=u.useCallback(()=>new Date().getHours()>=a,[a]);return u.useMemo(()=>({state:r,acknowledgeTimezone:d,markCheckedIn:l,dismissPrompt:n,isReminderTime:x}),[r,d,l,n,x])}function Kt(s){const t=s.toUpperCase().split("").map(a=>127397+a.charCodeAt(0));return String.fromCodePoint(...t)}function Zt({enabled:s=!0,onCheckin:t,onDismiss:a}){const[r,i]=u.useState(!1),{state:d,markCheckedIn:l,dismissPrompt:n}=Jt({enableReminder:s}),{data:x}=Ls(),{getCurrentPosition:c,isLoading:h,isSupported:w}=rs(),p=Qe();u.useEffect(()=>{if(r){const D=setTimeout(()=>i(!1),3e3);return()=>clearTimeout(D)}},[r]);const C=u.useCallback(async()=>{try{const D=await c();await p.mutateAsync({lat:D.lat,lng:D.lng,accuracy:D.accuracy,source:"checkin"}),l(),i(!0),t==null||t()}catch(D){console.error("Check-in failed:",D)}},[c,p,l,t]),v=u.useCallback(()=>{n(),a==null||a()},[n,a]);if(!s||!d.shouldPromptCheckin||d.checkedInToday)return null;const b=h||p.isPending;let o=le,y="Daily Location Check-in",j="Don't forget to check in your location for accurate Schengen tracking.",k="blue";if(d.timezoneChanged?(o=xe,y="Travel Detected",j=`Your timezone changed from ${d.storedTimezone} to ${d.currentTimezone}. Are you traveling?`,k="amber"):x!=null&&x.detected&&x.countryCode&&d.likelyCountry&&x.countryCode!==d.likelyCountry&&(o=z,y="Location Check",j=`Your IP suggests you're in ${x.countryName||x.countryCode}. Check in to confirm your location.`,k="purple"),r)return e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5 text-green-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Location recorded!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your location has been saved for Schengen tracking."})]})]})});const S=o,m={blue:{bg:"bg-blue-50",border:"border-blue-200",icon:"bg-blue-100 text-blue-600",title:"text-blue-800",message:"text-blue-700",button:"bg-blue-600 hover:bg-blue-700 text-white",dismiss:"text-blue-500 hover:text-blue-700 hover:bg-blue-100"},amber:{bg:"bg-amber-50",border:"border-amber-200",icon:"bg-amber-100 text-amber-600",title:"text-amber-800",message:"text-amber-700",button:"bg-amber-600 hover:bg-amber-700 text-white",dismiss:"text-amber-500 hover:text-amber-700 hover:bg-amber-100"},purple:{bg:"bg-purple-50",border:"border-purple-200",icon:"bg-purple-100 text-purple-600",title:"text-purple-800",message:"text-purple-700",button:"bg-purple-600 hover:bg-purple-700 text-white",dismiss:"text-purple-500 hover:text-purple-700 hover:bg-purple-100"}}[k];return e.jsx("div",{className:g("border rounded-lg p-4 mb-4",m.bg,m.border),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:g("p-2 rounded-lg",m.icon),children:e.jsx(S,{className:"w-5 h-5","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:g("font-medium",m.title),children:y}),(x==null?void 0:x.detected)&&x.countryCode&&e.jsx("span",{className:"text-lg",role:"img","aria-label":x.countryName||x.countryCode,children:Kt(x.countryCode)})]}),e.jsx("p",{className:g("text-sm mt-0.5",m.message),children:j}),d.likelySchengen&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs",children:[e.jsx(z,{className:"w-3 h-3 text-blue-500","aria-hidden":"true"}),e.jsxs("span",{className:"text-blue-600",children:["Based on timezone: Likely in Schengen zone (",d.likelyCountry,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsx("button",{onClick:C,disabled:b||!w,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",b||!w?"bg-gray-100 text-gray-400 cursor-not-allowed":m.button),children:b?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Getting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4","aria-hidden":"true"}),"Check In Now"]})}),e.jsx("button",{onClick:v,className:g("px-3 py-2 rounded-lg text-sm transition-colors",m.dismiss),children:"Maybe later"})]}),p.error&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-sm text-red-600",children:[e.jsx(ce,{className:"w-4 h-4","aria-hidden":"true"}),"Failed to save location. Please try again."]}),!w&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs text-gray-500",children:[e.jsx(ce,{className:"w-3 h-3","aria-hidden":"true"}),"Geolocation is not supported by your browser."]})]})]}),e.jsx("button",{onClick:v,className:g("p-1 rounded transition-colors",m.dismiss),"aria-label":"Dismiss",children:e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"})})]})})}const ns="r2f_schengen_onboarding_complete";function Qt(){return localStorage.getItem(ns)==="true"}function Ge(){localStorage.setItem(ns,"true")}function Xt({isOpen:s,onComplete:t,isPremium:a=!1}){const[r,i]=u.useState(0),d=[{icon:e.jsx(z,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Welcome to Schengen Tracker",description:"Understand and comply with the 90/180 day rule",details:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-5 bg-blue-50 border border-blue-100 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-base",children:"The 90/180 Rule"}),e.jsxs("p",{className:"text-blue-800 leading-relaxed",children:["Non-EU citizens may stay up to ",e.jsx("strong",{children:"90 days"})," within any"," ",e.jsx("strong",{children:"180-day rolling period"})," in the Schengen area without a long-stay visa."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Entry & Exit"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Both days count as full days"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Rolling Window"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Days expire after 180 days"})]})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Overstaying can result in fines, deportation, and future visa denials."})]})},{icon:e.jsx(xe,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Track Your Trips",description:"Add your past and future Schengen travel",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Keep an accurate record of all your Schengen zone visits to stay compliant."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"1"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:'Click "Add Trip"'}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Enter your travel dates and destination country"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"2"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Add all past trips"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Include trips from the last 6 months for accurate tracking"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"3"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Plan future trips"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Add upcoming travel to see projected compliance"})]})]})]})]})},{icon:e.jsx(O,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Smart Location Check-in",description:"Quick daily check-ins keep your tracker current",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Use location check-in to automatically record your presence in Schengen countries."}),e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-600 flex items-center justify-center",children:e.jsx(Z,{className:"w-5 h-5 text-white","aria-hidden":"true"})}),e.jsx("h4",{className:"font-semibold text-green-900 text-base",children:"Automatic Trip Creation"})]}),e.jsx("p",{className:"text-green-800 leading-relaxed",children:"When you check in from a Schengen country, we automatically create or extend your trip record. No manual entry needed!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Browser Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:"One-click check-in with GPS"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Smart Detection"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Prompts when timezone changes"})]})]})]})},{icon:e.jsx(ve,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Plan Future Travel",description:'Use the "What If" calculator before you book',details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Before booking a trip, check if it would violate the 90/180 rule."}),e.jsxs("div",{className:"p-5 bg-primary-50 border border-primary-100 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-primary-900 mb-4 text-base",children:"The Planning Tool shows you:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"Whether your planned trip would be safe"]}),e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"The earliest safe date to start your trip"]}),e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"Maximum safe trip length from any date"]})]})]}),!a&&e.jsx("p",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-100 p-3 rounded-xl text-center",children:"â­ Planning Tool is a premium feature"})]})},{icon:e.jsx(je,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Stay Informed with Alerts",description:"Get notified before you approach the limit",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Enable email alerts to receive warnings when approaching your 90-day limit."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-yellow-50 border border-yellow-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-yellow-900",children:"60 days used"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Friendly reminder to plan ahead"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-orange-50 border border-orange-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-orange-900",children:"80 days used"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Warning to limit travel"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-red-50 border border-red-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-red-900",children:"85+ days used"}),e.jsx("p",{className:"text-sm text-red-700",children:"Urgent alert to avoid overstay"})]})]})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Enable alerts in the Settings tab after completing this tour."})]})}],l=()=>{r<d.length-1?i(r+1):(Ge(),t())},n=()=>{r>0&&i(r-1)},x=()=>{Ge(),t()},c=d[r],h=r===d.length-1;return e.jsx(se,{isOpen:s,onClose:x,title:"",size:"lg",children:e.jsxs("div",{className:"px-4 py-6 sm:px-8 sm:py-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 bg-primary-50 rounded-2xl flex items-center justify-center",children:c.icon})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:c.title}),e.jsx("p",{className:"text-gray-500 text-lg",children:c.description})]}),e.jsx("div",{className:"mb-10 max-w-lg mx-auto",children:c.details}),e.jsx("div",{className:"flex justify-center gap-2.5 mb-8",children:d.map((w,p)=>e.jsx("button",{onClick:()=>i(p),className:g("h-2.5 rounded-full transition-all duration-300",p===r?"bg-primary-600 w-8":p<r?"bg-primary-300 w-2.5":"bg-gray-200 w-2.5"),"aria-label":`Go to step ${p+1}`},p))}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-100",children:[e.jsx("button",{onClick:x,className:"text-sm text-gray-400 hover:text-gray-600 transition-colors",children:"Skip tour"}),e.jsxs("div",{className:"flex items-center gap-3",children:[r>0&&e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-1.5 px-5 py-2.5 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(Ke,{className:"w-4 h-4","aria-hidden":"true"}),"Back"]}),e.jsx("button",{onClick:l,className:"inline-flex items-center gap-1.5 px-6 py-2.5 bg-primary-600 text-white rounded-lg font-medium text-sm hover:bg-primary-700 transition-colors shadow-sm",children:h?e.jsxs(e.Fragment,{children:["Get Started",e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"})]}):e.jsxs(e.Fragment,{children:["Next",e.jsx(Ze,{className:"w-4 h-4","aria-hidden":"true"})]})})]})]})]})})}function ea({className:s}){const{data:t,isLoading:a}=Ps(),{data:r,isLoading:i}=qe(),{data:d,isLoading:l}=As(),n=Fs(),x=Is(),[c,h]=u.useState(!1),[w,p]=u.useState("all"),C=a||i||l,v=new Set((r==null?void 0:r.map(S=>S.code))||[]),b=(t==null?void 0:t.filter(S=>!v.has(S.code)))||[],y=(w==="all"?b:b.filter(S=>S.type===w)).reduce((S,f)=>{const m=f.type;return S[m]||(S[m]=[]),S[m].push(f),S},{}),j=async S=>{try{await n.mutateAsync(S)}catch(f){console.error("Failed to add jurisdiction:",f)}},k=async S=>{try{await x.mutateAsync(S)}catch(f){console.error("Failed to remove jurisdiction:",f)}};return C?e.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3",role:"status","aria-label":"Loading"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading jurisdictions..."})]})}):e.jsxs("div",{className:g("space-y-6",s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(z,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Jurisdiction Tracking"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Track multiple visa and residency rules"})]})]}),e.jsxs("button",{type:"button",onClick:()=>h(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(ne,{className:"w-4 h-4","aria-hidden":"true"}),"Add Jurisdiction"]})]}),r&&r.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(S=>{const f=d==null?void 0:d[S.code];return e.jsx(sa,{jurisdiction:S,summary:f,onRemove:()=>k(S.code),isRemoving:x.isPending},S.code)})}):e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Jurisdictions Tracked"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add jurisdictions to track your visa and residency compliance across multiple countries."}),e.jsxs("button",{type:"button",onClick:()=>h(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(ne,{className:"w-4 h-4","aria-hidden":"true"}),"Add Your First Jurisdiction"]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Jurisdiction"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:e.jsx(B,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:["all","zone","country","state"].map(S=>e.jsx("button",{type:"button",onClick:()=>p(S),className:g("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",w===S?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:S==="all"?"All":S==="zone"?"Zones":S==="country"?"Countries":"States"},S))})}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[50vh]",children:Object.keys(y).length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No jurisdictions available to add."}):e.jsx("div",{className:"space-y-4",children:Object.entries(y).map(([S,f])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-2",children:S==="zone"?"Visa Zones":S==="country"?"Country Rules":"State Rules"}),e.jsx("div",{className:"space-y-2",children:f.map(m=>e.jsxs("button",{type:"button",onClick:D=>{D.preventDefault(),j(m.code),h(!1)},disabled:n.isPending,className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors text-left",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:m.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[m.daysAllowed," days / ",m.windowDays," day window"]}),m.description&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:m.description})]}),e.jsx(ne,{className:"w-5 h-5 text-primary-600 flex-shrink-0","aria-hidden":"true"})]},m.code))})]},S))})})]})})]})}function sa({jurisdiction:s,summary:t,onRemove:a,isRemoving:r}){const[i,d]=u.useState(!1),n=(p=>{switch(p){case"warning":return"warning";case"danger":return"danger";case"critical":case"violation":return"critical";default:return"safe"}})(t==null?void 0:t.status),x=(t==null?void 0:t.daysUsed)??0,c=(t==null?void 0:t.daysRemaining)??s.daysAllowed,h=(t==null?void 0:t.percentage)??0,w=p=>new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:g("card p-4 border-l-4",n==="safe"&&"border-l-green-500",n==="warning"&&"border-l-yellow-500",n==="danger"&&"border-l-orange-500",n==="critical"&&"border-l-red-500"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.type==="zone"?"Visa Zone":s.type==="country"?"Country Rule":"State Tax"})]}),e.jsx("button",{type:"button",onClick:a,disabled:r,className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors","aria-label":`Remove ${s.name}`,children:r?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx($e,{daysUsed:x,daysRemaining:c,status:n,size:"sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[x," / ",s.daysAllowed," days"]}),e.jsx(X,{status:n,size:"sm"})]}),e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:g("h-full rounded-full transition-all duration-500",n==="safe"&&"bg-green-500",n==="warning"&&"bg-yellow-500",n==="danger"&&"bg-orange-500",n==="critical"&&"bg-red-500"),style:{width:`${Math.min(h,100)}%`}})})]})]}),e.jsxs("button",{type:"button",onClick:()=>d(!i),className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 transition-colors",children:[e.jsx(me,{className:g("w-4 h-4 transition-transform",i&&"rotate-180"),"aria-hidden":"true"}),i?"Hide details":"Show details"]}),i&&t&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(F,{className:"w-3.5 h-3.5","aria-hidden":"true"}),e.jsxs("span",{children:["Window: ",w(t.windowStart)," - ",w(t.windowEnd)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(le,{className:"w-3.5 h-3.5","aria-hidden":"true"}),e.jsxs("span",{children:["Counting: ",t.countingMethod==="rolling"?"Rolling Window":t.countingMethod==="calendar_year"?"Calendar Year":"Fiscal Year"]})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:s.description})]})]})}function ta({className:s}){const[t,a]=u.useState(!1),r=u.useRef(null),{data:i,isLoading:d}=Us(),{data:l}=Rs(),n=zs(),x=Os(),c=$s(),h=(l==null?void 0:l.count)??0;u.useEffect(()=>{function o(y){r.current&&!r.current.contains(y.target)&&a(!1)}return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const w=o=>{o.isRead||n.mutate(o.id),o.actionUrl&&(window.location.href=o.actionUrl)},p=(o,y)=>{o.stopPropagation(),c.mutate(y)},C=()=>{x.mutate(void 0)},v=o=>{switch(o){case"threshold_warning":case"threshold_danger":return e.jsx(U,{className:"w-4 h-4 text-amber-500","aria-hidden":"true"});case"trip_reminder":case"calendar_sync":case"day_expiring":return e.jsx(F,{className:"w-4 h-4 text-primary-500","aria-hidden":"true"});case"location_checkin":return e.jsx(O,{className:"w-4 h-4 text-purple-500","aria-hidden":"true"});default:return e.jsx(ee,{className:"w-4 h-4 text-gray-500","aria-hidden":"true"})}},b=o=>{const y=new Date(o),k=new Date().getTime()-y.getTime(),S=Math.floor(k/6e4),f=Math.floor(k/36e5),m=Math.floor(k/864e5);return S<1?"Just now":S<60?`${S}m ago`:f<24?`${f}h ago`:m<7?`${m}d ago`:y.toLocaleDateString()};return e.jsxs("div",{ref:r,className:g("relative",s),children:[e.jsxs("button",{type:"button",onClick:()=>a(!t),className:g("relative p-2 rounded-lg transition-colors",t?"bg-primary-100 text-primary-600":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),"aria-label":`Notifications${h>0?` (${h} unread)`:""}`,"aria-expanded":t,"aria-haspopup":"true",children:[e.jsx(je,{className:"w-5 h-5","aria-hidden":"true"}),h>0&&e.jsx("span",{className:"absolute top-0 right-0 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full transform translate-x-1/4 -translate-y-1/4",children:h>99?"99+":h})]}),t&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 sm:w-96 bg-white rounded-xl shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[h>0&&e.jsxs("button",{type:"button",onClick:C,disabled:x.isPending,className:"text-xs text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1",children:[x.isPending?e.jsx(L,{className:"w-3 h-3 animate-spin","aria-hidden":"true"}):e.jsx(ot,{className:"w-3 h-3","aria-hidden":"true"}),"Mark all read"]}),e.jsx("button",{type:"button",onClick:()=>a(!1),className:"p-1 text-gray-400 hover:text-gray-600 rounded","aria-label":"Close notifications",children:e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"})})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:d?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})}):i&&i.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:i.map(o=>e.jsx("div",{className:g("px-4 py-3 cursor-pointer transition-colors hover:bg-gray-50",!o.isRead&&"bg-primary-50"),onClick:()=>w(o),role:"button",tabIndex:0,onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&w(o)},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:v(o.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:g("text-sm font-medium truncate",o.isRead?"text-gray-900":"text-primary-900"),children:o.title}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[!o.isRead&&e.jsx("span",{className:"w-2 h-2 bg-primary-500 rounded-full",title:"Unread"}),e.jsx("button",{type:"button",onClick:y=>p(y,o.id),disabled:c.isPending,className:"p-1 text-gray-400 hover:text-red-600 rounded opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Delete notification",children:e.jsx(oe,{className:"w-3 h-3","aria-hidden":"true"})})]})]}),o.body&&e.jsx("p",{className:"text-sm text-gray-600 mt-0.5 line-clamp-2",children:o.body}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:b(o.createdAt)})]})]})},o.id))}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(je,{className:"w-8 h-8 text-gray-300 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No notifications"})]})}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-gray-50",children:e.jsxs("a",{href:"/member-portal/schengen?tab=settings",className:"flex items-center justify-center gap-1 text-xs text-gray-500 hover:text-gray-700",children:[e.jsx(Fe,{className:"w-3 h-3","aria-hidden":"true"}),"Notification settings"]})})]})]})}function aa({className:s}){const[t,a]=u.useState(null),[r,i]=u.useState(""),[d,l]=u.useState(!0),[n,x]=u.useState(null),c=u.useRef(null),h=_s(),w=Hs(),p=async y=>{var S;const j=(S=y.target.files)==null?void 0:S[0];if(!j)return;const k=new FileReader;k.onload=f=>{var D;const m=(D=f.target)==null?void 0:D.result;i(m),a("file")},k.readAsText(j)},C=async()=>{if(r.trim())try{const y=await h.mutateAsync({csv:r,skipDuplicates:d});x(y)}catch{}},v=async()=>{try{const y=await w.mutateAsync(),j=new Blob([y.csv],{type:"text/csv;charset=utf-8;"}),k=URL.createObjectURL(j),S=document.createElement("a");S.href=k,S.download=y.filename,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(k)}catch{}},b=()=>{a(null),i(""),x(null),c.current&&(c.current.value="")};return e.jsxs("div",{className:g("space-y-6",s),children:[e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),"Export Trips"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Download all your trips as a CSV file for backup or editing."})]}),e.jsxs("button",{type:"button",onClick:v,disabled:w.isPending,className:"btn-primary flex items-center gap-2",children:[w.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Ae,{className:"w-4 h-4","aria-hidden":"true"}),"Export CSV"]})]})}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2 mb-4",children:[e.jsx(ye,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),"Import Trips"]}),n&&e.jsxs("div",{className:g("mb-4 p-4 rounded-lg flex items-start gap-3",n.imported>0?"bg-green-50":"bg-yellow-50"),children:[n.imported>0?e.jsx(at,{className:"w-5 h-5 text-green-600 flex-shrink-0","aria-hidden":"true"}):e.jsx(ce,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:g("font-medium",n.imported>0?"text-green-800":"text-yellow-800"),children:n.message}),n.errors.length>0&&e.jsx("ul",{className:"mt-2 text-sm text-gray-600 space-y-1",children:n.errors.map((y,j)=>e.jsx("li",{children:y},j))})]}),e.jsx("button",{type:"button",onClick:b,className:"p-1 text-gray-400 hover:text-gray-600","aria-label":"Dismiss",children:e.jsx(B,{className:"w-4 h-4","aria-hidden":"true"})})]}),!t&&!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>{var y;return(y=c.current)==null?void 0:y.click()},className:"p-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-400 hover:bg-primary-50 transition-colors text-center",children:[e.jsx(rt,{className:"w-8 h-8 text-gray-400 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"font-medium text-gray-700",children:"Upload CSV File"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Drag & drop or click to browse"})]}),e.jsxs("button",{type:"button",onClick:()=>a("paste"),className:"p-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-400 hover:bg-primary-50 transition-colors text-center",children:[e.jsx(ye,{className:"w-8 h-8 text-gray-400 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"font-medium text-gray-700",children:"Paste CSV Data"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Copy & paste your CSV content"})]})]}),e.jsx("input",{ref:c,type:"file",accept:".csv,text/csv",onChange:p,className:"hidden"})]}),t&&!n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"csv-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"CSV Data"}),e.jsx("textarea",{id:"csv-input",value:r,onChange:y=>i(y.target.value),rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:`start_date,end_date,country,category,notes
2024-01-15,2024-01-20,France,personal,My trip`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"skip-duplicates",checked:d,onChange:y=>l(y.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"skip-duplicates",className:"text-sm text-gray-700",children:"Skip duplicate trips (same dates and country)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:C,disabled:h.isPending||!r.trim(),className:"btn-primary flex items-center gap-2",children:[h.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(ye,{className:"w-4 h-4","aria-hidden":"true"}),"Import Trips"]}),e.jsx("button",{type:"button",onClick:b,className:"btn-secondary",children:"Cancel"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"CSV Format Requirements:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"start_date"}),": Trip start date (YYYY-MM-DD format, required)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"end_date"}),": Trip end date (YYYY-MM-DD format, required)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"country"}),": Schengen country name (required)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"category"}),': "personal" or "business" (optional, defaults to personal)']}),e.jsxs("li",{children:[e.jsx("strong",{children:"notes"}),": Trip notes (optional)"]})]}),e.jsx("p",{className:"mt-3 font-medium text-gray-700",children:"Sample CSV:"}),e.jsx("pre",{className:"mt-1 p-2 bg-white rounded border text-xs overflow-x-auto",children:`start_date,end_date,country,category,notes
2024-01-15,2024-01-20,France,personal,Winter vacation in Paris
2024-03-01,2024-03-05,Germany,business,Berlin conference
2024-06-10,2024-06-18,Italy,personal,Summer trip to Rome`})]})]})})]})]})}const ra={high:{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:"text-red-600"},medium:{bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-800",icon:"text-amber-600"},low:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:"text-blue-600"},info:{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-800",icon:"text-gray-600"}};function na(s,t){return{calendar:e.jsx(F,{className:t,"aria-hidden":"true"}),clock:e.jsx(le,{className:t,"aria-hidden":"true"}),sparkles:e.jsx(Xe,{className:t,"aria-hidden":"true"}),"trending-up":e.jsx(ss,{className:t,"aria-hidden":"true"}),"shield-alert":e.jsx(nt,{className:t,"aria-hidden":"true"}),"alert-triangle":e.jsx(U,{className:t,"aria-hidden":"true"})}[s]||e.jsx(es,{className:t,"aria-hidden":"true"})}function ia({suggestion:s,compact:t=!1}){const a=ra[s.priority];return e.jsx("div",{className:g("rounded-lg border p-4 transition-all hover:shadow-sm",a.bg,a.border,t&&"p-3"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:g("flex-shrink-0 mt-0.5",a.icon),children:na(s.icon,"w-5 h-5")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:g("font-medium",a.text,t?"text-sm":"text-base"),children:s.title}),e.jsx("p",{className:g("mt-1 text-gray-600",t?"text-xs":"text-sm"),children:s.message})]})]})})}function la({className:s,compact:t=!1}){const{data:a,isLoading:r,isError:i,refetch:d,isFetching:l}=Vs();if(r)return e.jsx("div",{className:g("card p-6",s),children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(L,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Analyzing your travel data..."})]})});if(i||!a)return e.jsx("div",{className:g("card p-6",s),children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-gray-500",children:"Unable to load suggestions"}),e.jsx("button",{onClick:()=>d(),className:"mt-2 text-primary-600 hover:text-primary-700 text-sm font-medium",children:"Try again"})]})});const{suggestions:n}=a,x={high:0,medium:1,low:2,info:3},c=[...n].sort((h,w)=>x[h.priority]-x[w.priority]);return e.jsxs("div",{className:g("card",s),children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Xe,{className:"w-5 h-5 text-purple-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Smart Suggestions"}),e.jsx("p",{className:"text-sm text-gray-500",children:"AI-powered insights for your travel planning"})]})]}),e.jsx("button",{onClick:()=>d(),disabled:l,className:g("p-2 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",l&&"animate-spin"),"aria-label":"Refresh suggestions",children:e.jsx(Re,{className:"w-4 h-4","aria-hidden":"true"})})]})}),e.jsx("div",{className:g("p-6 space-y-3",t&&"p-4 space-y-2"),children:c.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(es,{className:"w-10 h-10 text-gray-300 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500",children:"No suggestions available"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add more trips to get personalized recommendations"})]}):c.map((h,w)=>e.jsx(ia,{suggestion:h,compact:t},`${h.type}-${w}`))})]})}function da({compact:s=!1}){var k,S;const{data:t,isLoading:a,error:r,refetch:i}=Ws(),d=Ys(),l=Bs(),n=Gs(),[x,c]=u.useState(!1),[h,w]=u.useState(null),[p,C]=u.useState(new Set),v=f=>{const m=new Set(p);m.has(f)?m.delete(f):m.add(f),C(m)},b=async f=>{await d.mutateAsync(f),c(!1),i()},o=async(f,m)=>{await l.mutateAsync({id:f,data:m}),w(null),i()},y=async f=>{confirm("Remove this family member from tracking?")&&(await n.mutateAsync(f),i())};if(a)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(L,{className:"w-6 h-6 animate-spin text-primary-500"})});if(r)return e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:"Failed to load family data"});const j=t;return s?e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Family Overview"})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[(((k=j==null?void 0:j.family)==null?void 0:k.length)??0)+1," travelers"]})]}),e.jsxs("div",{className:"space-y-2",children:[(j==null?void 0:j.primaryUser)&&e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),e.jsx("span",{className:"text-sm font-medium",children:j.primaryUser.name}),e.jsx("span",{className:"text-xs text-gray-400",children:"(You)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-mono",children:[j.primaryUser.summary.daysUsed,"/90"]}),e.jsx(X,{status:j.primaryUser.summary.status,size:"sm"})]})]}),(S=j==null?void 0:j.family)==null?void 0:S.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:f.member.color}}),e.jsx("span",{className:"text-sm font-medium",children:f.member.name}),e.jsxs("span",{className:"text-xs text-gray-400 capitalize",children:["(",f.member.relationship,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-mono",children:[f.summary.daysUsed,"/90"]}),e.jsx(X,{status:f.summary.status,size:"sm"})]})]},f.member.id))]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Family Tracking"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Track Schengen days for each family member"})]})]}),e.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(ne,{className:"w-4 h-4","aria-hidden":"true"}),"Add Member"]})]}),(j==null?void 0:j.primaryUser)&&e.jsx("div",{className:"card p-6 border-l-4 border-l-indigo-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(qs,{className:"w-6 h-6 text-indigo-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:j.primaryUser.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Primary Account Holder"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx($e,{daysUsed:j.primaryUser.summary.daysUsed,daysRemaining:j.primaryUser.summary.daysRemaining,status:j.primaryUser.summary.status,size:"sm"}),e.jsx(X,{status:j.primaryUser.summary.status,size:"lg"})]})]})}),j!=null&&j.family&&j.family.length>0?e.jsx("div",{className:"space-y-4",children:j.family.map(f=>e.jsx(ca,{member:f.member,summary:f.summary,isExpanded:p.has(f.member.id),onToggle:()=>v(f.member.id),onEdit:()=>w(f.member),onDelete:()=>y(f.member.id)},f.member.id))}):e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(be,{className:"w-12 h-12 text-gray-300 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Family Members"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add family members to track their Schengen days separately"}),e.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700",children:[e.jsx(ne,{className:"w-4 h-4","aria-hidden":"true"}),"Add First Member"]})]}),e.jsx(se,{isOpen:x||!!h,onClose:()=>{c(!1),w(null)},title:h?"Edit Family Member":"Add Family Member",size:"md",children:e.jsx(oa,{member:h,onSubmit:f=>h?o(h.id,f):b(f),onCancel:()=>{c(!1),w(null)},isLoading:d.isPending||l.isPending})})]})}function ca({member:s,summary:t,isExpanded:a,onToggle:r,onEdit:i,onDelete:d}){return e.jsxs("div",{className:"card overflow-hidden",style:{borderLeftWidth:"4px",borderLeftColor:s.color},children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold",style:{backgroundColor:s.color},children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:s.relationship})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.daysUsed}),e.jsx("p",{className:"text-xs text-gray-500",children:"of 90 days"})]}),e.jsx(X,{status:t.status}),e.jsx("button",{onClick:r,className:"p-1 text-gray-400 hover:text-gray-600","aria-label":a?"Collapse":"Expand",children:a?e.jsx(ze,{className:"w-5 h-5"}):e.jsx(me,{className:"w-5 h-5"})})]})]})}),a&&e.jsxs("div",{className:"border-t border-gray-100 p-4 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Days Remaining"}),e.jsx("p",{className:"font-semibold",children:t.daysRemaining})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Trips"}),e.jsx("p",{className:"font-semibold",children:t.tripCount})]}),s.nationality&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Nationality"}),e.jsx("p",{className:"font-semibold",children:s.nationality})]}),s.passportExpiry&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Passport Expiry"}),e.jsx("p",{className:"font-semibold",children:s.passportExpiry})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:i,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded",children:[e.jsx(it,{className:"w-4 h-4","aria-hidden":"true"}),"Edit"]}),e.jsxs("button",{onClick:d,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 rounded",children:[e.jsx(oe,{className:"w-4 h-4","aria-hidden":"true"}),"Remove"]})]})]})]})}function oa({member:s,onSubmit:t,onCancel:a,isLoading:r}){const[i,d]=u.useState((s==null?void 0:s.name)??""),[l,n]=u.useState((s==null?void 0:s.relationship)??"spouse"),[x,c]=u.useState((s==null?void 0:s.birthDate)??""),[h,w]=u.useState((s==null?void 0:s.nationality)??""),[p,C]=u.useState((s==null?void 0:s.passportNumber)??""),[v,b]=u.useState((s==null?void 0:s.passportExpiry)??""),[o,y]=u.useState((s==null?void 0:s.color)??"#3B82F6"),[j,k]=u.useState((s==null?void 0:s.notes)??""),S=m=>{m.preventDefault(),t({name:i,relationship:l,birthDate:x||null,nationality:h||null,passportNumber:p||null,passportExpiry:v||null,color:o,notes:j||null})},f=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#6366F1"];return e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:i,onChange:m=>d(m.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Relationship"}),e.jsxs("select",{value:l,onChange:m=>n(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"spouse",children:"Spouse"}),e.jsx("option",{value:"child",children:"Child"}),e.jsx("option",{value:"parent",children:"Parent"}),e.jsx("option",{value:"sibling",children:"Sibling"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Birth Date"}),e.jsx("input",{type:"date",value:x,onChange:m=>c(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nationality"}),e.jsx("input",{type:"text",value:h,onChange:m=>w(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"e.g., American"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Passport Number"}),e.jsx("input",{type:"text",value:p,onChange:m=>C(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Passport Expiry"}),e.jsx("input",{type:"date",value:v,onChange:m=>b(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color Tag"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(m=>e.jsx("button",{type:"button",onClick:()=>y(m),className:g("w-8 h-8 rounded-full transition-all",o===m?"ring-2 ring-offset-2 ring-gray-400":""),style:{backgroundColor:m},"aria-label":`Select color ${m}`},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:j,onChange:m=>k(m.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Optional notes..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:r||!i,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 disabled:opacity-50",children:[r&&e.jsx(L,{className:"w-4 h-4 animate-spin"}),s?"Save Changes":"Add Member"]})]})]})}function ma(){const[s,t]=u.useState("180d"),[a,r]=u.useState("overview"),[i,d]=u.useState(new Date().getFullYear()),l=Js(s),n=Ks(s),x=Zs(s),c=Qs(i),h=[{value:"30d",label:"Last 30 days"},{value:"90d",label:"Last 90 days"},{value:"180d",label:"Last 180 days"},{value:"1y",label:"Last year"},{value:"all",label:"All time"}],w=[{id:"overview",label:"Overview",icon:Ne},{id:"countries",label:"Countries",icon:z},{id:"history",label:"Compliance",icon:ss},{id:"monthly",label:"Monthly",icon:F}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Travel Analytics"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Insights into your travel patterns"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:s,onChange:p=>t(p.target.value),className:"appearance-none px-4 py-2 pr-10 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:h.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),e.jsx(me,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-6",children:w.map(p=>e.jsxs("button",{onClick:()=>r(p.id),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2",a===p.id?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(p.icon,{className:"w-4 h-4","aria-hidden":"true"}),p.label]},p.id))})}),a==="overview"&&e.jsx(xa,{data:l.data,isLoading:l.isLoading}),a==="countries"&&e.jsx(ha,{data:n.data,isLoading:n.isLoading}),a==="history"&&e.jsx(ua,{data:x.data,isLoading:x.isLoading}),a==="monthly"&&e.jsx(ga,{data:c.data,isLoading:c.isLoading,year:i,onYearChange:d})]})}function xa({data:s,isLoading:t}){if(t)return e.jsx(ke,{});if(!s)return e.jsx(_e,{message:"No analytics data available"});const{stats:a,compliance:r}=s;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ge,{icon:xe,label:"Total Trips",value:a.totalTrips,color:"blue"}),e.jsx(ge,{icon:F,label:"Days Traveled",value:a.totalDays,color:"green"}),e.jsx(ge,{icon:z,label:"Countries",value:a.uniqueCountries,color:"purple"}),e.jsx(ge,{icon:le,label:"Avg Trip Length",value:`${a.avgTripLength} days`,color:"orange"})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Compliance"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:r.daysUsed}),e.jsx("p",{className:"text-sm text-gray-500",children:"Days Used"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:r.daysRemaining}),e.jsx("p",{className:"text-sm text-gray-500",children:"Days Remaining"})]})]}),e.jsx(X,{status:r.status,size:"lg"})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:g("h-full rounded-full transition-all",r.status==="safe"&&"bg-green-500",r.status==="warning"&&"bg-yellow-500",r.status==="danger"&&"bg-orange-500",r.status==="critical"&&"bg-red-500"),style:{width:`${Math.min(100,r.daysUsed/90*100)}%`}})})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.longestTrip&&e.jsxs("div",{className:"card p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Longest Trip"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(O,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.longestTrip.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.longestTrip.days," days"]})]})]})]}),a.mostVisited&&e.jsxs("div",{className:"card p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Most Visited"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(z,{className:"w-5 h-5 text-purple-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.mostVisited.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.mostVisited.visitCount," trips, ",a.mostVisited.totalDays," days"]})]})]})]})]})]})}function ha({data:s,isLoading:t}){return t?e.jsx(ke,{}):!s||s.countries.length===0?e.jsx(_e,{message:"No travel data for this period"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Countries Visited"})}),e.jsx("div",{className:"divide-y",children:s.countries.map((a,r)=>e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium text-gray-600",children:r+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.tripCount," ",a.tripCount===1?"trip":"trips"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:[a.totalDays," days"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.percentage,"%"]})]})]},a.country))})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Days Distribution"}),e.jsx("div",{className:"space-y-3",children:s.countries.slice(0,5).map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700",children:a.country}),e.jsxs("span",{className:"text-gray-500",children:[a.totalDays," days"]})]}),e.jsx("div",{className:"h-4 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full",style:{width:`${a.percentage}%`}})})]},a.country))})]})]})}function ua({data:s,isLoading:t}){if(t)return e.jsx(ke,{});if(!s||s.history.length===0)return e.jsx(_e,{message:"No compliance history available"});const a=90,r=s.history;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Compliance Over Time"}),e.jsxs("div",{className:"relative h-64",children:[e.jsxs("div",{className:"absolute left-0 top-0 bottom-0 w-12 flex flex-col justify-between text-xs text-gray-500 py-2",children:[e.jsx("span",{children:"90"}),e.jsx("span",{children:"60"}),e.jsx("span",{children:"30"}),e.jsx("span",{children:"0"})]}),e.jsxs("div",{className:"ml-14 h-full relative",children:[e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-between",children:[e.jsx("div",{className:"border-t border-gray-100"}),e.jsx("div",{className:"border-t border-gray-100"}),e.jsx("div",{className:"border-t border-gray-100"}),e.jsx("div",{className:"border-t border-gray-200"})]}),e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-yellow-400",style:{top:`${100-60/a*100}%`}}),e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-red-400",style:{top:`${100-80/a*100}%`}}),e.jsx("svg",{className:"absolute inset-0 w-full h-full overflow-visible",children:e.jsx("polyline",{fill:"none",stroke:"#3B82F6",strokeWidth:"2",points:r.map((i,d)=>{const l=d/(r.length-1)*100,n=100-i.daysUsed/a*100;return`${l}%,${n}%`}).join(" ")})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-0.5 bg-yellow-400"}),e.jsx("span",{className:"text-gray-600",children:"Warning (60 days)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-0.5 bg-red-400"}),e.jsx("span",{className:"text-gray-600",children:"Danger (80 days)"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"History Details"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Days Used"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Remaining"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y",children:r.slice(-10).reverse().map(i=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:i.date}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:i.daysUsed}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:i.daysRemaining}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(X,{status:i.status,size:"sm"})})]},i.date))})]})})]})]})}function ga({data:s,isLoading:t,year:a,onYearChange:r}){const i=new Date().getFullYear(),d=Array.from({length:5},(l,n)=>i-n);return t?e.jsx(ke,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Year:"}),e.jsx("div",{className:"flex gap-2",children:d.map(l=>e.jsx("button",{onClick:()=>r(l),className:g("px-3 py-1 rounded-lg text-sm font-medium transition-colors",a===l?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-100"),children:l},l))})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:s==null?void 0:s.months.map(l=>e.jsxs("div",{className:g("card p-4",l.days>0?"bg-white":"bg-gray-50"),children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-2",children:l.label}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.days}),e.jsxs("p",{className:"text-xs text-gray-500",children:[l.days===1?"day":"days"," in Schengen"]}),l.tripCount>0&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[l.tripCount," ",l.tripCount===1?"trip":"trips"]}),l.countries&&e.jsx("p",{className:"text-xs text-gray-400 truncate",title:l.countries,children:l.countries})]},l.month))}),s&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4",children:[a," Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.months.reduce((l,n)=>l+n.days,0)}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Days"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:s.months.reduce((l,n)=>l+n.tripCount,0)}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Trips"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:new Set(s.months.flatMap(l=>l.countries.split(", ").filter(Boolean))).size}),e.jsx("p",{className:"text-sm text-gray-500",children:"Countries"})]})]})]})]})}function ge({icon:s,label:t,value:a,color:r}){const i={blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",purple:"bg-purple-100 text-purple-600",orange:"bg-orange-100 text-orange-600"};return e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx("div",{className:g("p-2 rounded-lg",i[r]),children:e.jsx(s,{className:"w-5 h-5","aria-hidden":"true"})})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a}),e.jsx("p",{className:"text-sm text-gray-500",children:t})]})}function ke(){return e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-primary-500"})})}function _e({message:s}){return e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx(Ne,{className:"w-12 h-12 text-gray-300 mx-auto mb-4","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500",children:s})]})}function Fa(){const{trips:s,settings:t,isLoaded:a,addTrip:r,updateTrip:i,deleteTrip:d,updateSettings:l}=pt(),{data:n,isLoading:x}=Xs(),c=et(),[h,w]=u.useState(!1),[p,C]=u.useState(null),[v,b]=u.useState("trips"),[o,y]=u.useState(null),[j,k]=u.useState(null),[S,f]=u.useState(!1);u.useEffect(()=>{a&&!Qt()&&f(!0)},[a]);const m=u.useMemo(()=>ft(s,{yellow:t.yellowThreshold,red:t.redThreshold}),[s,t.yellowThreshold,t.redThreshold]),D=async A=>{k(null);try{await r(A),w(!1)}catch(I){const T=I instanceof Error?I.message:"Failed to add trip";k(T),console.error("Failed to add trip:",I)}},E=async A=>{if(p){k(null);try{await i(p.id,A),C(null)}catch(I){const T=I instanceof Error?I.message:"Failed to update trip";k(T),console.error("Failed to update trip:",I)}}},W=async A=>{k(null);try{await d(A)}catch(I){const T=I instanceof Error?I.message:"Failed to delete trip";k(T),console.error("Failed to delete trip:",I)}},K=A=>{C(A)},$=()=>{w(!1),C(null)},G=(n==null?void 0:n.canAddTrip)??!0,P=(n==null?void 0:n.isPremium)??!0;return!a||x?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3",role:"status","aria-label":"Loading"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Schengen Tracker"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track your 90/180 day Schengen zone compliance"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ta,{}),e.jsx("button",{type:"button",onClick:()=>f(!0),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Show help tour",title:"Show help tour",children:e.jsx(st,{className:"w-5 h-5","aria-hidden":"true"})}),P&&e.jsx($t,{}),e.jsxs("button",{onClick:()=>w(!0),disabled:!G,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors",G?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[e.jsx(ne,{className:"w-5 h-5","aria-hidden":"true"}),"Add Trip"]})]})]}),!P&&n&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-amber-600","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-amber-800",children:["Free Plan: ",n.tripCount," of ",n.tripLimit," trips used"]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Upgrade to Premium for unlimited trips, planning tools, and PDF reports"})]})]}),n.upgradeUrl&&e.jsxs("a",{href:n.upgradeUrl,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4","aria-hidden":"true"}),"Upgrade"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card p-6 flex flex-col items-center justify-center",children:[e.jsx($e,{daysUsed:m.daysUsed,daysRemaining:m.daysRemaining,status:m.status,size:"lg"}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{status:m.status,size:"lg"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:g("card p-4 border-l-4",m.status==="safe"&&"border-l-green-500",m.status==="warning"&&"border-l-yellow-500",m.status==="danger"&&"border-l-orange-500",m.status==="critical"&&"border-l-red-500"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(le,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Days Remaining"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.daysRemaining})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current 180-Day Window"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[Q(m.windowStart)," - ",Q(m.windowEnd)]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[m.nextExpiration&&e.jsx("div",{className:"card p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Next Day Expires"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:Q(m.nextExpiration)}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"A day will drop off the 180-day window"})]})]})}),e.jsx("div",{className:"card p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"The 90/180 Rule"}),e.jsx("p",{children:"Non-EU citizens may stay up to 90 days within any 180-day period in the Schengen area without a visa."})]})]})})]})]}),e.jsx(Zt,{enabled:!0}),e.jsx(Ve,{compact:!0}),m.status==="warning"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(U,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-medium",children:"Approaching limit:"})," You have used ",m.daysUsed," of your 90 days. Plan future travel carefully to avoid overstaying."]})]}),m.status==="danger"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(U,{className:"w-5 h-5 text-orange-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("span",{className:"font-medium",children:"Warning:"})," You have used ",m.daysUsed," of your 90 days. Limited travel remaining in this window."]})]}),m.status==="critical"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(U,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("span",{className:"font-medium",children:"Limit reached:"})," You have used all 90 days allowed in this 180-day window. Additional travel may result in overstay violations."]})]}),j&&e.jsxs("div",{className:"flex items-center justify-between gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:j})]}),e.jsx("button",{onClick:()=>k(null),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Dismiss"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-6","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>b("trips"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="trips"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4","aria-hidden":"true"}),"Trip List"]})}),e.jsx("button",{onClick:()=>b("family"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="family"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4","aria-hidden":"true"}),"Family",!P&&e.jsx(he,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>b("analytics"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="analytics"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4","aria-hidden":"true"}),"Analytics",!P&&e.jsx(he,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>b("jurisdictions"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="jurisdictions"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4","aria-hidden":"true"}),"Jurisdictions"]})}),e.jsx("button",{onClick:()=>b("calendar"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="calendar"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar View",!P&&e.jsx(he,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>b("sync"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="sync"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar Sync"]})}),e.jsx("button",{onClick:()=>b("planning"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="planning"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4","aria-hidden":"true"}),"Planning Tool",!P&&e.jsx(he,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>b("location"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="location"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4","aria-hidden":"true"}),"Location"]})}),e.jsx("button",{onClick:()=>b("settings"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",v==="settings"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4","aria-hidden":"true"}),"Settings"]})})]})}),v==="trips"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Your Trips"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.length," trip",s.length!==1?"s":""]})]}),e.jsx(Et,{trips:s,currentWindowStart:m.windowStart,onEdit:K,onDelete:W})]}),v==="family"&&(P?e.jsx(Pe,{children:e.jsx(da,{})}):e.jsx(pe,{feature:"Family Tracking",description:"Track Schengen days for each family member separately. Monitor individual compliance and assign travelers to trips.",upgradeUrl:n==null?void 0:n.upgradeUrl})),v==="analytics"&&(P?e.jsx(Pe,{children:e.jsx(ma,{})}):e.jsx(pe,{feature:"Analytics Dashboard",description:"View detailed travel statistics, patterns by country, and historical compliance data to understand your travel habits.",upgradeUrl:n==null?void 0:n.upgradeUrl})),v==="jurisdictions"&&e.jsx("div",{className:"card p-6",children:e.jsx(ea,{})}),v==="calendar"&&(P?e.jsx(It,{trips:s,windowStart:m.windowStart,windowEnd:m.windowEnd}):e.jsx(pe,{feature:"Calendar View",description:"Visualize your trips on an interactive calendar to better understand your travel patterns and plan future trips.",upgradeUrl:n==null?void 0:n.upgradeUrl})),v==="sync"&&e.jsx(Pe,{children:e.jsx(Ut,{})}),v==="planning"&&(P?e.jsxs("div",{className:"space-y-6",children:[e.jsx(la,{}),e.jsx("div",{className:"card p-6",children:e.jsx(Mt,{})})]}):e.jsx(pe,{feature:"Planning Tool",description:"Use the 'What If' calculator to check if a planned trip would violate the 90/180 rule before you book.",upgradeUrl:n==null?void 0:n.upgradeUrl})),v==="location"&&e.jsx(Ve,{}),v==="settings"&&e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(Fe,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tracker Settings"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure alerts and notification preferences"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Alerts"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive email notifications when approaching your 90-day limit"})]})]}),e.jsx("button",{onClick:()=>l({emailAlerts:!t.emailAlerts}),className:g("relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",t.emailAlerts?"bg-primary-600":"bg-gray-200"),role:"switch","aria-checked":t.emailAlerts,children:e.jsx("span",{className:g("pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",t.emailAlerts?"translate-x-5":"translate-x-0")})})]}),t.emailAlerts&&e.jsx("div",{className:"mt-4 ml-14 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Alert thresholds:"})," You will receive email alerts when you reach 60 days (warning), 80 days (danger), and 85 days (urgent)."]})}),t.emailAlerts&&e.jsxs("div",{className:"mt-4 ml-14",children:[e.jsx("button",{onClick:()=>{y(null),c.mutate(void 0,{onSuccess:A=>{y({type:A.success?"success":"error",text:A.message})},onError:A=>{y({type:"error",text:A instanceof Error?A.message:"Failed to send test alert"})}})},disabled:c.isPending,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",c.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4","aria-hidden":"true"}),"Send Test Alert"]})}),o&&e.jsxs("div",{className:g("mt-3 p-3 rounded-lg flex items-center gap-2 text-sm",o.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:[o.type==="success"?e.jsx(Y,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}):e.jsx(U,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),o.text]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Warning Thresholds"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Warning Level"}),e.jsxs("p",{className:"text-lg font-bold text-yellow-900",children:[t.yellowThreshold," days"]}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Status turns yellow"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:"Danger Level"}),e.jsxs("p",{className:"text-lg font-bold text-orange-900",children:[t.redThreshold," days"]}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Status turns red"})]})]})]}),(n==null?void 0:n.isPremium)&&e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Data Import/Export"}),e.jsx(aa,{})]})]}),e.jsx(se,{isOpen:h,onClose:$,title:"Add Trip",size:"md",children:e.jsx(He,{existingTrips:s,onSubmit:D,onCancel:$})}),e.jsx(se,{isOpen:!!p,onClose:$,title:"Edit Trip",size:"md",children:p&&e.jsx(He,{trip:p,existingTrips:s,onSubmit:E,onCancel:$})}),e.jsx(Xt,{isOpen:S,onComplete:()=>f(!1),isPremium:P})]})}function pe({feature:s,description:t,upgradeUrl:a}){return e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(fe,{className:"w-8 h-8 text-amber-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[s," is a Premium Feature"]}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:t}),a&&e.jsxs("a",{href:a,className:"inline-flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(fe,{className:"w-5 h-5","aria-hidden":"true"}),"Upgrade to Premium"]})]})}export{Fa as default};
