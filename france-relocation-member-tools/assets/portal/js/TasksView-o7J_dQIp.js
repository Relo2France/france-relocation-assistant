import{j as e}from"./vendor-query-D8MH73Ff.js";import{r as m}from"./vendor-react-F9Y4d3HK.js";import{c as B,S as J,X as U,P as F,C as E,a as $,A as V,b as K,u as Q,d as Z,e as ee,f as te,g as se,h as ae,i as X,j as re,D as le,U as q,F as ne,M as ie,k as oe,l as ce,m as de,n as xe,o as me}from"./main-Lr7E3dYR.js";import{a as v}from"./vendor-utils-C5RVuWu4.js";import{L as ue,a as he,u as ge,V as pe,T as je}from"./VirtualList-D50eCIL9.js";import{F as be}from"./filter-ddhos_FV.js";import{C as M}from"./circle-C_TeT3-C.js";import{M as fe}from"./more-vertical-kwfiGzDX.js";import{G as ye}from"./grip-vertical-Dt-QrmxP.js";import{L as G}from"./loader-2-DyOcjIhL.js";import{F as ve}from"./flag-DGU6C5SC.js";import{T as Ne}from"./trash-2-DyZ4StUS.js";import"./vendor-virtual-Bs6oCvg1.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=B("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function we({view:t,onViewChange:a,searchQuery:r,onSearchChange:i,filters:s,onFilterChange:d,onClearFilters:u,stages:o,onAddTask:c,totalTasks:g,filteredTasks:j}){const b=s.stage||s.status||s.taskType||r;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex rounded-lg bg-gray-100 p-1",children:[e.jsxs("button",{onClick:()=>a("list"),className:v("px-3 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-1.5",t==="list"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(ue,{className:"w-4 h-4"}),"List"]}),e.jsxs("button",{onClick:()=>a("board"),className:v("px-3 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-1.5",t==="board"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(he,{className:"w-4 h-4"}),"Board"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:r,onChange:x=>i(x.target.value),placeholder:"Search tasks...",className:"pl-9 pr-4 py-2 bg-gray-100 border-0 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 w-64"}),r&&e.jsx("button",{onClick:()=>i(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(U,{className:"w-4 h-4"})})]})]}),e.jsxs("button",{onClick:c,className:"btn btn-primary",children:[e.jsx(F,{className:"w-4 h-4"}),"Add Task"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:s.stage||"",onChange:x=>d({stage:x.target.value||null}),className:"select w-auto text-sm py-1.5",children:[e.jsx("option",{value:"",children:"All Stages"}),o.map(x=>e.jsx("option",{value:x.slug,children:x.title},x.slug))]}),e.jsxs("select",{value:s.status||"",onChange:x=>d({status:x.target.value||null}),className:"select w-auto text-sm py-1.5",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"todo",children:"To Do"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"waiting",children:"Waiting"}),e.jsx("option",{value:"done",children:"Done"})]}),e.jsxs("select",{value:s.taskType||"",onChange:x=>d({taskType:x.target.value||null}),className:"select w-auto text-sm py-1.5",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"client",children:"Client"}),e.jsx("option",{value:"team",children:"Team"})]}),b&&e.jsxs("button",{onClick:u,className:"text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),"Clear filters"]}),e.jsx("span",{className:"text-sm text-gray-500 ml-auto",children:j===g?`${g} tasks`:`${j} of ${g} tasks`})]})]})}const Ce={todo:{icon:M,color:"text-gray-400",bgColor:"bg-gray-100"},in_progress:{icon:$,color:"text-blue-500",bgColor:"bg-blue-100"},waiting:{icon:$,color:"text-yellow-500",bgColor:"bg-yellow-100"},done:{icon:E,color:"text-green-500",bgColor:"bg-green-100"}};function Te({tasks:t,groupBy:a="none",onTaskClick:r,onStatusChange:i,onAddTask:s}){const d=ge(t.length,30);if(a==="none")return t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No tasks found"})]}):d?e.jsx(pe,{items:t,estimateSize:72,className:"max-h-[calc(100vh-200px)]",getItemKey:o=>o.id,renderItem:o=>e.jsx("div",{className:"pb-2",children:e.jsx(O,{task:o,onClick:()=>r==null?void 0:r(o),onStatusChange:i})})}):e.jsx("div",{className:"space-y-2",children:t.map(o=>e.jsx(O,{task:o,onClick:()=>r==null?void 0:r(o),onStatusChange:i},o.id))});const u=_e(t,a);return e.jsx("div",{className:"space-y-6",children:Object.entries(u).map(([o,c])=>e.jsx(De,{title:ke(o,a),tasks:c,groupKey:o,onTaskClick:r,onStatusChange:i,onAddTask:s},o))})}function De({title:t,tasks:a,groupKey:r,onTaskClick:i,onStatusChange:s,onAddTask:d}){const u=a.filter(o=>o.status==="done").length;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t}),e.jsxs("span",{className:"text-sm text-gray-500",children:[u,"/",a.length," completed"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"badge badge-gray",children:a.length}),d&&e.jsxs("button",{onClick:()=>d(r),className:"btn btn-ghost btn-sm",children:[e.jsx(F,{className:"w-4 h-4"}),"Add Task"]})]})]}),e.jsxs("div",{className:"divide-y divide-gray-100",children:[a.map(o=>e.jsx(O,{task:o,onClick:()=>i==null?void 0:i(o),onStatusChange:s,compact:!0},o.id)),a.length===0&&e.jsx("div",{className:"p-6 text-center text-gray-500",children:e.jsx("p",{children:"No tasks in this section"})})]})]})}function O({task:t,onClick:a,onStatusChange:r,compact:i}){const s=Ce[t.status],d=s.icon,u=o=>{if(o.stopPropagation(),!r)return;const c=["todo","in_progress","waiting","done"],g=c.indexOf(t.status),j=c[(g+1)%c.length];r(t.id,j)};return e.jsxs("div",{onClick:a,className:v("flex items-center gap-4 transition-colors",i?"px-6 py-3":"p-4 rounded-lg border border-gray-200",t.is_overdue&&!i&&"border-red-200 bg-red-50",a&&"cursor-pointer hover:bg-gray-50"),children:[e.jsx("button",{onClick:u,className:v("flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center transition-colors",s.bgColor,"hover:opacity-80"),title:`Status: ${t.status_label}`,children:e.jsx(d,{className:v("w-4 h-4",s.color)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:v("font-medium truncate",t.status==="done"?"text-gray-400 line-through":"text-gray-900"),children:t.title}),t.is_overdue&&e.jsx(V,{className:"w-4 h-4 text-red-500 flex-shrink-0"})]}),t.description&&!i&&e.jsx("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsx(Se,{priority:t.priority}),t.task_type==="team"&&e.jsx("span",{className:"badge badge-blue text-xs",children:"Team"}),t.due_date&&e.jsxs("span",{className:v("flex items-center gap-1 text-xs",t.is_overdue?"text-red-600":"text-gray-500"),children:[e.jsx(K,{className:"w-3 h-3"}),Pe(t.due_date)]}),e.jsx("button",{onClick:o=>o.stopPropagation(),className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e.jsx(fe,{className:"w-4 h-4"})})]})]})}function Se({priority:t}){const a={low:"bg-gray-100 text-gray-600",medium:"bg-blue-100 text-blue-700",high:"bg-yellow-100 text-yellow-700",urgent:"bg-red-100 text-red-700"};return e.jsx("span",{className:v("badge text-xs",a[t]||a.medium),children:t})}function _e(t,a){return t.reduce((r,i)=>{const s=a==="stage"?i.stage||"unassigned":i.status;return r[s]||(r[s]=[]),r[s].push(i),r},{})}function ke(t,a){return a==="status"?{todo:"To Do",in_progress:"In Progress",waiting:"Waiting",done:"Done"}[t]||t:t==="unassigned"?"Unassigned":t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}function Pe(t){const a=new Date(t),r=new Date,i=new Date(r);return i.setDate(i.getDate()+1),a.toDateString()===r.toDateString()?"Today":a.toDateString()===i.toDateString()?"Tomorrow":a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const I=[{id:"todo",title:"To Do",icon:M,color:"text-gray-500",bgColor:"bg-gray-50",borderColor:"border-gray-200"},{id:"in_progress",title:"In Progress",icon:$,color:"text-blue-500",bgColor:"bg-blue-50",borderColor:"border-blue-200"},{id:"waiting",title:"Waiting",icon:$,color:"text-yellow-500",bgColor:"bg-yellow-50",borderColor:"border-yellow-200"},{id:"done",title:"Done",icon:E,color:"text-green-500",bgColor:"bg-green-50",borderColor:"border-green-200"}];function Ae({tasks:t,onTaskClick:a,onStatusChange:r,onAddTask:i}){const[s,d]=m.useState(null),[u,o]=m.useState(null),[c,g]=m.useState(null),[j,b]=m.useState(""),x=m.useRef(null),h=I.reduce((l,w)=>(l[w.id]=t.filter(P=>P.status===w.id),l),{}),y=m.useCallback(l=>{b(l),setTimeout(()=>b(""),100)},[]),f=l=>{d(l),y(`Picked up task: ${l.title}`)},D=()=>{s&&y(`Dropped task: ${s.title}`),d(null),o(null)},C=(l,w)=>{l.preventDefault(),o(w)},p=l=>{var w;if(s&&s.status!==l){const P=((w=I.find(k=>k.id===l))==null?void 0:w.title)||l;y(`Moved ${s.title} to ${P}`),r==null||r(s.id,l)}d(null),o(null)},T=l=>{g(l),y(`Picked up task: ${l.title}. Use left and right arrow keys to move between columns, then press Space or Enter to drop.`)},n=l=>{var w;if(c&&c.status!==l){const P=((w=I.find(k=>k.id===l))==null?void 0:w.title)||l;y(`Moved ${c.title} to ${P}`),r==null||r(c.id,l)}else c&&y(`Cancelled. ${c.title} stays in current column.`);g(null)},_=()=>{c&&(y(`Cancelled moving ${c.title}`),g(null))},A=l=>{if(!c)return;const w=I.findIndex(k=>k.id===c.status),P=l==="left"?Math.max(0,w-1):Math.min(I.length-1,w+1);if(P!==w){const k=I[P];y(`Over ${k.title} column. Press Space or Enter to drop here.`),o(k.id)}};return e.jsxs("div",{children:[e.jsx("div",{ref:x,className:"sr-only",role:"status","aria-live":"assertive","aria-atomic":"true",children:j}),c&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800",role:"status",children:[e.jsxs("strong",{children:["Moving: ",c.title]}),e.jsx("span",{className:"ml-2",children:"Use ← → to select column, Space/Enter to drop, Escape to cancel"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",role:"region","aria-label":"Task board",children:I.map(l=>e.jsx(Ie,{column:l,tasks:h[l.id],isDragOver:u===l.id,isKeyboardDragging:!!c,keyboardDragTask:c,onTaskClick:a,onDragStart:f,onDragEnd:D,onDragOver:w=>C(w,l.id),onDrop:()=>p(l.id),onAddTask:()=>i==null?void 0:i(l.id),onKeyboardPickUp:T,onKeyboardDrop:()=>n(l.id),onKeyboardCancel:_,onKeyboardMoveColumn:A},l.id))})]})}function Ie({column:t,tasks:a,isDragOver:r,isKeyboardDragging:i,keyboardDragTask:s,onTaskClick:d,onDragStart:u,onDragEnd:o,onDragOver:c,onDrop:g,onAddTask:j,onKeyboardPickUp:b,onKeyboardDrop:x,onKeyboardCancel:h,onKeyboardMoveColumn:y}){const f=t.icon,D=r&&(s==null?void 0:s.status)!==t.id,C=p=>{if(i)switch(p.key){case"ArrowLeft":p.preventDefault(),y("left");break;case"ArrowRight":p.preventDefault(),y("right");break;case" ":case"Enter":p.preventDefault(),r&&x();break;case"Escape":p.preventDefault(),h();break}};return e.jsxs("div",{className:v("flex-shrink-0 w-80 rounded-xl transition-colors",t.bgColor,D&&"ring-2 ring-primary-500"),onDragOver:c,onDrop:g,onKeyDown:C,role:"listbox","aria-label":`${t.title} column, ${a.length} tasks`,"aria-dropeffect":i?"move":void 0,children:[e.jsx("div",{className:v("p-4 border-b",t.borderColor),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:v("w-5 h-5",t.color),"aria-hidden":"true"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:t.title}),e.jsx("span",{className:"text-sm text-gray-500 bg-white px-2 py-0.5 rounded-full",children:a.length})]}),e.jsx("button",{onClick:j,className:"p-1 text-gray-400 hover:text-gray-600 hover:bg-white rounded transition-colors","aria-label":`Add task to ${t.title}`,children:e.jsx(F,{className:"w-5 h-5","aria-hidden":"true"})})]})}),e.jsxs("div",{className:"p-3 space-y-3 min-h-[200px]",children:[a.map((p,T)=>e.jsx(Le,{task:p,index:T,totalTasks:a.length,columnTitle:t.title,isBeingDragged:(s==null?void 0:s.id)===p.id,onClick:()=>d==null?void 0:d(p),onDragStart:()=>u(p),onDragEnd:o,onKeyboardPickUp:()=>b(p),onKeyboardDrop:x,onKeyboardCancel:h,onKeyboardMoveColumn:y},p.id)),a.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-400 text-sm",children:[e.jsx("p",{children:"No tasks"}),e.jsx("button",{onClick:j,className:"mt-2 text-primary-600 hover:text-primary-700",children:"+ Add a task"})]})]})]})}function Le({task:t,index:a,totalTasks:r,columnTitle:i,isBeingDragged:s,onClick:d,onDragStart:u,onDragEnd:o,onKeyboardPickUp:c,onKeyboardDrop:g,onKeyboardCancel:j,onKeyboardMoveColumn:b}){const x=h=>{switch(h.key){case" ":h.preventDefault(),s?g():c();break;case"Enter":h.preventDefault(),s?g():d==null||d();break;case"Escape":s&&(h.preventDefault(),j());break;case"ArrowLeft":s&&(h.preventDefault(),b("left"));break;case"ArrowRight":s&&(h.preventDefault(),b("right"));break}};return e.jsxs("div",{draggable:!0,tabIndex:0,role:"option","aria-selected":s,"aria-grabbed":s,"aria-label":`${t.title}${t.is_overdue?", overdue":""}, priority ${t.priority}${t.due_date?`, due ${Y(t.due_date)}`:""}`,"aria-describedby":"drag-instructions","aria-setsize":r,"aria-posinset":a+1,onDragStart:u,onDragEnd:o,onClick:d,onKeyDown:x,className:v("bg-white rounded-lg border p-3 cursor-pointer transition-all focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",t.is_overdue?"border-red-200":"border-gray-200",s&&"opacity-50 ring-2 ring-primary-500",!s&&"hover:shadow-md"),children:[e.jsx("span",{id:"drag-instructions",className:"sr-only",children:"Press Space to pick up and move this task, or Enter to open task details"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-300 flex-shrink-0 mt-0.5 cursor-grab","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:v("font-medium text-sm",t.status==="done"?"text-gray-400 line-through":"text-gray-900"),children:t.title}),t.is_overdue&&e.jsx(V,{className:"w-3.5 h-3.5 text-red-500 flex-shrink-0","aria-hidden":"true"})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[e.jsx($e,{priority:t.priority}),t.task_type==="team"&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded",children:"Team"}),t.due_date&&e.jsxs("span",{className:v("flex items-center gap-1 text-xs",t.is_overdue?"text-red-600":"text-gray-500"),children:[e.jsx(K,{className:"w-3 h-3","aria-hidden":"true"}),Y(t.due_date)]}),t.stage&&e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:t.stage.replace("_"," ")})]})]})]})]})}function $e({priority:t}){const a={low:"bg-gray-400",medium:"bg-blue-500",high:"bg-yellow-500",urgent:"bg-red-500"};return e.jsx("span",{className:v("w-2 h-2 rounded-full",a[t]||a.medium),title:`Priority: ${t}`,"aria-label":`Priority: ${t}`})}function Y(t){const a=new Date(t),r=new Date,i=Math.ceil((a.getTime()-r.getTime())/(1e3*60*60*24));return i===0?"Today":i===1?"Tomorrow":i===-1?"Yesterday":i<-1?`${Math.abs(i)}d ago`:i<=7?`${i}d`:a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Fe({taskId:t,editable:a=!0}){const[r,i]=m.useState(""),[s,d]=m.useState(!1),[u,o]=m.useState(null),{data:c,isLoading:g}=Q(t),j=Z(t),b=ee(t),x=te(t),h=(c==null?void 0:c.items)||[],y=h.filter(n=>n.completed).length,f=h.length,D=(n,_)=>{a&&j.mutate({itemId:n,completed:!_})},C=async()=>{if(!(!r.trim()||!a))try{await b.mutateAsync(r.trim()),i(""),d(!1)}catch(n){console.error("Failed to add checklist item:",n)}},p=n=>{a&&x.mutate(n)},T=n=>{n.key==="Enter"?C():n.key==="Escape"&&(i(""),d(!1))};return g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(G,{className:"w-5 h-5 animate-spin text-gray-400"})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Task Checklist",f>0&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",y,"/",f,")"]})]}),f>0&&e.jsx("div",{className:"flex-1 max-w-xs mx-3",children:e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 transition-all duration-300",style:{width:`${f>0?y/f*100:0}%`}})})})]}),e.jsxs("div",{className:"space-y-1.5",children:[h.length===0&&!s?e.jsx("p",{className:"text-sm text-gray-400 italic py-2",children:"No checklist items"}):h.map(n=>e.jsxs("div",{className:"group flex items-start gap-2 p-2 rounded-lg hover:bg-gray-50 transition-colors",onMouseEnter:()=>o(n.id),onMouseLeave:()=>o(null),children:[e.jsx("button",{onClick:()=>D(n.id,n.completed),disabled:!a||j.isPending,className:v("flex-shrink-0 mt-0.5 transition-colors",!a&&"cursor-default"),children:n.completed?e.jsx(se,{className:"w-4 h-4 text-primary-600"}):e.jsx(H,{className:"w-4 h-4 text-gray-400 hover:text-gray-600"})}),e.jsx("span",{className:v("flex-1 text-sm transition-all",n.completed?"text-gray-400 line-through":"text-gray-700"),children:n.title}),a&&u===n.id&&e.jsx("button",{onClick:()=>p(n.id),disabled:x.isPending,className:"flex-shrink-0 p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete item",children:e.jsx(U,{className:"w-3.5 h-3.5"})})]},n.id)),s?e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx(H,{className:"w-4 h-4 text-gray-300 flex-shrink-0 mt-0.5"}),e.jsx("input",{type:"text",value:r,onChange:n=>i(n.target.value),onKeyDown:T,onBlur:()=>{r.trim()||d(!1)},placeholder:"Add item...",className:"flex-1 text-sm bg-transparent border-none focus:outline-none focus:ring-0 p-0",autoFocus:!0,disabled:b.isPending}),b.isPending&&e.jsx(G,{className:"w-4 h-4 animate-spin text-gray-400"})]}):a&&e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 p-2 text-sm text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-lg transition-colors w-full",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"Add item..."})]})]})]})}const Ee=[{value:"todo",label:"To Do",icon:M,color:"text-gray-500"},{value:"in_progress",label:"In Progress",icon:$,color:"text-blue-500"},{value:"waiting",label:"Waiting",icon:$,color:"text-yellow-500"},{value:"done",label:"Done",icon:E,color:"text-green-500"}],Me=[{value:"low",label:"Low",color:"bg-gray-100 text-gray-600"},{value:"medium",label:"Medium",color:"bg-blue-100 text-blue-700"},{value:"high",label:"High",color:"bg-yellow-100 text-yellow-700"},{value:"urgent",label:"Urgent",color:"bg-red-100 text-red-700"}];function Ue({task:t,isOpen:a,onClose:r}){const[i,s]=m.useState(!1),[d,u]=m.useState(""),[o,c]=m.useState(""),[g,j]=m.useState(!1),b=ae(),x=X(),h=re();if(!t)return null;const y=n=>{x.mutate({id:t.id,status:n})},f=n=>{b.mutate({id:t.id,data:{priority:n}})},D=n=>{b.mutate({id:t.id,data:{due_date:n||null}})},C=()=>{d.trim()&&b.mutate({id:t.id,data:{title:d.trim(),description:o.trim()}}),s(!1)},p=()=>{u(t.title),c(t.description||""),s(!0)},T=()=>{h.mutate({id:t.id,projectId:t.project_id}),r()};return e.jsxs(le,{isOpen:a,onClose:r,title:"Task Details",width:"lg",footer:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("button",{onClick:()=>j(!0),className:"btn btn-ghost text-red-600 hover:bg-red-50",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Delete"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:r,className:"btn btn-secondary",children:"Close"})})]}),children:[t.is_overdue&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"This task is overdue"})]}),e.jsx("div",{className:"mb-6",children:i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:d,onChange:n=>u(n.target.value),className:"input text-lg font-semibold",placeholder:"Task title",autoFocus:!0}),e.jsx("textarea",{value:o,onChange:n=>c(n.target.value),className:"textarea h-24",placeholder:"Add a description..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,className:"btn btn-primary btn-sm",children:"Save"}),e.jsx("button",{onClick:()=>s(!1),className:"btn btn-secondary btn-sm",children:"Cancel"})]})]}):e.jsxs("div",{onClick:p,className:"cursor-pointer group",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 group-hover:text-primary-600",children:t.title}),t.description?e.jsx("p",{className:"mt-2 text-gray-600",children:t.description}):e.jsx("p",{className:"mt-2 text-gray-400 italic",children:"Click to add description..."})]})}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsx(Fe,{taskId:t.id,editable:!0})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(L,{icon:M,label:"Status",children:e.jsx("div",{className:"flex gap-2",children:Ee.map(n=>{const _=n.icon;return e.jsxs("button",{onClick:()=>y(n.value),className:v("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5",t.status===n.value?"bg-gray-900 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[e.jsx(_,{className:v("w-4 h-4",t.status===n.value?"text-white":n.color)}),n.label]},n.value)})})}),e.jsx(L,{icon:ve,label:"Priority",children:e.jsx("div",{className:"flex gap-2",children:Me.map(n=>e.jsx("button",{onClick:()=>f(n.value),className:v("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",t.priority===n.value?n.color+" ring-2 ring-offset-1 ring-gray-400":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:n.label},n.value))})}),e.jsxs(L,{icon:K,label:"Due Date",children:[e.jsx("input",{type:"date",value:t.due_date||"",onChange:n=>D(n.target.value),className:"input w-auto"}),t.due_date&&t.days_until_due!==null&&e.jsx("span",{className:v("ml-2 text-sm",t.is_overdue?"text-red-600":"text-gray-500"),children:Oe(t.days_until_due)})]}),t.stage&&e.jsx(L,{icon:je,label:"Stage",children:e.jsx("span",{className:"badge badge-primary capitalize",children:t.stage.replace("_"," ")})}),e.jsx(L,{icon:q,label:"Type",children:e.jsx("span",{className:v("badge",t.task_type==="team"?"badge-blue":"badge-gray"),children:t.task_type_label})}),t.assignee_name&&e.jsx(L,{icon:q,label:"Assignee",children:e.jsx("span",{className:"text-gray-900",children:t.assignee_name})})]}),e.jsx("hr",{className:"my-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Related"}),e.jsxs("button",{className:"w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Attachments"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Add files to this task"})]})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Comments"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Add notes or comments"})]})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-400",children:["Created ",new Date(t.created_at).toLocaleDateString(),t.completed_at&&e.jsxs(e.Fragment,{children:[" • Completed ",new Date(t.completed_at).toLocaleDateString()]})]})}),g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Task?"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:['Are you sure you want to delete "',t.title,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>j(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:T,className:"btn bg-red-600 text-white hover:bg-red-700",children:"Delete"})]})]})})]})}function L({icon:t,label:a,children:r}){return e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 w-24 flex-shrink-0 text-gray-500",children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:a})]}),e.jsx("div",{className:"flex-1 flex items-center flex-wrap gap-2",children:r})]})}function Oe(t){return t===0?"(Today)":t===1?"(Tomorrow)":t===-1?"(Yesterday)":t<0?`(${Math.abs(t)} days overdue)`:`(in ${t} days)`}function Ve({isOpen:t,onClose:a,projectId:r,defaultStatus:i="todo",defaultStage:s,stages:d=[]}){const[u,o]=m.useState(""),[c,g]=m.useState(""),[j,b]=m.useState(i),[x,h]=m.useState("medium"),[y,f]=m.useState(s||""),[D,C]=m.useState(""),[p,T]=m.useState("client"),n=oe(r),_=l=>{l.preventDefault(),u.trim()&&n.mutate({title:u.trim(),description:c.trim()||void 0,status:j,priority:x,stage:y||void 0,due_date:D||void 0,task_type:p},{onSuccess:()=>{o(""),g(""),b(i),h("medium"),f(s||""),C(""),T("client"),a()}})},A=()=>{o(""),g(""),b(i),h("medium"),f(s||""),C(""),T("client"),a()};return e.jsx(ce,{isOpen:t,onClose:A,title:"Add New Task",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A,className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:!u.trim()||n.isPending,className:"btn btn-primary",children:n.isPending?"Creating...":"Create Task"})]}),children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:["Task Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"title",type:"text",value:u,onChange:l=>o(l.target.value),className:"input",placeholder:"What needs to be done?",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{id:"description",value:c,onChange:l=>g(l.target.value),className:"textarea h-24",placeholder:"Add more details..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status",value:j,onChange:l=>b(l.target.value),className:"select",children:[e.jsx("option",{value:"todo",children:"To Do"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"waiting",children:"Waiting"}),e.jsx("option",{value:"done",children:"Done"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs("select",{id:"priority",value:x,onChange:l=>h(l.target.value),className:"select",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stage",className:"block text-sm font-medium text-gray-700 mb-1",children:"Stage"}),e.jsxs("select",{id:"stage",value:y,onChange:l=>f(l.target.value),className:"select",children:[e.jsx("option",{value:"",children:"Select stage..."}),d.map(l=>e.jsx("option",{value:l.slug,children:l.title},l.slug))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{id:"dueDate",type:"date",value:D,onChange:l=>C(l.target.value),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"taskType",value:"client",checked:p==="client",onChange:l=>T(l.target.value),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Client Task"}),e.jsx("span",{className:"text-xs text-gray-500",children:"(visible to you)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"taskType",value:"team",checked:p==="team",onChange:l=>T(l.target.value),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Team Task"}),e.jsx("span",{className:"text-xs text-gray-500",children:"(for support team)"})]})]})]})]})})}function tt(){var z;const[t,a]=m.useState("board"),[r,i]=m.useState(""),{taskFilters:s,setTaskFilters:d,resetTaskFilters:u}=de(),[o,c]=m.useState(null),[g,j]=m.useState(!1),[b,x]=m.useState(!1),[h,y]=m.useState({}),{data:f,isLoading:D}=xe(),{data:C=[],isLoading:p}=me(((z=f==null?void 0:f.project)==null?void 0:z.id)||0),T=X(),n=m.useMemo(()=>{let N=[...C];if(r){const S=r.toLowerCase();N=N.filter(R=>{var W;return R.title.toLowerCase().includes(S)||((W=R.description)==null?void 0:W.toLowerCase().includes(S))})}return s.stage&&(N=N.filter(S=>S.stage===s.stage)),s.status&&(N=N.filter(S=>S.status===s.status)),s.taskType&&(N=N.filter(S=>S.task_type===s.taskType)),N},[C,r,s]),_=N=>{c(N),j(!0)},A=(N,S)=>{T.mutate({id:N,status:S})},l=(N,S)=>{y({status:N,stage:S}),x(!0)},w=()=>{j(!1),c(null)};if(D||p)return e.jsx(Ke,{});if(!(f!=null&&f.project))return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Project Found"}),e.jsx("p",{className:"text-gray-600",children:"Please set up your relocation project first."})]})});const{project:P,stages:k}=f;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your relocation tasks across all stages"})]}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"p-4",children:e.jsx(we,{view:t,onViewChange:a,searchQuery:r,onSearchChange:i,filters:s,onFilterChange:d,onClearFilters:u,stages:k,onAddTask:()=>l(),totalTasks:C.length,filteredTasks:n.length})})}),t==="board"?e.jsx(Ae,{tasks:n,onTaskClick:_,onStatusChange:A,onAddTask:N=>l(N)}):e.jsx(Te,{tasks:n,groupBy:"stage",onTaskClick:_,onStatusChange:A,onAddTask:N=>l(void 0,N)}),n.length===0&&C.length>0&&e.jsxs("div",{className:"card p-8 text-center mt-6",children:[e.jsx("p",{className:"text-gray-500",children:"No tasks match your filters"}),e.jsx("button",{onClick:u,className:"mt-2 text-primary-600 hover:text-primary-700",children:"Clear filters"})]}),C.length===0&&e.jsxs("div",{className:"card p-12 text-center mt-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tasks yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first task to start tracking your relocation progress"}),e.jsx("button",{onClick:()=>l(),className:"btn btn-primary",children:"Create Your First Task"})]}),e.jsx(Ue,{task:o,isOpen:g,onClose:w}),e.jsx(Ve,{isOpen:b,onClose:()=>x(!1),projectId:P.id,defaultStatus:h.status,defaultStage:h.stage,stages:k})]})}function Ke(){return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"h-12 bg-gray-200 rounded-lg animate-pulse mb-6 w-48"}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"h-10 bg-gray-200 rounded-lg animate-pulse"})})}),e.jsx("div",{className:"flex gap-4",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"w-80 flex-shrink-0",children:[e.jsx("div",{className:"h-12 bg-gray-200 rounded-t-xl animate-pulse"}),e.jsx("div",{className:"bg-gray-100 rounded-b-xl p-4 space-y-3",children:[1,2,3].map(a=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-lg animate-pulse"},a))})]},t))})]})}export{tt as default};
