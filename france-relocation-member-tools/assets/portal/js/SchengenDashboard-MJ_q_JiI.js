import{j as e}from"./vendor-query-D8MH73Ff.js";import{r as u}from"./vendor-react-F9Y4d3HK.js";import{a as g}from"./vendor-utils-C5RVuWu4.js";import{c as Y,aI as ts,aJ as as,aK as rs,aL as ns,aM as is,aN as ls,A,a3 as Z,aO as Oe,aP as q,b as F,E as $,F as _e,aQ as ds,aR as os,C as W,Q as X,ay as $e,ai as He,aS as cs,aT as ms,aU as xs,aV as hs,aW as us,aX as gs,aY as ps,aZ as ys,a_ as bs,X as V,q as oe,a as le,a4 as De,a$ as fs,l as re,s as Se,b0 as js,b1 as We,b2 as Ns,b3 as ws,b4 as vs,b5 as Ss,_ as me,b6 as ks,b7 as Cs,b8 as Ts,b9 as Ds,P as ce,ba as Es,bb as Ms,bc as Ls,bd as Ps,be as Is,Z as ke,bf as As,bg as Fs,bh as Rs,ak as Ve,bi as zs,bj as Us,af as Os,bk as _s}from"./main-QnuU6erz.js";import{X as Ce}from"./x-circle-jZbKzk_0.js";import{A as ie}from"./alert-circle-B49vfpdd.js";import{B as $s}from"./briefcase-DlYnbMYH.js";import{T as ge}from"./trash-2-BrA6i21f.js";import{C as Ye}from"./chevron-up-BCjFP8Kb.js";import{C as Ee}from"./chevron-down-CQAkifLU.js";import{L}from"./loader-2-DaeO49ny.js";import{P as pe}from"./plane-dOtZaWsl.js";import{C as Hs}from"./check-circle-2-DHbER8gg.js";import{F as Ws,S as Vs}from"./shield-alert-eLQ_2EFg.js";import{L as Ge}from"./lightbulb-BBdYJoBk.js";import{C as xe,L as Le}from"./lock-BrGMkb4_.js";import{S as Ys}from"./send-CNMyJsH1.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=Y("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=Y("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=Y("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=Y("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=Y("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=Y("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=Y("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=Y("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=Y("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=Y("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),et={yellowThreshold:60,redThreshold:80,emailAlerts:!1,upcomingTripReminders:!0};function st(){const{data:s=[],isLoading:t,isError:r}=ts(),{data:a=et,isLoading:l}=as(),i=rs(),o=ns(),n=is(),m=ls(),c=!t&&!l,x=r,N=u.useMemo(()=>[...s].sort((h,S)=>new Date(S.startDate).getTime()-new Date(h.startDate).getTime()),[s]),f=u.useCallback(h=>i.mutateAsync(h),[i]),v=u.useCallback((h,S)=>o.mutateAsync({id:h,data:S}),[o]),j=u.useCallback(h=>n.mutateAsync(h),[n]),y=u.useCallback(h=>m.mutateAsync(h),[m]),d=i.isPending||o.isPending||n.isPending||m.isPending;return{trips:N,settings:a,isLoaded:c,isError:x,isSaving:d,addTrip:f,updateTrip:v,deleteTrip:j,updateSettings:y}}const Me=90,ye=180;function _(s){if(s instanceof Date){const t=s.toISOString().split("T")[0];return new Date(t+"T00:00:00Z")}return new Date(s+"T00:00:00Z")}function be(){const t=new Date().toISOString().split("T")[0];return new Date(t+"T00:00:00Z")}function ee(s){return s.toISOString().split("T")[0]}function Be(s,t=be()){const r=_(t),a=new Date(r.getTime()-(ye-1)*24*60*60*1e3),l=new Set;return s.forEach(i=>{const o=_(i.startDate),n=_(i.endDate);if(o>r)return;const m=o<a?a:o,c=n>r?r:n;if(m<=c){const x=new Date(m);for(;x<=c;)l.add(ee(x)),x.setTime(x.getTime()+24*60*60*1e3)}}),l.size}function tt(s,t=be()){const r=_(t),a=new Date(r.getTime()-(ye-1)*24*60*60*1e3),l=new Set;return s.forEach(i=>{const o=_(i.startDate),n=_(i.endDate);if(o>r)return;const m=o<a?a:o,c=n>r?r:n;if(m<=c){const x=new Date(m);for(;x<=c;)l.add(ee(x)),x.setTime(x.getTime()+24*60*60*1e3)}}),l}function at(s,t={yellow:60,red:80}){return s>=Me?"critical":s>=t.red?"danger":s>=t.yellow?"warning":"safe"}function rt(s,t=be()){const r=tt(s,t);if(r.size===0)return null;const l=Array.from(r).sort()[0],i=_(l);return i.setTime(i.getTime()+ye*24*60*60*1e3),ee(i)}function nt(s,t={yellow:60,red:80}){const r=be(),a=Be(s,r),l=Math.max(0,Me-a),i=r,o=new Date(r.getTime()-(ye-1)*24*60*60*1e3);return{daysUsed:a,daysRemaining:l,windowStart:ee(o),windowEnd:ee(i),status:at(a,t),nextExpiration:rt(s,r),statusThresholds:t}}function Je(s,t){const r=_(s),a=_(t),l=Math.abs(a.getTime()-r.getTime());return Math.floor(l/(1e3*60*60*24))+1}function ae(s){return Je(s.startDate,s.endDate)}function it(s,t,r){const a=_(t),l=_(r),i=new Date(a);let o=0;for(;i<=l;){const n={id:"temp",startDate:t,endDate:ee(i),country:"France",category:"personal",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},m=[...s,n],c=Be(m,i);if(o=Math.max(o,c),c>Me)return{wouldViolate:!0,projectedDaysUsed:c,earliestSafeEntry:null,maxTripLength:null,message:`This trip would exceed the 90-day limit on ${ee(i)} with ${c} days used.`};i.setTime(i.getTime()+24*60*60*1e3)}return{wouldViolate:!1,projectedDaysUsed:o,earliestSafeEntry:t,maxTripLength:Je(t,r),message:`This trip is safe. Maximum days used during trip: ${o}/90.`}}function Q(s){return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function lt(s,t){const r=new Date(s),a=new Date(t);return s===t?Q(s):r.getMonth()===a.getMonth()&&r.getFullYear()===a.getFullYear()?`${r.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.getDate()}, ${a.getFullYear()}`:r.getFullYear()===a.getFullYear()?`${r.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}, ${a.getFullYear()}`:`${Q(s)} - ${Q(t)}`}const dt={safe:{stroke:"stroke-green-500",text:"text-green-600",bg:"bg-green-50"},warning:{stroke:"stroke-yellow-500",text:"text-yellow-600",bg:"bg-yellow-50"},danger:{stroke:"stroke-orange-500",text:"text-orange-600",bg:"bg-orange-50"},critical:{stroke:"stroke-red-500",text:"text-red-600",bg:"bg-red-50"}},ot={sm:{container:"w-24 h-24",svgSize:96,strokeWidth:6,radius:42,textSize:"text-2xl",labelSize:"text-xs"},md:{container:"w-36 h-36",svgSize:144,strokeWidth:8,radius:64,textSize:"text-4xl",labelSize:"text-sm"},lg:{container:"w-48 h-48",svgSize:192,strokeWidth:10,radius:86,textSize:"text-5xl",labelSize:"text-base"}};function qe({daysUsed:s,daysRemaining:t,status:r,size:a="md",className:l}){const i=dt[r],o=ot[a],n=Math.min(s/90*100,100),m=2*Math.PI*o.radius,c=m-n/100*m;return e.jsxs("div",{className:g("relative inline-flex",o.container,l),children:[e.jsxs("svg",{className:"transform -rotate-90",width:o.svgSize,height:o.svgSize,"aria-hidden":"true",children:[e.jsx("circle",{cx:o.svgSize/2,cy:o.svgSize/2,r:o.radius,fill:"none",strokeWidth:o.strokeWidth,className:"stroke-gray-200"}),e.jsx("circle",{cx:o.svgSize/2,cy:o.svgSize/2,r:o.radius,fill:"none",strokeWidth:o.strokeWidth,strokeLinecap:"round",strokeDasharray:m,strokeDashoffset:c,className:g("transition-all duration-500",i.stroke)})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:g("font-bold",o.textSize,i.text),"aria-label":`${s} days used`,children:s}),e.jsx("span",{className:g("text-gray-500",o.labelSize),children:"of 90 days"})]}),e.jsx("div",{role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":90,"aria-label":`Schengen days: ${s} used, ${t} remaining`,className:"sr-only"})]})}const ct={safe:{label:"Safe",bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200",Icon:Z},warning:{label:"Warning",bgColor:"bg-yellow-50",textColor:"text-yellow-700",borderColor:"border-yellow-200",Icon:A},danger:{label:"Danger",bgColor:"bg-orange-50",textColor:"text-orange-700",borderColor:"border-orange-200",Icon:ie},critical:{label:"Critical",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200",Icon:Ce}},mt={sm:{badge:"px-2 py-0.5 text-xs",icon:"w-3 h-3"},md:{badge:"px-2.5 py-1 text-sm",icon:"w-4 h-4"},lg:{badge:"px-3 py-1.5 text-base",icon:"w-5 h-5"}};function Ke({status:s,showLabel:t=!0,size:r="md",className:a}){const l=ct[s],i=mt[r],o=l.Icon;return e.jsxs("span",{className:g("inline-flex items-center gap-1 rounded-full border font-medium",l.bgColor,l.textColor,l.borderColor,i.badge,a),children:[e.jsx(o,{className:i.icon,"aria-hidden":"true"}),t&&e.jsx("span",{children:l.label})]})}const xt=["Austria","Belgium","Bulgaria","Croatia","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Italy","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland"],ht=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming","District of Columbia"];function Pe({trip:s,existingTrips:t,onSubmit:r,onCancel:a,className:l,defaultJurisdiction:i="schengen"}){const o=!!s,[n,m]=u.useState((s==null?void 0:s.startDate)||""),[c,x]=u.useState((s==null?void 0:s.endDate)||""),[N,f]=u.useState((s==null?void 0:s.country)||"France"),[v,j]=u.useState((s==null?void 0:s.jurisdictionCode)||i),[y,d]=u.useState((s==null?void 0:s.category)||"personal"),[h,S]=u.useState((s==null?void 0:s.notes)||""),{data:C}=Oe(),[w,k]=u.useState(null),[b,D]=u.useState(null),E=C==null?void 0:C.find(T=>T.code===v),H=v==="schengen",K=(v==null?void 0:v.startsWith("us_"))&&(E==null?void 0:E.type)==="state",U=()=>H?[...xt]:K?[...ht]:E?[E.name]:["Unknown"];u.useEffect(()=>{const T=U();T.includes(N)||f(T[0]||"")},[v]),u.useEffect(()=>{if(n&&c)if(H){const ne=(o?t.filter(se=>se.id!==s.id):t).filter(se=>!se.jurisdictionCode||se.jurisdictionCode==="schengen"),O=it(ne,n,c);O.wouldViolate?k(O.message):O.projectedDaysUsed>=80?k(`This trip will bring you to ${O.projectedDaysUsed}/90 days - approaching the limit.`):O.projectedDaysUsed>=60?k(`This trip will bring you to ${O.projectedDaysUsed}/90 days.`):k(null)}else E&&ae({startDate:n,endDate:c})>E.daysAllowed?k(`This trip exceeds the ${E.daysAllowed}-day limit for ${E.name}.`):k(null);else k(null)},[n,c,t,o,s,v,E,H]);const G=T=>{if(T.preventDefault(),D(null),!n||!c){D("Please enter both start and end dates.");return}if(new Date(c)<new Date(n)){D("End date must be on or after start date.");return}const ne=ae({startDate:n,endDate:c}),O=(E==null?void 0:E.daysAllowed)||90;if(ne>O){D(`A single trip cannot exceed ${O} days for ${(E==null?void 0:E.name)||"this jurisdiction"}.`);return}r({startDate:n,endDate:c,country:N,jurisdictionCode:v,category:y,notes:h.trim()||void 0})},R=n&&c?ae({startDate:n,endDate:c}):null,P=U(),I=C&&C.length>1;return e.jsxs("form",{onSubmit:G,className:g("space-y-4",l),children:[I&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"jurisdiction",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Jurisdiction"]}),e.jsx("select",{id:"jurisdiction",value:v,onChange:T=>j(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:C.map(T=>e.jsxs("option",{value:T.code,children:[T.name," (",T.daysAllowed,"/",T.windowDays," days)"]},T.code))}),(E==null?void 0:E.description)&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:E.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(F,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Start Date"]}),e.jsx("input",{type:"date",id:"startDate",value:n,onChange:T=>m(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(F,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"End Date"]}),e.jsx("input",{type:"date",id:"endDate",value:c,onChange:T=>x(T.target.value),min:n,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]})]}),R!==null&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg",children:["Duration: ",e.jsxs("span",{className:"font-medium",children:[R," day",R!==1?"s":""]}),E&&e.jsxs("span",{className:"text-gray-400 ml-2",children:["(max ",E.daysAllowed," for ",E.name,")"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx($,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),K?"State":"Country"]}),e.jsx("select",{id:"country",value:N,onChange:T=>f(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:P.map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("div",{role:"radiogroup","aria-labelledby":"category-label",children:[e.jsxs("span",{id:"category-label",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx($s,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Category"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"personal",checked:y==="personal",onChange:()=>d("personal"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Personal"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"category",value:"business",checked:y==="business",onChange:()=>d("business"),className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Business"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(_e,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Notes (optional)"]}),e.jsx("textarea",{id:"notes",value:h,onChange:T=>S(T.target.value),rows:2,placeholder:"e.g., Visa appointment, apartment hunting...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-none"})]}),w&&e.jsxs("div",{className:"flex gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(A,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-amber-800",children:w})]}),b&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:b})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 text-white bg-primary-600 hover:bg-primary-700 rounded-lg font-medium transition-colors",children:o?"Save Changes":"Add Trip"})]})]})}function ut({trips:s,currentWindowStart:t,onEdit:r,onDelete:a,className:l}){const[i,o]=u.useState("date"),[n,m]=u.useState("desc"),[c,x]=u.useState(null),N=d=>{i===d?m(h=>h==="asc"?"desc":"asc"):(o(d),m("desc"))},f=[...s].sort((d,h)=>{let S=0;switch(i){case"date":S=new Date(d.startDate).getTime()-new Date(h.startDate).getTime();break;case"country":S=d.country.localeCompare(h.country);break;case"duration":S=ae(d)-ae(h);break}return n==="asc"?S:-S}),v=d=>new Date(d.endDate)>=new Date(t),j=d=>{c===d?(a(d),x(null)):(x(d),setTimeout(()=>x(null),3e3))};if(s.length===0)return e.jsxs("div",{className:g("text-center py-12",l),children:[e.jsx($,{className:"w-12 h-12 text-gray-300 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No trips recorded"}),e.jsx("p",{className:"text-gray-500",children:"Add your first trip to start tracking your Schengen days."})]});const y=({field:d})=>i!==d?null:n==="asc"?e.jsx(Ye,{className:"w-4 h-4"}):e.jsx(Ee,{className:"w-4 h-4"});return e.jsxs("div",{className:g("overflow-hidden",l),children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-3 bg-gray-50 border-b border-gray-200 text-sm font-medium text-gray-600",children:[e.jsxs("button",{onClick:()=>N("date"),className:"col-span-4 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx(F,{className:"w-4 h-4","aria-hidden":"true"}),"Dates",e.jsx(y,{field:"date"})]}),e.jsxs("button",{onClick:()=>N("country"),className:"col-span-3 flex items-center gap-1 text-left hover:text-gray-900",children:[e.jsx($,{className:"w-4 h-4","aria-hidden":"true"}),"Country",e.jsx(y,{field:"country"})]}),e.jsxs("button",{onClick:()=>N("duration"),className:"col-span-2 flex items-center gap-1 text-left hover:text-gray-900",children:["Days",e.jsx(y,{field:"duration"})]}),e.jsx("div",{className:"col-span-3 text-right",children:"Actions"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:f.map(d=>{const h=ae(d),S=v(d);return e.jsxs("div",{className:g("grid grid-cols-12 gap-4 px-4 py-3 items-center",S?"bg-white":"bg-gray-50 opacity-75"),children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:lt(d.startDate,d.endDate)}),d.notes&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:d.notes})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("span",{className:"text-sm text-gray-700",children:d.country}),e.jsx("span",{className:g("ml-2 text-xs px-1.5 py-0.5 rounded",d.category==="business"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"),children:d.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:[h," day",h!==1?"s":""]}),!S&&e.jsx("span",{className:"block text-xs text-gray-400",children:"outside window"})]}),e.jsxs("div",{className:"col-span-3 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>r(d),className:"p-2 text-gray-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors","aria-label":`Edit trip to ${d.country}`,children:e.jsx(ds,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(d.id),className:g("p-2 rounded-lg transition-colors",c===d.id?"text-white bg-red-600 hover:bg-red-700":"text-gray-400 hover:text-red-600 hover:bg-red-50"),"aria-label":c===d.id?"Confirm delete":`Delete trip to ${d.country}`,children:e.jsx(ge,{className:"w-4 h-4"})})]})]},d.id)})})]})}function gt(){const[s,t]=u.useState(""),[r,a]=u.useState(""),[l,i]=u.useState(null),o=os(),n=()=>{!s||!r||o.mutate({startDate:s,endDate:r},{onSuccess:x=>{i(x)}})},m=()=>{t(""),a(""),i(null)},c=s&&r&&new Date(r)>=new Date(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(he,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Trip Planning Tool"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Check if a planned trip would violate the 90/180 rule"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-start-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-start-date",value:s,onChange:x=>t(x.target.value),className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"planning-end-date",className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{type:"date",id:"planning-end-date",value:r,onChange:x=>a(x.target.value),min:s,className:"pl-10 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-primary-500 focus:ring-1 focus:ring-primary-500"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,disabled:!c||o.isPending,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",c&&!o.isPending?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-4 h-4","aria-hidden":"true"}),"Check Trip"]})}),l&&e.jsx("button",{onClick:m,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Reset"})]}),l&&e.jsx("div",{className:g("rounded-lg p-4 border",l.wouldViolate?"bg-red-50 border-red-200":"bg-green-50 border-green-200"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[l.wouldViolate?e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}):e.jsx(W,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:g("font-semibold",l.wouldViolate?"text-red-800":"text-green-800"),children:l.wouldViolate?"This trip would violate the 90/180 rule":"This trip is safe"}),e.jsx("p",{className:g("text-sm mt-1",l.wouldViolate?"text-red-700":"text-green-700"),children:l.wouldViolate?`You would exceed the limit by ${l.daysOverLimit} day${l.daysOverLimit!==1?"s":""}.`:`You would use ${l.maxDaysUsed} of your 90 days.`}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Trip Length"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[l.proposedLength," day",l.proposedLength!==1?"s":""]})]}),e.jsxs("div",{className:"bg-white/60 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Max Days Used"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:l.maxDaysUsed})]})]}),l.wouldViolate&&e.jsxs("div",{className:"mt-4 space-y-3",children:[l.earliestSafeDate&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Earliest safe start date:"})," ",Q(l.earliestSafeDate)]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsxs("span",{className:"font-medium",children:["Max safe trip length from ",Q(s),":"]})," ",l.maxSafeLength," day",l.maxSafeLength!==1?"s":""]})]})]})]})]})}),o.isError&&e.jsx("div",{className:"rounded-lg p-4 bg-red-50 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(A,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("p",{className:"text-sm",children:"Failed to simulate trip. Please try again."})]})})]})}const pt=["S","M","T","W","T","F","S"],yt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],bt=["January","February","March","April","May","June","July","August","September","October","November","December"],ft=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function jt({trips:s,windowStart:t,windowEnd:r}){const a=u.useMemo(()=>new Date().toISOString().split("T")[0],[]),l=u.useMemo(()=>new Date(a),[a]),[i,o]=u.useState(l.getMonth()),[n,m]=u.useState(l.getFullYear()),c=u.useMemo(()=>{const j=new Map;return s.forEach(y=>{const d=new Date(y.startDate),h=new Date(y.endDate),S=new Date(d);for(;S<=h;){const C=S.toISOString().split("T")[0];j.set(C,y),S.setDate(S.getDate()+1)}}),j},[s]),x=u.useMemo(()=>{const j=[],y=new Date(n,i,1),d=new Date(n,i+1,0),h=new Date(t),S=new Date(r),C=y.getDay();for(let k=C-1;k>=0;k--){const b=new Date(n,i,-k),D=b.toISOString().split("T")[0];j.push({date:b,isCurrentMonth:!1,isToday:!1,isInWindow:b>=h&&b<=S,trip:c.get(D)||null,isFuture:b>l})}for(let k=1;k<=d.getDate();k++){const b=new Date(n,i,k),D=b.toISOString().split("T")[0];j.push({date:b,isCurrentMonth:!0,isToday:D===a,isInWindow:b>=h&&b<=S,trip:c.get(D)||null,isFuture:b>l})}const w=6-d.getDay();for(let k=1;k<=w;k++){const b=new Date(n,i+1,k),D=b.toISOString().split("T")[0];j.push({date:b,isCurrentMonth:!1,isToday:!1,isInWindow:b>=h&&b<=S,trip:c.get(D)||null,isFuture:b>l})}return j},[i,n,c,t,r,l,a]),N=()=>{i===0?(o(11),m(n-1)):o(i-1)},f=()=>{i===11?(o(0),m(n+1)):o(i+1)},v=()=>{o(l.getMonth()),m(l.getFullYear())};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:N,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Previous month",children:e.jsx($e,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsx("button",{onClick:f,className:"p-1 sm:p-1.5 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Next month",children:e.jsx(He,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-gray-900 ml-1 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline",children:bt[i]}),e.jsx("span",{className:"sm:hidden",children:ft[i]})," ",n]})]}),e.jsx("button",{onClick:v,className:"px-2 sm:px-3 py-1 sm:py-1.5 text-xs sm:text-sm font-medium text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",children:"Today"})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200",children:yt.map((j,y)=>e.jsxs("div",{className:"py-1.5 sm:py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("span",{className:"hidden sm:inline",children:j}),e.jsx("span",{className:"sm:hidden",children:pt[y]})]},j))}),e.jsx("div",{className:"grid grid-cols-7",children:x.map((j,y)=>{const{date:d,isCurrentMonth:h,isToday:S,isInWindow:C,trip:w,isFuture:k}=j;return e.jsxs("div",{className:g("relative min-h-[44px] sm:min-h-[60px] p-0.5 sm:p-1 border-b border-r border-gray-100",!h&&"bg-gray-50",S&&"bg-primary-50"),children:[e.jsx("span",{className:g("inline-flex items-center justify-center w-5 h-5 sm:w-6 sm:h-6 text-xs sm:text-sm rounded-full",S&&"bg-primary-600 text-white font-medium",!S&&h&&"text-gray-900",!S&&!h&&"text-gray-400"),children:d.getDate()}),w&&e.jsxs("div",{className:g("mt-0.5 sm:mt-1 px-0.5 sm:px-1 py-0.5 rounded text-[10px] sm:text-xs truncate",k?"bg-blue-100 text-blue-700 border border-dashed border-blue-300":C?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600"),title:`${w.country}${k?" (planned)":""}`,children:[e.jsx(pe,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 inline-block sm:mr-0.5","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Trip to "}),e.jsx("span",{className:"hidden sm:inline",children:w.country.slice(0,3)})]}),C&&!w&&h&&e.jsx("div",{className:"absolute bottom-0.5 sm:bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-green-400",title:"In current 180-day window"})]},y)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 p-2 sm:p-3 border-t border-gray-200 text-[10px] sm:text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-primary-100 border border-primary-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (in window)"}),e.jsx("span",{className:"sm:hidden",children:"In window"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-blue-100 border border-dashed border-blue-300"}),e.jsx("span",{className:"hidden sm:inline",children:"Future trip"}),e.jsx("span",{className:"sm:hidden",children:"Future"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded bg-gray-100 border border-gray-200"}),e.jsx("span",{className:"hidden sm:inline",children:"Past trip (outside window)"}),e.jsx("span",{className:"sm:hidden",children:"Outside"})]})]})]})}function Nt({compact:s=!1}){const[t,r]=u.useState(new Set),[a,l]=u.useState(!1),[i,o]=u.useState(null),[n,m]=u.useState(null),c=u.useRef(null),x=cs(),N=ms(),f=xs("pending"),v=x.data??[],j=N.data??[],y=f.data??[],d=f.refetch,h=x.isLoading,S=N.isLoading,C=f.isLoading,w=x.error,k=N.error,b=f.error,D=hs(),E=us(),H=gs(),K=ps(),U=ys(),G=bs();u.useEffect(()=>{try{const p=new URLSearchParams(window.location.search),M=p.get("calendar_connected"),B=p.get("calendar_error");if(M){o(`Successfully connected ${M==="google"?"Google Calendar":"Microsoft Outlook"}!`),p.delete("calendar_connected");const z=p.toString(),ve=window.location.pathname+(z?`?${z}`:"");window.history.replaceState({},"",ve),d()}if(B){m(decodeURIComponent(B)),p.delete("calendar_error");const z=p.toString(),ve=window.location.pathname+(z?`?${z}`:"");window.history.replaceState({},"",ve)}}catch(p){console.error("Error handling URL params:",p)}},[d]),u.useEffect(()=>{if(i){const p=setTimeout(()=>o(null),5e3);return()=>clearTimeout(p)}},[i]),u.useEffect(()=>{if(n){const p=setTimeout(()=>m(null),8e3);return()=>clearTimeout(p)}},[n]);const R=p=>{m(null),D.mutate(p,{onError:M=>{m(M instanceof Error?M.message:"Failed to connect")}})},P=p=>{confirm("Are you sure you want to disconnect this calendar? Pending events will be removed.")&&E.mutate(p,{onSuccess:()=>{o("Calendar disconnected")},onError:M=>{m(M instanceof Error?M.message:"Failed to disconnect")}})},I=p=>{H.mutate(p,{onSuccess:M=>{o(`Synced! Found ${M.travelDetected} travel events.`)},onError:M=>{m(M instanceof Error?M.message:"Sync failed")}})},T=p=>{var B;const M=(B=p.target.files)==null?void 0:B[0];M&&G.mutate(M,{onSuccess:z=>{o(`Imported ${z.detected} travel events from ${z.parsed} calendar entries.`),c.current&&(c.current.value="")},onError:z=>{m(z instanceof Error?z.message:"Failed to import file")}})},ne=p=>{const M=new Set(t);M.has(p)?M.delete(p):M.add(p),r(M)},O=()=>{if(!y)return;const p=y.filter(M=>M.isSchengen);t.size===p.length?r(new Set):r(new Set(p.map(M=>M.id)))},se=()=>{t.size!==0&&K.mutate(Array.from(t),{onSuccess:p=>{o(`Imported ${p.imported} trips!`),r(new Set)},onError:p=>{m(p instanceof Error?p.message:"Import failed")}})},Xe=()=>{t.size!==0&&U.mutate(Array.from(t),{onSuccess:p=>{o(`Skipped ${p.skipped} events.`),r(new Set)},onError:p=>{m(p instanceof Error?p.message:"Skip failed")}})},es=h||S||C,ss=!!(w||k||b),fe=j.length>0,je=y.length>0,te=y.filter(p=>p.isSchengen),Ne=y.filter(p=>!p.isSchengen),we=p=>p instanceof Error?p.message:typeof p=="string"?p:"Unknown error";if(es)return e.jsx("div",{className:g("card p-6",s&&"p-4"),children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(L,{className:"w-6 h-6 animate-spin text-primary-600","aria-hidden":"true"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading calendar sync..."})]})});if(ss){const p=w?we(w):k?we(k):b?we(b):"Failed to load calendar data";return e.jsx("div",{className:g("card p-6",s&&"p-4"),children:e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ce,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Unable to load calendar sync"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:p})]})]})})}return s?e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Calendar Sync"})]}),je&&e.jsxs("span",{className:"px-2 py-1 bg-primary-100 text-primary-700 text-xs font-medium rounded-full",children:[te.length," to review"]})]}),fe?e.jsx("div",{className:"space-y-2",children:j.map(p=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-green-500","aria-hidden":"true"}),e.jsx("span",{children:p.providerName})]}),e.jsx("button",{onClick:()=>I(p.id),disabled:H.isPending,className:"text-primary-600 hover:text-primary-700 text-xs font-medium",children:H.isPending?"Syncing...":"Sync now"})]},p.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Connect your calendar to auto-detect travel."})]}):e.jsxs("div",{className:"space-y-6",children:[i&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(W,{className:"w-5 h-5 text-green-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-green-800",children:i}),e.jsx("button",{onClick:()=>o(null),className:"ml-auto text-green-600 hover:text-green-800",children:e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"})})]}),n&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ce,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:n}),e.jsx("button",{onClick:()=>m(null),className:"ml-auto text-red-600 hover:text-red-800",children:e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Connected Calendars"})}),e.jsxs("div",{className:"p-6",children:[fe?e.jsx("div",{className:"space-y-4",children:j.map(p=>e.jsx(wt,{connection:p,onSync:()=>I(p.id),onDisconnect:()=>P(p.id),isSyncing:H.isPending,isDisconnecting:E.isPending},p.id))}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(F,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No calendars connected yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Connect a calendar to automatically detect travel events"})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Add Calendar"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:v.map(p=>{const M=j.some(z=>z.provider===p.id),B=p.isConfigured&&!M;return e.jsxs("button",{onClick:()=>B&&R(p.id),disabled:!B||D.isPending,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",B?"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[D.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Ks,{className:"w-4 h-4","aria-hidden":"true"}),p.name,M&&e.jsx("span",{className:"text-xs text-green-600",children:"(Connected)"}),!p.isConfigured&&e.jsx("span",{className:"text-xs text-gray-400",children:"(Not configured)"})]},p.id)})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Import iCal File"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{ref:c,type:"file",accept:".ics,text/calendar",onChange:T,className:"hidden",id:"ical-upload"}),e.jsxs("label",{htmlFor:"ical-upload",className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium cursor-pointer transition-colors",G.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"),children:[G.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(oe,{className:"w-4 h-4","aria-hidden":"true"}),G.isPending?"Uploading...":"Upload .ics file"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"Export from Apple Calendar, Outlook, or other apps"})]})]})]})]}),je&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detected Travel Events"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Review and import these events as Schengen trips"})]}),te.length>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:O,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:t.size===te.length?"Deselect all":"Select all"})})]}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[te.length>0&&e.jsx("div",{children:te.map(p=>e.jsx(vt,{event:p,isSelected:t.has(p.id),onToggle:()=>ne(p.id)},p.id))}),Ne.length>0&&e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsxs("button",{onClick:()=>l(!a),className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800",children:[a?e.jsx(Ye,{className:"w-4 h-4","aria-hidden":"true"}):e.jsx(Ee,{className:"w-4 h-4","aria-hidden":"true"}),Ne.length," non-Schengen events detected"]}),a&&e.jsx("div",{className:"mt-4 space-y-2",children:Ne.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:p.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[ue(p.startDate)," - ",ue(p.endDate),p.location&&` â€¢ ${p.location}`]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:p.detectedCountry||"Unknown location"})]},p.id))})]})]}),t.size>0&&e.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[t.size," event",t.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Xe,disabled:U.isPending,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:[U.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"}),"Skip"]}),e.jsxs("button",{onClick:se,disabled:K.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-50",children:[K.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"}),"Import as Trips"]})]})]}),te.length===0&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(W,{className:"w-8 h-8 text-green-500 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-600",children:"All Schengen travel events have been processed!"})]})]}),!je&&fe&&e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx(W,{className:"w-12 h-12 text-green-400 mx-auto mb-3","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"All caught up!"}),e.jsx("p",{className:"text-gray-500",children:"No pending travel events to review. Events will appear here after syncing."})]})]})}function wt({connection:s,onSync:t,onDisconnect:r,isSyncing:a,isDisconnecting:l}){const i={active:"bg-green-100 text-green-700",error:"bg-red-100 text-red-700",expired:"bg-yellow-100 text-yellow-700"};return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm",children:e.jsx(F,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.providerName}),e.jsx("span",{className:g("px-2 py-0.5 rounded-full text-xs font-medium",i[s.syncStatus]),children:s.syncStatus})]}),s.lastSyncAt&&e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(le,{className:"w-3 h-3","aria-hidden":"true"}),"Last synced: ",St(s.lastSyncAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:t,disabled:a||s.syncStatus==="expired",className:g("inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",a||s.syncStatus==="expired"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-100 text-primary-700 hover:bg-primary-200"),children:[a?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(De,{className:"w-4 h-4","aria-hidden":"true"}),a?"Syncing...":"Sync"]}),e.jsx("button",{onClick:r,disabled:l,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 transition-colors",children:l?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Xs,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}function vt({event:s,isSelected:t,onToggle:r}){const a=s.confidence>=.8?"High":s.confidence>=.5?"Medium":"Low",l=s.confidence>=.8?"text-green-600":s.confidence>=.5?"text-yellow-600":"text-gray-500";return e.jsxs("div",{className:g("flex items-center gap-4 p-4 hover:bg-gray-50 cursor-pointer transition-colors",t&&"bg-primary-50"),onClick:r,role:"checkbox","aria-checked":t,tabIndex:0,onKeyDown:i=>{(i.key===" "||i.key==="Enter")&&(i.preventDefault(),r())},children:[e.jsx("div",{className:g("w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0",t?"bg-primary-600 border-primary-600":"border-gray-300"),children:t&&e.jsx(Z,{className:"w-3 h-3 text-white","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-primary-500 flex-shrink-0","aria-hidden":"true"}),e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:s.title})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3","aria-hidden":"true"}),ue(s.startDate)," - ",ue(s.endDate)]}),s.location&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx($,{className:"w-3 h-3","aria-hidden":"true"}),s.location]})]})]}),e.jsx("div",{className:"flex items-center gap-4 flex-shrink-0",children:s.detectedCountry&&e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:[s.countryCode&&e.jsx("span",{className:"font-mono",children:s.countryCode}),s.detectedCountry]}),e.jsxs("p",{className:g("text-xs mt-1",l),children:[a," confidence"]})]})})]})}function ue(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function St(s){const t=new Date(s),a=new Date().getTime()-t.getTime(),l=Math.floor(a/6e4),i=Math.floor(a/36e5),o=Math.floor(a/864e5);return l<1?"just now":l<60?`${l}m ago`:i<24?`${i}h ago`:o<7?`${o}d ago`:t.toLocaleDateString()}function kt({disabled:s}){const[t,r]=u.useState(!1),[a,l]=u.useState(null),i=u.useRef(null),o=fs(),n=()=>{o.mutate(void 0,{onSuccess:N=>{l(N),r(!0)}})},m=()=>{var N;(N=i.current)!=null&&N.contentWindow&&i.current.contentWindow.print()},c=()=>{if(!a)return;const N=new Blob([a.html],{type:"text/html"}),f=URL.createObjectURL(N),v=document.createElement("a");v.href=f,v.download=a.filename.replace(".pdf",".html"),document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(f)},x=()=>{r(!1),l(null)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,disabled:s||o.isPending,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Export Schengen report as PDF",children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4","aria-hidden":"true"}),"Export Report"]})}),e.jsx(re,{isOpen:t,onClose:x,title:"Schengen Report Preview",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.summary)&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.daysUsed}),e.jsx("p",{className:"text-xs text-gray-500",children:"Days Used"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.daysRemaining}),e.jsx("p",{className:"text-xs text-gray-500",children:"Remaining"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:a.summary.status}),e.jsx("p",{className:"text-xs text-gray-500",children:"Status"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.summary.tripCount}),e.jsx("p",{className:"text-xs text-gray-500",children:"Trips"})]})]}),(a==null?void 0:a.html)&&e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",style:{height:"400px"},children:e.jsx("iframe",{ref:i,srcDoc:a.html,title:"Report Preview",className:"w-full h-full",sandbox:"allow-same-origin"})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Close"}),e.jsxs("button",{onClick:c,className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(Se,{className:"w-4 h-4","aria-hidden":"true"}),"Download HTML"]}),e.jsxs("button",{onClick:m,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700",children:[e.jsx(Zs,{className:"w-4 h-4","aria-hidden":"true"}),"Print / Save as PDF"]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:`Tip: Use your browser's "Print to PDF" option to save as a PDF file`})]})}),o.isError&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-50 border border-red-200 rounded-lg p-4 shadow-lg flex items-center gap-3",children:[e.jsx("p",{className:"text-sm text-red-800",children:"Failed to generate report. Please try again."}),e.jsx("button",{onClick:()=>o.reset(),className:"text-red-600 hover:text-red-800","aria-label":"Dismiss error",children:e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"})})]})]})}const Ct={enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4};function Ze(s={}){const t={...Ct,...s},[r,a]=u.useState(null),[l,i]=u.useState(null),[o,n]=u.useState(!1),[m,c]=u.useState("prompt"),x=typeof navigator<"u"&&"geolocation"in navigator;u.useEffect(()=>{if(!x){c("unavailable");return}"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(v=>{c(v.state),v.addEventListener("change",()=>{c(v.state)})}).catch(()=>{c("prompt")})},[x]);const N=u.useCallback(()=>new Promise((v,j)=>{if(!x){const y={code:0,message:"Geolocation is not supported by this browser."};i(y),j(y);return}n(!0),i(null),navigator.geolocation.getCurrentPosition(y=>{const d={lat:y.coords.latitude,lng:y.coords.longitude,accuracy:y.coords.accuracy,timestamp:y.timestamp};a(d),i(null),n(!1),c("granted"),v(d)},y=>{const d={code:y.code,message:Tt(y.code)};i(d),n(!1),y.code===y.PERMISSION_DENIED&&c("denied"),j(d)},{enableHighAccuracy:t.enableHighAccuracy,timeout:t.timeout,maximumAge:t.maximumAge})}),[x,t.enableHighAccuracy,t.timeout,t.maximumAge]),f=u.useCallback(()=>{a(null),i(null)},[]);return{position:r,error:l,isLoading:o,permission:m,isSupported:x,getCurrentPosition:N,clearPosition:f}}function Tt(s){switch(s){case 1:return"Location permission denied. Please enable location access in your browser settings.";case 2:return"Unable to determine your location. Please try again.";case 3:return"Location request timed out. Please try again.";default:return"An unknown error occurred while getting your location."}}function Ie({compact:s=!1}){const[t,r]=u.useState(!1),[a,l]=u.useState(!1),{error:i,isLoading:o,permission:n,isSupported:m,getCurrentPosition:c}=Ze(),{data:x,isLoading:N}=js(),f=We(),v=u.useCallback(async()=>{try{const h=await c();await f.mutateAsync({lat:h.lat,lng:h.lng,accuracy:h.accuracy,source:"checkin"})}catch(h){console.error("Check-in failed:",h)}},[c,f]),j=(x==null?void 0:x.hasCheckedInToday)??!1,y=x==null?void 0:x.lastLocation,d=o||f.isPending;return s?e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("p-2 rounded-lg",j?"bg-green-100":"bg-gray-100"),children:e.jsx($,{className:g("w-5 h-5",j?"text-green-600":"text-gray-500"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"Location Check-in"}),j&&y?e.jsxs("p",{className:"text-xs text-green-600",children:["Checked in: ",y.countryName??"Unknown",y.isSchengen&&" (Schengen)"]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Not checked in today"})]})]}),e.jsx("button",{onClick:v,disabled:d||!m,className:g("inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",d?"bg-gray-100 text-gray-400 cursor-not-allowed":j?"bg-green-100 text-green-700 hover:bg-green-200":"bg-primary-600 text-white hover:bg-primary-700"),children:d?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Checking in..."})]}):j?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4","aria-hidden":"true"}),"Update"]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4","aria-hidden":"true"}),"Check In"]})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("p-3 rounded-xl",j?"bg-green-100":"bg-blue-100"),children:e.jsx($,{className:g("w-6 h-6",j?"text-green-600":"text-blue-600"),"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Location Check-in"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Record your current location for Schengen tracking"})]})]}),e.jsxs("button",{onClick:()=>r(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(qs,{className:"w-4 h-4","aria-hidden":"true"}),"History"]})]}),!m&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg mb-4",children:[e.jsx(A,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Geolocation is not supported by your browser. Try using a modern browser like Chrome, Firefox, or Safari."})]}),n==="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Location permission denied"}),e.jsx("p",{className:"text-sm text-red-700",children:"Please enable location access in your browser settings to use this feature."})]})]}),i&&n!=="denied"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:i.message})]}),f.error&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"Failed to save location."}),e.jsx("p",{className:"mt-1 text-xs",children:f.error instanceof Error?f.error.message:"Please try again."})]})]}),N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})}):j&&y?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-6 h-6 text-green-600","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-800",children:"Checked in today"}),e.jsxs("p",{className:"text-sm text-green-700",children:[y.city&&`${y.city}, `,y.countryName??"Unknown location",y.isSchengen&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:[e.jsx(q,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Schengen"]})]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["at ",new Date(y.recordedAt).toLocaleTimeString()]})]})]})}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-gray-500","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You haven't checked in today. Check in to record your location for Schengen tracking."})]})}),e.jsx("button",{onClick:v,disabled:d||!m||n==="denied",className:g("w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors",d||!m||n==="denied"?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:d?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5 animate-spin","aria-hidden":"true"}),"Getting your location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-5 h-5","aria-hidden":"true"}),j?"Update Location":"Check In Now"]})}),f.isSuccess&&f.data&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(W,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:f.data.message})]})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-blue-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"How location tracking works:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Your location is detected using your browser's GPS"}),e.jsx("li",{children:"We determine which country you're in automatically"}),e.jsx("li",{children:"Schengen zone countries are tracked for the 90/180 rule"}),e.jsx("li",{children:"You can view and delete your location history at any time"})]})]})]})})]}),e.jsx(re,{isOpen:t,onClose:()=>r(!1),title:"Location History",size:"lg",children:e.jsx(Dt,{onClearRequest:()=>l(!0)})}),e.jsx(re,{isOpen:a,onClose:()=>l(!1),title:"Clear Location History",size:"sm",children:e.jsx(Mt,{onConfirm:()=>{l(!1),r(!1)},onCancel:()=>l(!1)})})]})}function Dt({onClearRequest:s}){const{data:t,isLoading:r,refetch:a,isRefetching:l}=Ns({limit:50}),i=ws(),o=async m=>{confirm("Delete this location entry?")&&await i.mutateAsync(m)};if(r)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})});const n=(t==null?void 0:t.locations)??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[(t==null?void 0:t.total)??0," location",((t==null?void 0:t.total)??0)!==1?"s":""," recorded"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>a(),disabled:l,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded transition-colors",children:[e.jsx(De,{className:g("w-4 h-4",l&&"animate-spin"),"aria-hidden":"true"}),"Refresh"]}),n.length>0&&e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-1 px-2 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-colors",children:[e.jsx(ge,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All"]})]})]}),n.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500",children:"No location history yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Check in to start recording your locations"})]}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:n.map(m=>e.jsx(Et,{location:m,onDelete:()=>o(m.id),isDeleting:i.isPending},m.id))})]})}function Et({location:s,onDelete:t,isDeleting:r}){const a=new Date(s.recordedAt);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("p-2 rounded-lg",s.isSchengen?"bg-blue-100":"bg-gray-100"),children:s.isSchengen?e.jsx(q,{className:"w-4 h-4 text-blue-600","aria-hidden":"true"}):e.jsx($,{className:"w-4 h-4 text-gray-500","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[s.city&&`${s.city}, `,s.countryName??"Unknown location",s.isSchengen&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Schengen)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.toLocaleDateString()," at ",a.toLocaleTimeString(),s.accuracy&&e.jsxs("span",{className:"ml-2",children:["(Â±",Math.round(s.accuracy),"m)"]})]})]})]}),e.jsx("button",{onClick:t,disabled:r,className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-red-600 transition-all",title:"Delete",children:e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"})})]})}function Mt({onConfirm:s,onCancel:t}){const r=vs(),a=async()=>{await r.mutateAsync(),s()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete all your location history? This action cannot be undone."}),r.error&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:"Failed to clear history. Please try again."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:t,disabled:r.isPending,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:r.isPending,className:g("inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors",r.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700"),children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4","aria-hidden":"true"}),"Clear All History"]})})]})]})}const Lt={"Europe/Paris":["FR"],"Europe/Berlin":["DE"],"Europe/Rome":["IT"],"Europe/Madrid":["ES"],"Europe/Amsterdam":["NL"],"Europe/Brussels":["BE"],"Europe/Vienna":["AT"],"Europe/Zurich":["CH"],"Europe/Stockholm":["SE"],"Europe/Oslo":["NO"],"Europe/Copenhagen":["DK"],"Europe/Helsinki":["FI"],"Europe/Warsaw":["PL"],"Europe/Prague":["CZ"],"Europe/Budapest":["HU"],"Europe/Athens":["GR"],"Europe/Lisbon":["PT"],"Europe/Dublin":["IE"],"Europe/London":["GB"],"Europe/Bucharest":["RO"],"Europe/Sofia":["BG"],"Europe/Zagreb":["HR"],"Europe/Ljubljana":["SI"],"Europe/Bratislava":["SK"],"Europe/Tallinn":["EE"],"Europe/Riga":["LV"],"Europe/Vilnius":["LT"],"Europe/Luxembourg":["LU"],"Europe/Malta":["MT"],"Europe/Reykjavik":["IS"],"Europe/Vaduz":["LI"],"Europe/Monaco":["MC"]},Pt=new Set(["AT","BE","BG","HR","CZ","DK","EE","FI","FR","DE","GR","HU","IS","IT","LV","LI","LT","LU","MT","NL","NO","PL","PT","RO","SK","SI","ES","SE","CH"]),J={TIMEZONE:"r2f_schengen_last_timezone",LAST_CHECKIN:"r2f_schengen_last_checkin_date",PROMPT_DISMISSED:"r2f_schengen_prompt_dismissed_date"};function Ae(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return"UTC"}}function It(){return navigator.language||"en-US"}function Fe(s){const t=Lt[s];return(t==null?void 0:t[0])||null}function Re(s){return s?Pt.has(s):!1}function de(){return new Date().toISOString().split("T")[0]}function At(s={}){const{enableReminder:t=!0,reminderHour:r=9}=s,[a,l]=u.useState(()=>{const c=Ae(),x=localStorage.getItem(J.TIMEZONE),N=localStorage.getItem(J.LAST_CHECKIN),f=localStorage.getItem(J.PROMPT_DISMISSED),v=de(),j=Fe(c),y=x!==null&&x!==c,d=N===v,S=y||t&&!d&&!(f===v);return{currentTimezone:c,storedTimezone:x,timezoneChanged:y,likelyCountry:j,likelySchengen:Re(j),currentLocale:It(),shouldPromptCheckin:S,lastCheckinDate:N,checkedInToday:d}});u.useEffect(()=>{const x=setInterval(()=>{const N=Ae();l(f=>{if(f.currentTimezone!==N){const v=Fe(N);return{...f,currentTimezone:N,timezoneChanged:f.storedTimezone!==null&&f.storedTimezone!==N,likelyCountry:v,likelySchengen:Re(v),shouldPromptCheckin:!0}}return f})},3e5);return()=>clearInterval(x)},[]),u.useEffect(()=>{if(!t)return;const c=()=>{const N=new Date,f=de(),v=localStorage.getItem(J.LAST_CHECKIN),j=localStorage.getItem(J.PROMPT_DISMISSED);N.getHours()>=r&&v!==f&&j!==f&&l(y=>({...y,shouldPromptCheckin:!0,checkedInToday:!1}))};c();const x=setInterval(c,60*1e3);return()=>clearInterval(x)},[t,r]);const i=u.useCallback(()=>{localStorage.setItem(J.TIMEZONE,a.currentTimezone),l(c=>({...c,storedTimezone:c.currentTimezone,timezoneChanged:!1}))},[a.currentTimezone]),o=u.useCallback(()=>{const c=de();localStorage.setItem(J.LAST_CHECKIN,c),localStorage.setItem(J.TIMEZONE,a.currentTimezone),l(x=>({...x,lastCheckinDate:c,checkedInToday:!0,shouldPromptCheckin:!1,storedTimezone:x.currentTimezone,timezoneChanged:!1}))},[a.currentTimezone]),n=u.useCallback(()=>{const c=de();localStorage.setItem(J.PROMPT_DISMISSED,c),l(x=>({...x,shouldPromptCheckin:!1}))},[]),m=u.useCallback(()=>new Date().getHours()>=r,[r]);return u.useMemo(()=>({state:a,acknowledgeTimezone:i,markCheckedIn:o,dismissPrompt:n,isReminderTime:m}),[a,i,o,n,m])}function Ft(s){const t=s.toUpperCase().split("").map(r=>127397+r.charCodeAt(0));return String.fromCodePoint(...t)}function Rt({enabled:s=!0,onCheckin:t,onDismiss:r}){const[a,l]=u.useState(!1),{state:i,markCheckedIn:o,dismissPrompt:n}=At({enableReminder:s}),{data:m}=Ss(),{getCurrentPosition:c,isLoading:x,isSupported:N}=Ze(),f=We();u.useEffect(()=>{if(a){const D=setTimeout(()=>l(!1),3e3);return()=>clearTimeout(D)}},[a]);const v=u.useCallback(async()=>{try{const D=await c();await f.mutateAsync({lat:D.lat,lng:D.lng,accuracy:D.accuracy,source:"checkin"}),o(),l(!0),t==null||t()}catch(D){console.error("Check-in failed:",D)}},[c,f,o,t]),j=u.useCallback(()=>{n(),r==null||r()},[n,r]);if(!s||!i.shouldPromptCheckin||i.checkedInToday)return null;const y=x||f.isPending;let d=le,h="Daily Location Check-in",S="Don't forget to check in your location for accurate Schengen tracking.",C="blue";if(i.timezoneChanged?(d=pe,h="Travel Detected",S=`Your timezone changed from ${i.storedTimezone} to ${i.currentTimezone}. Are you traveling?`,C="amber"):m!=null&&m.detected&&m.countryCode&&i.likelyCountry&&m.countryCode!==i.likelyCountry&&(d=q,h="Location Check",S=`Your IP suggests you're in ${m.countryName||m.countryCode}. Check in to confirm your location.`,C="purple"),a)return e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(W,{className:"w-5 h-5 text-green-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Location recorded!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your location has been saved for Schengen tracking."})]})]})});const w=d,b={blue:{bg:"bg-blue-50",border:"border-blue-200",icon:"bg-blue-100 text-blue-600",title:"text-blue-800",message:"text-blue-700",button:"bg-blue-600 hover:bg-blue-700 text-white",dismiss:"text-blue-500 hover:text-blue-700 hover:bg-blue-100"},amber:{bg:"bg-amber-50",border:"border-amber-200",icon:"bg-amber-100 text-amber-600",title:"text-amber-800",message:"text-amber-700",button:"bg-amber-600 hover:bg-amber-700 text-white",dismiss:"text-amber-500 hover:text-amber-700 hover:bg-amber-100"},purple:{bg:"bg-purple-50",border:"border-purple-200",icon:"bg-purple-100 text-purple-600",title:"text-purple-800",message:"text-purple-700",button:"bg-purple-600 hover:bg-purple-700 text-white",dismiss:"text-purple-500 hover:text-purple-700 hover:bg-purple-100"}}[C];return e.jsx("div",{className:g("border rounded-lg p-4 mb-4",b.bg,b.border),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:g("p-2 rounded-lg",b.icon),children:e.jsx(w,{className:"w-5 h-5","aria-hidden":"true"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:g("font-medium",b.title),children:h}),(m==null?void 0:m.detected)&&m.countryCode&&e.jsx("span",{className:"text-lg",role:"img","aria-label":m.countryName||m.countryCode,children:Ft(m.countryCode)})]}),e.jsx("p",{className:g("text-sm mt-0.5",b.message),children:S}),i.likelySchengen&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs",children:[e.jsx(q,{className:"w-3 h-3 text-blue-500","aria-hidden":"true"}),e.jsxs("span",{className:"text-blue-600",children:["Based on timezone: Likely in Schengen zone (",i.likelyCountry,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsx("button",{onClick:v,disabled:y||!N,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",y||!N?"bg-gray-100 text-gray-400 cursor-not-allowed":b.button),children:y?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Getting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4","aria-hidden":"true"}),"Check In Now"]})}),e.jsx("button",{onClick:j,className:g("px-3 py-2 rounded-lg text-sm transition-colors",b.dismiss),children:"Maybe later"})]}),f.error&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-sm text-red-600",children:[e.jsx(ie,{className:"w-4 h-4","aria-hidden":"true"}),"Failed to save location. Please try again."]}),!N&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs text-gray-500",children:[e.jsx(ie,{className:"w-3 h-3","aria-hidden":"true"}),"Geolocation is not supported by your browser."]})]})]}),e.jsx("button",{onClick:j,className:g("p-1 rounded transition-colors",b.dismiss),"aria-label":"Dismiss",children:e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"})})]})})}const Qe="r2f_schengen_onboarding_complete";function zt(){return localStorage.getItem(Qe)==="true"}function ze(){localStorage.setItem(Qe,"true")}function Ut({isOpen:s,onComplete:t,isPremium:r=!1}){const[a,l]=u.useState(0),i=[{icon:e.jsx(q,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Welcome to Schengen Tracker",description:"Understand and comply with the 90/180 day rule",details:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-5 bg-blue-50 border border-blue-100 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3 text-base",children:"The 90/180 Rule"}),e.jsxs("p",{className:"text-blue-800 leading-relaxed",children:["Non-EU citizens may stay up to ",e.jsx("strong",{children:"90 days"})," within any"," ",e.jsx("strong",{children:"180-day rolling period"})," in the Schengen area without a long-stay visa."]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Entry & Exit"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Both days count as full days"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Rolling Window"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Days expire after 180 days"})]})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Overstaying can result in fines, deportation, and future visa denials."})]})},{icon:e.jsx(pe,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Track Your Trips",description:"Add your past and future Schengen travel",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Keep an accurate record of all your Schengen zone visits to stay compliant."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"1"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:'Click "Add Trip"'}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Enter your travel dates and destination country"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"2"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Add all past trips"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Include trips from the last 6 months for accurate tracking"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"3"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Plan future trips"}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Add upcoming travel to see projected compliance"})]})]})]})]})},{icon:e.jsx($,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Smart Location Check-in",description:"Quick daily check-ins keep your tracker current",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Use location check-in to automatically record your presence in Schengen countries."}),e.jsxs("div",{className:"p-5 bg-green-50 border border-green-100 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-600 flex items-center justify-center",children:e.jsx(Z,{className:"w-5 h-5 text-white","aria-hidden":"true"})}),e.jsx("h4",{className:"font-semibold text-green-900 text-base",children:"Automatic Trip Creation"})]}),e.jsx("p",{className:"text-green-800 leading-relaxed",children:"When you check in from a Schengen country, we automatically create or extend your trip record. No manual entry needed!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Browser Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:"One-click check-in with GPS"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-center",children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Smart Detection"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Prompts when timezone changes"})]})]})]})},{icon:e.jsx(he,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Plan Future Travel",description:'Use the "What If" calculator before you book',details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Before booking a trip, check if it would violate the 90/180 rule."}),e.jsxs("div",{className:"p-5 bg-primary-50 border border-primary-100 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-primary-900 mb-4 text-base",children:"The Planning Tool shows you:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"Whether your planned trip would be safe"]}),e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"The earliest safe date to start your trip"]}),e.jsxs("li",{className:"flex items-center gap-3 text-primary-800",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-white","aria-hidden":"true"})}),"Maximum safe trip length from any date"]})]})]}),!r&&e.jsx("p",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-100 p-3 rounded-xl text-center",children:"â­ Planning Tool is a premium feature"})]})},{icon:e.jsx(me,{className:"w-10 h-10 text-primary-600","aria-hidden":"true"}),title:"Stay Informed with Alerts",description:"Get notified before you approach the limit",details:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Enable email alerts to receive warnings when approaching your 90-day limit."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-yellow-50 border border-yellow-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-yellow-900",children:"60 days used"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Friendly reminder to plan ahead"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-orange-50 border border-orange-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-orange-900",children:"80 days used"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Warning to limit travel"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-red-50 border border-red-100 rounded-xl",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-red-900",children:"85+ days used"}),e.jsx("p",{className:"text-sm text-red-700",children:"Urgent alert to avoid overstay"})]})]})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Enable alerts in the Settings tab after completing this tour."})]})}],o=()=>{a<i.length-1?l(a+1):(ze(),t())},n=()=>{a>0&&l(a-1)},m=()=>{ze(),t()},c=i[a],x=a===i.length-1;return e.jsx(re,{isOpen:s,onClose:m,title:"",size:"lg",children:e.jsxs("div",{className:"px-4 py-6 sm:px-8 sm:py-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 bg-primary-50 rounded-2xl flex items-center justify-center",children:c.icon})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:c.title}),e.jsx("p",{className:"text-gray-500 text-lg",children:c.description})]}),e.jsx("div",{className:"mb-10 max-w-lg mx-auto",children:c.details}),e.jsx("div",{className:"flex justify-center gap-2.5 mb-8",children:i.map((N,f)=>e.jsx("button",{onClick:()=>l(f),className:g("h-2.5 rounded-full transition-all duration-300",f===a?"bg-primary-600 w-8":f<a?"bg-primary-300 w-2.5":"bg-gray-200 w-2.5"),"aria-label":`Go to step ${f+1}`},f))}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-100",children:[e.jsx("button",{onClick:m,className:"text-sm text-gray-400 hover:text-gray-600 transition-colors",children:"Skip tour"}),e.jsxs("div",{className:"flex items-center gap-3",children:[a>0&&e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-1.5 px-5 py-2.5 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx($e,{className:"w-4 h-4","aria-hidden":"true"}),"Back"]}),e.jsx("button",{onClick:o,className:"inline-flex items-center gap-1.5 px-6 py-2.5 bg-primary-600 text-white rounded-lg font-medium text-sm hover:bg-primary-700 transition-colors shadow-sm",children:x?e.jsxs(e.Fragment,{children:["Get Started",e.jsx(Z,{className:"w-4 h-4","aria-hidden":"true"})]}):e.jsxs(e.Fragment,{children:["Next",e.jsx(He,{className:"w-4 h-4","aria-hidden":"true"})]})})]})]})]})})}function Ot({className:s}){const{data:t,isLoading:r}=ks(),{data:a,isLoading:l}=Oe(),{data:i,isLoading:o}=Cs(),n=Ts(),m=Ds(),[c,x]=u.useState(!1),[N,f]=u.useState("all"),v=r||l||o,j=new Set((a==null?void 0:a.map(w=>w.code))||[]),y=(t==null?void 0:t.filter(w=>!j.has(w.code)))||[],h=(N==="all"?y:y.filter(w=>w.type===N)).reduce((w,k)=>{const b=k.type;return w[b]||(w[b]=[]),w[b].push(k),w},{}),S=async w=>{try{await n.mutateAsync(w)}catch(k){console.error("Failed to add jurisdiction:",k)}},C=async w=>{try{await m.mutateAsync(w)}catch(k){console.error("Failed to remove jurisdiction:",k)}};return v?e.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3",role:"status","aria-label":"Loading"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading jurisdictions..."})]})}):e.jsxs("div",{className:g("space-y-6",s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(q,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Jurisdiction Tracking"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Track multiple visa and residency rules"})]})]}),e.jsxs("button",{type:"button",onClick:()=>x(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(ce,{className:"w-4 h-4","aria-hidden":"true"}),"Add Jurisdiction"]})]}),a&&a.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(w=>{const k=i==null?void 0:i[w.code];return e.jsx(_t,{jurisdiction:w,summary:k,onRemove:()=>C(w.code),isRemoving:m.isPending},w.code)})}):e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(q,{className:"w-12 h-12 text-gray-300 mx-auto mb-3","aria-hidden":"true"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Jurisdictions Tracked"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add jurisdictions to track your visa and residency compliance across multiple countries."}),e.jsxs("button",{type:"button",onClick:()=>x(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors",children:[e.jsx(ce,{className:"w-4 h-4","aria-hidden":"true"}),"Add Your First Jurisdiction"]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Jurisdiction"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:e.jsx(V,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:["all","zone","country","state"].map(w=>e.jsx("button",{type:"button",onClick:()=>f(w),className:g("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",N===w?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:w==="all"?"All":w==="zone"?"Zones":w==="country"?"Countries":"States"},w))})}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[50vh]",children:Object.keys(h).length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No jurisdictions available to add."}):e.jsx("div",{className:"space-y-4",children:Object.entries(h).map(([w,k])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-2",children:w==="zone"?"Visa Zones":w==="country"?"Country Rules":"State Rules"}),e.jsx("div",{className:"space-y-2",children:k.map(b=>e.jsxs("button",{type:"button",onClick:D=>{D.preventDefault(),S(b.code),x(!1)},disabled:n.isPending,className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors text-left",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:b.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[b.daysAllowed," days / ",b.windowDays," day window"]}),b.description&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:b.description})]}),e.jsx(ce,{className:"w-5 h-5 text-primary-600 flex-shrink-0","aria-hidden":"true"})]},b.code))})]},w))})})]})})]})}function _t({jurisdiction:s,summary:t,onRemove:r,isRemoving:a}){const[l,i]=u.useState(!1),n=(f=>{switch(f){case"warning":return"warning";case"danger":return"danger";case"critical":case"violation":return"critical";default:return"safe"}})(t==null?void 0:t.status),m=(t==null?void 0:t.daysUsed)??0,c=(t==null?void 0:t.daysRemaining)??s.daysAllowed,x=(t==null?void 0:t.percentage)??0,N=f=>new Date(f).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:g("card p-4 border-l-4",n==="safe"&&"border-l-green-500",n==="warning"&&"border-l-yellow-500",n==="danger"&&"border-l-orange-500",n==="critical"&&"border-l-red-500"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.type==="zone"?"Visa Zone":s.type==="country"?"Country Rule":"State Tax"})]}),e.jsx("button",{type:"button",onClick:r,disabled:a,className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors","aria-label":`Remove ${s.name}`,children:a?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx(qe,{daysUsed:m,daysRemaining:c,status:n,size:"sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[m," / ",s.daysAllowed," days"]}),e.jsx(Ke,{status:n,size:"sm"})]}),e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:g("h-full rounded-full transition-all duration-500",n==="safe"&&"bg-green-500",n==="warning"&&"bg-yellow-500",n==="danger"&&"bg-orange-500",n==="critical"&&"bg-red-500"),style:{width:`${Math.min(x,100)}%`}})})]})]}),e.jsxs("button",{type:"button",onClick:()=>i(!l),className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 transition-colors",children:[e.jsx(Ee,{className:g("w-4 h-4 transition-transform",l&&"rotate-180"),"aria-hidden":"true"}),l?"Hide details":"Show details"]}),l&&t&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(F,{className:"w-3.5 h-3.5","aria-hidden":"true"}),e.jsxs("span",{children:["Window: ",N(t.windowStart)," - ",N(t.windowEnd)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(le,{className:"w-3.5 h-3.5","aria-hidden":"true"}),e.jsxs("span",{children:["Counting: ",t.countingMethod==="rolling"?"Rolling Window":t.countingMethod==="calendar_year"?"Calendar Year":"Fiscal Year"]})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:s.description})]})]})}function $t({className:s}){const[t,r]=u.useState(!1),a=u.useRef(null),{data:l,isLoading:i}=Es(),{data:o}=Ms(),n=Ls(),m=Ps(),c=Is(),x=(o==null?void 0:o.count)??0;u.useEffect(()=>{function d(h){a.current&&!a.current.contains(h.target)&&r(!1)}return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const N=d=>{d.isRead||n.mutate(d.id),d.actionUrl&&(window.location.href=d.actionUrl)},f=(d,h)=>{d.stopPropagation(),c.mutate(h)},v=()=>{m.mutate(void 0)},j=d=>{switch(d){case"threshold_warning":case"threshold_danger":return e.jsx(A,{className:"w-4 h-4 text-amber-500","aria-hidden":"true"});case"trip_reminder":case"calendar_sync":case"day_expiring":return e.jsx(F,{className:"w-4 h-4 text-primary-500","aria-hidden":"true"});case"location_checkin":return e.jsx($,{className:"w-4 h-4 text-purple-500","aria-hidden":"true"});default:return e.jsx(X,{className:"w-4 h-4 text-gray-500","aria-hidden":"true"})}},y=d=>{const h=new Date(d),C=new Date().getTime()-h.getTime(),w=Math.floor(C/6e4),k=Math.floor(C/36e5),b=Math.floor(C/864e5);return w<1?"Just now":w<60?`${w}m ago`:k<24?`${k}h ago`:b<7?`${b}d ago`:h.toLocaleDateString()};return e.jsxs("div",{ref:a,className:g("relative",s),children:[e.jsxs("button",{type:"button",onClick:()=>r(!t),className:g("relative p-2 rounded-lg transition-colors",t?"bg-primary-100 text-primary-600":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),"aria-label":`Notifications${x>0?` (${x} unread)`:""}`,"aria-expanded":t,"aria-haspopup":"true",children:[e.jsx(me,{className:"w-5 h-5","aria-hidden":"true"}),x>0&&e.jsx("span",{className:"absolute top-0 right-0 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full transform translate-x-1/4 -translate-y-1/4",children:x>99?"99+":x})]}),t&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 sm:w-96 bg-white rounded-xl shadow-lg border border-gray-200 z-50 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[x>0&&e.jsxs("button",{type:"button",onClick:v,disabled:m.isPending,className:"text-xs text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1",children:[m.isPending?e.jsx(L,{className:"w-3 h-3 animate-spin","aria-hidden":"true"}):e.jsx(Js,{className:"w-3 h-3","aria-hidden":"true"}),"Mark all read"]}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"p-1 text-gray-400 hover:text-gray-600 rounded","aria-label":"Close notifications",children:e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"})})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:i?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"})}):l&&l.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:l.map(d=>e.jsx("div",{className:g("px-4 py-3 cursor-pointer transition-colors hover:bg-gray-50",!d.isRead&&"bg-primary-50"),onClick:()=>N(d),role:"button",tabIndex:0,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&N(d)},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:j(d.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:g("text-sm font-medium truncate",d.isRead?"text-gray-900":"text-primary-900"),children:d.title}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[!d.isRead&&e.jsx("span",{className:"w-2 h-2 bg-primary-500 rounded-full",title:"Unread"}),e.jsx("button",{type:"button",onClick:h=>f(h,d.id),disabled:c.isPending,className:"p-1 text-gray-400 hover:text-red-600 rounded opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Delete notification",children:e.jsx(ge,{className:"w-3 h-3","aria-hidden":"true"})})]})]}),d.body&&e.jsx("p",{className:"text-sm text-gray-600 mt-0.5 line-clamp-2",children:d.body}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:y(d.createdAt)})]})]})},d.id))}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(me,{className:"w-8 h-8 text-gray-300 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No notifications"})]})}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-gray-50",children:e.jsxs("a",{href:"/member-portal/schengen?tab=settings",className:"flex items-center justify-center gap-1 text-xs text-gray-500 hover:text-gray-700",children:[e.jsx(ke,{className:"w-3 h-3","aria-hidden":"true"}),"Notification settings"]})})]})]})}function Ht({className:s}){const[t,r]=u.useState(null),[a,l]=u.useState(""),[i,o]=u.useState(!0),[n,m]=u.useState(null),c=u.useRef(null),x=As(),N=Fs(),f=async h=>{var w;const S=(w=h.target.files)==null?void 0:w[0];if(!S)return;const C=new FileReader;C.onload=k=>{var D;const b=(D=k.target)==null?void 0:D.result;l(b),r("file")},C.readAsText(S)},v=async()=>{if(a.trim())try{const h=await x.mutateAsync({csv:a,skipDuplicates:i});m(h)}catch{}},j=async()=>{try{const h=await N.mutateAsync(),S=new Blob([h.csv],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(S),w=document.createElement("a");w.href=C,w.download=h.filename,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(C)}catch{}},y=()=>{r(null),l(""),m(null),c.current&&(c.current.value="")};return e.jsxs("div",{className:g("space-y-6",s),children:[e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),"Export Trips"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Download all your trips as a CSV file for backup or editing."})]}),e.jsxs("button",{type:"button",onClick:j,disabled:N.isPending,className:"btn-primary flex items-center gap-2",children:[N.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(Se,{className:"w-4 h-4","aria-hidden":"true"}),"Export CSV"]})]})}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2 mb-4",children:[e.jsx(oe,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),"Import Trips"]}),n&&e.jsxs("div",{className:g("mb-4 p-4 rounded-lg flex items-start gap-3",n.imported>0?"bg-green-50":"bg-yellow-50"),children:[n.imported>0?e.jsx(Hs,{className:"w-5 h-5 text-green-600 flex-shrink-0","aria-hidden":"true"}):e.jsx(ie,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:g("font-medium",n.imported>0?"text-green-800":"text-yellow-800"),children:n.message}),n.errors.length>0&&e.jsx("ul",{className:"mt-2 text-sm text-gray-600 space-y-1",children:n.errors.map((h,S)=>e.jsx("li",{children:h},S))})]}),e.jsx("button",{type:"button",onClick:y,className:"p-1 text-gray-400 hover:text-gray-600","aria-label":"Dismiss",children:e.jsx(V,{className:"w-4 h-4","aria-hidden":"true"})})]}),!t&&!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>{var h;return(h=c.current)==null?void 0:h.click()},className:"p-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-400 hover:bg-primary-50 transition-colors text-center",children:[e.jsx(Ws,{className:"w-8 h-8 text-gray-400 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"font-medium text-gray-700",children:"Upload CSV File"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Drag & drop or click to browse"})]}),e.jsxs("button",{type:"button",onClick:()=>r("paste"),className:"p-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-400 hover:bg-primary-50 transition-colors text-center",children:[e.jsx(oe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"font-medium text-gray-700",children:"Paste CSV Data"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Copy & paste your CSV content"})]})]}),e.jsx("input",{ref:c,type:"file",accept:".csv,text/csv",onChange:f,className:"hidden"})]}),t&&!n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"csv-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"CSV Data"}),e.jsx("textarea",{id:"csv-input",value:a,onChange:h=>l(h.target.value),rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:`start_date,end_date,country,category,notes
2024-01-15,2024-01-20,France,personal,My trip`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"skip-duplicates",checked:i,onChange:h=>o(h.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"skip-duplicates",className:"text-sm text-gray-700",children:"Skip duplicate trips (same dates and country)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:v,disabled:x.isPending||!a.trim(),className:"btn-primary flex items-center gap-2",children:[x.isPending?e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):e.jsx(oe,{className:"w-4 h-4","aria-hidden":"true"}),"Import Trips"]}),e.jsx("button",{type:"button",onClick:y,className:"btn-secondary",children:"Cancel"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"CSV Format Requirements:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"start_date"}),": Trip start date (YYYY-MM-DD format, required)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"end_date"}),": Trip end date (YYYY-MM-DD format, required)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"country"}),": Schengen country name (required)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"category"}),': "personal" or "business" (optional, defaults to personal)']}),e.jsxs("li",{children:[e.jsx("strong",{children:"notes"}),": Trip notes (optional)"]})]}),e.jsx("p",{className:"mt-3 font-medium text-gray-700",children:"Sample CSV:"}),e.jsx("pre",{className:"mt-1 p-2 bg-white rounded border text-xs overflow-x-auto",children:`start_date,end_date,country,category,notes
2024-01-15,2024-01-20,France,personal,Winter vacation in Paris
2024-03-01,2024-03-05,Germany,business,Berlin conference
2024-06-10,2024-06-18,Italy,personal,Summer trip to Rome`})]})]})})]})]})}const Wt={high:{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:"text-red-600"},medium:{bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-800",icon:"text-amber-600"},low:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:"text-blue-600"},info:{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-800",icon:"text-gray-600"}};function Vt(s,t){return{calendar:e.jsx(F,{className:t,"aria-hidden":"true"}),clock:e.jsx(le,{className:t,"aria-hidden":"true"}),sparkles:e.jsx(Ve,{className:t,"aria-hidden":"true"}),"trending-up":e.jsx(Qs,{className:t,"aria-hidden":"true"}),"shield-alert":e.jsx(Vs,{className:t,"aria-hidden":"true"}),"alert-triangle":e.jsx(A,{className:t,"aria-hidden":"true"})}[s]||e.jsx(Ge,{className:t,"aria-hidden":"true"})}function Yt({suggestion:s,compact:t=!1}){const r=Wt[s.priority];return e.jsx("div",{className:g("rounded-lg border p-4 transition-all hover:shadow-sm",r.bg,r.border,t&&"p-3"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:g("flex-shrink-0 mt-0.5",r.icon),children:Vt(s.icon,"w-5 h-5")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:g("font-medium",r.text,t?"text-sm":"text-base"),children:s.title}),e.jsx("p",{className:g("mt-1 text-gray-600",t?"text-xs":"text-sm"),children:s.message})]})]})})}function Gt({className:s,compact:t=!1}){const{data:r,isLoading:a,isError:l,refetch:i,isFetching:o}=Rs();if(a)return e.jsx("div",{className:g("card p-6",s),children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(L,{className:"w-6 h-6 text-primary-600 animate-spin","aria-hidden":"true"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Analyzing your travel data..."})]})});if(l||!r)return e.jsx("div",{className:g("card p-6",s),children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-gray-500",children:"Unable to load suggestions"}),e.jsx("button",{onClick:()=>i(),className:"mt-2 text-primary-600 hover:text-primary-700 text-sm font-medium",children:"Try again"})]})});const{suggestions:n}=r,m={high:0,medium:1,low:2,info:3},c=[...n].sort((x,N)=>m[x.priority]-m[N.priority]);return e.jsxs("div",{className:g("card",s),children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Ve,{className:"w-5 h-5 text-purple-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Smart Suggestions"}),e.jsx("p",{className:"text-sm text-gray-500",children:"AI-powered insights for your travel planning"})]})]}),e.jsx("button",{onClick:()=>i(),disabled:o,className:g("p-2 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",o&&"animate-spin"),"aria-label":"Refresh suggestions",children:e.jsx(De,{className:"w-4 h-4","aria-hidden":"true"})})]})}),e.jsx("div",{className:g("p-6 space-y-3",t&&"p-4 space-y-2"),children:c.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Ge,{className:"w-10 h-10 text-gray-300 mx-auto mb-2","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-500",children:"No suggestions available"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add more trips to get personalized recommendations"})]}):c.map((x,N)=>e.jsx(Yt,{suggestion:x,compact:t},`${x.type}-${N}`))})]})}function ca(){const{trips:s,settings:t,isLoaded:r,addTrip:a,updateTrip:l,deleteTrip:i,updateSettings:o}=st(),{data:n,isLoading:m}=zs(),c=Us(),[x,N]=u.useState(!1),[f,v]=u.useState(null),[j,y]=u.useState("trips"),[d,h]=u.useState(null),[S,C]=u.useState(null),[w,k]=u.useState(!1);u.useEffect(()=>{r&&!zt()&&k(!0)},[r]);const b=u.useMemo(()=>nt(s,{yellow:t.yellowThreshold,red:t.redThreshold}),[s,t.yellowThreshold,t.redThreshold]),D=async P=>{C(null);try{await a(P),N(!1)}catch(I){const T=I instanceof Error?I.message:"Failed to add trip";C(T),console.error("Failed to add trip:",I)}},E=async P=>{if(f){C(null);try{await l(f.id,P),v(null)}catch(I){const T=I instanceof Error?I.message:"Failed to update trip";C(T),console.error("Failed to update trip:",I)}}},H=async P=>{C(null);try{await i(P)}catch(I){const T=I instanceof Error?I.message:"Failed to delete trip";C(T),console.error("Failed to delete trip:",I)}},K=P=>{v(P)},U=()=>{N(!1),v(null)},G=(n==null?void 0:n.canAddTrip)??!0,R=(n==null?void 0:n.isPremium)??!0;return!r||m?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto mb-3",role:"status","aria-label":"Loading"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Schengen Tracker"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track your 90/180 day Schengen zone compliance"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($t,{}),e.jsx("button",{type:"button",onClick:()=>k(!0),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Show help tour",title:"Show help tour",children:e.jsx(Os,{className:"w-5 h-5","aria-hidden":"true"})}),R&&e.jsx(kt,{}),e.jsxs("button",{onClick:()=>N(!0),disabled:!G,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors",G?"bg-primary-600 text-white hover:bg-primary-700":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[e.jsx(ce,{className:"w-5 h-5","aria-hidden":"true"}),"Add Trip"]})]})]}),!R&&n&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-5 h-5 text-amber-600","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-amber-800",children:["Free Plan: ",n.tripCount," of ",n.tripLimit," trips used"]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Upgrade to Premium for unlimited trips, planning tools, and PDF reports"})]})]}),n.upgradeUrl&&e.jsxs("a",{href:n.upgradeUrl,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4","aria-hidden":"true"}),"Upgrade"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card p-6 flex flex-col items-center justify-center",children:[e.jsx(qe,{daysUsed:b.daysUsed,daysRemaining:b.daysRemaining,status:b.status,size:"lg"}),e.jsx("div",{className:"mt-4",children:e.jsx(Ke,{status:b.status,size:"lg"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:g("card p-4 border-l-4",b.status==="safe"&&"border-l-green-500",b.status==="warning"&&"border-l-yellow-500",b.status==="danger"&&"border-l-orange-500",b.status==="critical"&&"border-l-red-500"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(le,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Days Remaining"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.daysRemaining})]})]})}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-gray-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current 180-Day Window"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[Q(b.windowStart)," - ",Q(b.windowEnd)]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[b.nextExpiration&&e.jsx("div",{className:"card p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Next Day Expires"}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:Q(b.nextExpiration)}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"A day will drop off the 180-day window"})]})]})}),e.jsx("div",{className:"card p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"The 90/180 Rule"}),e.jsx("p",{children:"Non-EU citizens may stay up to 90 days within any 180-day period in the Schengen area without a visa."})]})]})})]})]}),e.jsx(Rt,{enabled:!0}),e.jsx(Ie,{compact:!0}),b.status==="warning"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(A,{className:"w-5 h-5 text-yellow-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-medium",children:"Approaching limit:"})," You have used ",b.daysUsed," of your 90 days. Plan future travel carefully to avoid overstaying."]})]}),b.status==="danger"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(A,{className:"w-5 h-5 text-orange-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("span",{className:"font-medium",children:"Warning:"})," You have used ",b.daysUsed," of your 90 days. Limited travel remaining in this window."]})]}),b.status==="critical"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("span",{className:"font-medium",children:"Limit reached:"})," You have used all 90 days allowed in this 180-day window. Additional travel may result in overstay violations."]})]}),S&&e.jsxs("div",{className:"flex items-center justify-between gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:S})]}),e.jsx("button",{onClick:()=>C(null),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Dismiss"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-6","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>y("trips"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",j==="trips"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4","aria-hidden":"true"}),"Trip List"]})}),e.jsx("button",{onClick:()=>y("jurisdictions"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",j==="jurisdictions"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4","aria-hidden":"true"}),"Jurisdictions"]})}),e.jsx("button",{onClick:()=>y("calendar"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",j==="calendar"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar View",!R&&e.jsx(Le,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>y("sync"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",j==="sync"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4","aria-hidden":"true"}),"Calendar Sync"]})}),e.jsx("button",{onClick:()=>y("planning"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",j==="planning"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4","aria-hidden":"true"}),"Planning Tool",!R&&e.jsx(Le,{className:"w-3 h-3 text-gray-400","aria-hidden":"true"})]})}),e.jsx("button",{onClick:()=>y("location"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",j==="location"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4","aria-hidden":"true"}),"Location"]})}),e.jsx("button",{onClick:()=>y("settings"),className:g("pb-3 px-1 border-b-2 font-medium text-sm transition-colors",j==="settings"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4","aria-hidden":"true"}),"Settings"]})})]})}),j==="trips"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Your Trips"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.length," trip",s.length!==1?"s":""]})]}),e.jsx(ut,{trips:s,currentWindowStart:b.windowStart,onEdit:K,onDelete:H})]}),j==="jurisdictions"&&e.jsx("div",{className:"card p-6",children:e.jsx(Ot,{})}),j==="calendar"&&(R?e.jsx(jt,{trips:s,windowStart:b.windowStart,windowEnd:b.windowEnd}):e.jsx(Ue,{feature:"Calendar View",description:"Visualize your trips on an interactive calendar to better understand your travel patterns and plan future trips.",upgradeUrl:n==null?void 0:n.upgradeUrl})),j==="sync"&&e.jsx(_s,{children:e.jsx(Nt,{})}),j==="planning"&&(R?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Gt,{}),e.jsx("div",{className:"card p-6",children:e.jsx(gt,{})})]}):e.jsx(Ue,{feature:"Planning Tool",description:"Use the 'What If' calculator to check if a planned trip would violate the 90/180 rule before you book.",upgradeUrl:n==null?void 0:n.upgradeUrl})),j==="location"&&e.jsx(Ie,{}),j==="settings"&&e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(ke,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Tracker Settings"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure alerts and notification preferences"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(me,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Alerts"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive email notifications when approaching your 90-day limit"})]})]}),e.jsx("button",{onClick:()=>o({emailAlerts:!t.emailAlerts}),className:g("relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",t.emailAlerts?"bg-primary-600":"bg-gray-200"),role:"switch","aria-checked":t.emailAlerts,children:e.jsx("span",{className:g("pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",t.emailAlerts?"translate-x-5":"translate-x-0")})})]}),t.emailAlerts&&e.jsx("div",{className:"mt-4 ml-14 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Alert thresholds:"})," You will receive email alerts when you reach 60 days (warning), 80 days (danger), and 85 days (urgent)."]})}),t.emailAlerts&&e.jsxs("div",{className:"mt-4 ml-14",children:[e.jsx("button",{onClick:()=>{h(null),c.mutate(void 0,{onSuccess:P=>{h({type:P.success?"success":"error",text:P.message})},onError:P=>{h({type:"error",text:P instanceof Error?P.message:"Failed to send test alert"})}})},disabled:c.isPending,className:g("inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-colors",c.isPending?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"w-4 h-4","aria-hidden":"true"}),"Send Test Alert"]})}),d&&e.jsxs("div",{className:g("mt-3 p-3 rounded-lg flex items-center gap-2 text-sm",d.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:[d.type==="success"?e.jsx(W,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}):e.jsx(A,{className:"w-4 h-4 flex-shrink-0","aria-hidden":"true"}),d.text]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Warning Thresholds"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Warning Level"}),e.jsxs("p",{className:"text-lg font-bold text-yellow-900",children:[t.yellowThreshold," days"]}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Status turns yellow"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:"Danger Level"}),e.jsxs("p",{className:"text-lg font-bold text-orange-900",children:[t.redThreshold," days"]}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Status turns red"})]})]})]}),(n==null?void 0:n.isPremium)&&e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Data Import/Export"}),e.jsx(Ht,{})]})]}),e.jsx(re,{isOpen:x,onClose:U,title:"Add Trip",size:"md",children:e.jsx(Pe,{existingTrips:s,onSubmit:D,onCancel:U})}),e.jsx(re,{isOpen:!!f,onClose:U,title:"Edit Trip",size:"md",children:f&&e.jsx(Pe,{trip:f,existingTrips:s,onSubmit:E,onCancel:U})}),e.jsx(Ut,{isOpen:w,onComplete:()=>k(!1),isPremium:R})]})}function Ue({feature:s,description:t,upgradeUrl:r}){return e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(xe,{className:"w-8 h-8 text-amber-600","aria-hidden":"true"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[s," is a Premium Feature"]}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:t}),r&&e.jsxs("a",{href:r,className:"inline-flex items-center gap-2 px-6 py-3 bg-amber-600 text-white rounded-lg font-medium hover:bg-amber-700 transition-colors",children:[e.jsx(xe,{className:"w-5 h-5","aria-hidden":"true"}),"Upgrade to Premium"]})]})}export{ca as default};
