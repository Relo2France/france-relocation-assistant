import{j as e}from"./vendor-query-D8MH73Ff.js";import{r as m}from"./vendor-react-F9Y4d3HK.js";import{c as B,S as J,X as U,P as E,C as F,a as $,A as K,b as O,u as Q,d as Z,e as ee,f as te,g as se,h as ae,i as X,j as re,D as le,U as q,F as ne,M as ie,k as oe,l as ce,m as de,n as xe,o as me}from"./main-BfkksPvL.js";import{a as v}from"./vendor-utils-C5RVuWu4.js";import{L as ue,a as he,u as ge,V as pe,T as je}from"./useVirtualization-CGSKFMOt.js";import{F as fe}from"./filter-BrKE5oyf.js";import{C as M}from"./circle-Cqym-NTc.js";import{M as be}from"./more-vertical-DW8-5GAw.js";import{G as ye}from"./grip-vertical-M_CMpr0J.js";import{L as G}from"./loader-2-DJIL5QpT.js";import{F as ve}from"./flag-Vquhc6-v.js";import{T as Ne}from"./trash-2-C8YYuvUG.js";import"./vendor-virtual-Bs6oCvg1.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=B("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function we({view:t,onViewChange:s,searchQuery:l,onSearchChange:n,filters:a,onFilterChange:x,onClearFilters:g,stages:i,onAddTask:o,totalTasks:h,filteredTasks:y}){const p=a.stage||a.status||a.taskType||l;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex rounded-lg bg-gray-100 p-1",children:[e.jsxs("button",{onClick:()=>s("list"),className:v("px-3 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-1.5",t==="list"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(ue,{className:"w-4 h-4"}),"List"]}),e.jsxs("button",{onClick:()=>s("board"),className:v("px-3 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-1.5",t==="board"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(he,{className:"w-4 h-4"}),"Board"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:l,onChange:u=>n(u.target.value),placeholder:"Search tasks...",className:"pl-9 pr-4 py-2 bg-gray-100 border-0 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 w-64"}),l&&e.jsx("button",{onClick:()=>n(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(U,{className:"w-4 h-4"})})]})]}),e.jsxs("button",{onClick:o,className:"btn btn-primary",children:[e.jsx(E,{className:"w-4 h-4"}),"Add Task"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:a.stage||"",onChange:u=>x({stage:u.target.value||null}),className:"select w-auto text-sm py-1.5",children:[e.jsx("option",{value:"",children:"All Stages"}),i.map(u=>e.jsx("option",{value:u.slug,children:u.title},u.slug))]}),e.jsxs("select",{value:a.status||"",onChange:u=>x({status:u.target.value||null}),className:"select w-auto text-sm py-1.5",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"todo",children:"To Do"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"waiting",children:"Waiting"}),e.jsx("option",{value:"done",children:"Done"})]}),e.jsxs("select",{value:a.taskType||"",onChange:u=>x({taskType:u.target.value||null}),className:"select w-auto text-sm py-1.5",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"client",children:"Client"}),e.jsx("option",{value:"team",children:"Team"})]}),p&&e.jsxs("button",{onClick:g,className:"text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),"Clear filters"]}),e.jsx("span",{className:"text-sm text-gray-500 ml-auto",children:y===h?`${h} tasks`:`${y} of ${h} tasks`})]})]})}const De={todo:{icon:M,color:"text-gray-400",bgColor:"bg-gray-100"},in_progress:{icon:$,color:"text-blue-500",bgColor:"bg-blue-100"},waiting:{icon:$,color:"text-yellow-500",bgColor:"bg-yellow-100"},done:{icon:F,color:"text-green-500",bgColor:"bg-green-100"}};function Ce({tasks:t,groupBy:s="none",onTaskClick:l,onStatusChange:n,onAddTask:a}){const x=ge(t.length,30);if(s==="none")return t.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No tasks found"})]}):x?e.jsx(pe,{items:t,estimateSize:72,className:"max-h-[calc(100vh-200px)]",getItemKey:i=>i.id,renderItem:i=>e.jsx("div",{className:"pb-2",children:e.jsx(R,{task:i,onClick:()=>l==null?void 0:l(i),onStatusChange:n})})}):e.jsx("div",{className:"space-y-2",children:t.map(i=>e.jsx(R,{task:i,onClick:()=>l==null?void 0:l(i),onStatusChange:n},i.id))});const g=_e(t,s);return e.jsx("div",{className:"space-y-6",children:Object.entries(g).map(([i,o])=>e.jsx(Te,{title:ke(i,s),tasks:o,groupKey:i,onTaskClick:l,onStatusChange:n,onAddTask:a},i))})}function Te({title:t,tasks:s,groupKey:l,onTaskClick:n,onStatusChange:a,onAddTask:x}){const g=s.filter(i=>i.status==="done").length;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t}),e.jsxs("span",{className:"text-sm text-gray-500",children:[g,"/",s.length," completed"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"badge badge-gray",children:s.length}),x&&e.jsxs("button",{onClick:()=>x(l),className:"btn btn-ghost btn-sm",children:[e.jsx(E,{className:"w-4 h-4"}),"Add Task"]})]})]}),e.jsxs("div",{className:"divide-y divide-gray-100",children:[s.map(i=>e.jsx(R,{task:i,onClick:()=>n==null?void 0:n(i),onStatusChange:a,compact:!0},i.id)),s.length===0&&e.jsx("div",{className:"p-6 text-center text-gray-500",children:e.jsx("p",{children:"No tasks in this section"})})]})]})}function R({task:t,onClick:s,onStatusChange:l,compact:n}){const a=De[t.status],x=a.icon,g=o=>{if(o.stopPropagation(),!l)return;const h=["todo","in_progress","waiting","done"],y=h.indexOf(t.status),p=h[(y+1)%h.length];l(t.id,p)},i=o=>{s&&(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),s())};return e.jsxs("div",{onClick:s,onKeyDown:i,role:s?"button":void 0,tabIndex:s?0:void 0,className:v("flex items-center gap-4 transition-colors",n?"px-6 py-3":"p-4 rounded-lg border border-gray-200",t.is_overdue&&!n&&"border-red-200 bg-red-50",s&&"cursor-pointer hover:bg-gray-50"),children:[e.jsx("button",{onClick:g,className:v("flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center transition-colors",a.bgColor,"hover:opacity-80"),title:`Status: ${t.status_label}`,children:e.jsx(x,{className:v("w-4 h-4",a.color)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:v("font-medium truncate",t.status==="done"?"text-gray-400 line-through":"text-gray-900"),children:t.title}),t.is_overdue&&e.jsx(K,{className:"w-4 h-4 text-red-500 flex-shrink-0"})]}),t.description&&!n&&e.jsx("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsx(Se,{priority:t.priority}),t.task_type==="team"&&e.jsx("span",{className:"badge badge-blue text-xs",children:"Team"}),t.due_date&&e.jsxs("span",{className:v("flex items-center gap-1 text-xs",t.is_overdue?"text-red-600":"text-gray-500"),children:[e.jsx(O,{className:"w-3 h-3"}),Ie(t.due_date)]}),e.jsx("button",{onClick:o=>o.stopPropagation(),className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e.jsx(be,{className:"w-4 h-4"})})]})]})}function Se({priority:t}){const s={low:"bg-gray-100 text-gray-600",medium:"bg-blue-100 text-blue-700",high:"bg-yellow-100 text-yellow-700",urgent:"bg-red-100 text-red-700"};return e.jsx("span",{className:v("badge text-xs",s[t]||s.medium),children:t})}function _e(t,s){return t.reduce((l,n)=>{const a=s==="stage"?n.stage||"unassigned":n.status;return l[a]||(l[a]=[]),l[a].push(n),l},{})}function ke(t,s){return s==="status"?{todo:"To Do",in_progress:"In Progress",waiting:"Waiting",done:"Done"}[t]||t:t==="unassigned"?"Unassigned":t.split("_").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" ")}function Ie(t){const s=new Date(t),l=new Date,n=new Date(l);return n.setDate(n.getDate()+1),s.toDateString()===l.toDateString()?"Today":s.toDateString()===n.toDateString()?"Tomorrow":s.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const A=[{id:"todo",title:"To Do",icon:M,color:"text-gray-500",bgColor:"bg-gray-50",borderColor:"border-gray-200"},{id:"in_progress",title:"In Progress",icon:$,color:"text-blue-500",bgColor:"bg-blue-50",borderColor:"border-blue-200"},{id:"waiting",title:"Waiting",icon:$,color:"text-yellow-500",bgColor:"bg-yellow-50",borderColor:"border-yellow-200"},{id:"done",title:"Done",icon:F,color:"text-green-500",bgColor:"bg-green-50",borderColor:"border-green-200"}];function Pe({tasks:t,onTaskClick:s,onStatusChange:l,onAddTask:n}){const[a,x]=m.useState(null),[g,i]=m.useState(null),[o,h]=m.useState(null),[y,p]=m.useState(""),u=m.useRef(null),b=A.reduce((c,d)=>(c[d.id]=t.filter(P=>P.status===d.id),c),{}),j=m.useCallback(c=>{p(c),setTimeout(()=>p(""),100)},[]),N=c=>{x(c),j(`Picked up task: ${c.title}`)},C=()=>{a&&j(`Dropped task: ${a.title}`),x(null),i(null)},D=(c,d)=>{c.preventDefault(),i(d)},f=c=>{var d;if(a&&a.status!==c){const P=((d=A.find(I=>I.id===c))==null?void 0:d.title)||c;j(`Moved ${a.title} to ${P}`),l==null||l(a.id,c)}x(null),i(null)},T=c=>{h(c),j(`Picked up task: ${c.title}. Use left and right arrow keys to move between columns, then press Space or Enter to drop.`)},S=c=>{var d;if(o&&o.status!==c){const P=((d=A.find(I=>I.id===c))==null?void 0:d.title)||c;j(`Moved ${o.title} to ${P}`),l==null||l(o.id,c)}else o&&j(`Cancelled. ${o.title} stays in current column.`);h(null)},r=()=>{o&&(j(`Cancelled moving ${o.title}`),h(null))},k=c=>{if(!o)return;const d=A.findIndex(I=>I.id===o.status),P=c==="left"?Math.max(0,d-1):Math.min(A.length-1,d+1);if(P!==d){const I=A[P];j(`Over ${I.title} column. Press Space or Enter to drop here.`),i(I.id)}};return e.jsxs("div",{children:[e.jsx("div",{ref:u,className:"sr-only",role:"status","aria-live":"assertive","aria-atomic":"true",children:y}),o&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800",role:"status",children:[e.jsxs("strong",{children:["Moving: ",o.title]}),e.jsx("span",{className:"ml-2",children:"Use ← → to select column, Space/Enter to drop, Escape to cancel"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",role:"region","aria-label":"Task board",children:A.map(c=>e.jsx(Ae,{column:c,tasks:b[c.id],isDragOver:g===c.id,isKeyboardDragging:!!o,keyboardDragTask:o,onTaskClick:s,onDragStart:N,onDragEnd:C,onDragOver:d=>D(d,c.id),onDrop:()=>f(c.id),onAddTask:()=>n==null?void 0:n(c.id),onKeyboardPickUp:T,onKeyboardDrop:()=>S(c.id),onKeyboardCancel:r,onKeyboardMoveColumn:k},c.id))})]})}function Ae({column:t,tasks:s,isDragOver:l,isKeyboardDragging:n,keyboardDragTask:a,onTaskClick:x,onDragStart:g,onDragEnd:i,onDragOver:o,onDrop:h,onAddTask:y,onKeyboardPickUp:p,onKeyboardDrop:u,onKeyboardCancel:b,onKeyboardMoveColumn:j}){const N=t.icon,C=l&&(a==null?void 0:a.status)!==t.id,D=f=>{if(n)switch(f.key){case"ArrowLeft":f.preventDefault(),j("left");break;case"ArrowRight":f.preventDefault(),j("right");break;case" ":case"Enter":f.preventDefault(),l&&u();break;case"Escape":f.preventDefault(),b();break}};return e.jsxs("div",{className:v("flex-shrink-0 w-80 rounded-xl transition-colors",t.bgColor,C&&"ring-2 ring-primary-500"),onDragOver:o,onDrop:h,onKeyDown:D,role:"listbox",tabIndex:0,"aria-label":`${t.title} column, ${s.length} tasks`,"aria-dropeffect":n?"move":void 0,children:[e.jsx("div",{className:v("p-4 border-b",t.borderColor),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:v("w-5 h-5",t.color),"aria-hidden":"true"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:t.title}),e.jsx("span",{className:"text-sm text-gray-500 bg-white px-2 py-0.5 rounded-full",children:s.length})]}),e.jsx("button",{onClick:y,className:"p-1 text-gray-400 hover:text-gray-600 hover:bg-white rounded transition-colors","aria-label":`Add task to ${t.title}`,children:e.jsx(E,{className:"w-5 h-5","aria-hidden":"true"})})]})}),e.jsxs("div",{className:"p-3 space-y-3 min-h-[200px]",children:[s.map((f,T)=>e.jsx(Le,{task:f,index:T,totalTasks:s.length,columnTitle:t.title,isBeingDragged:(a==null?void 0:a.id)===f.id,onClick:()=>x==null?void 0:x(f),onDragStart:()=>g(f),onDragEnd:i,onKeyboardPickUp:()=>p(f),onKeyboardDrop:u,onKeyboardCancel:b,onKeyboardMoveColumn:j},f.id)),s.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-400 text-sm",children:[e.jsx("p",{children:"No tasks"}),e.jsx("button",{onClick:y,className:"mt-2 text-primary-600 hover:text-primary-700",children:"+ Add a task"})]})]})]})}function Le({task:t,index:s,totalTasks:l,columnTitle:n,isBeingDragged:a,onClick:x,onDragStart:g,onDragEnd:i,onKeyboardPickUp:o,onKeyboardDrop:h,onKeyboardCancel:y,onKeyboardMoveColumn:p}){const u=b=>{switch(b.key){case" ":b.preventDefault(),a?h():o();break;case"Enter":b.preventDefault(),a?h():x==null||x();break;case"Escape":a&&(b.preventDefault(),y());break;case"ArrowLeft":a&&(b.preventDefault(),p("left"));break;case"ArrowRight":a&&(b.preventDefault(),p("right"));break}};return e.jsxs("div",{draggable:!0,tabIndex:0,role:"option","aria-selected":a,"aria-grabbed":a,"aria-label":`${t.title}${t.is_overdue?", overdue":""}, priority ${t.priority}${t.due_date?`, due ${Y(t.due_date)}`:""}`,"aria-describedby":"drag-instructions","aria-setsize":l,"aria-posinset":s+1,onDragStart:g,onDragEnd:i,onClick:x,onKeyDown:u,className:v("bg-white rounded-lg border p-3 cursor-pointer transition-all focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",t.is_overdue?"border-red-200":"border-gray-200",a&&"opacity-50 ring-2 ring-primary-500",!a&&"hover:shadow-md"),children:[e.jsx("span",{id:"drag-instructions",className:"sr-only",children:"Press Space to pick up and move this task, or Enter to open task details"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-300 flex-shrink-0 mt-0.5 cursor-grab","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:v("font-medium text-sm",t.status==="done"?"text-gray-400 line-through":"text-gray-900"),children:t.title}),t.is_overdue&&e.jsx(K,{className:"w-3.5 h-3.5 text-red-500 flex-shrink-0","aria-hidden":"true"})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[e.jsx($e,{priority:t.priority}),t.task_type==="team"&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded",children:"Team"}),t.due_date&&e.jsxs("span",{className:v("flex items-center gap-1 text-xs",t.is_overdue?"text-red-600":"text-gray-500"),children:[e.jsx(O,{className:"w-3 h-3","aria-hidden":"true"}),Y(t.due_date)]}),t.stage&&e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:t.stage.replace("_"," ")})]})]})]})]})}function $e({priority:t}){const s={low:"bg-gray-400",medium:"bg-blue-500",high:"bg-yellow-500",urgent:"bg-red-500"};return e.jsx("span",{className:v("w-2 h-2 rounded-full",s[t]||s.medium),title:`Priority: ${t}`,"aria-label":`Priority: ${t}`})}function Y(t){const s=new Date(t),l=new Date,n=Math.ceil((s.getTime()-l.getTime())/(1e3*60*60*24));return n===0?"Today":n===1?"Tomorrow":n===-1?"Yesterday":n<-1?`${Math.abs(n)}d ago`:n<=7?`${n}d`:s.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Ee({taskId:t,editable:s=!0}){const[l,n]=m.useState(""),[a,x]=m.useState(!1),[g,i]=m.useState(null),o=m.useRef(null),{data:h,isLoading:y}=Q(t);m.useEffect(()=>{a&&o.current&&o.current.focus()},[a]);const p=Z(t),u=ee(t),b=te(t),j=(h==null?void 0:h.items)||[],N=j.filter(r=>r.completed).length,C=j.length,D=(r,k)=>{s&&p.mutate({itemId:r,completed:!k})},f=async()=>{if(!(!l.trim()||!s))try{await u.mutateAsync(l.trim()),n(""),x(!1)}catch(r){console.error("Failed to add checklist item:",r)}},T=r=>{s&&b.mutate(r)},S=r=>{r.key==="Enter"?f():r.key==="Escape"&&(n(""),x(!1))};return y?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(G,{className:"w-5 h-5 animate-spin text-gray-400"})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Task Checklist",C>0&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",N,"/",C,")"]})]}),C>0&&e.jsx("div",{className:"flex-1 max-w-xs mx-3",children:e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 transition-all duration-300",style:{width:`${C>0?N/C*100:0}%`}})})})]}),e.jsxs("div",{className:"space-y-1.5",children:[j.length===0&&!a?e.jsx("p",{className:"text-sm text-gray-400 italic py-2",children:"No checklist items"}):j.map(r=>e.jsxs("div",{className:"group flex items-start gap-2 p-2 rounded-lg hover:bg-gray-50 transition-colors",onMouseEnter:()=>i(r.id),onMouseLeave:()=>i(null),children:[e.jsx("button",{onClick:()=>D(r.id,r.completed),disabled:!s||p.isPending,className:v("flex-shrink-0 mt-0.5 transition-colors",!s&&"cursor-default"),children:r.completed?e.jsx(se,{className:"w-4 h-4 text-primary-600"}):e.jsx(H,{className:"w-4 h-4 text-gray-400 hover:text-gray-600"})}),e.jsx("span",{className:v("flex-1 text-sm transition-all",r.completed?"text-gray-400 line-through":"text-gray-700"),children:r.title}),s&&g===r.id&&e.jsx("button",{onClick:()=>T(r.id),disabled:b.isPending,className:"flex-shrink-0 p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete item",children:e.jsx(U,{className:"w-3.5 h-3.5"})})]},r.id)),a?e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx(H,{className:"w-4 h-4 text-gray-300 flex-shrink-0 mt-0.5"}),e.jsx("input",{ref:o,type:"text",value:l,onChange:r=>n(r.target.value),onKeyDown:S,onBlur:()=>{l.trim()||x(!1)},placeholder:"Add item...",className:"flex-1 text-sm bg-transparent border-none focus:outline-none focus:ring-0 p-0",disabled:u.isPending}),u.isPending&&e.jsx(G,{className:"w-4 h-4 animate-spin text-gray-400"})]}):s&&e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 p-2 text-sm text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-lg transition-colors w-full",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:"Add item..."})]})]})]})}const Fe=[{value:"todo",label:"To Do",icon:M,color:"text-gray-500"},{value:"in_progress",label:"In Progress",icon:$,color:"text-blue-500"},{value:"waiting",label:"Waiting",icon:$,color:"text-yellow-500"},{value:"done",label:"Done",icon:F,color:"text-green-500"}],Me=[{value:"low",label:"Low",color:"bg-gray-100 text-gray-600"},{value:"medium",label:"Medium",color:"bg-blue-100 text-blue-700"},{value:"high",label:"High",color:"bg-yellow-100 text-yellow-700"},{value:"urgent",label:"Urgent",color:"bg-red-100 text-red-700"}];function Ue({task:t,isOpen:s,onClose:l}){const[n,a]=m.useState(!1),[x,g]=m.useState(""),[i,o]=m.useState(""),[h,y]=m.useState(!1),p=m.useRef(null),u=ae();m.useEffect(()=>{n&&p.current&&p.current.focus()},[n]);const b=X(),j=re();if(!t)return null;const N=r=>{b.mutate({id:t.id,status:r})},C=r=>{u.mutate({id:t.id,data:{priority:r}})},D=r=>{u.mutate({id:t.id,data:{due_date:r||null}})},f=()=>{x.trim()&&u.mutate({id:t.id,data:{title:x.trim(),description:i.trim()}}),a(!1)},T=()=>{g(t.title),o(t.description||""),a(!0)},S=()=>{j.mutate({id:t.id,projectId:t.project_id}),l()};return e.jsxs(le,{isOpen:s,onClose:l,title:"Task Details",width:"lg",footer:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("button",{onClick:()=>y(!0),className:"btn btn-ghost text-red-600 hover:bg-red-50",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Delete"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:l,className:"btn btn-secondary",children:"Close"})})]}),children:[t.is_overdue&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"This task is overdue"})]}),e.jsx("div",{className:"mb-6",children:n?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{ref:p,type:"text",value:x,onChange:r=>g(r.target.value),className:"input text-lg font-semibold",placeholder:"Task title"}),e.jsx("textarea",{value:i,onChange:r=>o(r.target.value),className:"textarea h-24",placeholder:"Add a description..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f,className:"btn btn-primary btn-sm",children:"Save"}),e.jsx("button",{onClick:()=>a(!1),className:"btn btn-secondary btn-sm",children:"Cancel"})]})]}):e.jsxs("div",{onClick:T,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),T())},role:"button",tabIndex:0,className:"cursor-pointer group",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 group-hover:text-primary-600",children:t.title}),t.description?e.jsx("p",{className:"mt-2 text-gray-600",children:t.description}):e.jsx("p",{className:"mt-2 text-gray-400 italic",children:"Click to add description..."})]})}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsx(Ee,{taskId:t.id,editable:!0})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(L,{icon:M,label:"Status",children:e.jsx("div",{className:"flex gap-2",children:Fe.map(r=>{const k=r.icon;return e.jsxs("button",{onClick:()=>N(r.value),className:v("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5",t.status===r.value?"bg-gray-900 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[e.jsx(k,{className:v("w-4 h-4",t.status===r.value?"text-white":r.color)}),r.label]},r.value)})})}),e.jsx(L,{icon:ve,label:"Priority",children:e.jsx("div",{className:"flex gap-2",children:Me.map(r=>e.jsx("button",{onClick:()=>C(r.value),className:v("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",t.priority===r.value?r.color+" ring-2 ring-offset-1 ring-gray-400":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:r.label},r.value))})}),e.jsxs(L,{icon:O,label:"Due Date",children:[e.jsx("input",{type:"date",value:t.due_date||"",onChange:r=>D(r.target.value),className:"input w-auto"}),t.due_date&&t.days_until_due!==null&&e.jsx("span",{className:v("ml-2 text-sm",t.is_overdue?"text-red-600":"text-gray-500"),children:Re(t.days_until_due)})]}),t.stage&&e.jsx(L,{icon:je,label:"Stage",children:e.jsx("span",{className:"badge badge-primary capitalize",children:t.stage.replace("_"," ")})}),e.jsx(L,{icon:q,label:"Type",children:e.jsx("span",{className:v("badge",t.task_type==="team"?"badge-blue":"badge-gray"),children:t.task_type_label})}),t.assignee_name&&e.jsx(L,{icon:q,label:"Assignee",children:e.jsx("span",{className:"text-gray-900",children:t.assignee_name})})]}),e.jsx("hr",{className:"my-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Related"}),e.jsxs("button",{className:"w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Attachments"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Add files to this task"})]})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors text-left",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Comments"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Add notes or comments"})]})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-400",children:["Created ",new Date(t.created_at).toLocaleDateString(),t.completed_at&&e.jsxs(e.Fragment,{children:[" • Completed ",new Date(t.completed_at).toLocaleDateString()]})]})}),h&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Task?"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:['Are you sure you want to delete "',t.title,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>y(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:S,className:"btn bg-red-600 text-white hover:bg-red-700",children:"Delete"})]})]})})]})}function L({icon:t,label:s,children:l}){return e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 w-24 flex-shrink-0 text-gray-500",children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s})]}),e.jsx("div",{className:"flex-1 flex items-center flex-wrap gap-2",children:l})]})}function Re(t){return t===0?"(Today)":t===1?"(Tomorrow)":t===-1?"(Yesterday)":t<0?`(${Math.abs(t)} days overdue)`:`(in ${t} days)`}function Ke({isOpen:t,onClose:s,projectId:l,defaultStatus:n="todo",defaultStage:a,stages:x=[]}){const[g,i]=m.useState(""),[o,h]=m.useState(""),[y,p]=m.useState(n),[u,b]=m.useState("medium"),[j,N]=m.useState(a||""),[C,D]=m.useState(""),[f,T]=m.useState("client"),S=m.useRef(null),r=oe(l);m.useEffect(()=>{t&&S.current&&S.current.focus()},[t]);const k=d=>{d.preventDefault(),g.trim()&&r.mutate({title:g.trim(),description:o.trim()||void 0,status:y,priority:u,stage:j||void 0,due_date:C||void 0,task_type:f},{onSuccess:()=>{i(""),h(""),p(n),b("medium"),N(a||""),D(""),T("client"),s()}})},c=()=>{i(""),h(""),p(n),b("medium"),N(a||""),D(""),T("client"),s()};return e.jsx(ce,{isOpen:t,onClose:c,title:"Add New Task",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:k,disabled:!g.trim()||r.isPending,className:"btn btn-primary",children:r.isPending?"Creating...":"Create Task"})]}),children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:["Task Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{ref:S,id:"title",type:"text",value:g,onChange:d=>i(d.target.value),className:"input",placeholder:"What needs to be done?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{id:"description",value:o,onChange:d=>h(d.target.value),className:"textarea h-24",placeholder:"Add more details..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status",value:y,onChange:d=>p(d.target.value),className:"select",children:[e.jsx("option",{value:"todo",children:"To Do"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"waiting",children:"Waiting"}),e.jsx("option",{value:"done",children:"Done"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs("select",{id:"priority",value:u,onChange:d=>b(d.target.value),className:"select",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stage",className:"block text-sm font-medium text-gray-700 mb-1",children:"Stage"}),e.jsxs("select",{id:"stage",value:j,onChange:d=>N(d.target.value),className:"select",children:[e.jsx("option",{value:"",children:"Select stage..."}),x.map(d=>e.jsx("option",{value:d.slug,children:d.title},d.slug))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{id:"dueDate",type:"date",value:C,onChange:d=>D(d.target.value),className:"input"})]})]}),e.jsxs("div",{role:"radiogroup","aria-labelledby":"task-type-label",children:[e.jsx("span",{id:"task-type-label",className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"taskType",value:"client",checked:f==="client",onChange:d=>T(d.target.value),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Client Task"}),e.jsx("span",{className:"text-xs text-gray-500",children:"(visible to you)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"taskType",value:"team",checked:f==="team",onChange:d=>T(d.target.value),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Team Task"}),e.jsx("span",{className:"text-xs text-gray-500",children:"(for support team)"})]})]})]})]})})}function tt(){var V;const[t,s]=m.useState("board"),[l,n]=m.useState(""),{taskFilters:a,setTaskFilters:x,resetTaskFilters:g}=de(),[i,o]=m.useState(null),[h,y]=m.useState(!1),[p,u]=m.useState(!1),[b,j]=m.useState({}),{data:N,isLoading:C}=xe(),{data:D=[],isLoading:f}=me(((V=N==null?void 0:N.project)==null?void 0:V.id)||0),T=X(),S=m.useMemo(()=>{let w=[...D];if(l){const _=l.toLowerCase();w=w.filter(z=>{var W;return z.title.toLowerCase().includes(_)||((W=z.description)==null?void 0:W.toLowerCase().includes(_))})}return a.stage&&(w=w.filter(_=>_.stage===a.stage)),a.status&&(w=w.filter(_=>_.status===a.status)),a.taskType&&(w=w.filter(_=>_.task_type===a.taskType)),w},[D,l,a]),r=w=>{o(w),y(!0)},k=(w,_)=>{T.mutate({id:w,status:_})},c=(w,_)=>{j({status:w,stage:_}),u(!0)},d=()=>{y(!1),o(null)};if(C||f)return e.jsx(Oe,{});if(!(N!=null&&N.project))return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Project Found"}),e.jsx("p",{className:"text-gray-600",children:"Please set up your relocation project first."})]})});const{project:P,stages:I}=N;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your relocation tasks across all stages"})]}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"p-4",children:e.jsx(we,{view:t,onViewChange:s,searchQuery:l,onSearchChange:n,filters:a,onFilterChange:x,onClearFilters:g,stages:I,onAddTask:()=>c(),totalTasks:D.length,filteredTasks:S.length})})}),t==="board"?e.jsx(Pe,{tasks:S,onTaskClick:r,onStatusChange:k,onAddTask:w=>c(w)}):e.jsx(Ce,{tasks:S,groupBy:"stage",onTaskClick:r,onStatusChange:k,onAddTask:w=>c(void 0,w)}),S.length===0&&D.length>0&&e.jsxs("div",{className:"card p-8 text-center mt-6",children:[e.jsx("p",{className:"text-gray-500",children:"No tasks match your filters"}),e.jsx("button",{onClick:g,className:"mt-2 text-primary-600 hover:text-primary-700",children:"Clear filters"})]}),D.length===0&&e.jsxs("div",{className:"card p-12 text-center mt-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No tasks yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first task to start tracking your relocation progress"}),e.jsx("button",{onClick:()=>c(),className:"btn btn-primary",children:"Create Your First Task"})]}),e.jsx(Ue,{task:i,isOpen:h,onClose:d}),e.jsx(Ke,{isOpen:p,onClose:()=>u(!1),projectId:P.id,defaultStatus:b.status,defaultStage:b.stage,stages:I})]})}function Oe(){return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"h-12 bg-gray-200 rounded-lg animate-pulse mb-6 w-48"}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"h-10 bg-gray-200 rounded-lg animate-pulse"})})}),e.jsx("div",{className:"flex gap-4",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"w-80 flex-shrink-0",children:[e.jsx("div",{className:"h-12 bg-gray-200 rounded-t-xl animate-pulse"}),e.jsx("div",{className:"bg-gray-100 rounded-b-xl p-4 space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-lg animate-pulse"},s))})]},t))})]})}export{tt as default};
